{"version":3,"sources":["../../../../../node_modules/tslib/tslib.es6.js","ng://@nationallibraryofnorway/ngx-mime/lib/core/intl/help-intl.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/viewer-layout.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/viewer-mode.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/intl/viewer-intl.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/intl/help-intl.no_nb.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/intl/viewer-intl.no_nb.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/intl/help-intl.lt.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/intl/viewer-intl.lt.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/viewing-direction.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/mime-viewer-config.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/manifest.ts","ng://@nationallibraryofnorway/ngx-mime/lib/shared/mime-material.module.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/spinner-service/spinner.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/shared/shared.module.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/modeChanges.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/mode-service/mode.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/viewer-options.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/rect.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/canvas-group-position/calculate-canvas-group-position-utils.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/canvas-group-position/one-page-calculate-page-position-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/canvas-group-position/two-page-calculate-page-position-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/canvas-group-position/calculate-canvas-group-position-factory.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/canvas-groups.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/canvas-service/canvas-group.strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/canvas-service/canvas-groups-strategy.factory.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/canvas-service/canvas-service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/click-service/click.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/hit.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/controlAnchor.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/search-result.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/search-result.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/iiif-content-search-service/iiif-content-search.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/iiif-manifest-service/iiif-manifest-utils.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/gestureSettings.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/options.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/side.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/pinchStatus.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/direction.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/style-service/style.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-layout-service/viewer-layout-service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/navigator-calculate-next-canvas-group-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/dashboard-mode-calculate-next-canvas-group-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/page-mode-calculate-next-canvas-group-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/page-zoomed-mode-calculate-next-canvas-group-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/calculate-next-canvas-group-factory.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/canvas-group-mask.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/go-to-canvas-group-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/swipe-drag-end-counter.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/swipe-utils.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/iiif-tile-source-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/static-image-tile-source-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/tile-source-strategy-factory.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/dimensions.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/utils.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/zoom-utils.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/zoom-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/viewer-service/viewer.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/ext/svg-overlay.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/builder-utils.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/sizes.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/tiles.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/service.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/resource.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/images.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/canvas.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/sequence.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/metadata.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/structure.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/tile-source.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/builders/manifest.builder.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/iiif-manifest-service/iiif-manifest-service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/fullscreen-service/fullscreen.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/mime-dom-helper.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/mime-resize-service/mime-resize.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/content-search-dialog/content-search-dialog.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/content-search-dialog/content-search-dialog-config-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/content-search-dialog/content-search-dialog-config-strategy-factory.ts","ng://@nationallibraryofnorway/ngx-mime/lib/content-search-dialog/content-search-dialog.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/contents-dialog/contents-dialog.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/contents-dialog/contents-dialog-config-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/contents-dialog/contents-dialog-config-strategy-factory.ts","ng://@nationallibraryofnorway/ngx-mime/lib/contents-dialog/contents-dialog.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/AccessKeys.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/navigation/content-search-navigation-service/content-search-navigation.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/access-keys-handler-service/access-keys.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/attribution-dialog/attribution-dialog-resize.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/attribution-dialog/attribution-dialog.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/attribution-dialog/attribution-dialog.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/attribution-dialog/attribution-dialog.module.ts","ng://@nationallibraryofnorway/ngx-mime/lib/canvas-group-dialog/canvas-group-dialog.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/canvas-group-dialog/canvas-group-dialog.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/canvas-group-dialog/canvas-group-dialog.module.ts","ng://@nationallibraryofnorway/ngx-mime/lib/content-search-dialog/content-search-dialog.module.ts","ng://@nationallibraryofnorway/ngx-mime/lib/help-dialog/help-dialog.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/help-dialog/help-dialog-config-strategy.ts","ng://@nationallibraryofnorway/ngx-mime/lib/help-dialog/help-dialog-config-strategy-factory.ts","ng://@nationallibraryofnorway/ngx-mime/lib/help-dialog/help-dialog.service.ts","ng://@nationallibraryofnorway/ngx-mime/lib/help-dialog/help-dialog.module.ts","ng://@nationallibraryofnorway/ngx-mime/lib/contents-dialog/metadata/metadata.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/contents-dialog/table-of-contents/table-of-contents.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/contents-dialog/contents-dialog.module.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/core.module.ts","ng://@nationallibraryofnorway/ngx-mime/lib/viewer/osd-toolbar/osd-toolbar.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/viewer/viewer-footer/canvas-group-navigator/canvas-group-navigator.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/viewer/viewer-footer/content-search-navigator/content-search-navigator.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/viewer/viewer-footer/viewer-footer.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/viewer/viewer-header/icon/icon.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/viewer/viewer-header/viewer-header.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/viewer/viewer-spinner/viewer-spinner.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/content-dialog-state.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/contents-search-dialog-state.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/help-dialog-state.ts","ng://@nationallibraryofnorway/ngx-mime/lib/core/models/viewerState.ts","ng://@nationallibraryofnorway/ngx-mime/lib/viewer/viewer.component.ts","ng://@nationallibraryofnorway/ngx-mime/lib/ngx-mime.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__decorate","decorators","target","key","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__values","o","Symbol","iterator","m","next","value","done","TypeError","ViewerLayout","ViewerMode","HelpIntl","helpLabel","line1","line2","line3","line4","line5","line6","line7","line8","line9","line10","MimeViewerIntl","changes","Subject","help","closeLabel","attributionLabel","attributonCloseAriaLabel","contentsLabel","twoPageViewLabel","singlePageViewLabel","metadataLabel","licenseLabel","tocLabel","fullScreenLabel","exitFullScreenLabel","zoomInLabel","zoomOutLabel","previousPageLabel","nextPageLabel","homeLabel","rotateCwLabel","searchLabel","clearSearchLabel","previousHitLabel","nextHitLabel","goToPageLabel","currentPageLabel","enterPageNumber","dropDisabled","somethingHasGoneWrongLabel","manifestUriMissingLabel","manifestNotValidLabel","pageDoesNotExists","noResultsFoundLabel","q","resultsFoundLabel","numberOfHits","currentHitLabel","currentHit","Injectable","HelpIntlNoNb","_super","_this","MimeViewerIntlNoNb","HelpIntlLt","MimeViewerIntlLt","ViewingDirection","fields","attributionDialogEnabled","attributionDialogHideTimeout","navigationControlEnabled","initViewerMode","PAGE","initViewerLayout","TWO_PAGE","withCredentials","loadTilesWithAjax","crossOriginPolicy","ajaxHeaders","preserveZoomOnCanvasGroupChange","startOnTopOnCanvasGroupChange","isDropEnabled","undefined","viewingDirection","LTR","structures","context","type","id","label","metadata","license","logo","attribution","service","sequences","tileSource","viewingHint","Metadata","Sequence","canvases","Canvas","thumbnail","height","width","images","Images","motivation","resource","on","Resource","format","Service","protocol","sizes","tiles","profile","physicalScale","physicalUnits","Size","Tile","scaleFactors","Structure","canvasIndex","MimeMaterialModule","NgModule","exports","MatToolbarModule","MatButtonModule","MatIconModule","MatTooltipModule","MatDialogModule","MatTabsModule","MatListModule","MatSliderModule","MatProgressSpinnerModule","MatInputModule","MatProgressBarModule","MatCardModule","MatSnackBarModule","SpinnerService","spinnerSubject","spinnerState","asObservable","show","hide","SharedModule","imports","CommonModule","FormsModule","ReactiveFormsModule","FlexLayoutModule","providers","ModeChanges","currentValue","previousValue","ModeService","toggleModeSubject","ReplaySubject","modeChanges","pipe","distinctUntilChanged","_mode","mode","change","_initialMode","toggleMode","DASHBOARD","PAGE_ZOOMED","ViewerOptions","zoom","zoomFactor","dblClickZoomFactor","pinchZoomThreshold","pan","swipeDirectionThreshold","transitions","toolbarsEaseInTime","toolbarsEaseOutTime","OSDAnimationTime","overlays","canvasGroupMarginInDashboardView","canvasGroupMarginInPageView","padding","header","footer","colors","canvasGroupBackgroundColor","Rect","x","y","centerX","centerY","canvasRectFromCriteria","rotation","criteria","rect","canvasSource","OnePageCalculatePagePositionStrategy","calculateCanvasGroupPosition","canvasGroupIndex","calculateLtrX","calculateRtlX","previousCanvasGroupPosition","TwoPageCalculateCanvasGroupPositionStrategy","calculateEvenLtrX","calculateEvenRtlX","calculateOddLtrX","calculateOddRtlX","CalculateCanvasGroupPositionFactory","viewerLayout","paged","ONE_PAGE","CanvasGroups","canvasGroupRects","canvasRects","canvasesPerCanvasGroup","add","push","addRange","rects","get","index","findClosestIndex","point","lastDelta","some","delta","Math","abs","getMaxHeight","max","map","getMaxWidth","OneCanvasPerCanvasGroupStrategy","addAll","canvasGroups","TwoCanvasPerCanvasGroupStrategy","thisRect","nextRect","groupedRect","min","CanvasGroupStrategyFactory","layout","CanvasService","_currentNumberOfCanvasGroups","BehaviorSubject","_currentCanvasGroupIndex","_numberOfCanvases","numberOfCanvases","canvasGroupStrategy","reset","currentCanvasGroupIndex","isWithinBounds","numberOfCanvasGroups","isCurrentCanvasGroupValid","getNextCanvasGroupIndex","getPrevCanvasGroupIndex","constrainToRange","canvasGroupsIndex","findClosestCanvasGroupIndex","findCanvasGroupByCanvasIndex","findIndex","canvasForCanvasGroup","indexOf","findCanvasByCanvasIndex","getCanvasGroupLabel","canvasGroup","canvasGroupLabel","getCanvasesPerCanvasGroup","getCanvasRect","getCurrentCanvasGroupRect","getCanvasGroupRect","ClickService","clickCount","click","event","preventDefaultAction","quick","dblClickTimeOut","setTimeout","triggerSingleClick","tracker","dblClickTimeThreshold","clearTimeout","triggerDoubleClick","singleClickHandlers","doubleClickHandlers","addSingleClickHandler","singleClickHandler","addDoubleClickHandler","doubleClickHandler","forEach","handler","ControlAnchor","Hit","match","before","after","SearchResult","hits","hit","size","last","SearchResultBuilder","manifest","iiifSearchResult","build","searchResult","resources","findResources","resources_1","resources_1_1","findSequenceIndex","findLabel","coords","substring","split","parseInt","annotation","res","this_1","find","_b","annotations","_c","firstSequence","IiifContentSearchService","http","_currentSearchResult","_searching","_currentQ","_selected","destroy","search","finalize","subscribe","extractData","err","handleError","selected","errMsg","error","Error","message","throwError","HttpClient","ManifestUtils","isManifestPaged","GestureSettings","scrollToZoom","clickToZoom","dblClickToZoom","pinchToZoom","flickEnabled","flickMinSpeed","flickMomentum","pinchRotate","GestureSettingsMouse","GestureSettingsTouch","GestureSettingsPen","GestureSettingsUnknown","Side","Options","tileSources","tabIndex","xmlPath","prefixUrl","debugMode","debugGridColor","blendTime","alwaysBlend","autoHideControls","immediateRender","defaultZoomLevel","opacity","compositeOperation","placeholderFillStyle","degrees","minZoomLevel","maxZoomLevel","homeFillsViewer","panHorizontal","panVertical","constrainDuringPan","wrapHorizontal","wrapVertical","minZoomImageRatio","maxZoomPixelRatio","smoothTileEdgesMinZoom","iOSDevice","autoResize","preserveImageSizeOnResize","minScrollDeltaTime","pixelsPerWheelLine","visibilityRatio","viewportMargins","imageLoaderLimit","clickTimeThreshold","clickDistThreshold","dblClickDistThreshold","springStiffness","animationTime","gestureSettingsMouse","gestureSettingsTouch","gestureSettingsPen","gestureSettingsUnknown","zoomPerClick","zoomPerScroll","zoomPerSecond","showNavigator","navigatorPosition","navigatorSizeRatio","navigatorMaintainSizeRatio","navigatorTop","navigatorLeft","navigatorHeight","navigatorWidth","navigatorAutoResize","navigatorAutoFade","navigatorRotate","controlsFadeDelay","controlsFadeLength","maxImageCacheCount","timeout","useCanvas","minPixelRatio","mouseNavEnabled","showNavigationControl","navigationControlAnchor","TOP_LEFT","showZoomControl","showHomeControl","showFullPageControl","showRotationControl","showSequenceControl","sequenceControlAnchor","navPrevNextWrap","zoomInButton","zoomOutButton","homeButton","previousButton","nextButton","sequenceMode","initialPage","preserveViewport","preserveOverlays","showReferenceStrip","referenceStripScroll","referenceStripElement","referenceStripHeight","referenceStripWidth","referenceStripPosition","referenceStripSizeRatio","collectionMode","collectionRows","collectionColumns","collectionLayout","collectionTileSize","collectionTileMargin","ajaxWithCredentials","PinchStatus","active","previousGestureId","shouldStop","Direction","StyleService","zone","colorSubject","filter","init","runOutsideAngular","interval","tap","previousRgbColor","currentRgbColor","getComputedBackgroundColor","convertToRgba","rgbColor","replace","matAppBackground","document","getElementsByClassName","matSidenavContainer","getElementsByTagName","getComputedStyle","el","property","window","getPropertyValue","NgZone","providedIn","ViewerLayoutService","mediaObserver","mimeConfig","MimeViewerConfig","subject","isPagedManifest","isMobile","_layout","setLayout","toggle","isActive","MediaObserver","NavigatorCalculateNextCanvasGroupStrategy","calculateNextCanvasGroup","direction","nextCanvasGroup","NEXT","DashboardModeCalculateNextCanvasGroupStrategy","speed","currentCanvasGroupCenter","canvasGroupDelta","calculateNumberOfCanvasGroupsToGo","LEFT","PageModeCalculateNextCanvasGroupStrategy","isNewCanvasGroupInCenter","diff","PageZoomedModeCalculateNextCanvasGroupStrategy","canvasGroupEndHitCountReached","CalculateNextCanvasGroupFactory","CanvasGroupMask","viewer","styleService","disableResize","destroyed","animationHandler","resize","resizeHandler","setCenter","canvasGroupPinchHandler","canvasGroupDragHandler","e","canvasGroupDragEndHandler","onChange","takeUntil","backgroundColor","leftMask","style","rightMask","initialise","pageBounds","visible","canvasGroupRect","addCanvasGroupMask","complete","changeCanvasGroup","addHandlers","attr","removeHandlers","addHandler","removeHandler","mask","d3.select","svgOverlay","node","parentNode","append","center","OpenSeadragon.Point","viewport","_containerInnerSize","leftMaskRect","getLeftMaskRect","rightMaskRect","getRightMaskRect","round","imgBounds","OpenSeadragon.Rect","viewportToViewerElementCoordinates","getTopLeft","topRight","getTopRight","DefaultGoToCanvasGroupStrategy","zoomStrategy","canvasService","modeService","config","goToCanvasGroup","oldCanvasGroupIndex","newCanvasGroup","canvasGroupIndexes","previousCanvasIndex","previousCanvasRect","leftX","rightX","getViewportBounds","getViewportCenter","panTo","immediately","oldCanvasGroupCenter","panToCenter","goToHomeZoom","goToPreviousCanvasGroup","currentCanvasIndex","viewportCenter","newCanvasGroupIndex","PREVIOUS","goToNextCanvasGroup","centerCurrentCanvas","canvas","getCenter","getBounds","SwipeDragEndCounter","leftCount","rightCount","addHit","side","dir","incrementSide","clearOppositeSideOfDragDirection","hitCountReached","RIGHT","SwipeUtils","getSwipeDirection","start","end","useThreshold","deltaX","deltaY","getSideIfPanningPastEndOfCanvasGroup","vpBounds","isPanningOutsideLeft","isPanningOutsideRight","isPanningOutsideCanvasGroup","isDirectionInRightSemicircle","PI","isDirectionInLeftSemicircle","IiifTileSourceStrategy","getTileSource","startsWith","location","endsWith","StaticImageTileSourceStrategy","url","TileSourceStrategyFactory","Dimensions","bottom","left","right","top","Utils","numbersAreClose","thing","realThing","epsilon","shortenDecimals","precision","short","Number","toPrecision","ZoomUtils","constrainPositionToCanvasGroup","canvasGroupBounds","constraintZoomFactor","currentZoom","maxZoom","DefaultZoomStrategy","viewerLayoutService","ZoomStrategy","setMinZoom","getHomeZoomLevel","getMinZoom","getMaxZoom","getZoom","zoomTo","level","position","canvasGroupHeight","canvasGroupWidth","viewportBounds","getDashboardViewportBounds","currentCanvasGroupRect","getFittedZoomLevel","zoomIn","pointFromPixel","zoomBy","zoomOut","pow","isViewportLargerThanCanvasGroup","homeZoomFactor","getHomeZoomFactor","maxViewportDimensions","d3\n            .select","container","getBoundingClientRect","viewportHeight","viewportWidth","viewportSizeInViewportCoordinates","deltaPointsFromPixels","resizeRatio","canvasGroupRec","pbWidth","pbHeight","vpWidth","getDashboardZoomHomeFactor","ViewerService","clickService","iiifContentSearchService","subscriptions","isCanvasPressed","currentCenter","osdIsReady","swipeDragEndCounter","pinchStatus","scrollHandler","scroll","zoomInGesture","zoomOutGesture","pinchHandler","distance","lastDistance","zoomInPinchGesture","zoomOutPinchGesture","originalEvent","tileIndex","getOverlayIndexFromClickEvent","requestedCanvasGroupIndex","dblClickHandler","dragHandler","pannedPastCanvasGroup","getViewer","getTilesources","getOverlays","home","getValue","goToCanvasGroupStrategy","goToCanvas","highlight","clearHightlight","currentSearch","_d","_e","e_2","_f","canvasRect","svgNode","highlightCurrentHit","selectAll","remove","setUpViewer","OpenSeadragon","Viewer","getOptions","svgNS","Overlay","self","_viewer","_containerWidth","_containerHeight","_svg","createElementNS","appendChild","_node","evt","clientWidth","setAttribute","clientHeight","pixelFromPoint","Point","getRotation","scale","onClick","MouseTracker","element","clickHandler","setTracking","_svgOverlayInfo","console","createSvgOverlay","defaultKeyDownHandler","innerTracker","keyDownHandler","disableKeyDownHandler","keyHandler","canvasGroupMask","addToWindow","setupOverlays","createOverlays","addEvents","addSubscriptions","modeChanged","onCenterChange","sample","calculateCurrentCanvasGroup","onCanvasGroupIndexChange","onOsdReadyChange","state","initialCanvasGroupLoaded","layoutPages","onSelected","openSeadragonViewer","resetKeyDownHandler","layoutSwitch","isOpen","dragStartPosition","swipeToCanvasGroup","rotate","toggleToDashboard","toggleToPage","gestureId","gesturePoints","isCanvasGroupHit","SVGRectElement","calculateCanvasGroupPositionStrategy","isTwoPageView","group","tile","bounds","addTiledImage","fitBounds","currentOverlay","noLeftStrokeStyle","noRightStrokeStyle","currentOverlayNode","transition","duration","requestedCanvasGroup","options","pannedPastSide","dragEndPosision","isCanvasGroupZoomed","calculateNextCanvasGroupStrategy","BuilderUtils","extractId","extracType","extractContext","extractViewingDirection","RTL","findCanvasIndex","SizesBuilder","TilesBuilder","ServiceBuilder","ResourceBuilder","ImagesBuilder","image","CanvasBuilder","SequenceBuilder","seq","MetadataBuilder","metadatas","data","StructureBuilder","structure","TileSourceBuilder","tilesources","ManifestBuilder","Manifest","IiifManifestService","intl","spinnerService","_currentManifest","_errorMessage","load","manifestUri","response","isManifestValid","resetCurrentManifest","resetErrorMessage","FullscreenService","changeSubject","onchange","isEnabled","fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled","isFullscreen","fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement","closeFullscreen","openFullscreen","func","addEventListener","elem","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","MimeDomHelper","fullscreen","isDocumentInFullScreenMode","nativeElement","nodeName","createFullscreenDimensions","createDimensions","toggleFullscreen","getElementById","setFocusOnViewer","focus","dimensions","getFullscreenWidth","getFullscreenHeight","innerWidth","documentElement","body","innerHeight","MimeResizeService","mimeDomHelper","resizeSubject","_el","markForCheck","ContentSearchDialogComponent","dialogRef","mimeResizeService","iiifManifestService","isSearching","tabHeight","mimeHeight","ngOnInit","onResize","resizeTabHeight","currentManifest","sr","resultContainer","qEl","scrollCurrentHitIntoView","ngAfterViewInit","ngOnDestroy","onSubmit","preventDefault","clear","goToHit","close","maxHeight","take","findSelected","selectedHit","hitList","selectedList","item","MatDialogRef","ElementRef","ViewChild","static","ViewChildren","read","HostListener","Component","selector","template","MobileContentSearchDialogConfigStrategy","getConfig","elementRef","hasBackdrop","disableClose","autoFocus","panelClass","DesktopContentSearchDialogConfigStrategy","getPosition","dialogWidth","paddingRight","ContentSearchDialogConfigStrategyFactory","ContentSearchDialogService","dialog","contentSearchDialogConfigStrategyFactory","isContentSearchDialogOpen","initialize","getDialogConfig","updatePosition","updateSize","open","afterClosed","result","MatDialog","ContentsDialogComponent","changeDetectorRef","showToc","selectedIndex","detectChanges","onCanvasChanged","ChangeDetectorRef","changeDetection","ChangeDetectionStrategy","OnPush","MobileContentsDialogConfigStrategy","DesktopContentsDialogConfigStrategy","ContentsDialogConfigStrategyFactory","ContentsDialogService","contentsDialogConfigStrategyFactory","isContentsDialogOpen","componentInstance","getSelectedIndex","AccessKeys","altKey","shiftKey","ctrlkey","keyCode","ctrlKey","isArrowRightKeys","isMultiKeys","arrayContainsKeys","ARROWRIGHT","isArrowLeftKeys","ARROWLEFT","isPageUpKeys","PAGEUP","isPageDownKeys","PAGEDOWN","isFirstCanvasGroupKeys","firstCanvasGroupCodes","isLastCanvasGroupKeys","lastCanvasGroupCodes","isSliderKeys","isZoomInKeys","zoomInCodes","isZoomOutKeys","zoomOutCodes","isZoomHomeKeys","zoomHomeCodes","isNextHitKeys","nextHit","isPreviousHitKeys","previousHit","isSearchDialogKeys","toggleSearchDialogCodes","isContentsDialogKeys","toggleContentsDialogCodes","isFullscreenKeys","toggleFullscreenCodes","isResetSearchKeys","isShiftPressed","resetSearch","isRotateKeys","rotateCwCodes","keys","ContentSearchNavigationService","currentIndex","isHitOnActiveCanvasGroup","_isFirstHitOnCanvasGroup","_isLastHitOnCanvasGroup","update","findCurrentHitIndex","findHitOnActiveCanvasGroup","isFirstHitOnCanvasGroup","findLastHitOnCanvasGroup","getCurrentIndex","getHitOnActiveCanvasGroup","getFirstHitCanvasGroup","getLastHitCanvasGroup","goToNextCanvasGroupHit","current","lastCanvasGroupIndex_1","getLastCanvasGroupIndex","h","goToCanvasIndex","goToPreviousCanvasGroupHit","previousIndex","findFirstHitOnCanvasGroup","lastCanvasIndex","leftCanvas","leftCanvasHit","rightCanvas_1","phit_1","AccessKeysService","viewerService","contentSearchDialogService","contentsDialogService","contentSearchNavigationService","isSearchable","hasHits","disabledKeys","invert","isManifestSearchable","handleKeyEvents","accessKeys","isKeyDisabled","isZoomedIn","goToFirstCanvasGroup","goToLastCanvasGroup","goToNextHit","goToPreviousHit","toggleSearchDialog","toggleContentsDialog","zoomHome","rotateClockWise","updateDisabledKeys","resetDisabledKeys","disableKeysForContentDialog","diableKeysForContentSearchDialog","concat","AttributionDialogResizeService","AttributionDialogComponent","renderer","attributionDialogResizeService","accessKeysHandlerService","backgroundRgbaColor","setStyle","handleKeys","ngAfterViewChecked","Renderer2","AttributionDialogService","isAttributionDialogOpen","attributionDialogHeight","closeDialogAfter","seconds","restoreFocus","AttributionDialogModule","declarations","entryComponents","CanvasGroupDialogComponent","fb","createForm","canvasGroupControl","FormControl","Validators","required","canvasGroupForm","valid","pageNumber","FormBuilder","CanvasGroupDialogService","isCanvasGroupDialogOpen","CanvasGroupDialogModule","ContentSearchDialogModule","HelpDialogComponent","MobileHelpDialogConfigStrategy","DesktopHelpDialogConfigStrategy","HelpDialogConfigStrategyFactory","HelpDialogService","helpDialogConfigStrategyFactory","isHelpDialogOpen","HelpDialogModule","MetadataComponent","TocComponent","canvasChanged","EventEmitter","emit","Output","ContentsDialogModule","provide","ErrorStateMatcher","useClass","ShowOnDirtyErrorStateMatcher","CoreModule","OsdToolbarComponent","mimeService","osdToolbarStyle","isFirstCanvasGroup","isOnFirstCanvasGroup","isLastCanvasGroup","isOnLastCanvasGroup","HostBinding","animations","trigger","transform","display","animate","CanvasGroupNavigatorComponent","pageDialogService","currentSliderCanvasGroupIndex","onNumberOfCanvasGroupsChange","onSliderChange","onSliderHotKey","stopPropagation","openCanvasGroupDialog","Input","ContentSearchNavigatorComponent","isFirstCanvasGroupHit","isLastCanvasGroupHit","ViewerFooterComponent","showNavigationToolbar","showPageNavigator","showContentSearchNavigator","mediaSubscription","unsubscribe","ViewContainerRef","IconComponent","ViewerHeaderComponent","helpDialogService","fullscreenService","isContentSearchEnabled","isFullscreenEnabled","isInFullscreen","fullscreenLabel","toggleContents","toggleSearch","toggleHelp","isInFullScreen","toggleViewerLayout","setLayoutOnePage","setLayoutTwoPage","Default","ViewerSpinnerComponent","spinnerSub","ContentDialogState","ContentsSearchDialogState","HelpDialogState","ViewerState","contentDialogState","contentsSearchDialogState","helpDialogState","ViewerComponent","snackBar","attributionDialogService","viewerModeChanged","qChanged","manifestChanged","viewerState","errorMessage","mimeHeaderBefore","mimeHeaderAfter","mimeFooterBefore","mimeFooterAfter","initialMode","onQChange","toggleToolbarsState","run","throttle","val","loadManifest","ngOnChanges","manifestUriIsChanged","qIsChanged","canvasIndexChanged","qChanges","isFirstChange","firstChange","canvasIndexChanges","manifestUriChanges","onDrop","dataTransfer","getData","params","URL","searchParams","startCanvasId_1","onDragOver","onDragLeave","cleanup","osdToolbar","setClasses","mode-page","mode-page-zoomed","mode-dashboard","layout-one-page","layout-two-page","canvas-pressed","MatSnackBar","MimeModule"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export class HelpIntl {\n  helpLabel = 'Help';\n  line1 = '<strong>ARROW LEFT</strong> or <strong>PAGE UP</strong>: Previous page';\n  line2 = '<strong>ARROW RIGHT</strong> or <strong>PAGE DOWN</strong>: Next page';\n  line3 = '<strong>HOME</strong>: Go to first page';\n  line4 = '<strong>END</strong>: Go to last page';\n  line5 = '<strong>C</strong>: Contents window with more information/metadata about the object. (Close with <strong>ESC</strong>.)';\n  line6 = '<strong>S</strong>: Search inside the object. (Close with <strong>ESC</strong>.)';\n  line7 = '<strong>N</strong>: Next result';\n  line8 = '<strong>P</strong>: Previous result';\n  line9 = '<strong>F</strong>: Fullscreen on/off (Close with <strong>F</strong> or <strong>ESC</strong>.)';\n  line10 = '<strong>R</strong>: Rotate 90°';\n}\n","export enum ViewerLayout {\n  ONE_PAGE,\n  TWO_PAGE\n}\n","export enum ViewerMode {\n  DASHBOARD,\n  PAGE,\n  PAGE_ZOOMED\n}\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { HelpIntl } from './help-intl';\n\n@Injectable()\nexport class MimeViewerIntl {\n  changes: Subject<void> = new Subject<void>();\n\n  help: HelpIntl = new HelpIntl();\n  closeLabel = 'Close';\n  attributionLabel = 'Attribution';\n  attributonCloseAriaLabel = 'Close attribution dialog';\n  contentsLabel = 'Contents';\n  twoPageViewLabel = 'Two page display';\n  singlePageViewLabel = 'Single page display';\n  metadataLabel = 'Metadata';\n  licenseLabel = 'License';\n  tocLabel = 'Table of Contents';\n  fullScreenLabel = 'Full screen';\n  exitFullScreenLabel = 'Exit full screen';\n  zoomInLabel = 'Zoom in';\n  zoomOutLabel = 'Zoom out';\n  previousPageLabel = 'Previous Page';\n  nextPageLabel = 'Next Page';\n  homeLabel = 'Go Home';\n  rotateCwLabel = 'Rotate 90°';\n  searchLabel = 'Search';\n  clearSearchLabel = 'Clear';\n  previousHitLabel = 'Previous Hit';\n  nextHitLabel = 'Next Hit';\n  goToPageLabel = 'Go to page';\n  currentPageLabel = 'Current page';\n  enterPageNumber = 'Enter page number';\n  dropDisabled = 'Sorry, but drag and drop is disabled';\n\n  // ERRORS\n  somethingHasGoneWrongLabel = 'Oh dear, something has gone terribly wrong...';\n  manifestUriMissingLabel = 'ManifestUri is missing';\n  manifestNotValidLabel = 'Manifest is not valid';\n  pageDoesNotExists = 'Sorry, that page does not exist';\n\n  noResultsFoundLabel = (q: string) => {\n    return `No results found for <em class=\"current-search\">${q}</em>`;\n  };\n\n  resultsFoundLabel = (numberOfHits: number, q: string) => {\n    return `${numberOfHits} results found for <em class=\"current-search\">${q}</em>`;\n  };\n\n  currentHitLabel = (currentHit: number, numberOfHits: number) => {\n    return `${currentHit} of ${numberOfHits} hits`;\n  };\n}\n","import { HelpIntl } from './help-intl';\n\nexport class HelpIntlNoNb extends HelpIntl {\n  helpLabel = 'Hjelp';\n  line1 = '<strong>PIL VENSTRE</strong> eller <strong>PAGE UP</strong>: Gå til forrige side';\n  line2 = '<strong>PIL HØYRE</strong> eller <strong>PAGE DOWN</strong>: Gå til neste side';\n  line3 = '<strong>HOME</strong>: Gå til første side';\n  line4 = '<strong>END</strong>: Gå til siste side';\n  line5 = '<strong>C</strong>: Slår innholdsfanen på, og viser mer informasjon/metadata om objektet. (Lukk med <strong>ESC</strong>-tasten.)';\n  line6 = '<strong>S</strong>: Åpner søkefeltet for søk i objektet. (Lukk med <strong>ESC</strong>-tasten.)';\n  line7 = '<strong>N</strong>: Går til neste treff i objektet';\n  line8 = '<strong>P</strong>: Går til forrige treff i objektet';\n  line9 = '<strong>F</strong>: Fullskjerm av og på (Lukk med <strong>F</strong> eller <strong>ESC</strong>-tasten.)';\n  line10 = '<strong>R</strong>: Rotér 90°';\n}\n\n","import { Injectable } from '@angular/core';\nimport { MimeViewerIntl } from './viewer-intl';\nimport { HelpIntlNoNb } from './help-intl.no_nb';\n\n@Injectable()\nexport class MimeViewerIntlNoNb extends MimeViewerIntl {\n  help = new HelpIntlNoNb();\n  closeLabel = 'Lukk';\n  attributionLabel = 'Tillatelse';\n  attributonCloseAriaLabel = 'Steng tillatelse dialog';\n  contentsLabel = 'Innhold';\n  twoPageViewLabel = 'Tosidevisning';\n  singlePageViewLabel = 'Enkeltsidevisning';\n  metadataLabel = 'Metadata';\n  licenseLabel = 'Lisens';\n  tocLabel = 'Innholdsfortegnelse';\n  fullScreenLabel = 'Fullskjerm';\n  exitFullScreenLabel = 'Avslutt fullskjerm';\n  zoomInLabel = 'Zoom inn';\n  zoomOutLabel = 'Zoom ut';\n  previousPageLabel = 'Forrige side';\n  nextPageLabel = 'Neste side';\n  homeLabel = 'Hjem';\n  rotateCwLabel = 'Rotér 90°';\n  searchLabel = 'Søk';\n  clearSearchLabel = 'Tøm';\n  previousHitLabel = 'Forrige treff';\n  nextHitLabel = 'Neste treff';\n  goToPageLabel = 'Gå til side';\n  currentPageLabel = 'Nåværende side';\n  enterPageNumber = 'Skriv inn sidenummer';\n  dropDisabled = 'Beklager, men drag and drop er ikke aktivert';\n\n  // ERRORS\n  somethingHasGoneWrongLabel = 'Å nei! Noe har gått galt...';\n  manifestUriMissingLabel = 'Lenke til manifest mangler';\n  manifestNotValidLabel = 'Manifestet er ikke gyldig';\n  pageDoesNotExists = 'Beklager, men den siden finnes ikke';\n\n  noResultsFoundLabel = (q: string) => {\n    return `Ingen treff funnet for <em class=\"current-search\">${q}</em>`;\n  };\n\n  resultsFoundLabel = (numberOfHits: number, q: string) => {\n    return `${numberOfHits} treff funnet for <em class=\"current-search\">${q}</em>`;\n  };\n\n  currentHitLabel = (currentHit: number, numberOfHits: number) => {\n    return `${currentHit} av ${numberOfHits} treff`;\n  };\n}\n","import { HelpIntl } from './help-intl';\n\nexport class HelpIntlLt extends HelpIntl {\n  helpLabel = 'Pagalba';\n  line1 =\n    '<strong>RODYKLĖ KAIRĖN</strong> arba <strong>PAGE UP</strong>: Buvęs puslapis';\n  line2 =\n    '<strong>RODYKLĖ DEŠINĖN</strong> arba <strong>PAGE DOWN</strong>: Kitas puslapis';\n  line3 = '<strong>HOME</strong>: Pirmas puslapis';\n  line4 = '<strong>END</strong>: Paskutinis puslapis';\n  line5 =\n    '<strong>C</strong>: Turinio langas su daugiau informacijos apie objektą. (Uždaromas paspaudus <strong>ESC</strong>.)';\n  line6 =\n    '<strong>S</strong>: Paieška objekto viduje. (Uždaroma paspaudus <strong>ESC</strong>.)';\n  line7 = '<strong>N</strong>: Kitas rezultatas';\n  line8 = '<strong>P</strong>: Buvęs rezultatas';\n  line9 =\n    '<strong>F</strong>: Pilno ekrano režimas (Uždaroma paspaudus <strong>F</strong> arba <strong>ESC</strong>.)';\n  line10 = '<strong>R</strong>: Pasukti 90 laipsnių';\n}\n","import { Injectable } from '@angular/core';\nimport { MimeViewerIntl } from './viewer-intl';\nimport { HelpIntlLt } from './help-intl.lt';\n\n@Injectable()\nexport class MimeViewerIntlLt extends MimeViewerIntl {\n  help = new HelpIntlLt();\n  closeLabel = 'Uždaryti';\n  attributionLabel = 'Teisių priskyrimas';\n  attributonCloseAriaLabel = 'Uždaryti teisių priskyrimo langą';\n  contentsLabel = 'Informacija apie objektą';\n  twoPageViewLabel = 'Atvaizduoti po du puslapius';\n  singlePageViewLabel = 'Atvaizduoti po vieną puslapį';\n  metadataLabel = 'Metaduomenys';\n  licenseLabel = 'Licencija';\n  tocLabel = 'Turinys';\n  fullScreenLabel = 'Pilno ekrano režimas';\n  exitFullScreenLabel = 'Išeiti iš pilno ekrano režimo';\n  zoomInLabel = 'Priartinti';\n  zoomOutLabel = 'Atitolinti';\n  previousPageLabel = 'Buvęs puslapis';\n  nextPageLabel = 'Kitas puslapis';\n  homeLabel = 'Grįžti į pradžią';\n  rotateCwLabel = 'Pasukti 90°';\n  searchLabel = 'Paieška';\n  clearSearchLabel = 'Išvalyti';\n  previousHitLabel = 'Buvęs rezultatas';\n  nextHitLabel = 'Kitas rezultatas';\n  goToPageLabel = 'Persikelti į puslapį';\n  currentPageLabel = 'Dabartinis puslapis';\n  enterPageNumber = 'Įveskite puslapio numerį';\n  dropDisabled = 'Atleiskite, bet veiksmas negalimas';\n\n  // ERRORS\n  somethingHasGoneWrongLabel = 'Objekto atvaizduoti nepavyko...';\n  manifestUriMissingLabel = 'Nerastas objektų sąrašo identifikatorius (ManifestUri)';\n  manifestNotValidLabel = 'Netinkamas objektų sąrašas (Manifest)';\n  pageDoesNotExists = 'Nepavyko rasti šio paslapio';\n\n  noResultsFoundLabel = (q: string) => {\n    return `Objekte nerasta atitikmenų <em class=\"current-search\">${q}</em>`;\n  };\n\n  resultsFoundLabel = (numberOfHits: number, q: string) => {\n    return `${numberOfHits} rezultata${numberOfHits === 1 ? 's' : 'i'} su <em class=\"current-search\">${q}</em>`;\n  };\n  currentHitLabel = (currentHit: number, numberOfHits: number) => {\n    return `${currentHit} iš ${numberOfHits} atitikmenų`;\n  };\n}\n","export enum ViewingDirection {\n  LTR,\n  RTL\n}\n","import { ViewerLayout } from './models/viewer-layout';\nimport { ViewerMode } from './models/viewer-mode';\n\nexport class MimeViewerConfig {\n  public attributionDialogEnabled? = true;\n  public attributionDialogHideTimeout? = -1;\n  public navigationControlEnabled? = true;\n  public initViewerMode? = ViewerMode.PAGE;\n  public initViewerLayout? = ViewerLayout.TWO_PAGE;\n  public withCredentials? = false;\n  public loadTilesWithAjax? = false;\n  public crossOriginPolicy?: string | boolean = false;\n  public ajaxHeaders?: any = null;\n  public preserveZoomOnCanvasGroupChange? = false;\n  public startOnTopOnCanvasGroupChange? = false;\n  public isDropEnabled? = false;\n\n  constructor(fields?: {\n    attributionDialogEnabled?: boolean;\n    attributionDialogHideTimeout?: number;\n    navigationControlEnabled?: boolean;\n    initViewerMode?: ViewerMode;\n    initViewerLayout?: ViewerLayout;\n    withCredentials?: boolean;\n    loadTilesWithAjax?: boolean;\n    crossOriginPolicy?: string | boolean;\n    ajaxHeaders?: any;\n    preserveZoomOnCanvasGroupChange?: boolean;\n    startOnTopOnCanvasGroupChange?: boolean;\n    isDropEnabled?: boolean;\n  }) {\n    if (fields) {\n      this.attributionDialogEnabled =\n        fields.attributionDialogEnabled !== undefined\n          ? fields.attributionDialogEnabled\n          : this.attributionDialogEnabled;\n\n      this.attributionDialogHideTimeout =\n        fields.attributionDialogHideTimeout ||\n        this.attributionDialogHideTimeout;\n\n      this.navigationControlEnabled =\n        fields.navigationControlEnabled !== undefined\n          ? fields.navigationControlEnabled\n          : this.navigationControlEnabled;\n\n      this.initViewerMode =\n        fields.initViewerMode !== undefined\n          ? fields.initViewerMode\n          : this.initViewerMode;\n\n      this.initViewerLayout =\n        fields.initViewerLayout !== undefined\n          ? fields.initViewerLayout\n          : this.initViewerLayout;\n\n      this.withCredentials =\n        fields.withCredentials !== undefined\n          ? fields.withCredentials\n          : this.withCredentials;\n\n      this.loadTilesWithAjax =\n        fields.loadTilesWithAjax !== undefined\n          ? fields.loadTilesWithAjax\n          : this.loadTilesWithAjax;\n\n      this.crossOriginPolicy =\n        fields.crossOriginPolicy !== undefined\n          ? fields.crossOriginPolicy\n          : this.crossOriginPolicy;\n\n      this.ajaxHeaders =\n        fields.ajaxHeaders !== undefined\n          ? fields.ajaxHeaders\n          : this.ajaxHeaders;\n\n      this.preserveZoomOnCanvasGroupChange =\n        fields.preserveZoomOnCanvasGroupChange !== undefined\n          ? fields.preserveZoomOnCanvasGroupChange\n          : this.preserveZoomOnCanvasGroupChange;\n\n      this.startOnTopOnCanvasGroupChange =\n        fields.startOnTopOnCanvasGroupChange !== undefined\n          ? fields.startOnTopOnCanvasGroupChange\n          : this.startOnTopOnCanvasGroupChange;\n\n      this.isDropEnabled =\n        fields.isDropEnabled !== undefined\n          ? fields.isDropEnabled\n          : this.isDropEnabled;\n    }\n  }\n}\n","import { ViewingDirection } from './viewing-direction';\n\nexport class Manifest {\n  public context?: string;\n  public type?: string;\n  public id?: string;\n  public viewingDirection? = ViewingDirection.LTR;\n  public label?: string;\n  public metadata?: Metadata[];\n  public license?: string;\n  public logo?: string;\n  public attribution?: string;\n  public service?: Service;\n  public sequences?: Sequence[];\n  public structures?: Structure[] = [];\n  public tileSource?: Service[];\n  public viewingHint?: string;\n\n  constructor(fields?: {\n    context?: string;\n    type?: string;\n    id?: string;\n    viewingDirection?: ViewingDirection;\n    label?: string;\n    metadata?: Metadata[];\n    license?: string;\n    logo?: string;\n    attribution?: string;\n    service?: Service;\n    sequences?: Sequence[];\n    structures?: Structure[];\n    tileSource?: Service[];\n    viewingHint?: string;\n  }) {\n    if (fields) {\n      this.context = fields.context || this.context;\n      this.type = fields.type || this.type;\n      this.id = fields.id || this.id;\n      this.viewingDirection = fields.viewingDirection || this.viewingDirection;\n      this.label = fields.label || this.label;\n      this.metadata = fields.metadata || this.metadata;\n      this.license = fields.license || this.license;\n      this.logo = fields.logo || this.logo;\n      this.attribution = fields.attribution || this.attribution;\n      this.service = fields.service || this.service;\n      this.sequences = fields.sequences || this.sequences;\n      this.structures = fields.structures || this.structures;\n      this.tileSource = fields.tileSource || this.tileSource;\n      this.viewingHint = fields.viewingHint || this.viewingHint;\n    }\n  }\n}\n\nexport class Metadata {\n  constructor(public label: string, public value: string | number) {}\n}\n\nexport class Sequence {\n  public id?: string;\n  public type?: string;\n  public label?: string;\n  public viewingHint?: string;\n  public canvases?: Canvas[];\n\n  constructor(fields?: {\n    id?: string;\n    type?: string;\n    label?: string;\n    viewingHint?: string;\n    canvases?: Canvas[];\n  }) {\n    if (fields) {\n      this.id = fields.id || this.id;\n      this.type = fields.type || this.type;\n      this.label = fields.label || this.label;\n      this.viewingHint = fields.viewingHint || this.viewingHint;\n      this.canvases = fields.canvases || this.canvases;\n    }\n  }\n}\n\nexport class Canvas {\n  public id?: string;\n  public type?: string;\n  public label?: string;\n  public thumbnail?: string;\n  public height?: number;\n  public width?: number;\n  public images?: Images[];\n\n  constructor(fields?: {\n    id?: string;\n    type?: string;\n    label?: string;\n    thumbnail?: string;\n    height?: number;\n    width?: number;\n    images?: Images[];\n  }) {\n    if (fields) {\n      this.id = fields.id || this.id;\n      this.type = fields.type || this.type;\n      this.label = fields.label || this.label;\n      this.thumbnail = fields.thumbnail || this.thumbnail;\n      this.height = fields.height || this.height;\n      this.width = fields.width || this.width;\n      this.images = fields.images || this.images;\n    }\n  }\n}\n\nexport class Images {\n  public id: string;\n  public type: string;\n  public motivation: string;\n  public resource: Resource;\n  public on: string;\n\n  constructor(fields?: {\n    id?: string;\n    type?: string;\n    motivation?: string;\n    resource?: Resource;\n    on?: string;\n  }) {\n    if (fields) {\n      this.id = fields.id || this.id;\n      this.type = fields.type || this.type;\n      this.motivation = fields.motivation || this.motivation;\n      this.resource = fields.resource || this.resource;\n      this.on = fields.on || this.on;\n    }\n  }\n}\n\nexport class Resource {\n  public id: string;\n  public type: string;\n  public format: string;\n  public service: Service;\n  public height: number;\n  public width: number;\n\n  constructor(fields?: {\n    id?: string;\n    type?: string;\n    format?: string;\n    service?: Service;\n    height?: number;\n    width?: number;\n  }) {\n    if (fields) {\n      this.id = fields.id || this.id;\n      this.type = fields.type || this.type;\n      this.format = fields.format || this.format;\n      this.service = fields.service || this.service;\n      this.height = fields.height || this.height;\n      this.width = fields.width || this.width;\n    }\n  }\n}\n\nexport class Service {\n  public context?: string;\n  public id?: string;\n  public protocol?: string;\n  public width?: number;\n  public height?: number;\n  public sizes?: Size[];\n  public tiles?: Tile[];\n  public profile?: string;\n  public physicalScale?: number;\n  public physicalUnits?: string;\n  public service?: Service;\n\n  constructor(fields?: {\n    context?: string;\n    id?: string;\n    protocol?: string;\n    width?: number;\n    height?: number;\n    sizes?: Size[];\n    tiles?: Tile[];\n    profile?: string;\n    physicalScale?: number;\n    physicalUnits?: string;\n    service?: Service;\n  }) {\n    if (fields) {\n      this.context = fields.context || this.context;\n      this.id = fields.id || this.id;\n      this.protocol = fields.protocol || this.protocol;\n      this.width = fields.width || this.width;\n      this.height = fields.height || this.height;\n      this.sizes = fields.sizes || this.sizes;\n      this.tiles = fields.tiles || this.tiles;\n      this.profile = fields.profile || this.profile;\n      this.physicalScale = fields.physicalScale || this.physicalScale;\n      this.physicalUnits = fields.physicalUnits || this.physicalUnits;\n      this.service = fields.service || this.service;\n    }\n  }\n}\n\nexport class Size {\n  constructor(public width: number, public height: number) {}\n}\n\nexport class Tile {\n  public width: number;\n  public scaleFactors: number[];\n\n  constructor(fields?: { width?: number; scaleFactors?: number[] }) {\n    if (fields) {\n      this.width = fields.width || this.width;\n      this.scaleFactors = fields.scaleFactors || this.scaleFactors;\n    }\n  }\n}\n\nexport class Structure {\n  public id: string;\n  public type: string;\n  public label: string;\n  public canvases: string[];\n  public canvasIndex: number;\n\n  constructor(fields?: {\n    id?: string;\n    type?: string;\n    label?: string;\n    canvases?: string[];\n    canvasIndex?: number;\n  }) {\n    if (fields) {\n      this.id = fields.id || this.id;\n      this.type = fields.type || this.type;\n      this.label = fields.label || this.label;\n      this.canvases = fields.canvases || this.canvases;\n      this.canvasIndex = fields.canvasIndex;\n    }\n  }\n}\n\nexport class TileSource {}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatProgressBarModule } from '@angular/material/progress-bar';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\n@NgModule({\n  exports: [\n    MatToolbarModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatDialogModule,\n    MatTabsModule,\n    MatListModule,\n    MatSliderModule,\n    MatProgressSpinnerModule,\n    MatInputModule,\n    MatProgressBarModule,\n    MatCardModule,\n    MatSnackBarModule\n  ]\n})\nexport class MimeMaterialModule {}\n","import { Injectable, Optional, SkipSelf } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { Observable } from 'rxjs';\n\nexport interface SpinnerState {\n  show: boolean;\n}\n\n@Injectable()\nexport class SpinnerService {\n  private spinnerSubject = new Subject<SpinnerState>();\n  public spinnerState = this.spinnerSubject.asObservable();\n\n  constructor() {}\n\n  show() {\n    this.spinnerSubject.next(<SpinnerState>{ show: true });\n  }\n\n  hide() {\n    this.spinnerSubject.next(<SpinnerState>{ show: false });\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { FlexLayoutModule } from '@angular/flex-layout';\n\nimport { MimeMaterialModule } from './mime-material.module';\nimport { SpinnerService } from '../core/spinner-service/spinner.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    FlexLayoutModule,\n    MimeMaterialModule\n  ],\n  exports: [\n    CommonModule,\n    FlexLayoutModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MimeMaterialModule\n  ],\n  providers: [SpinnerService]\n})\nexport class SharedModule {}\n","import { ViewerMode } from '../models/viewer-mode';\n\nexport class ModeChanges {\n  public currentValue: ViewerMode;\n  public previousValue: ViewerMode;\n\n  constructor(fields?: {\n    currentValue?: ViewerMode;\n    previousValue?: ViewerMode;\n  }) {\n    if (fields) {\n      this.currentValue = fields.currentValue || this.currentValue;\n      this.previousValue = fields.previousValue || this.previousValue;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, ReplaySubject } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\nimport { ModeChanges } from '../models/modeChanges';\nimport { ViewerMode } from '../models/viewer-mode';\n\n@Injectable()\nexport class ModeService {\n  private _initialMode: ViewerMode;\n  private _mode: ViewerMode;\n  private toggleModeSubject: ReplaySubject<ModeChanges> = new ReplaySubject();\n  private modeChanges = new ModeChanges();\n\n  constructor() {}\n\n  get onChange(): Observable<ModeChanges> {\n    return this.toggleModeSubject.asObservable().pipe(distinctUntilChanged());\n  }\n\n  set mode(mode: ViewerMode) {\n    this._mode = mode;\n    this.change();\n  }\n\n  get mode(): ViewerMode {\n    return this._mode;\n  }\n\n  set initialMode(mode: ViewerMode) {\n    this._initialMode = mode;\n    this.mode = mode;\n  }\n\n  get initialMode(): ViewerMode {\n    return this._initialMode;\n  }\n\n  toggleMode(): void {\n    if (this.mode === ViewerMode.DASHBOARD) {\n      this.mode = ViewerMode.PAGE;\n    } else if (\n      this.mode === ViewerMode.PAGE ||\n      this.mode === ViewerMode.PAGE_ZOOMED\n    ) {\n      this.mode = ViewerMode.DASHBOARD;\n    }\n  }\n\n  private change() {\n    this.modeChanges.previousValue = this.modeChanges.currentValue;\n    this.modeChanges.currentValue = this._mode;\n    this.toggleModeSubject.next({\n      ...this.modeChanges\n    });\n  }\n}\n","/****************************************************************\n * MIME-viewer options\n ****************************************************************/\n\nexport const ViewerOptions = {\n  zoom: {\n    zoomFactor: 1.15,\n    dblClickZoomFactor: 2.7,\n    // How many pixels since lastDistance before it is considered a pinch\n    pinchZoomThreshold: 3\n  },\n\n  pan: {\n    // Sensitivity when determining swipe-direction.\n    // Higher threshold means that swipe must be more focused in\n    // x-direction before the gesture is recognized as \"left\" or \"right\"\n    swipeDirectionThreshold: 70\n  },\n\n  // All transition times in milliseconds\n  transitions: {\n    toolbarsEaseInTime: 400,\n    toolbarsEaseOutTime: 500,\n    OSDAnimationTime: 600 // Animation-time for OSD-animations\n  },\n\n  overlays: {\n    // Margin between canvas groups in Dashboard View in OpenSeadragon viewport-coordinates\n    canvasGroupMarginInDashboardView: 300,\n    // Margin between canvas groups in Page View in OpenSeadragon viewport-coordinates\n    canvasGroupMarginInPageView: 20\n  },\n\n  padding: {\n    // Padding in viewer container in pixels\n    header: 80, // Placeholder above viewer for header in Dashboard View\n    footer: 80 // Placeholder below viewer for footer in Dashboard View\n  },\n\n  colors: {\n    canvasGroupBackgroundColor: '#fafafa'\n  }\n};\n","export class Rect {\n  public x? = 0;\n  public y? = 0;\n  public width? = 0;\n  public height? = 0;\n  public centerX? = 0;\n  public centerY? = 0;\n\n  constructor(fields?: {\n    x?: number;\n    y?: number;\n    width?: number;\n    height?: number;\n  }) {\n    if (fields) {\n      this.x = fields.x || this.x;\n      this.y = fields.y || this.y;\n      this.width = fields.width || this.width;\n      this.height = fields.height || this.height;\n      this.centerX = this.x + this.width / 2;\n      this.centerY = this.y + this.height / 2;\n    }\n  }\n}\n","import { Rect } from '../models/rect';\nimport { CanvasGroupPositionCriteria } from './calculate-canvas-group-position-strategy';\n\nexport const canvasRectFromCriteria = (\n  rotation: number,\n  criteria: CanvasGroupPositionCriteria,\n  x: number\n) => {\n  let rect = {};\n\n  if (rotation === 90 || rotation === 270) {\n    rect = {\n      height: criteria.canvasSource.width,\n      width: criteria.canvasSource.height,\n      x: x,\n      y: (criteria.canvasSource.width / 2) * -1\n    };\n  } else {\n    rect = {\n      height: criteria.canvasSource.height,\n      width: criteria.canvasSource.width,\n      x: x,\n      y: (criteria.canvasSource.height / 2) * -1\n    };\n  }\n  return new Rect(rect);\n};\n","import { Rect } from '../models/rect';\nimport { ViewerOptions } from '../models/viewer-options';\nimport { ViewingDirection } from '../models/viewing-direction';\nimport {\n  CalculateCanvasGroupPositionStrategy,\n  CanvasGroupPositionCriteria\n} from './calculate-canvas-group-position-strategy';\nimport { canvasRectFromCriteria } from './calculate-canvas-group-position-utils';\n\nexport class OnePageCalculatePagePositionStrategy\n  implements CalculateCanvasGroupPositionStrategy {\n  calculateCanvasGroupPosition(\n    criteria: CanvasGroupPositionCriteria,\n    rotation: number = 0\n  ): Rect {\n    let x: number;\n    if (!criteria.canvasGroupIndex) {\n      if (rotation === 90 || rotation === 270) {\n        x = (criteria.canvasSource.height / 2) * -1;\n      } else {\n        x = (criteria.canvasSource.width / 2) * -1;\n      }\n    } else {\n      x =\n        criteria.viewingDirection === ViewingDirection.LTR\n          ? this.calculateLtrX(criteria)\n          : this.calculateRtlX(criteria);\n    }\n    return canvasRectFromCriteria(rotation, criteria, x);\n  }\n\n  private calculateLtrX(criteria: CanvasGroupPositionCriteria) {\n    return (\n      criteria.previousCanvasGroupPosition.x +\n      criteria.previousCanvasGroupPosition.width +\n      ViewerOptions.overlays.canvasGroupMarginInDashboardView\n    );\n  }\n\n  private calculateRtlX(criteria: CanvasGroupPositionCriteria) {\n    return (\n      criteria.previousCanvasGroupPosition.x -\n      criteria.previousCanvasGroupPosition.width -\n      ViewerOptions.overlays.canvasGroupMarginInDashboardView\n    );\n  }\n}\n","import { Rect } from '../models/rect';\nimport { ViewerOptions } from '../models/viewer-options';\nimport { ViewingDirection } from '../models/viewing-direction';\nimport {\n  CalculateCanvasGroupPositionStrategy,\n  CanvasGroupPositionCriteria\n} from './calculate-canvas-group-position-strategy';\nimport { canvasRectFromCriteria } from './calculate-canvas-group-position-utils';\n\nexport class TwoPageCalculateCanvasGroupPositionStrategy\n  implements CalculateCanvasGroupPositionStrategy {\n  calculateCanvasGroupPosition(\n    criteria: CanvasGroupPositionCriteria,\n    rotation: number = 0\n  ): Rect {\n    let x: number;\n\n    if (!criteria.canvasGroupIndex) {\n      // First page\n      x = 0;\n    } else if (criteria.canvasGroupIndex % 2) {\n      // Even page numbers\n      x =\n        criteria.viewingDirection === ViewingDirection.LTR\n          ? this.calculateEvenLtrX(criteria)\n          : this.calculateEvenRtlX(criteria);\n    } else {\n      // Odd page numbers\n      x =\n        criteria.viewingDirection === ViewingDirection.LTR\n          ? this.calculateOddLtrX(criteria)\n          : this.calculateOddRtlX(criteria);\n    }\n\n    return canvasRectFromCriteria(rotation, criteria, x);\n  }\n\n  private calculateEvenLtrX(criteria: CanvasGroupPositionCriteria) {\n    return (\n      criteria.previousCanvasGroupPosition.x +\n      criteria.previousCanvasGroupPosition.width +\n      ViewerOptions.overlays.canvasGroupMarginInDashboardView\n    );\n  }\n\n  private calculateOddLtrX(criteria: CanvasGroupPositionCriteria) {\n    return (\n      criteria.previousCanvasGroupPosition.x +\n      criteria.previousCanvasGroupPosition.width\n    );\n  }\n\n  private calculateEvenRtlX(criteria: CanvasGroupPositionCriteria) {\n    return (\n      criteria.previousCanvasGroupPosition.x -\n      criteria.canvasSource.width -\n      ViewerOptions.overlays.canvasGroupMarginInDashboardView\n    );\n  }\n\n  private calculateOddRtlX(criteria: CanvasGroupPositionCriteria) {\n    return criteria.previousCanvasGroupPosition.x - criteria.canvasSource.width;\n  }\n}\n","import { CalculateCanvasGroupPositionStrategy } from './calculate-canvas-group-position-strategy';\nimport { OnePageCalculatePagePositionStrategy } from './one-page-calculate-page-position-strategy';\nimport { TwoPageCalculateCanvasGroupPositionStrategy } from './two-page-calculate-page-position-strategy';\nimport { ViewerLayout } from '../models/viewer-layout';\n\nexport class CalculateCanvasGroupPositionFactory {\n  public static create(\n    viewerLayout: ViewerLayout,\n    paged: boolean\n  ): CalculateCanvasGroupPositionStrategy {\n    if (viewerLayout === ViewerLayout.ONE_PAGE || !paged) {\n      return new OnePageCalculatePagePositionStrategy();\n    } else if (viewerLayout === ViewerLayout.TWO_PAGE) {\n      return new TwoPageCalculateCanvasGroupPositionStrategy();\n    }\n  }\n}\n","import { Point } from './point';\nimport { Rect } from './rect';\n\nexport class CanvasGroups {\n  canvasGroupRects: Rect[] = [];\n  canvasRects: Rect[] = [];\n  canvasesPerCanvasGroup: number[][] = [];\n\n  public add(rect: Rect): void {\n    this.canvasGroupRects.push(rect);\n  }\n\n  public addRange(rects: Rect[]): void {\n    this.canvasGroupRects = rects;\n  }\n\n  public get(index: number): Rect {\n    return { ...this.canvasGroupRects[index] };\n  }\n\n  public findClosestIndex(point: Point): number {\n    let i = 0;\n    let lastDelta: any;\n\n    if (point === null) {\n      return -1;\n    }\n    this.canvasGroupRects.some(function(rect: Rect, index: number) {\n      const delta = Math.abs(point.x - rect.centerX);\n      if (delta >= lastDelta) {\n        return true;\n      }\n      i = index;\n      lastDelta = delta;\n    });\n    return i;\n  }\n\n  public getMaxHeight(): number {\n    return Math.max.apply(\n      Math,\n      this.canvasGroupRects.map(function(rect) {\n        return rect.height;\n      })\n    );\n  }\n\n  public getMaxWidth(): number {\n    return Math.max.apply(\n      Math,\n      this.canvasGroupRects.map(function(rect) {\n        return rect.width;\n      })\n    );\n  }\n\n  public length(): number {\n    return this.canvasGroupRects.length;\n  }\n}\n","import { Rect } from './../models/rect';\nimport { CanvasGroups } from './../models/canvas-groups';\n\nexport interface AbstractCanvasGroupStrategy {\n  addAll(canvasRects: Rect[]): CanvasGroups;\n}\n\nexport class OneCanvasPerCanvasGroupStrategy\n  implements AbstractCanvasGroupStrategy {\n  addAll = (canvasRects: Rect[]) => {\n    const canvasGroups = new CanvasGroups();\n    canvasGroups.addRange(canvasRects);\n    canvasGroups.canvasRects = canvasRects;\n    for (let i = 0; i < canvasRects.length; i++) {\n      canvasGroups.canvasesPerCanvasGroup.push([i]);\n    }\n    return canvasGroups;\n  };\n}\n\nexport class TwoCanvasPerCanvasGroupStrategy\n  implements AbstractCanvasGroupStrategy {\n  addAll = (canvasRects: Rect[]) => {\n    const canvasGroups = new CanvasGroups();\n    // Single first page\n    canvasGroups.add(canvasRects[0]);\n    canvasGroups.canvasRects = canvasRects;\n    canvasGroups.canvasesPerCanvasGroup.push([0]);\n\n    for (let i = 1; i < canvasRects.length; i = i + 2) {\n      if (i + 1 < canvasRects.length) {\n        // Paired pages\n        const thisRect = canvasRects[i];\n        const nextRect = canvasRects[i + 1];\n        const groupedRect = new Rect({\n          x: Math.min(thisRect.x, nextRect.x),\n          y: Math.min(thisRect.y, nextRect.y),\n          height: Math.max(thisRect.height, nextRect.height),\n          width: thisRect.width + nextRect.width\n        });\n        canvasGroups.add(groupedRect);\n        canvasGroups.canvasesPerCanvasGroup.push([i, i + 1]);\n      } else {\n        // Single last page, if applicable\n        canvasGroups.add(canvasRects[i]);\n        canvasGroups.canvasesPerCanvasGroup.push([i]);\n      }\n    }\n    return canvasGroups;\n  };\n}\n","import { ViewerLayout } from '../models/viewer-layout';\nimport {\n  OneCanvasPerCanvasGroupStrategy,\n  TwoCanvasPerCanvasGroupStrategy\n} from './canvas-group.strategy';\n\nexport class CanvasGroupStrategyFactory {\n  public static create(layout: ViewerLayout) {\n    if (layout === ViewerLayout.ONE_PAGE) {\n      return new OneCanvasPerCanvasGroupStrategy();\n    } else if (layout === ViewerLayout.TWO_PAGE) {\n      return new TwoCanvasPerCanvasGroupStrategy();\n    }\n\n    return null;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { CanvasGroups } from './../models/canvas-groups';\nimport { ViewerLayout } from '../models/viewer-layout';\nimport { Point } from './../models/point';\nimport { Rect } from './../models/rect';\nimport { CanvasGroupStrategyFactory } from './canvas-groups-strategy.factory';\n\n@Injectable()\nexport class CanvasService {\n  protected _currentNumberOfCanvasGroups: BehaviorSubject<\n    number\n  > = new BehaviorSubject(0);\n  protected _currentCanvasGroupIndex: BehaviorSubject<\n    number\n  > = new BehaviorSubject(0);\n\n  protected canvasGroups: CanvasGroups = new CanvasGroups();\n  protected _numberOfCanvases = 0;\n\n  constructor() {}\n\n  addAll(canvasRects: Rect[], layout: ViewerLayout) {\n    this.numberOfCanvases = canvasRects.length;\n    const canvasGroupStrategy = CanvasGroupStrategyFactory.create(layout);\n    this.canvasGroups = canvasGroupStrategy.addAll(canvasRects);\n    this._currentNumberOfCanvasGroups.next(this.canvasGroups.length());\n  }\n\n  reset() {\n    this.numberOfCanvases = 0;\n    this._currentCanvasGroupIndex.next(0);\n    this.canvasGroups = new CanvasGroups();\n  }\n\n  get onCanvasGroupIndexChange(): Observable<number> {\n    return this._currentCanvasGroupIndex\n      .asObservable()\n      .pipe(distinctUntilChanged());\n  }\n\n  get onNumberOfCanvasGroupsChange(): Observable<number> {\n    return this._currentNumberOfCanvasGroups\n      .asObservable()\n      .pipe(distinctUntilChanged());\n  }\n\n  set currentCanvasGroupIndex(currentCanvasGroupIndex: number) {\n    if (!this.isWithinBounds(currentCanvasGroupIndex)) {\n      return;\n    }\n    this._currentCanvasGroupIndex.next(currentCanvasGroupIndex);\n  }\n\n  get currentCanvasGroupIndex(): number {\n    return this._currentCanvasGroupIndex.value;\n  }\n\n  get numberOfCanvases(): number {\n    return this._numberOfCanvases;\n  }\n\n  set numberOfCanvases(numberOfCanvases: number) {\n    this._numberOfCanvases = numberOfCanvases;\n  }\n\n  get numberOfCanvasGroups(): number {\n    return this.canvasGroups.length();\n  }\n\n  get currentCanvasIndex(): number {\n    return this.canvasGroups.canvasesPerCanvasGroup[\n      this.currentCanvasGroupIndex\n    ][0];\n  }\n\n  isWithinBounds(canvasGroupIndex: number): boolean {\n    return (\n      canvasGroupIndex > -1 && canvasGroupIndex <= this.numberOfCanvasGroups - 1\n    );\n  }\n\n  isCurrentCanvasGroupValid(): boolean {\n    return this.isWithinBounds(this.currentCanvasGroupIndex);\n  }\n\n  // Returns -1 if next canvas index is out of bounds\n  getNextCanvasGroupIndex(): number {\n    if (!this.isWithinBounds(this.currentCanvasGroupIndex + 1)) {\n      return -1;\n    }\n    this.currentCanvasGroupIndex++;\n    return this.currentCanvasGroupIndex;\n  }\n\n  // Returns -1 if previous canvas index is out of bounds\n  getPrevCanvasGroupIndex(): number {\n    if (!this.isWithinBounds(this.currentCanvasGroupIndex - 1)) {\n      return -1;\n    }\n    this.currentCanvasGroupIndex--;\n    return this.currentCanvasGroupIndex;\n  }\n\n  constrainToRange(canvasGroupsIndex: number): number {\n    if (canvasGroupsIndex < 0) {\n      return 0;\n    } else if (canvasGroupsIndex >= this.numberOfCanvasGroups - 1) {\n      return this.numberOfCanvasGroups - 1;\n    } else {\n      return canvasGroupsIndex;\n    }\n  }\n\n  findClosestCanvasGroupIndex(point: Point): number {\n    return this.canvasGroups.findClosestIndex(point);\n  }\n\n  findCanvasGroupByCanvasIndex(canvasIndex: number): number {\n    return this.canvasGroups.canvasesPerCanvasGroup.findIndex(function(\n      canvasForCanvasGroup: number[]\n    ) {\n      return canvasForCanvasGroup.indexOf(canvasIndex) >= 0;\n    });\n  }\n\n  findCanvasByCanvasIndex(canvasIndex: number): number {\n    return this.canvasGroups.canvasesPerCanvasGroup.length === 0\n      ? -1\n      : this.canvasGroups.canvasesPerCanvasGroup[canvasIndex][0];\n  }\n\n  getCanvasGroupLabel(canvasGroupIndex: number): string {\n    if (\n      !this.canvasGroups.canvasGroupRects ||\n      this.canvasGroups.canvasesPerCanvasGroup.length === 0\n    ) {\n      return '1';\n    }\n\n    const canvasGroup = this.canvasGroups.canvasesPerCanvasGroup[\n      canvasGroupIndex\n    ];\n    let canvasGroupLabel = '' + (canvasGroup[0] + 1);\n\n    if (canvasGroup.length > 1) {\n      canvasGroupLabel =\n        canvasGroupLabel + '-' + (canvasGroup[canvasGroup.length - 1] + 1);\n    }\n\n    return canvasGroupLabel;\n  }\n\n  getCanvasesPerCanvasGroup(canvasIndex: number): number[] {\n    return !this.canvasGroups.canvasGroupRects\n      ? [0]\n      : this.canvasGroups.canvasesPerCanvasGroup[canvasIndex];\n  }\n\n  getCanvasRect(canvasIndex: number): Rect {\n    return this.canvasGroups.canvasRects[canvasIndex];\n  }\n\n  getCurrentCanvasGroupRect(): Rect {\n    return this.getCanvasGroupRect(this.currentCanvasGroupIndex);\n  }\n\n  getCanvasGroupRect(canvasGroupIndex: number): Rect {\n    return this.canvasGroups.get(canvasGroupIndex);\n  }\n\n  getMaxHeight(): number {\n    return this.canvasGroups.getMaxHeight();\n  }\n\n  getMaxWidth(): number {\n    return this.canvasGroups.getMaxWidth();\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable()\nexport class ClickService {\n  private singleClickHandlers: Array<(event: any) => void>;\n  private doubleClickHandlers: Array<(event: any) => void>;\n  private clickCount = 0;\n  private dblClickTimeOut: any;\n\n  constructor() {\n    this.reset();\n  }\n\n  reset(): void {\n    this.singleClickHandlers = [];\n    this.doubleClickHandlers = [];\n  }\n\n  addSingleClickHandler(singleClickHandler: (event: any) => void) {\n    this.singleClickHandlers.push(singleClickHandler);\n  }\n\n  addDoubleClickHandler(doubleClickHandler: (event: any) => void) {\n    this.doubleClickHandlers.push(doubleClickHandler);\n  }\n\n  private triggerSingleClick(event: any) {\n    this.singleClickHandlers.forEach((handler: any) => {\n      handler(event);\n    });\n  }\n\n  private triggerDoubleClick(event: any) {\n    this.doubleClickHandlers.forEach((handler: any) => {\n      handler(event);\n    });\n  }\n\n  click = (event: any) => {\n    event.preventDefaultAction = true;\n    if (event.quick) {\n      this.clickCount++;\n      if (this.clickCount === 1) {\n        this.dblClickTimeOut = setTimeout(() => {\n          this.clickCount = 0;\n          this.triggerSingleClick(event);\n        }, event.tracker.dblClickTimeThreshold);\n      } else if (this.clickCount === 2) {\n        clearTimeout(this.dblClickTimeOut);\n        this.clickCount = 0;\n        this.triggerDoubleClick(event);\n      }\n    }\n  };\n}\n","import { Rect } from './rect';\n\nexport class Hit {\n  public id = 0;\n  public index = 0;\n  public label: string;\n  public match: string;\n  public before: string;\n  public after: string;\n  public rects: Rect[];\n\n  constructor(fields?: {\n    id?: number;\n    index?: number;\n    label?: string;\n    match?: string;\n    before?: string;\n    after?: string;\n    rects?: Rect[];\n  }) {\n    if (fields) {\n      this.id = fields.id || this.id;\n      this.index = fields.index || this.index;\n      this.label = fields.label || this.label;\n      this.match = fields.match || this.match;\n      this.before = fields.before || this.before;\n      this.after = fields.after || this.after;\n      this.rects = fields.rects || this.rects;\n    }\n  }\n}\n","export enum ControlAnchor {\n  NONE = 0,\n  TOP_LEFT = 1,\n  TOP_RIGHT = 2,\n  BOTTOM_RIGHT = 3,\n  BOTTOM_LEFT = 4,\n  ABSOLUTE = 5\n}\n","import { Hit } from './hit';\n\nexport class SearchResult {\n  public q = '';\n  public hits: Hit[] = [];\n\n  constructor(fields?: { q?: string; hits?: Hit[] }) {\n    if (fields) {\n      this.q = fields.q || this.q;\n      this.hits = fields.hits || this.hits;\n    }\n  }\n\n  public add(hit: Hit): void {\n    this.hits.push(hit);\n  }\n\n  public get(index: number): Hit {\n    return new Hit({\n      ...this.hits[index]\n    });\n  }\n\n  public size(): number {\n    return this.hits.length;\n  }\n\n  public last(): Hit {\n    return this.get(this.size() - 1);\n  }\n}\n","import { Rect } from './../models/rect';\nimport { Manifest } from './../models/manifest';\nimport {\n  IiifSearchResult,\n  Hit as IiifHit,\n  Resource as IiifResource\n} from './../models/iiif-search-result';\nimport { SearchResult } from './../models/search-result';\nimport { Hit } from './../models/hit';\n\nexport class SearchResultBuilder {\n  constructor(\n    private q: string,\n    private manifest: Manifest,\n    private iiifSearchResult: IiifSearchResult\n  ) {}\n\n  public build(): SearchResult {\n    const searchResult = new SearchResult();\n    searchResult.q = this.q;\n    const hits: Hit[] = [];\n    if (this.iiifSearchResult && this.iiifSearchResult.hits) {\n      this.iiifSearchResult.hits.forEach((hit: IiifHit, index: number) => {\n        const id: number = index;\n        let canvasIndex = -1;\n        let label = null;\n        const rects: Rect[] = [];\n        if (this.manifest.sequences && this.manifest.sequences[0].canvases) {\n          const resources = this.findResources(hit);\n          for (const resource of resources) {\n            canvasIndex = this.findSequenceIndex(resource);\n            label = this.findLabel(canvasIndex);\n            const on = resource.on;\n            const coords = on.substring(on.indexOf('=') + 1).split(',');\n            const rect = new Rect({\n              x: parseInt(coords[0], 10),\n              y: parseInt(coords[1], 10),\n              width: parseInt(coords[2], 10),\n              height: parseInt(coords[3], 10)\n            });\n            rects.push(rect);\n          }\n        }\n\n        searchResult.add(\n          new Hit({\n            id: id,\n            index: canvasIndex,\n            label: label,\n            match: hit.match,\n            before: hit.before,\n            after: hit.after,\n            rects: rects\n          })\n        );\n      });\n      return searchResult;\n    }\n  }\n\n  private findResources(hit: IiifHit): IiifResource[] {\n    const resources: IiifResource[] = [];\n    for (const annotation of hit.annotations) {\n      const res = this.iiifSearchResult.resources.find(\n        (r: IiifResource) => r['@id'] === annotation\n      );\n      resources.push(res);\n    }\n    return resources;\n  }\n\n  private findSequenceIndex(resource: IiifResource): number {\n    const firstSequence = this.manifest.sequences[0];\n    const on = resource.on;\n    const id = on.substring(0, on.indexOf('#'));\n    return firstSequence.canvases.findIndex(c => c.id === id);\n  }\n\n  private findLabel(index: number): string {\n    if (index === -1) {\n      return null;\n    } else {\n      return this.manifest.sequences[0].canvases[index].label;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { Observable, Subject, BehaviorSubject, throwError } from 'rxjs';\nimport { distinctUntilChanged, finalize } from 'rxjs/operators';\n\nimport { IiifSearchResult } from './../models/iiif-search-result';\nimport { SearchResultBuilder } from './../builders/search-result.builder';\nimport { SearchResult } from './../models/search-result';\nimport { Hit } from './../models/hit';\nimport { Manifest } from './../models/manifest';\n\n@Injectable()\nexport class IiifContentSearchService {\n  protected _currentSearchResult: Subject<SearchResult> = new BehaviorSubject<\n    SearchResult\n  >(new SearchResult({}));\n  protected _searching: Subject<boolean> = new BehaviorSubject<boolean>(false);\n  protected _currentQ: Subject<string> = new Subject<string>();\n  protected _selected: Subject<Hit> = new BehaviorSubject<Hit>(null);\n\n  constructor(private http: HttpClient) {}\n\n  destroy() {\n    this._currentSearchResult.next(new SearchResult({}));\n    this._selected.next(null);\n  }\n\n  get onQChange(): Observable<string> {\n    return this._currentQ.asObservable().pipe(distinctUntilChanged());\n  }\n\n  get onChange(): Observable<SearchResult> {\n    return this._currentSearchResult.asObservable();\n  }\n\n  get isSearching(): Observable<boolean> {\n    return this._searching.asObservable();\n  }\n\n  get onSelected(): Observable<Hit> {\n    return this._selected.asObservable();\n  }\n\n  public search(manifest: Manifest, q: string): void {\n    this._currentQ.next(q);\n    this._selected.next(null);\n    if (q.length === 0) {\n      this._currentSearchResult.next(new SearchResult());\n      return;\n    }\n    if (!manifest.service || manifest.service === null) {\n      return;\n    }\n    this._searching.next(true);\n    this.http\n      .get(`${manifest.service.id}?q=${q}`)\n      .pipe(finalize(() => this._searching.next(false)))\n      .subscribe(\n        (res: IiifSearchResult) =>\n          this._currentSearchResult.next(this.extractData(q, manifest, res)),\n        (err: HttpErrorResponse) => this.handleError\n      );\n  }\n\n  public selected(hit: Hit) {\n    this._selected.next(hit);\n  }\n\n  private extractData(\n    q: string,\n    manifest: Manifest,\n    iiifSearchResult: IiifSearchResult\n  ): SearchResult {\n    return new SearchResultBuilder(q, manifest, iiifSearchResult).build();\n  }\n\n  private handleError(err: HttpErrorResponse | any) {\n    let errMsg: string;\n    if (err.error instanceof Error) {\n      errMsg = err.error.message;\n    } else {\n      errMsg = err.error;\n    }\n    return throwError(errMsg);\n  }\n}\n","import { Manifest } from '../models/manifest';\n\nexport class ManifestUtils {\n  static isManifestPaged(manifest: Manifest): boolean {\n    return (\n      manifest &&\n      (manifest.viewingHint === 'paged' ||\n        (manifest.sequences && manifest.sequences[0].viewingHint === 'paged'))\n    );\n  }\n}\n","export class GestureSettings {\n  scrollToZoom = false;\n  clickToZoom = false;\n  dblClickToZoom = false;\n  pinchToZoom = false;\n  flickEnabled = false;\n  flickMinSpeed = 120;\n  flickMomentum = 0.25;\n  pinchRotate = false;\n}\n\nexport class GestureSettingsMouse extends GestureSettings {}\n\nexport class GestureSettingsTouch extends GestureSettings {}\n\nexport class GestureSettingsPen extends GestureSettings {}\n\nexport class GestureSettingsUnknown extends GestureSettings {}\n","import { ViewerOptions } from './viewer-options';\nimport {\n  GestureSettingsMouse,\n  GestureSettingsPen,\n  GestureSettingsTouch,\n  GestureSettingsUnknown\n} from './gestureSettings';\nimport { ControlAnchor } from './controlAnchor';\nimport { Service } from './manifest';\nimport { ViewerMode } from './viewer-mode';\n\nexport class Options {\n  id = 'openseadragon';\n  element: Element;\n  tileSources: any[] = [];\n  tabIndex = 0;\n  overlays: any[];\n  xmlPath: string = null;\n  prefixUrl = 'https://openseadragon.github.io/openseadragon/images/';\n  navImages: null;\n  debugMode = false;\n  debugGridColor = '#08f';\n  blendTime = 0;\n  alwaysBlend = false;\n  autoHideControls = true;\n  immediateRender = false;\n  defaultZoomLevel = 0;\n  opacity = 1;\n  compositeOperation: string = null;\n  placeholderFillStyle: string | CanvasGradient | CanvasPattern = null;\n  degrees = 0;\n  minZoomLevel = this.defaultZoomLevel;\n  maxZoomLevel: number = null;\n  homeFillsViewer = false;\n  panHorizontal = true;\n  panVertical = false;\n  constrainDuringPan = false;\n  wrapHorizontal = false;\n  wrapVertical = false;\n  minZoomImageRatio = 1;\n  maxZoomPixelRatio = 1;\n  smoothTileEdgesMinZoom = 1;\n  iOSDevice = true;\n  autoResize = true;\n  preserveImageSizeOnResize = true;\n  minScrollDeltaTime = 50;\n  pixelsPerWheelLine = 40;\n  visibilityRatio = 1;\n  viewportMargins: Object = {};\n  imageLoaderLimit = 0;\n  clickTimeThreshold = 300;\n  clickDistThreshold = 5;\n  dblClickTimeThreshold = 300;\n  dblClickDistThreshold = 20;\n  springStiffness = 6.5;\n  animationTime = ViewerOptions.transitions.OSDAnimationTime / 1000;\n  gestureSettingsMouse = new GestureSettingsMouse();\n  gestureSettingsTouch = new GestureSettingsTouch();\n  gestureSettingsPen = new GestureSettingsPen();\n  gestureSettingsUnknown = new GestureSettingsUnknown();\n  zoomPerClick = 2.0;\n  zoomPerScroll = 1.2;\n  zoomPerSecond = 1.0;\n  showNavigator = false;\n  navigatorId: string;\n  navigatorPosition = 'TOP_RIGHT';\n  navigatorSizeRatio = 0.2;\n  navigatorMaintainSizeRatio = false;\n  navigatorTop: number | string = null;\n  navigatorLeft: number | string = null;\n  navigatorHeight: number | string = null;\n  navigatorWidth: number | string = null;\n  navigatorAutoResize = true;\n  navigatorAutoFade = true;\n  navigatorRotate = true;\n  controlsFadeDelay = 2000;\n  controlsFadeLength = 1500;\n  maxImageCacheCount = 200;\n  timeout = 30000;\n  useCanvas = true;\n  minPixelRatio = 0.5;\n  mouseNavEnabled = true;\n  showNavigationControl = false;\n  navigationControlAnchor = ControlAnchor.TOP_LEFT;\n  showZoomControl = true;\n  showHomeControl = true;\n  showFullPageControl = false;\n  showRotationControl = false;\n  showSequenceControl = false;\n  sequenceControlAnchor = ControlAnchor.TOP_LEFT;\n  navPrevNextWrap = false;\n  zoomInButton: string = null;\n  zoomOutButton: string = null;\n  homeButton: string = null;\n  fullPageButton: string;\n  rotateLeftButton: string;\n  rotateRightButton: string;\n  previousButton: string = null;\n  nextButton: string = null;\n  sequenceMode = true;\n  initialPage = 0;\n  preserveViewport = false;\n  preserveOverlays = false;\n  showReferenceStrip = false;\n  referenceStripScroll = 'horizontal';\n  referenceStripElement: Element = null;\n  referenceStripHeight: number = null;\n  referenceStripWidth: number = null;\n  referenceStripPosition = 'BOTTOM_LEFT';\n  referenceStripSizeRatio = 0.2;\n  collectionMode = false;\n  collectionRows = 1;\n  collectionColumns = 0;\n  collectionLayout = 'horizontal';\n  collectionTileSize = 800;\n  collectionTileMargin = 80;\n  crossOriginPolicy: string | boolean = false;\n  ajaxWithCredentials = false;\n  loadTilesWithAjax = false;\n  ajaxHeaders: any = null;\n}\n","export enum Side {\n  LEFT,\n  RIGHT,\n  TOP,\n  BOTTOM\n}\n","export class PinchStatus {\n  public active = false;\n  public previousGestureId = 0;\n  public shouldStop = false;\n}\n","export enum Direction {\n  UNDEFINED = 0,\n  LEFT = 1,\n  RIGHT = 2,\n  UP = 3,\n  DOWN = 4,\n  NEXT = 5,\n  PREVIOUS = 6\n}\n","import { Injectable, NgZone } from '@angular/core';\nimport { interval, ReplaySubject, Observable } from 'rxjs';\nimport { switchMap, tap, distinctUntilChanged, filter } from 'rxjs/operators';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleService {\n  private currentRgbColor: string;\n  private colorSubject: ReplaySubject<string> = new ReplaySubject();\n\n  constructor(private zone: NgZone) {}\n\n  get onChange(): Observable<string> {\n    return this.colorSubject.asObservable().pipe(\n      filter(c => c !== null),\n      distinctUntilChanged()\n    );\n  }\n\n  init() {\n    this.zone.runOutsideAngular(() => {\n      interval(1000)\n        .pipe(\n          tap(() => {\n            const previousRgbColor = this.currentRgbColor;\n            const currentRgbColor = this.getComputedBackgroundColor(1);\n            if (previousRgbColor !== currentRgbColor) {\n              this.currentRgbColor = currentRgbColor;\n              this.colorSubject.next(currentRgbColor);\n            }\n          })\n        )\n        .subscribe();\n    });\n  }\n\n  public convertToRgba(rgbColor: string, opacity: number) {\n    return rgbColor.replace(/rgb/i, 'rgba').replace(/\\)/i, `,${opacity})`);\n  }\n\n  private getComputedBackgroundColor(opacity: number): string {\n    const matAppBackground = document.getElementsByClassName(\n      'mat-app-background'\n    );\n    const matSidenavContainer = document.getElementsByTagName(\n      'mat-sidenav-container'\n    );\n\n    if (matAppBackground.length > 0) {\n      return this.getComputedStyle(matAppBackground[0], 'background-color');\n    } else if (matSidenavContainer.length > 0) {\n      return this.getComputedStyle(matSidenavContainer[0], 'background-color');\n    } else {\n      return null;\n    }\n  }\n\n  private getComputedStyle(el: any, property: string) {\n    return window.getComputedStyle(el, null).getPropertyValue(property);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { MediaObserver } from '@angular/flex-layout';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\nimport { MimeViewerConfig } from '../mime-viewer-config';\nimport { ViewerLayout } from '../models/viewer-layout';\n\n@Injectable()\nexport class ViewerLayoutService {\n  private mimeConfig = new MimeViewerConfig();\n  private _layout: ViewerLayout;\n  private subject: BehaviorSubject<ViewerLayout> = new BehaviorSubject<\n    ViewerLayout\n  >(this.mimeConfig.initViewerLayout);\n  constructor(private mediaObserver: MediaObserver) {}\n\n  init(isPagedManifest?: boolean): void {\n    if (\n      this.mimeConfig.initViewerLayout === ViewerLayout.TWO_PAGE &&\n      isPagedManifest &&\n      !this.isMobile()\n    ) {\n      this._layout = ViewerLayout.TWO_PAGE;\n      this.change();\n    } else {\n      this._layout = ViewerLayout.ONE_PAGE;\n      this.change();\n    }\n  }\n\n  get onChange(): Observable<ViewerLayout> {\n    return this.subject.asObservable().pipe(distinctUntilChanged());\n  }\n\n  get layout(): ViewerLayout {\n    return this._layout;\n  }\n\n  setLayout(viewerLayout: ViewerLayout) {\n    this._layout = viewerLayout;\n    this.change();\n  }\n\n  toggle() {\n    if (this._layout === ViewerLayout.TWO_PAGE) {\n      this.setLayout(ViewerLayout.ONE_PAGE);\n    } else if (this._layout === ViewerLayout.ONE_PAGE) {\n      this.setLayout(ViewerLayout.TWO_PAGE);\n    }\n  }\n\n  private change() {\n    this.subject.next(this._layout);\n  }\n\n  private isMobile(): boolean {\n    return this.mediaObserver.isActive('lt-md');\n  }\n}\n","import { Direction } from '../models/direction';\nimport {\n  CalculateNextCanvasGroupStrategy,\n  NextCanvasGroupCriteria\n} from './calculate-next-canvas-group-strategy';\n\nexport class NavigatorCalculateNextCanvasGroupStrategy\n  implements CalculateNextCanvasGroupStrategy {\n  calculateNextCanvasGroup(criteria: NextCanvasGroupCriteria): number {\n    const direction = criteria.direction;\n    const currentCanvasGroupIndex = criteria.currentCanvasGroupIndex;\n\n    let nextCanvasGroup = 1;\n    nextCanvasGroup =\n      direction === Direction.NEXT ? nextCanvasGroup : nextCanvasGroup * -1;\n    nextCanvasGroup = currentCanvasGroupIndex + nextCanvasGroup;\n    return nextCanvasGroup;\n  }\n}\n","import { Direction } from '../models/direction';\nimport { ViewingDirection } from '../models/viewing-direction';\nimport {\n  CalculateNextCanvasGroupStrategy,\n  NextCanvasGroupCriteria\n} from './calculate-next-canvas-group-strategy';\n\nexport class DashboardModeCalculateNextCanvasGroupStrategy\n  implements CalculateNextCanvasGroupStrategy {\n  calculateNextCanvasGroup(criteria: NextCanvasGroupCriteria): number {\n    const speed = criteria.speed;\n    const direction = criteria.direction;\n    const currentCanvasGroupIndex = criteria.currentCanvasGroupIndex;\n    const currentCanvasGroupCenter = criteria.currentCanvasGroupCenter;\n\n    let nextCanvasGroup: number;\n    let canvasGroupDelta = this.calculateNumberOfCanvasGroupsToGo(speed);\n    if (canvasGroupDelta === 0) {\n      nextCanvasGroup = currentCanvasGroupCenter;\n    } else {\n      canvasGroupDelta =\n        direction === Direction.LEFT ? canvasGroupDelta : canvasGroupDelta * -1;\n      nextCanvasGroup =\n        criteria.viewingDirection === ViewingDirection.LTR\n          ? currentCanvasGroupIndex + canvasGroupDelta\n          : currentCanvasGroupIndex - canvasGroupDelta;\n    }\n\n    return nextCanvasGroup;\n  }\n\n  private calculateNumberOfCanvasGroupsToGo(speed: number): number {\n    if (speed < 500) {\n      return 0;\n    } else if (speed >= 500 && speed < 1500) {\n      return 1;\n    } else if (speed >= 1500 && speed < 2500) {\n      return 3;\n    } else if (speed >= 2500 && speed < 3500) {\n      return 5;\n    } else {\n      return 10;\n    }\n  }\n}\n","import { Direction } from '../models/direction';\nimport { ViewingDirection } from '../models/viewing-direction';\nimport {\n  CalculateNextCanvasGroupStrategy,\n  NextCanvasGroupCriteria\n} from './calculate-next-canvas-group-strategy';\n\nexport class PageModeCalculateNextCanvasGroupStrategy\n  implements CalculateNextCanvasGroupStrategy {\n  calculateNextCanvasGroup(criteria: NextCanvasGroupCriteria): number {\n    const isNewCanvasGroupInCenter =\n      criteria.currentCanvasGroupIndex !== criteria.currentCanvasGroupCenter;\n    const speed = criteria.speed;\n    const direction = criteria.direction;\n\n    let nextCanvasGroup = criteria.currentCanvasGroupIndex;\n    if (speed >= 200) {\n      const diff = direction === Direction.LEFT ? 1 : -1;\n      nextCanvasGroup =\n        criteria.viewingDirection === ViewingDirection.LTR\n          ? criteria.currentCanvasGroupIndex + diff\n          : criteria.currentCanvasGroupIndex - diff;\n    } else if (isNewCanvasGroupInCenter) {\n      nextCanvasGroup = criteria.currentCanvasGroupCenter;\n    }\n    return nextCanvasGroup;\n  }\n}\n","import { Direction } from '../models/direction';\nimport { ViewingDirection } from '../models/viewing-direction';\nimport {\n  CalculateNextCanvasGroupStrategy,\n  NextCanvasGroupCriteria\n} from './calculate-next-canvas-group-strategy';\n\nexport class PageZoomedModeCalculateNextCanvasGroupStrategy\n  implements CalculateNextCanvasGroupStrategy {\n  calculateNextCanvasGroup(criteria: NextCanvasGroupCriteria): number {\n    const direction = criteria.direction;\n    const currentCanvasGroupIndex = criteria.currentCanvasGroupIndex;\n    const canvasGroupEndHitCountReached =\n      criteria.canvasGroupEndHitCountReached;\n\n    let nextCanvasGroup = canvasGroupEndHitCountReached ? 1 : 0;\n\n    nextCanvasGroup =\n      direction === Direction.LEFT ? nextCanvasGroup : nextCanvasGroup * -1;\n    nextCanvasGroup =\n      criteria.viewingDirection === ViewingDirection.LTR\n        ? currentCanvasGroupIndex + nextCanvasGroup\n        : currentCanvasGroupIndex - nextCanvasGroup;\n    return nextCanvasGroup;\n  }\n}\n","import { ViewerMode } from '../models/viewer-mode';\nimport { NavigatorCalculateNextCanvasGroupStrategy } from './navigator-calculate-next-canvas-group-strategy';\nimport { CalculateNextCanvasGroupStrategy } from './calculate-next-canvas-group-strategy';\nimport { DashboardModeCalculateNextCanvasGroupStrategy } from './dashboard-mode-calculate-next-canvas-group-strategy';\nimport { PageModeCalculateNextCanvasGroupStrategy } from './page-mode-calculate-next-canvas-group-strategy';\nimport { PageZoomedModeCalculateNextCanvasGroupStrategy } from './page-zoomed-mode-calculate-next-canvas-group-strategy';\n\nexport class CalculateNextCanvasGroupFactory {\n  public static create(mode: ViewerMode): CalculateNextCanvasGroupStrategy {\n    if (mode === ViewerMode.DASHBOARD) {\n      return new DashboardModeCalculateNextCanvasGroupStrategy();\n    } else if (mode === ViewerMode.PAGE) {\n      return new PageModeCalculateNextCanvasGroupStrategy();\n    } else if (mode === ViewerMode.PAGE_ZOOMED) {\n      return new PageZoomedModeCalculateNextCanvasGroupStrategy();\n    } else {\n      return new NavigatorCalculateNextCanvasGroupStrategy();\n    }\n  }\n}\n","import * as d3 from 'd3';\nimport * as OpenSeadragon from 'openseadragon';\n\nimport { ViewerOptions } from '../models/viewer-options';\nimport { Point } from '../models/point';\nimport { Rect } from '../models/rect';\nimport { StyleService } from '../style-service/style.service';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nexport class CanvasGroupMask {\n  viewer: any;\n  canvasGroupRect: Rect;\n\n  leftMask: any;\n  rightMask: any;\n\n  disableResize = false;\n  center: Point;\n\n  backgroundColor: string;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(viewer: any, private styleService: StyleService) {\n    this.viewer = viewer;\n    styleService.onChange.pipe(takeUntil(this.destroyed)).subscribe(c => {\n      this.backgroundColor = c;\n      if (this.leftMask) {\n        this.leftMask.style('fill', this.backgroundColor);\n      }\n      if (this.rightMask) {\n        this.rightMask.style('fill', this.backgroundColor);\n      }\n    });\n  }\n\n  public initialise(pageBounds: Rect, visible: boolean): void {\n    this.canvasGroupRect = pageBounds;\n\n    this.addCanvasGroupMask();\n\n    this.setCenter();\n    this.resize();\n\n    if (visible) {\n      this.show();\n    } else {\n      this.hide();\n    }\n  }\n\n  public destroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  public changeCanvasGroup(pageBounds: Rect) {\n    this.canvasGroupRect = pageBounds;\n    this.resize();\n  }\n\n  public show(): void {\n    this.addHandlers();\n    if (!this.leftMask || !this.rightMask) {\n      return;\n    }\n    this.setCenter();\n    this.resize();\n    this.leftMask.attr('height', '100%');\n    this.rightMask.attr('height', '100%');\n  }\n\n  public hide(): void {\n    this.removeHandlers();\n    if (!this.leftMask || !this.rightMask) {\n      return;\n    }\n    this.leftMask.attr('height', '0');\n    this.rightMask.attr('height', '0');\n  }\n\n  private addHandlers() {\n    this.viewer.addHandler('animation', this.animationHandler);\n    this.viewer.addHandler('resize', this.resizeHandler);\n    this.viewer.addHandler('canvas-pinch', this.canvasGroupPinchHandler);\n    this.viewer.addHandler('canvas-drag', this.canvasGroupDragHandler);\n    this.viewer.addHandler('canvas-drag-end', this.canvasGroupDragEndHandler);\n  }\n\n  private removeHandlers() {\n    this.viewer.removeHandler('animation', this.animationHandler);\n    this.viewer.removeHandler('resize', this.resizeHandler);\n    this.viewer.removeHandler('canvas-pinch', this.canvasGroupPinchHandler);\n    this.viewer.removeHandler('canvas-drag', this.canvasGroupDragHandler);\n    this.viewer.removeHandler(\n      'canvas-drag-end',\n      this.canvasGroupDragEndHandler\n    );\n  }\n\n  private animationHandler = () => {\n    this.resize();\n  };\n\n  private resizeHandler = () => {\n    this.setCenter();\n    this.resize();\n  };\n\n  private canvasGroupPinchHandler = () => {\n    this.disableResize = false;\n  };\n\n  private canvasGroupDragHandler = (e: any) => {\n    if ((e.delta.x || e.delta.y) && e.speed > 0 && e.direction !== 0) {\n      this.disableResize = true;\n    }\n  };\n\n  private canvasGroupDragEndHandler = () => {\n    this.disableResize = false;\n    this.resize();\n  };\n\n  private addCanvasGroupMask() {\n    const overlays = d3.select(this.viewer.svgOverlay().node().parentNode);\n\n    const mask = overlays.append('g').attr('id', 'page-mask');\n\n    this.leftMask = mask\n      .append('rect')\n      .attr('id', 'mime-left-page-mask')\n      .attr('height', '100%')\n      .attr('y', 0)\n      .style('fill', this.backgroundColor);\n\n    this.rightMask = mask\n      .append('rect')\n      .attr('id', 'mime-right-page-mask')\n      .attr('height', '100%')\n      .attr('y', 0)\n      .style('fill', this.backgroundColor);\n  }\n\n  private setCenter(): void {\n    this.center = new OpenSeadragon.Point(\n      this.viewer.viewport._containerInnerSize.x / 2,\n      this.viewer.viewport._containerInnerSize.y / 2\n    );\n  }\n\n  private resize(): void {\n    if (this.disableResize || !this.leftMask || !this.rightMask) {\n      return;\n    }\n\n    const leftMaskRect = this.getLeftMaskRect();\n    const rightMaskRect = this.getRightMaskRect();\n    this.leftMask.attr('width', leftMaskRect.width).attr('x', leftMaskRect.x);\n    this.rightMask\n      .attr('width', rightMaskRect.width)\n      .attr('x', Math.round(rightMaskRect.x));\n  }\n\n  private getLeftMaskRect(): Rect {\n    const imgBounds = new OpenSeadragon.Rect(\n      this.canvasGroupRect.x,\n      this.canvasGroupRect.y,\n      this.canvasGroupRect.width,\n      this.canvasGroupRect.height\n    );\n    const topLeft = this.viewer.viewport.viewportToViewerElementCoordinates(\n      imgBounds.getTopLeft()\n    );\n    let width = topLeft.x - ViewerOptions.overlays.canvasGroupMarginInPageView;\n\n    if (width < 0) {\n      width = 0;\n    }\n\n    return new Rect({\n      x: 0,\n      width: width\n    });\n  }\n\n  private getRightMaskRect(): Rect {\n    const imgBounds = new OpenSeadragon.Rect(\n      this.canvasGroupRect.x,\n      this.canvasGroupRect.y,\n      this.canvasGroupRect.width,\n      this.canvasGroupRect.height\n    );\n    const topRight = this.viewer.viewport.viewportToViewerElementCoordinates(\n      imgBounds.getTopRight()\n    );\n    let width = this.viewer.viewport._containerInnerSize.x - topRight.x;\n    const x =\n      this.viewer.viewport._containerInnerSize.x -\n      width +\n      ViewerOptions.overlays.canvasGroupMarginInPageView;\n\n    if (width < 0) {\n      width = 0;\n    }\n\n    return new Rect({\n      x: x,\n      width: width\n    });\n  }\n}\n","import { CanvasService } from '../canvas-service/canvas-service';\nimport { MimeViewerConfig } from '../mime-viewer-config';\nimport { ModeService } from '../mode-service/mode.service';\nimport { Direction } from '../models/direction';\nimport { Options } from '../models/options';\nimport { Point } from '../models/point';\nimport { Rect } from '../models/rect';\nimport { ViewerMode } from '../models/viewer-mode';\nimport { ViewerOptions } from '../models/viewer-options';\nimport { ViewingDirection } from '../models/viewing-direction';\nimport { CalculateNextCanvasGroupFactory } from './calculate-next-canvas-group-factory';\nimport { Strategy } from './zoom-strategy';\n\nexport interface CanvasGroup {\n  canvasGroupIndex: number;\n  direction?: Direction;\n  immediately?: boolean;\n}\n\nexport interface GoToCanvasGroupStrategy {\n  goToCanvasGroup(canvasGroup: CanvasGroup): void;\n  goToPreviousCanvasGroup(currentCanvasIndex: number): void;\n  goToNextCanvasGroup(currentCanvasIndex: number): void;\n  centerCurrentCanvas(): void;\n}\n\nexport class DefaultGoToCanvasGroupStrategy implements GoToCanvasGroupStrategy {\n  constructor(\n    private viewer: any,\n    private zoomStrategy: Strategy,\n    private canvasService: CanvasService,\n    private modeService: ModeService,\n    private config: MimeViewerConfig,\n    private viewingDirection: ViewingDirection\n  ) {}\n\n  goToCanvasGroup(canvasGroup: CanvasGroup) {\n    const oldCanvasGroupIndex = this.canvasService.currentCanvasGroupIndex;\n    this.canvasService.currentCanvasGroupIndex = this.canvasService.constrainToRange(\n      canvasGroup.canvasGroupIndex\n    );\n    const newCanvasGroup = this.canvasService.getCanvasGroupRect(\n      this.canvasService.currentCanvasGroupIndex\n    );\n    if (\n      this.modeService.mode === ViewerMode.PAGE_ZOOMED &&\n      this.config.preserveZoomOnCanvasGroupChange\n    ) {\n      let x: number;\n\n      if (oldCanvasGroupIndex > canvasGroup.canvasGroupIndex) {\n        if (this.config.startOnTopOnCanvasGroupChange) {\n          const canvasGroupIndexes = this.canvasService.getCanvasesPerCanvasGroup(\n            canvasGroup.canvasGroupIndex\n          );\n          const previousCanvasIndex =\n            canvasGroupIndexes[canvasGroupIndexes.length - 1];\n          const previousCanvasRect = this.canvasService.getCanvasRect(\n            previousCanvasIndex\n          );\n          x =\n            this.viewingDirection === ViewingDirection.LTR\n              ? this.leftX(previousCanvasRect)\n              : this.rightX(newCanvasGroup);\n        } else {\n          x =\n            this.viewingDirection === ViewingDirection.LTR\n              ? this.rightX(newCanvasGroup)\n              : this.leftX(newCanvasGroup);\n        }\n      } else {\n        x =\n          this.viewingDirection === ViewingDirection.LTR\n            ? this.leftX(newCanvasGroup)\n            : this.rightX(newCanvasGroup);\n      }\n\n      const y = this.config.startOnTopOnCanvasGroupChange\n        ? newCanvasGroup.y +\n          this.getViewportBounds().height / 2 -\n          new Options().collectionTileMargin\n        : this.getViewportCenter().y;\n\n      this.panTo(x, y, canvasGroup.immediately);\n    } else if (this.modeService.mode === ViewerMode.PAGE_ZOOMED) {\n      const oldCanvasGroupCenter = this.canvasService.getCanvasGroupRect(\n        oldCanvasGroupIndex\n      );\n      this.panToCenter(oldCanvasGroupCenter, canvasGroup.immediately);\n      this.zoomStrategy.goToHomeZoom();\n      setTimeout(() => {\n        this.panToCenter(newCanvasGroup, canvasGroup.immediately);\n        this.modeService.mode = ViewerMode.PAGE;\n      }, ViewerOptions.transitions.OSDAnimationTime);\n    } else {\n      this.panToCenter(newCanvasGroup, canvasGroup.immediately);\n    }\n  }\n\n  public goToPreviousCanvasGroup(currentCanvasIndex: number): void {\n    if (this.canvasService.currentCanvasGroupIndex > 0) {\n      const viewportCenter = this.getViewportCenter();\n      const currentCanvasGroupIndex = this.canvasService.findClosestCanvasGroupIndex(\n        viewportCenter\n      );\n\n      const calculateNextCanvasGroupStrategy = CalculateNextCanvasGroupFactory.create(\n        null\n      );\n      const newCanvasGroupIndex = calculateNextCanvasGroupStrategy.calculateNextCanvasGroup(\n        {\n          direction: Direction.PREVIOUS,\n          currentCanvasGroupIndex: currentCanvasGroupIndex,\n          currentCanvasGroupCenter: currentCanvasIndex,\n          viewingDirection: this.viewingDirection\n        }\n      );\n      this.goToCanvasGroup({\n        canvasGroupIndex: newCanvasGroupIndex,\n        immediately: false\n      });\n    }\n  }\n\n  public goToNextCanvasGroup(currentCanvasIndex: number): void {\n    if (\n      this.canvasService.currentCanvasGroupIndex <\n      this.canvasService.numberOfCanvasGroups\n    ) {\n      const viewportCenter = this.getViewportCenter();\n      const currentCanvasGroupIndex = this.canvasService.findClosestCanvasGroupIndex(\n        viewportCenter\n      );\n\n      const calculateNextCanvasGroupStrategy = CalculateNextCanvasGroupFactory.create(\n        null\n      );\n      const newCanvasGroupIndex = calculateNextCanvasGroupStrategy.calculateNextCanvasGroup(\n        {\n          direction: Direction.NEXT,\n          currentCanvasGroupIndex: currentCanvasGroupIndex,\n          currentCanvasGroupCenter: currentCanvasIndex,\n          viewingDirection: this.viewingDirection\n        }\n      );\n      this.goToCanvasGroup({\n        canvasGroupIndex: newCanvasGroupIndex,\n        immediately: false\n      });\n    }\n  }\n\n  public centerCurrentCanvas(): void {\n    const currentCanvasGroupIndex = this.canvasService.currentCanvasGroupIndex;\n    const currentCanvasGroupCenter = this.canvasService.getCanvasGroupRect(\n      currentCanvasGroupIndex\n    );\n    this.panToCenter(currentCanvasGroupCenter, false);\n  }\n\n  private leftX(canvas: Rect): number {\n    return canvas.x + this.getViewportBounds().width / 2;\n  }\n\n  private rightX(canvas: Rect): number {\n    return canvas.x + canvas.width - this.getViewportBounds().width / 2;\n  }\n\n  private panToCenter(canvasGroup: Rect, immediately: boolean): void {\n    this.panTo(canvasGroup.centerX, canvasGroup.centerY, immediately);\n  }\n\n  private panTo(x: number, y: number, immediately: boolean): void {\n    this.viewer.viewport.panTo(\n      {\n        x: x,\n        y: y\n      },\n      immediately\n    );\n  }\n\n  private getViewportCenter(): Point {\n    return this.viewer.viewport.getCenter(true);\n  }\n\n  private getViewportBounds(): Rect {\n    return this.viewer.viewport.getBounds(true);\n  }\n}\n","import { Direction } from '../models/direction';\nimport { Side } from '../models/side';\nexport class SwipeDragEndCounter {\n  public leftCount: number;\n  public rightCount: number;\n\n  constructor() {\n    this.reset();\n  }\n\n  public reset(): void {\n    this.leftCount = 0;\n    this.rightCount = 0;\n  }\n\n  /**\n   * @param direction of swipe / pan\n   * @param side hit by swipe\n   */\n  public addHit(side: Side, dir: Direction): void {\n    this.incrementSide(side);\n    this.clearOppositeSideOfDragDirection(dir);\n  }\n\n  public hitCountReached(): boolean {\n    return this.leftCount >= 2 || this.rightCount >= 2;\n  }\n\n  private incrementSide(side: Side): void {\n    if (side === Side.LEFT) {\n      this.leftCount++;\n      this.rightCount = 0;\n    } else if (side === Side.RIGHT) {\n      this.rightCount++;\n      this.leftCount = 0;\n    }\n  }\n\n  /**\n   * Clear opposite side if swiping in the other direction\n   * @param Direction of swipe / pan\n   */\n  private clearOppositeSideOfDragDirection(dir: Direction): void {\n    if (dir === Direction.LEFT) {\n      this.leftCount = 0;\n    } else if (dir === Direction.RIGHT) {\n      this.rightCount = 0;\n    }\n  }\n}\n","import { Rect } from '../models/rect';\nimport { Point } from '../models/point';\nimport { Side } from '../models/side';\nimport { Direction } from '../models/direction';\nimport { ViewerOptions } from '../models/viewer-options';\nexport class SwipeUtils {\n  // Added threshold to prevent sensitive direction-calculation when zoomed in\n  static getSwipeDirection(\n    start: Point,\n    end: Point,\n    useThreshold?: boolean\n  ): Direction {\n    let deltaX = Math.abs(start.x - end.x);\n    const deltaY = Math.abs(start.y - end.y);\n    deltaX = useThreshold\n      ? deltaX - ViewerOptions.pan.swipeDirectionThreshold\n      : deltaX;\n\n    if (start.x > end.x && deltaX >= deltaY) {\n      return Direction.LEFT;\n    } else if (start.x < end.x && deltaX >= deltaY) {\n      return Direction.RIGHT;\n    }\n  }\n\n  static getSideIfPanningPastEndOfCanvasGroup(\n    canvasGroupRect: Rect,\n    vpBounds: Rect\n  ): Side {\n    if (this.isPanningOutsideLeft(canvasGroupRect, vpBounds)) {\n      return Side.LEFT;\n    } else if (this.isPanningOutsideRight(canvasGroupRect, vpBounds)) {\n      return Side.RIGHT;\n    }\n  }\n\n  static isPanningOutsideCanvasGroup(\n    canvasGroupRect: Rect,\n    vpBounds: Rect\n  ): boolean {\n    return (\n      this.isPanningOutsideLeft(canvasGroupRect, vpBounds) ||\n      this.isPanningOutsideRight(canvasGroupRect, vpBounds)\n    );\n  }\n\n  static isPanningOutsideLeft(canvasGroupRect: Rect, vpBounds: Rect): boolean {\n    return vpBounds.x < canvasGroupRect.x;\n  }\n\n  static isPanningOutsideRight(canvasGroupRect: Rect, vpBounds: Rect): boolean {\n    return (\n      vpBounds.x + vpBounds.width > canvasGroupRect.x + canvasGroupRect.width\n    );\n  }\n\n  /**\n   *\n   * @param direction Current computed direction, expressed as an\n   * angle counterclockwise relative to the positive X axis (-pi to pi, in radians).\n   * Only valid if speed > 0.\n   */\n  static isDirectionInRightSemicircle(direction: number): boolean {\n    return direction > -Math.PI / 2 && direction < Math.PI / 2;\n  }\n\n  /**\n   * @param direction @see isDirectionInRightSemicircle\n   */\n  static isDirectionInLeftSemicircle(direction: number): boolean {\n    return !this.isDirectionInRightSemicircle(direction) || direction === 0; // fix for speed = 0\n  }\n}\n","import { Service } from '../models/manifest';\nimport { TileSourceStrategy } from './tile-source-strategy';\n\nexport class IiifTileSourceStrategy implements TileSourceStrategy {\n  public getTileSource(resource: Service): any {\n    let tileSource: any;\n    if (resource.service.service) {\n      tileSource = resource.service;\n    } else {\n      tileSource = resource.service['@id'];\n      tileSource = tileSource.startsWith('//')\n        ? `${location.protocol}${tileSource}`\n        : tileSource;\n      tileSource = !tileSource.endsWith('/info.json')\n        ? `${tileSource}/info.json`\n        : tileSource;\n    }\n    return tileSource;\n  }\n}\n","import { Service } from '../models/manifest';\nimport { TileSourceStrategy } from './tile-source-strategy';\n\nexport class StaticImageTileSourceStrategy implements TileSourceStrategy {\n  public getTileSource(resource: Service): any {\n    return {\n      type: 'image',\n      url: resource['@id']\n    };\n  }\n}\n","import { Service } from '../models/manifest';\nimport { IiifTileSourceStrategy } from './iiif-tile-source-strategy';\nimport { StaticImageTileSourceStrategy } from './static-image-tile-source-strategy';\nimport { TileSourceStrategy } from './tile-source-strategy';\n\nexport class TileSourceStrategyFactory {\n  public static create(resource: Service): TileSourceStrategy {\n    if (resource.service) {\n      return new IiifTileSourceStrategy();\n    } else {\n      return new StaticImageTileSourceStrategy();\n    }\n  }\n}\n","export class Dimensions {\n  bottom? = 0;\n  height? = 0;\n  left? = 0;\n  right? = 0;\n  top? = 0;\n  width? = 0;\n\n  constructor(fields?: {\n    bottom?: number;\n    height?: number;\n    left?: number;\n    right?: number;\n    top?: number;\n    width?: number;\n  }) {\n    if (fields) {\n      this.bottom = fields.bottom || this.bottom;\n      this.height = fields.height || this.height;\n      this.left = fields.left || this.left;\n      this.right = fields.right || this.right;\n      this.top = fields.top || this.top;\n      this.width = fields.width || this.width;\n    }\n  }\n}\n","export class Utils {\n  static numbersAreClose(\n    thing: number,\n    realThing: number,\n    epsilon: number\n  ): boolean {\n    return Math.abs(thing - realThing) <= epsilon;\n  }\n  static shortenDecimals(zoom: any, precision: number): number {\n    const short = Number(zoom).toPrecision(precision);\n    return Number(short);\n  }\n}\n","import { Rect } from '../models/rect';\nimport { Point } from '../models/point';\n\nexport class ZoomUtils {\n  /**\n   *\n   * @param Point in OSD-viewport-coordinates\n   * @param Rect canvasGroupBounds\n   */\n  static constrainPositionToCanvasGroup(\n    point: Point,\n    canvasGroupBounds: Rect\n  ): Point {\n    if (point.x < canvasGroupBounds.x) {\n      point.x = canvasGroupBounds.x;\n    } else if (point.x > canvasGroupBounds.x + canvasGroupBounds.width) {\n      point.x = canvasGroupBounds.x + canvasGroupBounds.width;\n    }\n    return point;\n  }\n\n  static constraintZoomFactor(\n    zoomFactor: number,\n    currentZoom: number,\n    maxZoom: number\n  ): number {\n    const target = currentZoom * zoomFactor;\n    return target > maxZoom ? (maxZoom / target) * zoomFactor : zoomFactor;\n  }\n}\n","import * as d3 from 'd3';\nimport * as OpenSeadragon from 'openseadragon';\nimport { CanvasService } from '../canvas-service/canvas-service';\nimport { ModeService } from '../mode-service/mode.service';\nimport { Dimensions } from '../models/dimensions';\nimport { Direction } from '../models/direction';\nimport { Point } from '../models/point';\nimport { ViewerLayout } from '../models/viewer-layout';\nimport { ViewerMode } from '../models/viewer-mode';\nimport { ViewerOptions } from '../models/viewer-options';\nimport { Utils } from '../utils';\nimport { ViewerLayoutService } from '../viewer-layout-service/viewer-layout-service';\nimport { ZoomUtils } from './zoom-utils';\n\nexport interface CanvasGroup {\n  canvasGroupIndex: number;\n  canvasGroupEndHitCountReached?: boolean;\n  direction: Direction;\n  immediately: boolean;\n}\n\nexport interface Strategy {\n  setMinZoom(mode: ViewerMode): void;\n  getMinZoom(): number;\n  getMaxZoom(): number;\n  getZoom(): number;\n  goToHomeZoom(): void;\n  zoomTo(level: number, position?: Point): void;\n  zoomIn(zoomFactor?: number, position?: Point): void;\n  zoomOut(zoomFactor?: number, position?: Point): void;\n}\n\nexport class ZoomStrategy {\n  constructor(\n    protected viewer: any,\n    protected canvasService: CanvasService,\n    protected modeService: ModeService,\n    protected viewerLayoutService: ViewerLayoutService\n  ) {}\n\n  setMinZoom(mode: ViewerMode): void {\n    this.viewer.viewport.minZoomLevel = this.getHomeZoomLevel(mode);\n  }\n\n  getMinZoom(): number {\n    return Utils.shortenDecimals(this.viewer.viewport.getMinZoom(), 5);\n  }\n\n  getMaxZoom(): number {\n    return Utils.shortenDecimals(this.viewer.viewport.getMaxZoom(), 5);\n  }\n\n  getZoom(): number {\n    return Utils.shortenDecimals(this.viewer.viewport.getZoom(true), 5);\n  }\n\n  goToHomeZoom(): void {\n    this.zoomTo(this.getHomeZoomLevel(this.modeService.mode));\n    if (this.modeService.mode === ViewerMode.PAGE_ZOOMED) {\n      this.modeService.mode = ViewerMode.PAGE;\n    }\n  }\n\n  zoomTo(level: number, position?: Point): void {\n    this.viewer.viewport.zoomTo(level, position);\n  }\n\n  private getHomeZoomLevel(mode: ViewerMode): number {\n    if (!this.viewer || !this.canvasService) {\n      return;\n    }\n\n    let canvasGroupHeight: number;\n    let canvasGroupWidth: number;\n    let viewportBounds: any;\n\n    if (mode === ViewerMode.DASHBOARD) {\n      canvasGroupHeight = this.canvasService.getMaxHeight();\n      canvasGroupWidth = this.canvasService.getMaxWidth();\n      viewportBounds = this.getDashboardViewportBounds();\n    } else {\n      const currentCanvasGroupRect = this.canvasService.getCurrentCanvasGroupRect();\n      canvasGroupHeight = currentCanvasGroupRect.height;\n      canvasGroupWidth = currentCanvasGroupRect.width;\n      viewportBounds = this.viewer.viewport.getBounds();\n    }\n\n    return this.getFittedZoomLevel(\n      viewportBounds,\n      canvasGroupHeight,\n      canvasGroupWidth\n    );\n  }\n\n  zoomIn(zoomFactor?: number, position?: Point): void {\n    if (typeof zoomFactor === 'undefined') {\n      zoomFactor = ViewerOptions.zoom.zoomFactor;\n    }\n\n    if (typeof position !== 'undefined') {\n      position = this.viewer.viewport.pointFromPixel(position);\n      position = ZoomUtils.constrainPositionToCanvasGroup(\n        position,\n        this.canvasService.getCurrentCanvasGroupRect()\n      );\n    }\n\n    if (this.modeService.mode !== ViewerMode.PAGE_ZOOMED) {\n      this.modeService.mode = ViewerMode.PAGE_ZOOMED;\n    }\n\n    this.zoomBy(zoomFactor, position);\n  }\n\n  zoomOut(zoomFactor?: number, position?: Point): void {\n    if (typeof zoomFactor === 'undefined') {\n      zoomFactor = Math.pow(ViewerOptions.zoom.zoomFactor, -1);\n    }\n\n    if (typeof position !== 'undefined') {\n      position = this.viewer.viewport.pointFromPixel(position);\n      position = ZoomUtils.constrainPositionToCanvasGroup(\n        position,\n        this.canvasService.getCurrentCanvasGroupRect()\n      );\n    }\n\n    if (this.isViewportLargerThanCanvasGroup()) {\n      this.modeService.mode = ViewerMode.PAGE;\n    } else {\n      this.zoomBy(zoomFactor, position);\n    }\n  }\n\n  private getDashboardViewportBounds(): any {\n    if (!this.viewer) {\n      return;\n    }\n\n    const homeZoomFactor = this.getHomeZoomFactor();\n    const maxViewportDimensions = new Dimensions(\n      d3\n        .select(this.viewer.container.parentNode.parentNode)\n        .node()\n        .getBoundingClientRect()\n    );\n    const viewportHeight =\n      maxViewportDimensions.height -\n      ViewerOptions.padding.header -\n      ViewerOptions.padding.footer;\n    const viewportWidth = maxViewportDimensions.width * homeZoomFactor;\n\n    const viewportSizeInViewportCoordinates = this.viewer.viewport.deltaPointsFromPixels(\n      new OpenSeadragon.Point(viewportWidth, viewportHeight)\n    );\n\n    return new OpenSeadragon.Rect(\n      0,\n      0,\n      viewportSizeInViewportCoordinates.x,\n      viewportSizeInViewportCoordinates.y\n    );\n  }\n\n  private getFittedZoomLevel(\n    viewportBounds: any,\n    canvasGroupHeight: number,\n    canvasGroupWidth: number\n  ) {\n    const currentZoom: number = this.viewer.viewport.getZoom();\n    const resizeRatio: number = viewportBounds.height / canvasGroupHeight;\n\n    if (resizeRatio * canvasGroupWidth <= viewportBounds.width) {\n      return Utils.shortenDecimals(resizeRatio * currentZoom, 5);\n    } else {\n      // Canvas group at full height is wider than viewport.  Return fit by width instead.\n      return Utils.shortenDecimals(\n        (viewportBounds.width / canvasGroupWidth) * currentZoom,\n        5\n      );\n    }\n  }\n\n  private zoomBy(zoomFactor: number, position?: Point): void {\n    const currentZoom = this.viewer.viewport.getZoom(false);\n    zoomFactor = ZoomUtils.constraintZoomFactor(\n      zoomFactor,\n      currentZoom,\n      this.getMaxZoom()\n    );\n    this.viewer.viewport.zoomBy(zoomFactor, position);\n  }\n\n  private isViewportLargerThanCanvasGroup(): boolean {\n    const canvasGroupRec = this.canvasService.getCurrentCanvasGroupRect();\n    const viewportBounds = this.viewer.viewport.getBounds();\n    const pbWidth = Math.round(canvasGroupRec.width);\n    const pbHeight = Math.round(canvasGroupRec.height);\n    const vpWidth = Math.round(viewportBounds.width);\n    const vpHeight = Math.round(viewportBounds.height);\n    return vpHeight >= pbHeight || vpWidth >= pbWidth;\n  }\n\n  private getHomeZoomFactor() {\n    return this.modeService.mode === ViewerMode.DASHBOARD\n      ? this.getDashboardZoomHomeFactor()\n      : 1;\n  }\n\n  private getDashboardZoomHomeFactor() {\n    return this.viewerLayoutService.layout === ViewerLayout.ONE_PAGE\n      ? 0.85\n      : 0.66;\n  }\n}\n\nexport class DefaultZoomStrategy extends ZoomStrategy implements Strategy {\n  constructor(\n    viewer: any,\n    canvasService: CanvasService,\n    modeService: ModeService,\n    viewerLayoutService: ViewerLayoutService\n  ) {\n    super(viewer, canvasService, modeService, viewerLayoutService);\n  }\n}\n","import { Injectable, NgZone } from '@angular/core';\nimport * as d3 from 'd3';\nimport {\n  BehaviorSubject,\n  interval,\n  Observable,\n  Subject,\n  Subscription\n} from 'rxjs';\nimport { distinctUntilChanged, sample, takeUntil } from 'rxjs/operators';\nimport { ModeService } from '../../core/mode-service/mode.service';\nimport { CalculateCanvasGroupPositionFactory } from '../canvas-group-position/calculate-canvas-group-position-factory';\nimport { CanvasService } from '../canvas-service/canvas-service';\nimport { ClickService } from '../click-service/click.service';\nimport { createSvgOverlay } from '../ext/svg-overlay';\nimport { IiifContentSearchService } from '../iiif-content-search-service/iiif-content-search.service';\nimport { ManifestUtils } from '../iiif-manifest-service/iiif-manifest-utils';\nimport { MimeViewerConfig } from '../mime-viewer-config';\nimport { Direction } from '../models/direction';\nimport { Manifest, Service } from '../models/manifest';\nimport { ModeChanges } from '../models/modeChanges';\nimport { Options } from '../models/options';\nimport { PinchStatus } from '../models/pinchStatus';\nimport { Side } from '../models/side';\nimport { ViewerLayout } from '../models/viewer-layout';\nimport { ViewerMode } from '../models/viewer-mode';\nimport { ViewerOptions } from '../models/viewer-options';\nimport { StyleService } from '../style-service/style.service';\nimport { ViewerLayoutService } from '../viewer-layout-service/viewer-layout-service';\nimport { Hit } from './../models/hit';\nimport { Point } from './../models/point';\nimport { Rect } from './../models/rect';\nimport { SearchResult } from './../models/search-result';\nimport { CalculateNextCanvasGroupFactory } from './calculate-next-canvas-group-factory';\nimport { CanvasGroupMask } from './canvas-group-mask';\nimport {\n  DefaultGoToCanvasGroupStrategy,\n  GoToCanvasGroupStrategy\n} from './go-to-canvas-group-strategy';\nimport { SwipeDragEndCounter } from './swipe-drag-end-counter';\nimport { SwipeUtils } from './swipe-utils';\nimport { TileSourceStrategyFactory } from './tile-source-strategy-factory';\nimport { DefaultZoomStrategy, ZoomStrategy } from './zoom-strategy';\n\ndeclare const OpenSeadragon: any;\n@Injectable()\nexport class ViewerService {\n  private viewer: any;\n  private svgOverlay: any;\n  private svgNode: any;\n  private config: MimeViewerConfig;\n\n  private overlays: Array<SVGRectElement>;\n  private tileSources: Array<Service>;\n  private subscriptions: Array<Subscription> = [];\n  private destroyed: Subject<void> = new Subject();\n\n  public isCanvasPressed: Subject<boolean> = new BehaviorSubject<boolean>(\n    false\n  );\n\n  private currentCenter: Subject<Point> = new Subject();\n  private currentCanvasIndex: BehaviorSubject<number> = new BehaviorSubject(0);\n  private currentHit: BehaviorSubject<Hit> = new BehaviorSubject(null);\n  private osdIsReady: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private swipeDragEndCounter = new SwipeDragEndCounter();\n  private canvasGroupMask: CanvasGroupMask;\n  private pinchStatus = new PinchStatus();\n  private dragStartPosition: any;\n  private manifest: Manifest;\n  private isManifestPaged: boolean;\n  private defaultKeyDownHandler: any;\n\n  public currentSearch: SearchResult;\n  private zoomStrategy: ZoomStrategy;\n  private goToCanvasGroupStrategy: GoToCanvasGroupStrategy;\n\n  public rotation = 0;\n\n  constructor(\n    private zone: NgZone,\n    private clickService: ClickService,\n    private canvasService: CanvasService,\n    private modeService: ModeService,\n    private viewerLayoutService: ViewerLayoutService,\n    private iiifContentSearchService: IiifContentSearchService,\n    private styleService: StyleService\n  ) {}\n\n  get onCenterChange(): Observable<Point> {\n    return this.currentCenter.asObservable();\n  }\n\n  get onCanvasGroupIndexChange(): Observable<number> {\n    return this.currentCanvasIndex.asObservable().pipe(distinctUntilChanged());\n  }\n\n  get onHitChange(): Observable<Hit> {\n    return this.currentHit.asObservable().pipe(distinctUntilChanged());\n  }\n\n  get onOsdReadyChange(): Observable<boolean> {\n    return this.osdIsReady.asObservable().pipe(distinctUntilChanged());\n  }\n\n  public getViewer(): any {\n    return this.viewer;\n  }\n\n  public getTilesources(): Service[] {\n    return this.tileSources;\n  }\n\n  public getOverlays(): SVGRectElement[] {\n    return this.overlays;\n  }\n\n  public getZoom(): number {\n    return this.zoomStrategy.getZoom();\n  }\n\n  public getMinZoom(): number {\n    return this.zoomStrategy.getMinZoom();\n  }\n\n  public getMaxZoom(): number {\n    return this.zoomStrategy.getMaxZoom();\n  }\n\n  public home(): void {\n    if (!this.osdIsReady.getValue()) {\n      return;\n    }\n    this.zoomStrategy.setMinZoom(this.modeService.mode);\n\n    this.goToCanvasGroupStrategy.centerCurrentCanvas();\n\n    this.zoomStrategy.goToHomeZoom();\n  }\n\n  public goToPreviousCanvasGroup(): void {\n    this.goToCanvasGroupStrategy.goToPreviousCanvasGroup(\n      this.currentCanvasIndex.getValue()\n    );\n  }\n\n  public goToNextCanvasGroup(): void {\n    this.goToCanvasGroupStrategy.goToNextCanvasGroup(\n      this.currentCanvasIndex.getValue()\n    );\n  }\n\n  public goToCanvasGroup(canvasGroupIndex: number, immediately: boolean): void {\n    this.goToCanvasGroupStrategy.goToCanvasGroup({\n      canvasGroupIndex: canvasGroupIndex,\n      immediately: immediately\n    });\n  }\n\n  public goToCanvas(canvasIndex: number, immediately: boolean): void {\n    const canvasGroupIndex = this.canvasService.findCanvasGroupByCanvasIndex(\n      canvasIndex\n    );\n    this.goToCanvasGroupStrategy.goToCanvasGroup({\n      canvasGroupIndex: canvasGroupIndex,\n      immediately: immediately\n    });\n  }\n\n  public highlight(searchResult: SearchResult): void {\n    this.clearHightlight();\n    if (this.viewer) {\n      if (searchResult.q) {\n        this.currentSearch = searchResult;\n      }\n      for (const hit of searchResult.hits) {\n        for (const rect of hit.rects) {\n          const canvasRect = this.canvasService.getCanvasRect(hit.index);\n          if (canvasRect) {\n            const x = canvasRect.x + rect.x;\n            const y = canvasRect.y + rect.y;\n            const width = rect.width;\n            const height = rect.height;\n            const currentOverlay: SVGRectElement = this.svgNode\n              .append('rect')\n              .attr('mimeHitIndex', hit.id)\n              .attr('x', x)\n              .attr('y', y)\n              .attr('width', width)\n              .attr('height', height)\n              .attr('class', 'hit');\n          }\n        }\n      }\n    }\n  }\n\n  private highlightCurrentHit(hit: Hit) {\n    this.svgNode.selectAll(`g > rect.selected`).attr('class', 'hit');\n    this.svgNode\n      .selectAll(`g > rect[mimeHitIndex='${hit.id}']`)\n      .attr('class', 'hit selected');\n  }\n\n  public clearHightlight(): void {\n    if (this.svgNode) {\n      this.svgNode.selectAll('.hit').remove();\n      this.currentSearch = null;\n    }\n  }\n\n  setUpViewer(manifest: Manifest, config: MimeViewerConfig) {\n    this.config = config;\n    if (manifest && manifest.tileSource) {\n      this.tileSources = manifest.tileSource;\n      this.zone.runOutsideAngular(() => {\n        this.manifest = manifest;\n        this.isManifestPaged = ManifestUtils.isManifestPaged(this.manifest);\n        this.viewer = new OpenSeadragon.Viewer(\n          Object.assign({}, this.getOptions())\n        );\n        createSvgOverlay();\n        this.zoomStrategy = new DefaultZoomStrategy(\n          this.viewer,\n          this.canvasService,\n          this.modeService,\n          this.viewerLayoutService\n        );\n        this.goToCanvasGroupStrategy = new DefaultGoToCanvasGroupStrategy(\n          this.viewer,\n          this.zoomStrategy,\n          this.canvasService,\n          this.modeService,\n          this.config,\n          this.manifest.viewingDirection\n        );\n\n        /*\n          This disables keyboard navigation in openseadragon.\n          We use s for opening search dialog and OSD use the same key for panning.\n          Issue: https://github.com/openseadragon/openseadragon/issues/794\n         */\n        this.defaultKeyDownHandler = this.viewer.innerTracker.keyDownHandler;\n        this.disableKeyDownHandler();\n        this.viewer.innerTracker.keyHandler = null;\n        this.canvasService.reset();\n        this.canvasGroupMask = new CanvasGroupMask(\n          this.viewer,\n          this.styleService\n        );\n      });\n\n      this.addToWindow();\n      this.setupOverlays();\n      this.createOverlays();\n      this.addEvents();\n      this.addSubscriptions();\n    }\n  }\n\n  addSubscriptions(): void {\n    this.modeService.onChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((mode: ModeChanges) => {\n        this.modeChanged(mode);\n      });\n\n    this.zone.runOutsideAngular(() => {\n      this.onCenterChange\n        .pipe(takeUntil(this.destroyed), sample(interval(500)))\n        .subscribe((center: Point) => {\n          this.calculateCurrentCanvasGroup(center);\n          if (center && center !== null) {\n            this.osdIsReady.next(true);\n          }\n        });\n    });\n\n    this.canvasService.onCanvasGroupIndexChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((canvasGroupIndex: number) => {\n        this.swipeDragEndCounter.reset();\n        if (canvasGroupIndex !== -1) {\n          this.canvasGroupMask.changeCanvasGroup(\n            this.canvasService.getCanvasGroupRect(canvasGroupIndex)\n          );\n          if (this.modeService.mode === ViewerMode.PAGE) {\n            this.zoomStrategy.goToHomeZoom();\n          }\n        }\n      });\n\n    this.onOsdReadyChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((state: boolean) => {\n        if (state) {\n          this.initialCanvasGroupLoaded();\n          this.currentCenter.next(this.viewer.viewport.getCenter(true));\n        }\n      });\n\n    this.viewerLayoutService.onChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((state: ViewerLayout) => {\n        this.layoutPages();\n      });\n\n    this.iiifContentSearchService.onSelected\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((hit: Hit) => {\n        if (hit) {\n          this.highlightCurrentHit(hit);\n          this.goToCanvas(hit.index, false);\n        }\n      });\n  }\n\n  private layoutPages() {\n    if (this.osdIsReady.getValue()) {\n      const currentCanvasIndex = this.canvasService.currentCanvasIndex;\n      this.destroy(true);\n      this.setUpViewer(this.manifest, this.config);\n      this.goToCanvasGroupStrategy.goToCanvasGroup({\n        canvasGroupIndex: this.canvasService.findCanvasGroupByCanvasIndex(\n          currentCanvasIndex\n        ),\n        immediately: false\n      });\n\n      // Recreate highlights if there is an active search going on\n      if (this.currentSearch) {\n        this.highlight(this.currentSearch);\n      }\n    }\n  }\n\n  addToWindow() {\n    (<any>window).openSeadragonViewer = this.viewer;\n  }\n\n  setupOverlays(): void {\n    this.svgOverlay = this.viewer.svgOverlay();\n    this.svgNode = d3.select(this.svgOverlay.node());\n  }\n\n  disableKeyDownHandler() {\n    this.viewer.innerTracker.keyDownHandler = null;\n  }\n\n  resetKeyDownHandler() {\n    this.viewer.innerTracker.keyDownHandler = this.defaultKeyDownHandler;\n  }\n\n  /**\n   *\n   * @param layoutSwitch true if switching between layouts\n   * to keep current search-state and rotation\n   */\n  destroy(layoutSwitch?: boolean) {\n    this.osdIsReady.next(false);\n    this.currentCenter.next(null);\n    if (this.viewer != null && this.viewer.isOpen()) {\n      if (this.viewer.container != null) {\n        d3.select(this.viewer.container.parentNode).style('opacity', '0');\n      }\n      this.viewer.destroy();\n    }\n    this.destroyed.next();\n    this.overlays = null;\n    this.canvasService.reset();\n    if (this.canvasGroupMask) {\n      this.canvasGroupMask.destroy();\n    }\n    // Keep search-state and rotation only if layout-switch\n    if (!layoutSwitch) {\n      this.currentSearch = null;\n      this.iiifContentSearchService.destroy();\n      this.rotation = 0;\n    }\n  }\n\n  addEvents(): void {\n    this.clickService.reset();\n    this.clickService.addSingleClickHandler(this.singleClickHandler);\n    this.clickService.addDoubleClickHandler(this.dblClickHandler);\n    this.viewer.addHandler('animation-finish', () => {\n      this.currentCenter.next(this.viewer.viewport.getCenter(true));\n    });\n    this.viewer.addHandler('canvas-click', this.clickService.click);\n    this.viewer.addHandler(\n      'canvas-double-click',\n      (e: any) => (e.preventDefaultAction = true)\n    );\n    this.viewer.addHandler('canvas-press', (e: any) => {\n      this.pinchStatus.active = false;\n      this.dragStartPosition = e.position;\n      this.isCanvasPressed.next(true);\n    });\n    this.viewer.addHandler('canvas-release', () =>\n      this.isCanvasPressed.next(false)\n    );\n    this.viewer.addHandler('canvas-scroll', this.scrollHandler);\n    this.viewer.addHandler('canvas-pinch', this.pinchHandler);\n\n    this.viewer.addHandler('canvas-drag', (e: any) => this.dragHandler(e));\n    this.viewer.addHandler('canvas-drag-end', (e: any) =>\n      this.swipeToCanvasGroup(e)\n    );\n\n    this.viewer.addHandler('animation', (e: any) => {\n      this.currentCenter.next(this.viewer.viewport.getCenter(true));\n    });\n  }\n\n  zoomIn(zoomFactor?: number, position?: Point): void {\n    this.zoomStrategy.zoomIn(zoomFactor, position);\n  }\n\n  zoomOut(zoomFactor?: number, position?: Point): void {\n    this.zoomStrategy.zoomOut(zoomFactor, position);\n  }\n\n  rotate(): void {\n    this.rotation = (this.rotation + 90) % 360;\n    this.layoutPages();\n  }\n\n  /**\n   * Callback for mode-change\n   * @param mode ViewerMode\n   */\n  modeChanged(mode: ModeChanges): void {\n    if (mode.currentValue === ViewerMode.DASHBOARD) {\n      this.viewer.panVertical = false;\n      this.toggleToDashboard();\n      this.disableKeyDownHandler();\n    } else if (mode.currentValue === ViewerMode.PAGE) {\n      this.viewer.panVertical = false;\n      this.toggleToPage();\n      this.disableKeyDownHandler();\n    } else if (mode.currentValue === ViewerMode.PAGE_ZOOMED) {\n      this.viewer.panVertical = true;\n      this.resetKeyDownHandler();\n    }\n  }\n\n  /**\n   * Switches to DASHBOARD-mode, repositions canvas group and removes max-width on viewer\n   */\n  private toggleToDashboard(): void {\n    if (!this.canvasService.isCurrentCanvasGroupValid()) {\n      return;\n    }\n    this.goToCanvasGroupStrategy.goToCanvasGroup({\n      canvasGroupIndex: this.canvasService.currentCanvasGroupIndex,\n      immediately: false\n    });\n\n    this.canvasGroupMask.hide();\n\n    this.zoomStrategy.setMinZoom(ViewerMode.DASHBOARD);\n    this.zoomStrategy.goToHomeZoom();\n  }\n\n  /**\n   * Switches to PAGE-mode, centers current canvas group and repositions other canvas groups\n   */\n  private toggleToPage(): void {\n    if (!this.canvasService.isCurrentCanvasGroupValid()) {\n      return;\n    }\n    this.goToCanvasGroupStrategy.goToCanvasGroup({\n      canvasGroupIndex: this.canvasService.currentCanvasGroupIndex,\n      immediately: false\n    });\n\n    this.canvasGroupMask.show();\n\n    this.zoomStrategy.setMinZoom(ViewerMode.PAGE);\n    this.zoomStrategy.goToHomeZoom();\n  }\n\n  /**\n   * Scroll-handler\n   */\n  scrollHandler = (event: any) => {\n    const zoomFactor = Math.pow(ViewerOptions.zoom.zoomFactor, event.scroll);\n    // Scrolling up\n    if (event.scroll > 0) {\n      this.zoomInGesture(event.position, zoomFactor);\n      // Scrolling down\n    } else if (event.scroll < 0) {\n      this.zoomOutGesture(event.position, zoomFactor);\n    }\n  };\n\n  /**\n   * Pinch-handler\n   */\n  pinchHandler = (event: any) => {\n    this.pinchStatus.active = true;\n    const zoomFactor = event.distance / event.lastDistance;\n    // Pinch Out\n    if (\n      event.distance >\n      event.lastDistance + ViewerOptions.zoom.pinchZoomThreshold\n    ) {\n      this.zoomInPinchGesture(event, zoomFactor);\n      // Pinch In\n    } else if (\n      event.distance + ViewerOptions.zoom.pinchZoomThreshold <\n      event.lastDistance\n    ) {\n      this.zoomOutPinchGesture(event, zoomFactor);\n    }\n  };\n\n  /**\n   *\n   * @param point to zoom to. If not set, the viewer will zoom to center\n   */\n  zoomInGesture(position: Point, zoomFactor?: number): void {\n    if (this.modeService.mode === ViewerMode.DASHBOARD) {\n      this.modeService.mode = ViewerMode.PAGE;\n    } else {\n      if (position) {\n        this.zoomStrategy.zoomIn(zoomFactor, position);\n      } else {\n        this.zoomStrategy.zoomIn();\n      }\n    }\n  }\n\n  zoomOutGesture(position: Point, zoomFactor?: number): void {\n    if (this.modeService.mode === ViewerMode.PAGE_ZOOMED) {\n      this.zoomStrategy.zoomOut(zoomFactor, position);\n    } else if (this.modeService.mode === ViewerMode.PAGE) {\n      this.modeService.mode = ViewerMode.DASHBOARD;\n    }\n  }\n\n  /**\n   * Process zoom in pinch gesture (pinch out)\n   *\n   * Toggle to page mode and Zoom in\n   *\n   * @param event from pinch gesture\n   */\n  zoomInPinchGesture(event: any, zoomFactor: number): void {\n    if (this.modeService.mode === ViewerMode.DASHBOARD) {\n      this.modeService.mode = ViewerMode.PAGE;\n    } else {\n      this.zoomIn(zoomFactor, this.dragStartPosition || event.center);\n    }\n  }\n\n  /**\n   * Process zoom out pinch gesture (pinch in)\n   *\n   * Zoom out and toggle to dashboard when all zoomed out.\n   * Stop between zooming out and toggling to dashboard.\n   *\n   * @param event from pinch gesture\n   */\n  zoomOutPinchGesture(event: any, zoomFactor: number): void {\n    const gestureId = event.gesturePoints[0].id;\n    if (this.modeService.mode === ViewerMode.PAGE_ZOOMED) {\n      this.pinchStatus.shouldStop = true;\n      this.zoomStrategy.zoomOut(zoomFactor, event.center);\n    } else if (this.modeService.mode === ViewerMode.PAGE) {\n      if (\n        !this.pinchStatus.shouldStop ||\n        gestureId === this.pinchStatus.previousGestureId + 2\n      ) {\n        this.pinchStatus.shouldStop = false;\n        this.modeService.toggleMode();\n      }\n      this.pinchStatus.previousGestureId = gestureId;\n    }\n  }\n\n  /**\n   * Single-click-handler\n   * Single-click toggles between page/dashboard-mode if a page is hit\n   */\n  singleClickHandler = (event: any) => {\n    const target = event.originalEvent.target;\n    const tileIndex = this.getOverlayIndexFromClickEvent(target);\n    const requestedCanvasGroupIndex = this.canvasService.findCanvasGroupByCanvasIndex(\n      tileIndex\n    );\n    if (requestedCanvasGroupIndex) {\n      this.canvasService.currentCanvasGroupIndex = requestedCanvasGroupIndex;\n    }\n    this.modeService.toggleMode();\n  };\n\n  /**\n   * Double-click-handler\n   * Double-click dashboard-mode should go to page-mode\n   * Double-click page-mode should\n   *    a) Zoom in if page is fitted vertically, or\n   *    b) Fit vertically if page is already zoomed in\n   */\n  dblClickHandler = (event: any) => {\n    const target = event.originalEvent.target;\n    // Page is fitted vertically, so dbl-click zooms in\n    if (this.modeService.mode === ViewerMode.PAGE) {\n      this.modeService.mode = ViewerMode.PAGE_ZOOMED;\n      this.zoomStrategy.zoomIn(\n        ViewerOptions.zoom.dblClickZoomFactor,\n        event.position\n      );\n    } else {\n      this.modeService.mode = ViewerMode.PAGE;\n      const canvasIndex: number = this.getOverlayIndexFromClickEvent(target);\n      const requestedCanvasGroupIndex = this.canvasService.findCanvasGroupByCanvasIndex(\n        canvasIndex\n      );\n      if (requestedCanvasGroupIndex >= 0) {\n        this.canvasService.currentCanvasGroupIndex = requestedCanvasGroupIndex;\n      }\n    }\n  };\n\n  /**\n   * Checks if hit element is a <rect>-element\n   * @param target\n   */\n  isCanvasGroupHit(target: HTMLElement): boolean {\n    return target instanceof SVGRectElement;\n  }\n\n  /**\n   * Iterates tilesources and adds them to viewer\n   * Creates svg clickable overlays for each tile\n   */\n  createOverlays(): void {\n    this.overlays = [];\n    const canvasRects: Rect[] = [];\n    const calculateCanvasGroupPositionStrategy = CalculateCanvasGroupPositionFactory.create(\n      this.viewerLayoutService.layout,\n      this.isManifestPaged\n    );\n\n    const isTwoPageView: boolean =\n      this.viewerLayoutService.layout === ViewerLayout.TWO_PAGE;\n    let group: any = this.svgNode.append('g').attr('class', 'page-group');\n\n    this.tileSources.forEach((tile, i) => {\n      const position = calculateCanvasGroupPositionStrategy.calculateCanvasGroupPosition(\n        {\n          canvasGroupIndex: i,\n          canvasSource: tile,\n          previousCanvasGroupPosition: canvasRects[i - 1],\n          viewingDirection: this.manifest.viewingDirection\n        },\n        this.rotation\n      );\n\n      canvasRects.push(position);\n\n      const tileSourceStrategy = TileSourceStrategyFactory.create(tile);\n      const tileSource = tileSourceStrategy.getTileSource(tile);\n\n      this.zone.runOutsideAngular(() => {\n        const rotated = this.rotation === 90 || this.rotation === 270;\n\n        let bounds;\n\n        /* Because image scaling is performed before rotation,\n         * we must invert width & height and translate position so that tile rotation ends up correct\n         */\n        if (rotated) {\n          bounds = new OpenSeadragon.Rect(\n            position.x + (position.width - position.height) / 2,\n            position.y - (position.width - position.height) / 2,\n            position.height,\n            position.width\n          );\n        } else {\n          bounds = new OpenSeadragon.Rect(\n            position.x,\n            position.y,\n            position.width,\n            position.height\n          );\n        }\n\n        this.viewer.addTiledImage({\n          index: i,\n          tileSource: tileSource,\n          fitBounds: bounds,\n          degrees: this.rotation\n        });\n      });\n\n      if (isTwoPageView && i % 2 !== 0) {\n        group = this.svgNode.append('g').attr('class', 'page-group');\n      }\n\n      const currentOverlay = group\n        .append('rect')\n        .attr('x', position.x)\n        .attr('y', position.y)\n        .attr('width', position.width)\n        .attr('height', position.height)\n        .attr('class', 'tile');\n\n      // Make custom borders if current layout is two-paged\n      if (isTwoPageView) {\n        if (i % 2 === 0 && i !== 0) {\n          const noLeftStrokeStyle =\n            Number(position.width * 2 + position.height) +\n            ', ' +\n            position.width * 2;\n          currentOverlay.style('stroke-dasharray', noLeftStrokeStyle);\n        } else if (i % 2 !== 0 && i !== 0) {\n          const noRightStrokeStyle =\n            position.width +\n            ', ' +\n            position.height +\n            ', ' +\n            Number(position.width * 2 + position.height);\n          currentOverlay.style('stroke-dasharray', noRightStrokeStyle);\n        }\n      }\n\n      const currentOverlayNode: SVGRectElement = currentOverlay.node();\n      this.overlays[i] = currentOverlayNode;\n    });\n\n    const layout =\n      this.viewerLayoutService.layout === ViewerLayout.ONE_PAGE ||\n      !this.isManifestPaged\n        ? ViewerLayout.ONE_PAGE\n        : ViewerLayout.TWO_PAGE;\n    this.canvasService.addAll(canvasRects, layout);\n  }\n\n  /**\n   * Sets viewer size and opacity once the first canvas group has fully loaded\n   */\n  private initialCanvasGroupLoaded(): void {\n    this.home();\n    this.canvasGroupMask.initialise(\n      this.canvasService.getCurrentCanvasGroupRect(),\n      this.modeService.mode !== ViewerMode.DASHBOARD\n    );\n    d3.select(this.viewer.container.parentNode)\n      .transition()\n      .duration(ViewerOptions.transitions.OSDAnimationTime)\n      .style('opacity', '1');\n  }\n\n  /**\n   * Returns overlay-index for click-event if hit\n   * @param target hit <rect>\n   */\n  getOverlayIndexFromClickEvent(target: any) {\n    if (this.isCanvasGroupHit(target)) {\n      const requestedCanvasGroup: number = this.overlays.indexOf(target);\n      if (requestedCanvasGroup >= 0) {\n        return requestedCanvasGroup;\n      }\n    }\n    return -1;\n  }\n\n  private getOptions(): Options {\n    const options = new Options();\n    options.ajaxWithCredentials = this.config.withCredentials;\n    options.loadTilesWithAjax = this.config.loadTilesWithAjax;\n    options.crossOriginPolicy = this.config.crossOriginPolicy;\n    options.ajaxHeaders = this.config.ajaxHeaders;\n    return options;\n  }\n\n  private calculateCurrentCanvasGroup(center: Point) {\n    if (center) {\n      const currentCanvasGroupIndex = this.canvasService.findClosestCanvasGroupIndex(\n        center\n      );\n      this.currentCanvasIndex.next(currentCanvasGroupIndex);\n    }\n  }\n\n  private dragHandler = (e: any) => {\n    this.viewer.panHorizontal = true;\n    if (this.modeService.mode === ViewerMode.PAGE_ZOOMED) {\n      const dragEndPosision: Point = e.position;\n      const canvasGroupRect: Rect = this.canvasService.getCurrentCanvasGroupRect();\n      const vpBounds: Rect = this.getViewportBounds();\n      const pannedPastCanvasGroup: Side = SwipeUtils.getSideIfPanningPastEndOfCanvasGroup(\n        canvasGroupRect,\n        vpBounds\n      );\n      const direction: number = e.direction;\n      if (\n        (pannedPastCanvasGroup === Side.LEFT &&\n          SwipeUtils.isDirectionInRightSemicircle(direction)) ||\n        (pannedPastCanvasGroup === Side.RIGHT &&\n          SwipeUtils.isDirectionInLeftSemicircle(direction))\n      ) {\n        this.viewer.panHorizontal = false;\n      }\n    }\n  };\n\n  private swipeToCanvasGroup(e: any) {\n    // Don't swipe on pinch actions\n    if (this.pinchStatus.active) {\n      return;\n    }\n\n    const speed: number = e.speed;\n    const dragEndPosision = e.position;\n\n    const isCanvasGroupZoomed =\n      this.modeService.mode === ViewerMode.PAGE_ZOOMED;\n\n    const canvasGroupRect: Rect = this.canvasService.getCurrentCanvasGroupRect();\n    const viewportBounds: Rect = this.getViewportBounds();\n\n    const direction: Direction = SwipeUtils.getSwipeDirection(\n      this.dragStartPosition,\n      dragEndPosision,\n      isCanvasGroupZoomed\n    );\n\n    const currentCanvasGroupIndex: number = this.canvasService\n      .currentCanvasGroupIndex;\n    const calculateNextCanvasGroupStrategy = CalculateNextCanvasGroupFactory.create(\n      this.modeService.mode\n    );\n\n    let pannedPastSide: Side, canvasGroupEndHitCountReached: boolean;\n    if (this.modeService.mode === ViewerMode.PAGE_ZOOMED) {\n      pannedPastSide = SwipeUtils.getSideIfPanningPastEndOfCanvasGroup(\n        canvasGroupRect,\n        viewportBounds\n      );\n      this.swipeDragEndCounter.addHit(pannedPastSide, direction);\n      canvasGroupEndHitCountReached = this.swipeDragEndCounter.hitCountReached();\n    }\n\n    const newCanvasGroupIndex = calculateNextCanvasGroupStrategy.calculateNextCanvasGroup(\n      {\n        currentCanvasGroupCenter: this.currentCanvasIndex.getValue(),\n        speed: speed,\n        direction: direction,\n        currentCanvasGroupIndex: currentCanvasGroupIndex,\n        canvasGroupEndHitCountReached: canvasGroupEndHitCountReached,\n        viewingDirection: this.manifest.viewingDirection\n      }\n    );\n    if (\n      this.modeService.mode === ViewerMode.DASHBOARD ||\n      this.modeService.mode === ViewerMode.PAGE ||\n      (canvasGroupEndHitCountReached && direction)\n    ) {\n      this.goToCanvasGroupStrategy.goToCanvasGroup({\n        canvasGroupIndex: newCanvasGroupIndex,\n        immediately: false,\n        direction: direction\n      });\n    }\n  }\n\n  private getViewportBounds(): Rect {\n    return this.viewer.viewport.getBounds();\n  }\n}\n","declare const OpenSeadragon: any;\n\n// OpenSeadragon SVG Overlay plugin 0.0.4\n\nexport function createSvgOverlay() {\n  if (!OpenSeadragon) {\n    console.error('[openseadragon-svg-overlay] requires OpenSeadragon');\n    return;\n  }\n\n  const svgNS = 'http://www.w3.org/2000/svg';\n\n  // ----------\n  class Overlay {\n    // ----------\n\n    _viewer: any;\n    _containerWidth: any;\n    _containerHeight: any;\n    _svg: any;\n    _node: any;\n\n    constructor(viewer: any) {\n      const self = this;\n\n      this._viewer = viewer;\n      this._containerWidth = 0;\n      this._containerHeight = 0;\n\n      this._svg = document.createElementNS(svgNS, 'svg');\n      this._svg.style.position = 'absolute';\n      this._svg.style.left = 0;\n      this._svg.style.top = 0;\n      this._svg.style.width = '100%';\n      this._svg.style.height = '100%';\n      this._viewer.canvas.appendChild(this._svg);\n\n      this._node = document.createElementNS(svgNS, 'g');\n      this._svg.appendChild(this._node);\n\n      this._viewer.addHandler('animation', function() {\n        self.resize();\n      });\n\n      this._viewer.addHandler('open', function() {\n        self.resize();\n      });\n\n      this._viewer.addHandler('rotate', function(evt: any) {\n        self.resize();\n      });\n\n      this._viewer.addHandler('resize', function() {\n        self.resize();\n      });\n\n      this.resize();\n    }\n    node() {\n      return this._node;\n    }\n\n    // ----------\n    resize() {\n      if (this._containerWidth !== this._viewer.container.clientWidth) {\n        this._containerWidth = this._viewer.container.clientWidth;\n        this._svg.setAttribute('width', this._containerWidth);\n      }\n\n      if (this._containerHeight !== this._viewer.container.clientHeight) {\n        this._containerHeight = this._viewer.container.clientHeight;\n        this._svg.setAttribute('height', this._containerHeight);\n      }\n\n      const p = this._viewer.viewport.pixelFromPoint(\n        new OpenSeadragon.Point(0, 0),\n        true\n      );\n      const zoom = this._viewer.viewport.getZoom(true);\n      const rotation = this._viewer.viewport.getRotation();\n      // TODO: Expose an accessor for _containerInnerSize in the OSD API so we don't have to use the private variable.\n      const scale = this._viewer.viewport._containerInnerSize.x * zoom;\n      this._node.setAttribute(\n        'transform',\n        'translate(' +\n          p.x +\n          ',' +\n          p.y +\n          ') scale(' +\n          scale +\n          ') rotate(' +\n          rotation +\n          ')'\n      );\n    }\n\n    // ----------\n    onClick(node: any, handler: any) {\n      // TODO: Fast click for mobile browsers\n\n      new OpenSeadragon.MouseTracker({\n        element: node,\n        clickHandler: handler\n      }).setTracking(true);\n    }\n  }\n\n  // ----------\n\n  // ----------\n  OpenSeadragon.Viewer.prototype.svgOverlay = function() {\n    if (this._svgOverlayInfo) {\n      return this._svgOverlayInfo;\n    }\n\n    this._svgOverlayInfo = new Overlay(this);\n    return this._svgOverlayInfo;\n  };\n}\n","import { Canvas, Sequence } from '../models/manifest';\nimport { ViewingDirection } from '../models/viewing-direction';\n\nexport class BuilderUtils {\n  static extractId(value: any): any {\n    return value['@id'];\n  }\n\n  static extracType(value: any): any {\n    return value['@type'];\n  }\n\n  static extractContext(value: any): any {\n    return value['@context'];\n  }\n\n  static extractViewingDirection(value: any): ViewingDirection {\n    if (value['viewingDirection'] === 'left-to-right') {\n      return ViewingDirection.LTR;\n    } else if (value['viewingDirection'] === 'right-to-left') {\n      return ViewingDirection.RTL;\n    }\n  }\n\n  static findCanvasIndex(canvases: string[], sequences: Sequence[]): number {\n    let index = -1;\n    if (sequences[0] && sequences[0].canvases && canvases[0]) {\n      index = sequences[0].canvases.findIndex(\n        (canvas: Canvas) => canvas.id === canvases[0]\n      );\n    }\n    return index;\n  }\n}\n","import { Size } from '../models/manifest';\n\nexport class SizesBuilder {\n  constructor(private sizes: any[]) {}\n\n  build(): Size[] {\n    const sizes: Size[] = [];\n    if (this.sizes) {\n      for (let i = 0; i < this.sizes.length; i++) {\n        const size = this.sizes[i];\n        sizes.push(new Size(size.width, size.height));\n      }\n    }\n    return sizes;\n  }\n}\n","import { Tile } from '../models/manifest';\n\nexport class TilesBuilder {\n  constructor(private tiles: any[]) {}\n\n  build(): Tile[] {\n    const tiles: Tile[] = [];\n    if (this.tiles) {\n      for (let i = 0; i < this.tiles.length; i++) {\n        const tile = this.tiles[i];\n        tiles.push(\n          new Tile({\n            width: tile.width,\n            scaleFactors: tile.scaleFactors\n          })\n        );\n      }\n    }\n    return tiles;\n  }\n}\n","import { Service } from '../models/manifest';\nimport { BuilderUtils } from './builder-utils';\nimport { SizesBuilder } from './sizes.builder';\nimport { TilesBuilder } from './tiles.builder';\n\nexport class ServiceBuilder {\n  constructor(private service: any) {}\n\n  build(): Service {\n    if (this.service) {\n      return new Service({\n        id: BuilderUtils.extractId(this.service),\n        context: BuilderUtils.extractContext(this.service),\n        protocol: this.service.protocol,\n        width: this.service.width,\n        height: this.service.height,\n        sizes: new SizesBuilder(this.service.sizes).build(),\n        tiles: new TilesBuilder(this.service.tiles).build(),\n        profile: this.service.profile,\n        physicalScale: this.service.physicalScale,\n        physicalUnits: this.service.physicalUnits,\n        service: new ServiceBuilder(this.service.service).build()\n      });\n    }\n    return null;\n  }\n}\n","import { Resource } from '../models/manifest';\nimport { BuilderUtils } from './builder-utils';\nimport { ServiceBuilder } from './service.builder';\n\nexport class ResourceBuilder {\n  constructor(private resource: any) {}\n\n  build(): Resource {\n    if (this.resource) {\n      return new Resource({\n        id: BuilderUtils.extractId(this.resource),\n        type: BuilderUtils.extracType(this.resource),\n        format: this.resource.format,\n        service: new ServiceBuilder(this.resource.service).build(),\n        height: this.resource.height,\n        width: this.resource.width\n      });\n    }\n    return null;\n  }\n}\n","import { Images } from '../models/manifest';\nimport { BuilderUtils } from './builder-utils';\nimport { ResourceBuilder } from './resource.builder';\n\nexport class ImagesBuilder {\n  constructor(private images: any[]) {}\n\n  build(): Images[] {\n    const images: Images[] = [];\n    if (this.images) {\n      for (let i = 0; i < this.images.length; i++) {\n        const image = this.images[i];\n        images.push(\n          new Images({\n            id: BuilderUtils.extractId(image),\n            type: BuilderUtils.extracType(image),\n            motivation: image.motivation,\n            resource: new ResourceBuilder(image.resource).build(),\n            on: image.on\n          })\n        );\n      }\n    }\n    return images;\n  }\n}\n","import { Canvas } from '../models/manifest';\nimport { BuilderUtils } from './builder-utils';\nimport { ImagesBuilder } from './images.builder';\n\nexport class CanvasBuilder {\n  constructor(private canvases: any[]) {}\n\n  build(): Canvas[] {\n    const canvases: Canvas[] = [];\n    if (this.canvases) {\n      for (let i = 0; i < this.canvases.length; i++) {\n        const canvas = this.canvases[i];\n        canvases.push(\n          new Canvas({\n            id: BuilderUtils.extractId(canvas),\n            type: BuilderUtils.extracType(canvas),\n            label: canvas.label,\n            thumbnail: canvas.thumbnail,\n            height: canvas.height,\n            width: canvas.width,\n            images: new ImagesBuilder(canvas.images).build()\n          })\n        );\n      }\n    }\n    return canvases;\n  }\n}\n","import { Sequence } from '../models/manifest';\nimport { BuilderUtils } from './builder-utils';\nimport { CanvasBuilder } from './canvas.builder';\n\nexport class SequenceBuilder {\n  constructor(private sequences: any[]) {}\n\n  build(): Sequence[] {\n    const sequences: Sequence[] = [];\n    if (this.sequences) {\n      for (let i = 0; i < this.sequences.length; i++) {\n        const seq = this.sequences[i];\n        sequences.push(\n          new Sequence({\n            id: BuilderUtils.extractId(seq),\n            type: BuilderUtils.extracType(seq),\n            label: seq.label,\n            viewingHint: seq.viewingHint,\n            canvases: new CanvasBuilder(seq.canvases).build()\n          })\n        );\n      }\n    }\n    return sequences;\n  }\n}\n","import { Metadata } from '../models/manifest';\n\nexport class MetadataBuilder {\n  constructor(private metadatas: any) {}\n\n  build(): Metadata[] {\n    const metadatas: Metadata[] = [];\n    if (this.metadatas) {\n      for (let i = 0; i < this.metadatas.length; i++) {\n        const data = this.metadatas[i];\n        metadatas.push(new Metadata(data.label, data.value));\n      }\n    }\n    return metadatas;\n  }\n}\n","import { Structure, Sequence } from '../models/manifest';\nimport { BuilderUtils } from './builder-utils';\n\nexport class StructureBuilder {\n  constructor(private structures: any[], private sequences: Sequence[]) {}\n\n  build(): Structure[] {\n    const structures: Structure[] = [];\n    if (this.structures) {\n      for (let i = 0; i < this.structures.length; i++) {\n        const structure = this.structures[i];\n        structures.push(\n          new Structure({\n            id: BuilderUtils.extractId(structure),\n            type: BuilderUtils.extracType(structure),\n            label: structure.label,\n            canvases: structure.canvases,\n            canvasIndex: BuilderUtils.findCanvasIndex(\n              structure.canvases,\n              this.sequences\n            )\n          })\n        );\n      }\n    }\n    return structures;\n  }\n}\n","import { Sequence, Service } from '../models/manifest';\n\nexport class TileSourceBuilder {\n  constructor(private sequences: Sequence[]) {}\n\n  build(): Service[] {\n    const tilesources: Service[] = [];\n    if (this.sequences && this.sequences.length > 0) {\n      const canvases = this.sequences[0].canvases;\n      for (let i = 0; i < canvases.length; i++) {\n        const canvas = canvases[i];\n        if (canvas) {\n          tilesources.push(canvas.images[0].resource);\n        }\n      }\n    }\n    return tilesources;\n  }\n}\n","import { Manifest, Sequence } from '../models/manifest';\nimport { BuilderUtils } from './builder-utils';\nimport { SequenceBuilder } from './sequence.builder';\nimport { ServiceBuilder } from './service.builder';\nimport { MetadataBuilder } from './metadata.builder';\nimport { StructureBuilder } from './structure.builder';\nimport { TileSourceBuilder } from './tile-source.builder';\n\nexport class ManifestBuilder {\n  constructor(private data: any) {}\n\n  build(): Manifest {\n    const sequences: Sequence[] = new SequenceBuilder(\n      this.data.sequences\n    ).build();\n\n    return new Manifest({\n      context: BuilderUtils.extractContext(this.data),\n      type: BuilderUtils.extracType(this.data),\n      id: BuilderUtils.extractId(this.data),\n      viewingDirection: BuilderUtils.extractViewingDirection(this.data),\n      label: this.data.label,\n      metadata: new MetadataBuilder(this.data.metadata).build(),\n      license: this.data.license,\n      logo: this.data.logo,\n      attribution: this.data.attribution,\n      service: new ServiceBuilder(this.data.service).build(),\n      sequences: sequences,\n      structures: new StructureBuilder(this.data.structures, sequences).build(),\n      tileSource: new TileSourceBuilder(this.data.sequences).build(),\n      viewingHint: this.data.viewingHint\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { Observable, Subject, BehaviorSubject } from 'rxjs';\nimport { filter, distinctUntilChanged, finalize } from 'rxjs/operators';\n\nimport { Manifest } from '../models/manifest';\nimport { ManifestBuilder } from '../builders/manifest.builder';\nimport { SpinnerService } from '../spinner-service/spinner.service';\nimport { MimeViewerIntl } from '../intl/viewer-intl';\n\n@Injectable()\nexport class IiifManifestService {\n  protected _currentManifest: Subject<Manifest> = new BehaviorSubject<Manifest>(\n    null\n  );\n  protected _errorMessage: Subject<string> = new BehaviorSubject(null);\n\n  constructor(\n    public intl: MimeViewerIntl,\n    private http: HttpClient,\n    private spinnerService: SpinnerService\n  ) {}\n\n  get currentManifest(): Observable<Manifest> {\n    return this._currentManifest.asObservable().pipe(\n      filter(m => m !== null),\n      distinctUntilChanged()\n    );\n  }\n\n  get errorMessage(): Observable<string> {\n    return this._errorMessage.asObservable();\n  }\n\n  load(manifestUri: string): void {\n    if (manifestUri === null) {\n      this._errorMessage.next(this.intl.manifestUriMissingLabel);\n    } else {\n      this.spinnerService.show();\n      this.http\n        .get(manifestUri)\n        .pipe(finalize(() => this.spinnerService.hide()))\n        .subscribe(\n          (response: Response) => {\n            const manifest = this.extractData(response);\n            if (this.isManifestValid(manifest)) {\n              this._currentManifest.next(manifest);\n            } else {\n              this._errorMessage.next(this.intl.manifestNotValidLabel);\n            }\n          },\n          (err: HttpErrorResponse) => {\n            this._errorMessage.next(this.handleError(err));\n          }\n        );\n    }\n  }\n\n  destroy() {\n    this.resetCurrentManifest();\n    this.resetErrorMessage();\n  }\n\n  private resetCurrentManifest() {\n    this._currentManifest.next(null);\n  }\n\n  private resetErrorMessage() {\n    this._errorMessage.next(null);\n  }\n\n  private extractData(response: Response) {\n    return new ManifestBuilder(response).build();\n  }\n\n  private isManifestValid(manifest: Manifest): boolean {\n    return manifest && manifest.tileSource && manifest.tileSource.length > 0;\n  }\n\n  private handleError(err: HttpErrorResponse): string {\n    let errMsg: string;\n    if (err.error instanceof Object) {\n      errMsg = err.message;\n    } else {\n      errMsg = err.error;\n    }\n    return errMsg;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, ReplaySubject } from 'rxjs';\n\n@Injectable()\nexport class FullscreenService {\n  private changeSubject: ReplaySubject<boolean> = new ReplaySubject();\n\n  constructor() {\n    this.onchange();\n  }\n\n  get onChange(): Observable<boolean> {\n    return this.changeSubject.asObservable();\n  }\n\n  public isEnabled(): boolean {\n    const d: any = document;\n    return (\n      d.fullscreenEnabled ||\n      d.webkitFullscreenEnabled ||\n      d.mozFullScreenEnabled ||\n      d.msFullscreenEnabled\n    );\n  }\n\n  public isFullscreen(): boolean {\n    const d: any = document;\n    return (\n      d.fullscreenElement ||\n      d.webkitFullscreenElement ||\n      d.mozFullScreenElement ||\n      d.msFullscreenElement\n    );\n  }\n\n  public toggle(el: HTMLElement) {\n    this.isFullscreen() ? this.closeFullscreen(el) : this.openFullscreen(el);\n  }\n\n  public onchange() {\n    const d: any = document;\n\n    const func = () => {\n      this.changeSubject.next(true);\n    };\n\n    if (d.fullscreenEnabled) {\n      document.addEventListener('fullscreenchange', func);\n    } else if (d.webkitFullscreenEnabled) {\n      document.addEventListener('webkitfullscreenchange', func);\n    } else if (d.mozFullScreenEnabled) {\n      document.addEventListener('mozfullscreenchange', func);\n    } else if (d.msFullscreenEnabled) {\n      document.addEventListener('msfullscreenchange', func);\n    }\n  }\n\n  private openFullscreen(elem: any) {\n    if (elem.requestFullscreen) {\n      elem.requestFullscreen();\n    } else if (elem.mozRequestFullScreen) {\n      elem.mozRequestFullScreen();\n    } else if (elem.webkitRequestFullscreen) {\n      elem.webkitRequestFullscreen();\n    } else if (elem.msRequestFullscreen) {\n      elem.msRequestFullscreen();\n    }\n  }\n\n  private closeFullscreen(elem: any) {\n    const d = <any>document;\n    if (d.exitFullscreen) {\n      d.exitFullscreen();\n    } else if (d.mozCancelFullScreen) {\n      d.mozCancelFullScreen();\n    } else if (d.webkitExitFullscreen) {\n      d.webkitExitFullscreen();\n    } else if (d.msExitFullscreen) {\n      d.msExitFullscreen();\n    }\n  }\n}\n","import { FullscreenService } from './fullscreen-service/fullscreen.service';\nimport { Dimensions } from './models/dimensions';\nimport { ElementRef, Injectable } from '@angular/core';\n\n@Injectable()\nexport class MimeDomHelper {\n  constructor(private fullscreen: FullscreenService) {}\n\n  public getBoundingClientRect(el: ElementRef): Dimensions {\n    try {\n      if (\n        this.isDocumentInFullScreenMode() &&\n        el.nativeElement.nodeName === 'MIME-VIEWER'\n      ) {\n        return this.createFullscreenDimensions(el);\n      } else {\n        return this.createDimensions(el);\n      }\n    } catch (e) {\n      return new Dimensions();\n    }\n  }\n\n  public isDocumentInFullScreenMode(): boolean {\n    return this.fullscreen.isFullscreen();\n  }\n\n  public toggleFullscreen(): void {\n    const el = <any>document.getElementById('mimeViewer');\n    if (this.fullscreen.isEnabled()) {\n      this.fullscreen.toggle(el);\n    }\n  }\n\n  public setFocusOnViewer(): void {\n    const el: HTMLElement = document.getElementById('mimeViewer');\n    if (el) {\n      el.focus();\n    }\n  }\n\n  private createFullscreenDimensions(el: ElementRef): Dimensions {\n    const dimensions = el.nativeElement.getBoundingClientRect();\n    const width = this.getFullscreenWidth();\n    const height = this.getFullscreenHeight();\n    return new Dimensions({\n      ...dimensions,\n      top: 0,\n      bottom: height,\n      width: width,\n      height: height,\n      left: 0,\n      right: width\n    });\n  }\n\n  private createDimensions(el: ElementRef): Dimensions {\n    const dimensions = el.nativeElement.getBoundingClientRect();\n    return new Dimensions({\n      top: dimensions.top,\n      bottom: dimensions.bottom,\n      width: dimensions.width,\n      height: dimensions.height,\n      left: dimensions.left,\n      right: dimensions.right\n    });\n  }\n\n  private getFullscreenWidth(): number {\n    return (\n      window.innerWidth ||\n      document.documentElement.clientWidth ||\n      document.body.clientWidth\n    );\n  }\n\n  private getFullscreenHeight(): number {\n    return (\n      window.innerHeight ||\n      document.documentElement.clientHeight ||\n      document.body.clientHeight\n    );\n  }\n}\n","import { Injectable, ElementRef } from '@angular/core';\nimport { Observable, ReplaySubject } from 'rxjs';\n\nimport { MimeDomHelper } from '../mime-dom-helper';\nimport { Dimensions } from '../models/dimensions';\n\n@Injectable()\nexport class MimeResizeService {\n  private _el: ElementRef;\n  private resizeSubject: ReplaySubject<Dimensions> = new ReplaySubject();\n  private dimensions = new Dimensions();\n\n  constructor(private mimeDomHelper: MimeDomHelper) {}\n\n  set el(el: ElementRef) {\n    this._el = el;\n  }\n\n  get el() {\n    return this._el;\n  }\n\n  get onResize(): Observable<Dimensions> {\n    return this.resizeSubject.asObservable();\n  }\n\n  markForCheck(): void {\n    const dimensions = this.mimeDomHelper.getBoundingClientRect(this.el);\n\n    if (\n      this.dimensions.bottom !== dimensions.bottom ||\n      this.dimensions.height !== dimensions.height ||\n      this.dimensions.left !== dimensions.left ||\n      this.dimensions.right !== dimensions.right ||\n      this.dimensions.top !== dimensions.top ||\n      this.dimensions.width !== dimensions.width\n    ) {\n      this.dimensions = dimensions;\n      this.resizeSubject.next({ ...this.dimensions });\n    }\n  }\n}\n","import {\n  AfterViewInit,\n  Component,\n  ElementRef,\n  HostListener,\n  OnDestroy,\n  OnInit,\n  QueryList,\n  ViewChild,\n  ViewChildren\n} from '@angular/core';\nimport { MediaObserver } from '@angular/flex-layout';\nimport { MatDialogRef } from '@angular/material/dialog';\nimport { Subject } from 'rxjs';\nimport { filter, take, takeUntil } from 'rxjs/operators';\nimport { IiifContentSearchService } from './../core/iiif-content-search-service/iiif-content-search.service';\nimport { IiifManifestService } from './../core/iiif-manifest-service/iiif-manifest-service';\nimport { MimeViewerIntl } from './../core/intl/viewer-intl';\nimport { MimeDomHelper } from './../core/mime-dom-helper';\nimport { MimeResizeService } from './../core/mime-resize-service/mime-resize.service';\nimport { Dimensions } from './../core/models/dimensions';\nimport { Hit } from './../core/models/hit';\nimport { Manifest } from './../core/models/manifest';\nimport { SearchResult } from './../core/models/search-result';\n\n@Component({\n  selector: 'mime-search',\n  templateUrl: './content-search-dialog.component.html',\n  styleUrls: ['./content-search-dialog.component.scss']\n})\nexport class ContentSearchDialogComponent\n  implements OnInit, AfterViewInit, OnDestroy {\n  public q: string;\n  public hits: Hit[] = [];\n  public currentHit: Hit;\n  public currentSearch = '';\n  public numberOfHits = 0;\n  public isSearching = false;\n  public tabHeight = {};\n  private manifest: Manifest;\n  private mimeHeight = 0;\n  private destroyed: Subject<void> = new Subject();\n  @ViewChild('contentSearchResult', { static: true })\n  resultContainer: ElementRef;\n  @ViewChild('query', { static: true }) qEl: ElementRef;\n  @ViewChildren('hitButton', { read: ElementRef })\n  hitList: QueryList<ElementRef>;\n\n  constructor(\n    public dialogRef: MatDialogRef<ContentSearchDialogComponent>,\n    public intl: MimeViewerIntl,\n    public mediaObserver: MediaObserver,\n    private mimeResizeService: MimeResizeService,\n    private iiifManifestService: IiifManifestService,\n    private iiifContentSearchService: IiifContentSearchService,\n    private el: ElementRef,\n    private mimeDomHelper: MimeDomHelper\n  ) {}\n\n  ngOnInit() {\n    this.mimeResizeService.onResize\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((dimensions: Dimensions) => {\n        this.mimeHeight = dimensions.height;\n        this.resizeTabHeight();\n      });\n\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        this.manifest = manifest;\n      });\n\n    this.iiifContentSearchService.onChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((sr: SearchResult) => {\n        this.hits = sr.hits;\n        this.currentSearch = sr.q ? sr.q : '';\n        this.q = sr.q;\n        this.numberOfHits = sr.size();\n        if (this.resultContainer !== null && this.numberOfHits > 0) {\n          this.resultContainer.nativeElement.focus();\n        } else if (this.q.length === 0 || this.numberOfHits === 0) {\n          this.qEl.nativeElement.focus();\n        }\n      });\n\n    this.iiifContentSearchService.isSearching\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((s: boolean) => {\n        this.isSearching = s;\n      });\n\n    this.iiifContentSearchService.onSelected\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((hit: Hit) => {\n        if (hit === null) {\n          this.currentHit = hit;\n        } else {\n          if (!this.currentHit || this.currentHit.id !== hit.id) {\n            this.currentHit = hit;\n            this.scrollCurrentHitIntoView();\n          }\n        }\n      });\n\n    this.resizeTabHeight();\n  }\n\n  ngAfterViewInit() {\n    this.scrollCurrentHitIntoView();\n  }\n\n  ngOnDestroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  @HostListener('window:resize', ['$event'])\n  onResize(event: any) {\n    this.resizeTabHeight();\n  }\n\n  onSubmit(event: KeyboardEvent) {\n    event.preventDefault();\n    this.search();\n  }\n\n  clear() {\n    this.q = '';\n    this.search();\n  }\n\n  goToHit(hit: Hit): void {\n    this.currentHit = hit;\n    this.iiifContentSearchService.selected(hit);\n    if (this.mediaObserver.isActive('lt-md')) {\n      this.dialogRef.close();\n    }\n  }\n\n  private search() {\n    this.currentSearch = this.q;\n    this.iiifContentSearchService.search(this.manifest, this.q);\n  }\n\n  private resizeTabHeight(): void {\n    const dimensions = this.mimeDomHelper.getBoundingClientRect(this.el);\n    let height = this.mimeHeight;\n\n    if (this.mediaObserver.isActive('lt-md')) {\n      this.tabHeight = {\n        maxHeight: window.innerHeight - 128 + 'px'\n      };\n    } else {\n      height -= 272;\n      this.tabHeight = {\n        maxHeight: height + 'px'\n      };\n    }\n  }\n\n  private scrollCurrentHitIntoView() {\n    this.iiifContentSearchService.onSelected\n      .pipe(\n        take(1),\n        filter(s => s !== null)\n      )\n      .subscribe((hit: Hit) => {\n        const selected = this.findSelected(hit);\n        if (selected) {\n          selected.nativeElement.focus();\n        }\n      });\n  }\n\n  private findSelected(selectedHit: Hit): ElementRef {\n    if (this.hitList) {\n      const selectedList = this.hitList.filter(\n        (item: ElementRef, index: number) => index === selectedHit.id\n      );\n      return selectedList.length > 0 ? selectedList[0] : null;\n    } else {\n      return null;\n    }\n  }\n}\n","import { MimeDomHelper } from './../core/mime-dom-helper';\nimport { ElementRef } from '@angular/core';\nimport { MatDialogConfig } from '@angular/material/dialog';\n\nimport { Dimensions } from './../core/models/dimensions';\n\nexport interface ContentSearchDialogConfigStrategy {\n  getConfig(elementRef?: ElementRef): MatDialogConfig;\n}\n\nexport class MobileContentSearchDialogConfigStrategy\n  implements ContentSearchDialogConfigStrategy {\n  public getConfig(elementRef: ElementRef): MatDialogConfig {\n    return {\n      hasBackdrop: false,\n      disableClose: false,\n      autoFocus: false,\n      width: '100%',\n      height: '100%',\n      panelClass: 'content-search-panel'\n    };\n  }\n}\n\nexport class DesktopContentSearchDialogConfigStrategy\n  implements ContentSearchDialogConfigStrategy {\n  public static readonly dialogWidth = 350;\n  public static readonly paddingRight = 20;\n  private mimeDomHelper: MimeDomHelper;\n\n  constructor(mimeDomHelper: MimeDomHelper) {\n    this.mimeDomHelper = mimeDomHelper;\n  }\n\n  public getConfig(el: ElementRef): MatDialogConfig {\n    const dimensions = this.getPosition(el);\n    return {\n      hasBackdrop: false,\n      disableClose: false,\n      autoFocus: false,\n      width: `${DesktopContentSearchDialogConfigStrategy.dialogWidth}px`,\n      position: {\n        top: dimensions.top + 'px',\n        left: dimensions.left + 'px'\n      },\n      panelClass: 'content-search-panel'\n    };\n  }\n\n  private getPosition(el: ElementRef): Dimensions {\n    const dimensions = this.mimeDomHelper.getBoundingClientRect(el);\n    return new Dimensions({\n      top: dimensions.top + 64,\n      left:\n        dimensions.right -\n        DesktopContentSearchDialogConfigStrategy.dialogWidth -\n        DesktopContentSearchDialogConfigStrategy.paddingRight\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { MediaObserver } from '@angular/flex-layout';\nimport { MimeDomHelper } from '../core/mime-dom-helper';\nimport {\n  ContentSearchDialogConfigStrategy,\n  DesktopContentSearchDialogConfigStrategy,\n  MobileContentSearchDialogConfigStrategy\n} from './content-search-dialog-config-strategy';\n\n@Injectable()\nexport class ContentSearchDialogConfigStrategyFactory {\n  constructor(\n    private mediaObserver: MediaObserver,\n    private mimeDomHelper: MimeDomHelper\n  ) {}\n\n  public create(): ContentSearchDialogConfigStrategy {\n    return this.mediaObserver.isActive('lt-md')\n      ? new MobileContentSearchDialogConfigStrategy()\n      : new DesktopContentSearchDialogConfigStrategy(this.mimeDomHelper);\n  }\n}\n","import { ElementRef, Injectable } from '@angular/core';\nimport {\n  MatDialog,\n  MatDialogConfig,\n  MatDialogRef\n} from '@angular/material/dialog';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { ContentSearchDialogComponent } from './content-search-dialog.component';\nimport { ContentSearchDialogConfigStrategyFactory } from './content-search-dialog-config-strategy-factory';\nimport { MimeResizeService } from './../core/mime-resize-service/mime-resize.service';\n\n@Injectable()\nexport class ContentSearchDialogService {\n  private _el: ElementRef;\n  private isContentSearchDialogOpen = false;\n  private dialogRef: MatDialogRef<ContentSearchDialogComponent>;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    private dialog: MatDialog,\n    private contentSearchDialogConfigStrategyFactory: ContentSearchDialogConfigStrategyFactory,\n    private mimeResizeService: MimeResizeService\n  ) {}\n\n  public initialize(): void {\n    this.mimeResizeService.onResize\n      .pipe(takeUntil(this.destroyed))\n      .subscribe(rect => {\n        if (this.isContentSearchDialogOpen) {\n          const config = this.getDialogConfig();\n          this.dialogRef.updatePosition(config.position);\n          this.dialogRef.updateSize(config.width, config.height);\n        }\n      });\n  }\n\n  public destroy() {\n    this.close();\n    this.destroyed.next();\n  }\n\n  set el(el: ElementRef) {\n    this._el = el;\n  }\n\n  public open() {\n    if (!this.isContentSearchDialogOpen) {\n      const config = this.getDialogConfig();\n      this.dialogRef = this.dialog.open(ContentSearchDialogComponent, config);\n      this.dialogRef.afterClosed().subscribe(result => {\n        this.isContentSearchDialogOpen = false;\n      });\n      this.isContentSearchDialogOpen = true;\n    }\n  }\n\n  public close() {\n    if (this.dialogRef) {\n      this.dialogRef.close();\n    }\n    this.isContentSearchDialogOpen = false;\n  }\n\n  public toggle() {\n    this.isContentSearchDialogOpen ? this.close() : this.open();\n  }\n\n  public isOpen(): boolean {\n    return this.isContentSearchDialogOpen;\n  }\n\n  private getDialogConfig(): MatDialogConfig {\n    return this.contentSearchDialogConfigStrategyFactory\n      .create()\n      .getConfig(this._el);\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  HostListener,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { MediaObserver } from '@angular/flex-layout';\nimport { MatDialogRef } from '@angular/material/dialog';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { IiifManifestService } from '../core/iiif-manifest-service/iiif-manifest-service';\nimport { MimeViewerIntl } from '../core/intl/viewer-intl';\nimport { MimeDomHelper } from '../core/mime-dom-helper';\nimport { MimeResizeService } from '../core/mime-resize-service/mime-resize.service';\nimport { Dimensions } from '../core/models/dimensions';\nimport { Manifest } from './../core/models/manifest';\n\n@Component({\n  selector: 'mime-contents',\n  templateUrl: './contents-dialog.component.html',\n  styleUrls: ['./contents-dialog.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContentsDialogComponent implements OnInit, OnDestroy {\n  public manifest: Manifest;\n  public tabHeight = {};\n  public showToc = false;\n  public selectedIndex = 0;\n  private mimeHeight = 0;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    public intl: MimeViewerIntl,\n    public mediaObserver: MediaObserver,\n    private dialogRef: MatDialogRef<ContentsDialogComponent>,\n    private el: ElementRef,\n    private mimeDomHelper: MimeDomHelper,\n    private changeDetectorRef: ChangeDetectorRef,\n    private iiifManifestService: IiifManifestService,\n    mimeResizeService: MimeResizeService\n  ) {\n    mimeResizeService.onResize\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((dimensions: Dimensions) => {\n        this.mimeHeight = dimensions.height;\n        this.resizeTabHeight();\n      });\n  }\n\n  ngOnInit() {\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        this.manifest = manifest;\n        this.showToc = this.manifest && this.manifest.structures.length > 0;\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.resizeTabHeight();\n  }\n\n  ngOnDestroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  @HostListener('window:resize', ['$event'])\n  onResize(event: any) {\n    this.resizeTabHeight();\n  }\n\n  onCanvasChanged() {\n    if (this.mediaObserver.isActive('lt-md')) {\n      this.dialogRef.close();\n    }\n  }\n\n  private resizeTabHeight(): void {\n    const dimensions = this.mimeDomHelper.getBoundingClientRect(this.el);\n    let height = this.mimeHeight;\n\n    if (this.mediaObserver.isActive('lt-md')) {\n      height -= 104;\n      this.tabHeight = {\n        maxHeight: window.innerHeight - 128 + 'px'\n      };\n    } else {\n      height -= 278;\n      this.tabHeight = {\n        maxHeight: height + 'px'\n      };\n    }\n  }\n}\n","import { MimeDomHelper } from './../core/mime-dom-helper';\nimport { ElementRef, Injectable } from '@angular/core';\nimport { MatDialogConfig } from '@angular/material/dialog';\n\nimport { Dimensions } from './../core/models/dimensions';\n\nexport interface ContentsDialogConfigStrategy {\n  getConfig(elementRef?: ElementRef): MatDialogConfig;\n}\n\nexport class MobileContentsDialogConfigStrategy\n  implements ContentsDialogConfigStrategy {\n  public getConfig(elementRef: ElementRef): MatDialogConfig {\n    return {\n      hasBackdrop: false,\n      disableClose: false,\n      width: '100%',\n      height: '100%',\n      panelClass: 'contents-panel'\n    };\n  }\n}\n\nexport class DesktopContentsDialogConfigStrategy\n  implements ContentsDialogConfigStrategy {\n  public static readonly dialogWidth = 350;\n  public static readonly paddingRight = 20;\n  private mimeDomHelper: MimeDomHelper;\n\n  constructor(mimeDomHelper: MimeDomHelper) {\n    this.mimeDomHelper = mimeDomHelper;\n  }\n\n  public getConfig(el: ElementRef): MatDialogConfig {\n    const dimensions = this.getPosition(el);\n    return {\n      hasBackdrop: false,\n      disableClose: false,\n      width: `${DesktopContentsDialogConfigStrategy.dialogWidth}px`,\n      position: {\n        top: dimensions.top + 'px',\n        left: dimensions.left + 'px'\n      },\n      panelClass: 'contents-panel'\n    };\n  }\n\n  private getPosition(el: ElementRef): Dimensions {\n    const dimensions = this.mimeDomHelper.getBoundingClientRect(el);\n    return new Dimensions({\n      top: dimensions.top + 64,\n      left:\n        dimensions.right -\n        DesktopContentsDialogConfigStrategy.dialogWidth -\n        DesktopContentsDialogConfigStrategy.paddingRight\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { MediaObserver } from '@angular/flex-layout';\nimport { MimeDomHelper } from '../core/mime-dom-helper';\nimport {\n  ContentsDialogConfigStrategy,\n  DesktopContentsDialogConfigStrategy,\n  MobileContentsDialogConfigStrategy\n} from './contents-dialog-config-strategy';\n\n@Injectable()\nexport class ContentsDialogConfigStrategyFactory {\n  constructor(\n    private mediaObserver: MediaObserver,\n    private mimeDomHelper: MimeDomHelper\n  ) {}\n\n  public create(): ContentsDialogConfigStrategy {\n    return this.mediaObserver.isActive('lt-md')\n      ? new MobileContentsDialogConfigStrategy()\n      : new DesktopContentsDialogConfigStrategy(this.mimeDomHelper);\n  }\n}\n","import { ElementRef, Injectable } from '@angular/core';\nimport {\n  MatDialog,\n  MatDialogConfig,\n  MatDialogRef\n} from '@angular/material/dialog';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { ContentsDialogComponent } from './contents-dialog.component';\nimport { ContentsDialogConfigStrategyFactory } from './contents-dialog-config-strategy-factory';\nimport { MimeResizeService } from '../core/mime-resize-service/mime-resize.service';\n\n@Injectable()\nexport class ContentsDialogService {\n  private _el: ElementRef;\n  private isContentsDialogOpen = false;\n  private dialogRef: MatDialogRef<ContentsDialogComponent>;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    private dialog: MatDialog,\n    private contentsDialogConfigStrategyFactory: ContentsDialogConfigStrategyFactory,\n    private mimeResizeService: MimeResizeService\n  ) {}\n\n  public initialize(): void {\n    this.mimeResizeService.onResize\n      .pipe(takeUntil(this.destroyed))\n      .subscribe(rect => {\n        if (this.isContentsDialogOpen) {\n          const config = this.getDialogConfig();\n          this.dialogRef.updatePosition(config.position);\n          this.dialogRef.updateSize(config.width, config.height);\n        }\n      });\n  }\n\n  public destroy() {\n    this.close();\n    this.destroyed.next();\n  }\n\n  set el(el: ElementRef) {\n    this._el = el;\n  }\n\n  public open(selectedIndex?: number) {\n    if (!this.isContentsDialogOpen) {\n      const config = this.getDialogConfig();\n      this.dialogRef = this.dialog.open(ContentsDialogComponent, config);\n\n      if (selectedIndex) {\n        this.dialogRef.componentInstance.selectedIndex = selectedIndex;\n      }\n\n      this.dialogRef.afterClosed().subscribe(result => {\n        this.isContentsDialogOpen = false;\n      });\n      this.isContentsDialogOpen = true;\n    }\n  }\n\n  public close() {\n    if (this.dialogRef) {\n      this.dialogRef.close();\n      this.isContentsDialogOpen = false;\n    }\n    this.isContentsDialogOpen = false;\n  }\n\n  public toggle() {\n    this.isContentsDialogOpen ? this.close() : this.open();\n  }\n\n  public isOpen(): boolean {\n    return this.isContentsDialogOpen;\n  }\n\n  public getSelectedIndex(): number {\n    return this.dialogRef && this.dialogRef.componentInstance\n      ? this.dialogRef.componentInstance.selectedIndex\n      : 0;\n  }\n\n  private getDialogConfig(): MatDialogConfig {\n    return this.contentsDialogConfigStrategyFactory\n      .create()\n      .getConfig(this._el);\n  }\n}\n","export class AccessKeys {\n  public static PAGEDOWN = [34];\n  public static PAGEUP = [33];\n  public static ARROWRIGHT = [39];\n  public static ARROWLEFT = [37];\n  public static firstCanvasGroupCodes = [36]; // Home\n  public static lastCanvasGroupCodes = [35]; // End\n  public static zoomInCodes = [107, 187, 171]; // +, numpad and standard position, Firefox uses 171 for standard position\n  public static zoomOutCodes = [109, 189, 173]; // -, numpad and standard position, Firefox uses 173 for standard position\n  public static zoomHomeCodes = [96, 48]; // 0\n  public static nextHit = [78]; // n\n  public static previousHit = [80]; // p\n  public static toggleSearchDialogCodes = [83]; // s\n  public static toggleContentsDialogCodes = [67]; // C\n  public static toggleFullscreenCodes = [70]; // f\n  public static resetSearch = [83]; // s\n  public static rotateCwCodes = [82]; // r\n  private keyCode: number;\n  private altKey = false;\n  private shiftKey = false;\n  private ctrlkey = false;\n\n  constructor(event: KeyboardEvent) {\n    this.keyCode = event.keyCode;\n    this.altKey = event.altKey;\n    this.shiftKey = event.shiftKey;\n    this.ctrlkey = event.ctrlKey;\n  }\n\n  public isArrowRightKeys() {\n    return !this.isMultiKeys() && this.arrayContainsKeys(AccessKeys.ARROWRIGHT);\n  }\n\n  public isArrowLeftKeys() {\n    return !this.isMultiKeys() && this.arrayContainsKeys(AccessKeys.ARROWLEFT);\n  }\n\n  public isPageUpKeys() {\n    return !this.isMultiKeys() && this.arrayContainsKeys(AccessKeys.PAGEUP);\n  }\n\n  public isPageDownKeys() {\n    return !this.isMultiKeys() && this.arrayContainsKeys(AccessKeys.PAGEDOWN);\n  }\n\n  public isFirstCanvasGroupKeys() {\n    return (\n      !this.isMultiKeys() &&\n      this.arrayContainsKeys(AccessKeys.firstCanvasGroupCodes)\n    );\n  }\n\n  public isLastCanvasGroupKeys() {\n    return (\n      !this.isMultiKeys() &&\n      this.arrayContainsKeys(AccessKeys.lastCanvasGroupCodes)\n    );\n  }\n\n  public isSliderKeys() {\n    return (\n      this.isArrowLeftKeys() ||\n      this.isArrowRightKeys() ||\n      this.isPageDownKeys() ||\n      this.isPageUpKeys() ||\n      this.isFirstCanvasGroupKeys() ||\n      this.isLastCanvasGroupKeys()\n    );\n  }\n\n  public isZoomInKeys() {\n    return (\n      !this.isMultiKeys() && this.arrayContainsKeys(AccessKeys.zoomInCodes)\n    );\n  }\n\n  public isZoomOutKeys() {\n    return (\n      !this.isMultiKeys() && this.arrayContainsKeys(AccessKeys.zoomOutCodes)\n    );\n  }\n\n  public isZoomHomeKeys() {\n    return (\n      !this.isMultiKeys() && this.arrayContainsKeys(AccessKeys.zoomHomeCodes)\n    );\n  }\n\n  public isNextHitKeys() {\n    return !this.isMultiKeys() && this.arrayContainsKeys(AccessKeys.nextHit);\n  }\n\n  public isPreviousHitKeys() {\n    return (\n      !this.isMultiKeys() && this.arrayContainsKeys(AccessKeys.previousHit)\n    );\n  }\n\n  public isSearchDialogKeys() {\n    return (\n      !this.isMultiKeys() &&\n      this.arrayContainsKeys(AccessKeys.toggleSearchDialogCodes)\n    );\n  }\n\n  public isContentsDialogKeys() {\n    return (\n      !this.isMultiKeys() &&\n      this.arrayContainsKeys(AccessKeys.toggleContentsDialogCodes)\n    );\n  }\n\n  public isFullscreenKeys() {\n    return (\n      !this.isMultiKeys() &&\n      this.arrayContainsKeys(AccessKeys.toggleFullscreenCodes)\n    );\n  }\n\n  public isResetSearchKeys() {\n    return (\n      this.isShiftPressed() && this.arrayContainsKeys(AccessKeys.resetSearch)\n    );\n  }\n\n  public isRotateKeys() {\n    return (\n      !this.isMultiKeys() && this.arrayContainsKeys(AccessKeys.rotateCwCodes)\n    );\n  }\n\n  private isMultiKeys(): boolean {\n    return this.altKey || this.shiftKey || this.ctrlkey;\n  }\n\n  private arrayContainsKeys(keys: number[]): boolean {\n    return keys.indexOf(this.keyCode) > -1;\n  }\n\n  private isShiftPressed(): boolean {\n    return this.shiftKey;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { CanvasService } from '../../canvas-service/canvas-service';\nimport { IiifContentSearchService } from '../../iiif-content-search-service/iiif-content-search.service';\nimport { SearchResult } from '../../models/search-result';\nimport { Hit } from '../../models/hit';\n\n@Injectable()\nexport class ContentSearchNavigationService {\n  private currentIndex = 0;\n  private isHitOnActiveCanvasGroup = false;\n  private _isFirstHitOnCanvasGroup = false;\n  private _isLastHitOnCanvasGroup = false;\n  private canvasesPerCanvasGroup = [-1];\n  private searchResult: SearchResult;\n\n  constructor(\n    private canvasService: CanvasService,\n    private iiifContentSearchService: IiifContentSearchService\n  ) {\n    this.iiifContentSearchService.onChange.subscribe((result: SearchResult) => {\n      this.searchResult = result;\n    });\n  }\n\n  update(canvasGroupIndex: number) {\n    this.canvasesPerCanvasGroup = this.canvasService.getCanvasesPerCanvasGroup(\n      canvasGroupIndex\n    );\n    this.currentIndex = this.findCurrentHitIndex(this.canvasesPerCanvasGroup);\n    this.isHitOnActiveCanvasGroup = this.findHitOnActiveCanvasGroup();\n    this._isFirstHitOnCanvasGroup = this.isFirstHitOnCanvasGroup();\n    this._isLastHitOnCanvasGroup = this.findLastHitOnCanvasGroup();\n  }\n\n  getCurrentIndex(): number {\n    return this.currentIndex;\n  }\n\n  getHitOnActiveCanvasGroup(): boolean {\n    return this.isHitOnActiveCanvasGroup;\n  }\n\n  getFirstHitCanvasGroup(): boolean {\n    return this._isFirstHitOnCanvasGroup;\n  }\n\n  getLastHitCanvasGroup(): boolean {\n    return this._isLastHitOnCanvasGroup;\n  }\n\n  goToNextCanvasGroupHit() {\n    if (!this._isLastHitOnCanvasGroup) {\n      let nextHit: Hit;\n      if (this.currentIndex === -1) {\n        nextHit = this.searchResult.get(0);\n      } else {\n        const current = this.searchResult.get(this.currentIndex);\n        const canvasGroup = this.canvasService.findCanvasGroupByCanvasIndex(\n          current.index\n        );\n        const canvasesPerCanvasGroup = this.canvasService.getCanvasesPerCanvasGroup(\n          canvasGroup\n        );\n        const lastCanvasGroupIndex = this.getLastCanvasGroupIndex(\n          canvasesPerCanvasGroup\n        );\n        nextHit = this.searchResult.hits.find(\n          h => h.index > lastCanvasGroupIndex\n        );\n      }\n      if (nextHit) {\n        this.goToCanvasIndex(nextHit);\n      }\n    }\n  }\n\n  goToPreviousCanvasGroupHit() {\n    const previousIndex = this.isHitOnActiveCanvasGroup\n      ? this.currentIndex - 1\n      : this.currentIndex;\n    const previousHit = this.findFirstHitOnCanvasGroup(previousIndex);\n    this.goToCanvasIndex(previousHit);\n  }\n\n  private goToCanvasIndex(hit: Hit): void {\n    this.currentIndex = this.findCurrentHitIndex([hit.index]);\n    this.iiifContentSearchService.selected(hit);\n  }\n\n  private findLastHitOnCanvasGroup() {\n    const lastCanvasIndex = this.searchResult.get(this.searchResult.size() - 1)\n      .index;\n    const currentHit = this.searchResult.get(this.currentIndex);\n    return currentHit.index === lastCanvasIndex;\n  }\n\n  private findFirstHitOnCanvasGroup(previousIndex: number): Hit {\n    let previousHit = this.searchResult.get(previousIndex);\n    const canvasGroupIndex = this.canvasService.findCanvasGroupByCanvasIndex(\n      previousHit.index\n    );\n    const canvasesPerCanvasGroup = this.canvasService.getCanvasesPerCanvasGroup(\n      canvasGroupIndex\n    );\n    const leftCanvas = canvasesPerCanvasGroup[0];\n    const leftCanvasHit = this.searchResult.hits.find(\n      h => h.index === leftCanvas\n    );\n    if (leftCanvasHit) {\n      previousHit = leftCanvasHit;\n    } else if (canvasesPerCanvasGroup.length === 2) {\n      const rightCanvas = canvasesPerCanvasGroup[1];\n      previousHit = this.searchResult.hits.find(h => h.index === rightCanvas);\n    }\n    return previousHit;\n  }\n\n  private findHitOnActiveCanvasGroup() {\n    return (\n      this.canvasesPerCanvasGroup.indexOf(\n        this.searchResult.get(this.currentIndex).index\n      ) >= 0\n    );\n  }\n\n  private findCurrentHitIndex(canvasGroupIndexes: number[]): number {\n    for (let i = 0; i < this.searchResult.size(); i++) {\n      const hit = this.searchResult.get(i);\n      if (canvasGroupIndexes.indexOf(hit.index) >= 0) {\n        return i;\n      }\n      if (hit.index >= canvasGroupIndexes[canvasGroupIndexes.length - 1]) {\n        if (i === 0) {\n          return -1;\n        } else {\n          const phit = this.searchResult.get(i - 1);\n          return this.searchResult.hits.findIndex(\n            sr => sr.index === phit.index\n          );\n        }\n      }\n    }\n    return this.searchResult.size() - 1;\n  }\n\n  private isFirstHitOnCanvasGroup() {\n    return this.currentIndex <= 0;\n  }\n\n  private getLastCanvasGroupIndex(canvasesPerCanvasGroup: number[]) {\n    return canvasesPerCanvasGroup.length === 1\n      ? canvasesPerCanvasGroup[0]\n      : canvasesPerCanvasGroup[1];\n  }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { ViewerService } from '../viewer-service/viewer.service';\nimport { CanvasService } from '../canvas-service/canvas-service';\nimport { ContentSearchDialogService } from '../../content-search-dialog/content-search-dialog.service';\nimport { ContentsDialogService } from '../../contents-dialog/contents-dialog.service';\nimport { ModeService } from '../mode-service/mode.service';\nimport { ViewerMode } from '../models/viewer-mode';\nimport { IiifManifestService } from '../iiif-manifest-service/iiif-manifest-service';\nimport { Manifest } from '../models/manifest';\nimport { MimeDomHelper } from '../mime-dom-helper';\nimport { AccessKeys } from '../models/AccessKeys';\nimport { ContentSearchNavigationService } from '../navigation/content-search-navigation-service/content-search-navigation.service';\nimport { IiifContentSearchService } from '../iiif-content-search-service/iiif-content-search.service';\nimport { SearchResult } from '../models/search-result';\nimport { ViewingDirection } from '../models/viewing-direction';\n\n@Injectable()\nexport class AccessKeysService implements OnDestroy {\n  private isSearchable = false;\n  private hasHits = false;\n  private disabledKeys: number[] = [];\n  private destroyed: Subject<void> = new Subject();\n  private invert = false;\n\n  constructor(\n    private viewerService: ViewerService,\n    private canvasService: CanvasService,\n    private modeService: ModeService,\n    private iiifManifestService: IiifManifestService,\n    private iiifContentSearchService: IiifContentSearchService,\n    private contentSearchDialogService: ContentSearchDialogService,\n    private contentsDialogService: ContentsDialogService,\n    private mimeDomHelper: MimeDomHelper,\n    private contentSearchNavigationService: ContentSearchNavigationService\n  ) {\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        this.isSearchable = this.isManifestSearchable(manifest);\n        this.invert = manifest.viewingDirection === ViewingDirection.RTL;\n      });\n\n    this.iiifContentSearchService.onChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((result: SearchResult) => {\n        this.hasHits = result.hits.length > 0;\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  public handleKeyEvents(event: KeyboardEvent) {\n    const accessKeys = new AccessKeys(event);\n    if (!this.isKeyDisabled(event.keyCode)) {\n      if (accessKeys.isArrowLeftKeys()) {\n        if (!this.isZoomedIn()) {\n          this.invert\n            ? this.goToNextCanvasGroup()\n            : this.goToPreviousCanvasGroup();\n        }\n      } else if (accessKeys.isArrowRightKeys()) {\n        if (!this.isZoomedIn()) {\n          this.invert\n            ? this.goToPreviousCanvasGroup()\n            : this.goToNextCanvasGroup();\n        }\n      } else if (accessKeys.isFirstCanvasGroupKeys()) {\n        this.goToFirstCanvasGroup();\n      } else if (accessKeys.isLastCanvasGroupKeys()) {\n        this.goToLastCanvasGroup();\n      } else if (accessKeys.isNextHitKeys() && this.hasHits) {\n        this.goToNextHit();\n      } else if (accessKeys.isPreviousHitKeys() && this.hasHits) {\n        this.goToPreviousHit();\n      } else if (accessKeys.isFullscreenKeys()) {\n        this.toggleFullscreen();\n      } else if (accessKeys.isSearchDialogKeys() && this.isSearchable) {\n        this.toggleSearchDialog();\n      } else if (accessKeys.isContentsDialogKeys()) {\n        this.toggleContentsDialog();\n      } else if (accessKeys.isResetSearchKeys()) {\n        this.resetSearch();\n      } else if (accessKeys.isPageDownKeys()) {\n        this.goToNextCanvasGroup();\n      } else if (accessKeys.isPageUpKeys()) {\n        this.goToPreviousCanvasGroup();\n      } else if (accessKeys.isZoomInKeys()) {\n        this.zoomIn();\n      } else if (accessKeys.isZoomOutKeys()) {\n        this.zoomOut();\n      } else if (accessKeys.isZoomHomeKeys()) {\n        this.zoomHome();\n      } else if (accessKeys.isRotateKeys()) {\n        this.rotateClockWise();\n      }\n    }\n  }\n\n  private goToNextCanvasGroup() {\n    this.viewerService.goToNextCanvasGroup();\n  }\n\n  private goToPreviousCanvasGroup() {\n    this.viewerService.goToPreviousCanvasGroup();\n  }\n\n  private goToFirstCanvasGroup() {\n    this.viewerService.goToCanvasGroup(0, false);\n  }\n\n  private goToLastCanvasGroup() {\n    this.viewerService.goToCanvasGroup(\n      this.canvasService.numberOfCanvasGroups - 1,\n      false\n    );\n  }\n\n  private rotateClockWise() {\n    this.viewerService.rotate();\n    this.mimeDomHelper.setFocusOnViewer();\n  }\n\n  private goToNextHit() {\n    this.contentSearchNavigationService.goToNextCanvasGroupHit();\n  }\n\n  private goToPreviousHit() {\n    this.contentSearchNavigationService.goToPreviousCanvasGroupHit();\n  }\n\n  private zoomIn() {\n    if (this.modeService.mode === ViewerMode.DASHBOARD) {\n      this.modeService.toggleMode();\n    } else {\n      this.viewerService.zoomIn();\n    }\n  }\n\n  private zoomOut() {\n    if (this.modeService.mode === ViewerMode.PAGE) {\n      this.modeService.toggleMode();\n    } else if (this.modeService.mode === ViewerMode.PAGE_ZOOMED) {\n      this.viewerService.zoomOut();\n    }\n  }\n\n  private zoomHome() {\n    if (this.modeService.mode === ViewerMode.PAGE_ZOOMED) {\n      this.viewerService.home();\n    }\n  }\n\n  private toggleSearchDialog() {\n    if (\n      this.modeService.mode === ViewerMode.PAGE ||\n      this.modeService.mode === ViewerMode.PAGE_ZOOMED\n    ) {\n      this.modeService.mode = ViewerMode.DASHBOARD;\n      this.contentSearchDialogService.open();\n    } else {\n      if (this.contentSearchDialogService.isOpen()) {\n        this.contentSearchDialogService.close();\n      } else {\n        this.contentSearchDialogService.open();\n      }\n    }\n\n    this.contentsDialogService.close();\n  }\n\n  private toggleContentsDialog() {\n    if (\n      this.modeService.mode === ViewerMode.PAGE ||\n      this.modeService.mode === ViewerMode.PAGE_ZOOMED\n    ) {\n      this.modeService.mode = ViewerMode.DASHBOARD;\n      this.contentsDialogService.open();\n    } else {\n      if (this.contentsDialogService.isOpen()) {\n        this.contentsDialogService.close();\n      } else {\n        this.contentsDialogService.open();\n      }\n    }\n    this.contentSearchDialogService.close();\n  }\n\n  private toggleFullscreen() {\n    this.mimeDomHelper.toggleFullscreen();\n    this.mimeDomHelper.setFocusOnViewer();\n  }\n\n  private resetSearch() {\n    this.iiifContentSearchService.destroy();\n  }\n\n  private isManifestSearchable(manifest: Manifest): boolean {\n    return manifest.service ? true : false;\n  }\n\n  private isZoomedIn(): boolean {\n    return this.modeService.mode === ViewerMode.PAGE_ZOOMED;\n  }\n\n  private updateDisabledKeys() {\n    this.resetDisabledKeys();\n    if (this.contentsDialogService.isOpen()) {\n      this.disableKeysForContentDialog();\n    } else if (this.contentSearchDialogService.isOpen()) {\n      this.diableKeysForContentSearchDialog();\n    }\n  }\n\n  private disableKeysForContentDialog() {\n    this.disabledKeys = this.disabledKeys\n      .concat(AccessKeys.ARROWLEFT)\n      .concat(AccessKeys.ARROWRIGHT);\n  }\n\n  private diableKeysForContentSearchDialog() {\n    this.disabledKeys = this.disabledKeys\n      .concat(AccessKeys.ARROWLEFT)\n      .concat(AccessKeys.ARROWRIGHT)\n      .concat(AccessKeys.firstCanvasGroupCodes)\n      .concat(AccessKeys.lastCanvasGroupCodes)\n      .concat(AccessKeys.zoomInCodes)\n      .concat(AccessKeys.zoomOutCodes)\n      .concat(AccessKeys.zoomHomeCodes)\n      .concat(AccessKeys.nextHit)\n      .concat(AccessKeys.previousHit)\n      .concat(AccessKeys.toggleSearchDialogCodes)\n      .concat(AccessKeys.toggleContentsDialogCodes)\n      .concat(AccessKeys.toggleFullscreenCodes);\n  }\n\n  private resetDisabledKeys() {\n    this.disabledKeys = [];\n  }\n\n  private isKeyDisabled(keyCode: number): boolean {\n    this.updateDisabledKeys();\n    return this.disabledKeys.indexOf(keyCode) > -1;\n  }\n}\n","import { Injectable, ElementRef } from '@angular/core';\nimport { Observable, ReplaySubject } from 'rxjs';\n\nimport { MimeDomHelper } from './../core/mime-dom-helper';\nimport { Dimensions } from './../core/models/dimensions';\n\n@Injectable()\nexport class AttributionDialogResizeService {\n  private _el: ElementRef;\n  private resizeSubject: ReplaySubject<Dimensions> = new ReplaySubject();\n  private dimensions = new Dimensions();\n\n  constructor(private mimeDomHelper: MimeDomHelper) {}\n\n  set el(el: ElementRef) {\n    this._el = el;\n  }\n\n  get el() {\n    return this._el;\n  }\n\n  get onResize(): Observable<Dimensions> {\n    return this.resizeSubject.asObservable();\n  }\n\n  markForCheck() {\n    const dimensions = this.mimeDomHelper.getBoundingClientRect(this.el);\n    if (\n      this.dimensions.bottom !== dimensions.bottom ||\n      this.dimensions.height !== dimensions.height ||\n      this.dimensions.left !== dimensions.left ||\n      this.dimensions.right !== dimensions.right ||\n      this.dimensions.top !== dimensions.top ||\n      this.dimensions.width !== dimensions.width\n    ) {\n      this.dimensions = dimensions;\n      this.resizeSubject.next({ ...this.dimensions });\n    }\n  }\n}\n","import {\n  AfterViewChecked,\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  HostListener,\n  OnDestroy,\n  OnInit,\n  Renderer2,\n  ViewChild\n} from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { AccessKeysService } from '../core/access-keys-handler-service/access-keys.service';\nimport { IiifManifestService } from '../core/iiif-manifest-service/iiif-manifest-service';\nimport { MimeViewerIntl } from '../core/intl/viewer-intl';\nimport { Manifest } from '../core/models/manifest';\nimport { StyleService } from '../core/style-service/style.service';\nimport { AttributionDialogResizeService } from './attribution-dialog-resize.service';\n\n@Component({\n  templateUrl: './attribution-dialog.component.html',\n  styleUrls: ['./attribution-dialog.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AttributionDialogComponent\n  implements OnInit, AfterViewInit, OnDestroy, AfterViewChecked {\n  public manifest: Manifest;\n  private destroyed: Subject<void> = new Subject();\n  @ViewChild('container', { static: true }) container: ElementRef;\n\n  constructor(\n    public intl: MimeViewerIntl,\n    private renderer: Renderer2,\n    private el: ElementRef,\n    private changeDetectorRef: ChangeDetectorRef,\n    private iiifManifestService: IiifManifestService,\n    private attributionDialogResizeService: AttributionDialogResizeService,\n    private styleService: StyleService,\n    private accessKeysHandlerService: AccessKeysService\n  ) {\n    attributionDialogResizeService.el = el;\n  }\n\n  ngOnInit() {\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        this.manifest = manifest;\n        this.changeDetectorRef.markForCheck();\n      });\n  }\n\n  ngAfterViewInit() {\n    this.styleService.onChange.pipe(takeUntil(this.destroyed)).subscribe(c => {\n      const backgroundRgbaColor = this.styleService.convertToRgba(c, 0.3);\n      this.renderer.setStyle(\n        this.container.nativeElement,\n        'background-color',\n        backgroundRgbaColor\n      );\n    });\n  }\n\n  ngOnDestroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  @HostListener('keyup', ['$event'])\n  handleKeys(event: KeyboardEvent) {\n    this.accessKeysHandlerService.handleKeyEvents(event);\n  }\n\n  @HostListener('window:resize', ['$event'])\n  onResize(event: any) {\n    this.attributionDialogResizeService.markForCheck();\n  }\n\n  ngAfterViewChecked() {\n    this.attributionDialogResizeService.markForCheck();\n  }\n}\n","import { Injectable, ElementRef } from '@angular/core';\nimport {\n  MatDialog,\n  MatDialogRef,\n  MatDialogConfig\n} from '@angular/material/dialog';\nimport { Observable, Subscription, Subject, interval } from 'rxjs';\nimport { take, takeUntil } from 'rxjs/operators';\n\nimport { AttributionDialogComponent } from './attribution-dialog.component';\nimport { MimeResizeService } from '../core/mime-resize-service/mime-resize.service';\nimport { AttributionDialogResizeService } from './attribution-dialog-resize.service';\nimport { MimeDomHelper } from '../core/mime-dom-helper';\nimport { Dimensions } from '../core/models/dimensions';\n\n@Injectable()\nexport class AttributionDialogService {\n  private isAttributionDialogOpen = false;\n  private dialogRef: MatDialogRef<AttributionDialogComponent>;\n  private _el: ElementRef;\n  private attributionDialogHeight = 0;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    private dialog: MatDialog,\n    private mimeResizeService: MimeResizeService,\n    private attributionDialogResizeService: AttributionDialogResizeService,\n    private mimeDomHelper: MimeDomHelper\n  ) {}\n\n  public initialize(): void {\n    this.mimeResizeService.onResize\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((dimensions: Dimensions) => {\n        if (this.isAttributionDialogOpen) {\n          const config = this.getDialogConfig();\n          this.dialogRef.updatePosition(config.position);\n        }\n      });\n    this.attributionDialogResizeService.onResize\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((dimensions: Dimensions) => {\n        if (this.isAttributionDialogOpen) {\n          this.attributionDialogHeight = dimensions.height;\n          const config = this.getDialogConfig();\n          this.dialogRef.updatePosition(config.position);\n        }\n      });\n  }\n\n  public destroy() {\n    this.close();\n    this.destroyed.next();\n  }\n\n  set el(el: ElementRef) {\n    this._el = el;\n  }\n\n  public open(timeout?: number): void {\n    if (!this.isAttributionDialogOpen) {\n      /**\n       * Sleeping for material animations to finish\n       * fix: https://github.com/angular/material2/issues/7438\n       */\n      interval(1000)\n        .pipe(take(1))\n        .subscribe(() => {\n          const config = this.getDialogConfig();\n          this.dialogRef = this.dialog.open(AttributionDialogComponent, config);\n          this.dialogRef.afterClosed().subscribe((result) => {\n            this.isAttributionDialogOpen = false;\n            this.mimeDomHelper.setFocusOnViewer();\n          });\n          this.isAttributionDialogOpen = true;\n          this.closeDialogAfter(timeout);\n        });\n    }\n  }\n\n  public close(): void {\n    if (this.dialogRef) {\n      this.dialogRef.close();\n      this.isAttributionDialogOpen = false;\n    }\n  }\n\n  public toggle(): void {\n    this.isAttributionDialogOpen ? this.close() : this.open();\n  }\n\n  private closeDialogAfter(seconds: number) {\n    if (seconds > 0) {\n      interval(seconds * 1000)\n        .pipe(take(1))\n        .subscribe(() => {\n          this.close();\n        });\n    }\n  }\n\n  private getDialogConfig(): MatDialogConfig {\n    const dimensions = this.getPosition(this._el);\n    return {\n      hasBackdrop: false,\n      width: '180px',\n      panelClass: 'attribution-panel',\n      position: {\n        top: dimensions.top + 'px',\n        left: dimensions.left + 'px'\n      },\n      autoFocus: true,\n      restoreFocus: false\n    };\n  }\n\n  private getPosition(el: ElementRef) {\n    const padding = 20;\n    const dimensions = this.mimeDomHelper.getBoundingClientRect(el);\n    return new Dimensions({\n      top:\n        dimensions.top + dimensions.height - this.attributionDialogHeight - 68,\n      left: dimensions.left + padding\n    });\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { SharedModule } from './../shared/shared.module';\nimport { AttributionDialogComponent } from './attribution-dialog.component';\nimport { AttributionDialogService } from './attribution-dialog.service';\nimport { AttributionDialogResizeService } from './attribution-dialog-resize.service';\nimport { MimeDomHelper } from '../core/mime-dom-helper';\n\n@NgModule({\n  imports: [SharedModule],\n  declarations: [AttributionDialogComponent],\n  providers: [\n    AttributionDialogService,\n    AttributionDialogResizeService,\n    MimeDomHelper\n  ],\n  entryComponents: [AttributionDialogComponent]\n})\nexport class AttributionDialogModule {}\n","import {\n  Component,\n  OnInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnDestroy\n} from '@angular/core';\nimport {\n  FormControl,\n  FormGroup,\n  FormBuilder,\n  Validators\n} from '@angular/forms';\nimport { MatDialogRef } from '@angular/material/dialog';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { ViewerService } from '../core/viewer-service/viewer.service';\nimport { CanvasService } from '../core/canvas-service/canvas-service';\nimport { MimeViewerIntl } from '../core/intl/viewer-intl';\n\n@Component({\n  templateUrl: './canvas-group-dialog.component.html',\n  styleUrls: ['./canvas-group-dialog.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CanvasGroupDialogComponent implements OnInit, OnDestroy {\n  numberOfCanvases: number;\n  canvasGroupForm: FormGroup;\n  canvasGroupControl: FormControl;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    private dialogRef: MatDialogRef<CanvasGroupDialogComponent>,\n    private fb: FormBuilder,\n    private viewerService: ViewerService,\n    private canvasService: CanvasService,\n    public intl: MimeViewerIntl,\n    private changeDetectorRef: ChangeDetectorRef\n  ) {\n    this.numberOfCanvases = this.canvasService.numberOfCanvases;\n    this.createForm();\n  }\n\n  createForm() {\n    this.canvasGroupControl = new FormControl('', [\n      Validators.required,\n      Validators.min(1),\n      Validators.max(this.numberOfCanvases)\n    ]);\n    this.canvasGroupForm = this.fb.group({\n      canvasGroupControl: this.canvasGroupControl\n    });\n  }\n\n  ngOnInit() {\n    this.intl.changes\n      .pipe(takeUntil(this.destroyed))\n      .subscribe(() => this.changeDetectorRef.markForCheck());\n  }\n\n  ngOnDestroy(): void {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  onSubmit(): void {\n    if (this.canvasGroupForm.valid) {\n      const pageNumber =\n        this.canvasGroupForm.get('canvasGroupControl').value - 1;\n      this.viewerService.goToCanvasGroup(\n        this.canvasService.findCanvasGroupByCanvasIndex(pageNumber),\n        false\n      );\n      this.dialogRef.close();\n    }\n  }\n}\n","import { Injectable, ElementRef } from '@angular/core';\nimport {\n  MatDialog,\n  MatDialogRef,\n  MatDialogConfig\n} from '@angular/material/dialog';\nimport { Subject } from 'rxjs';\nimport { take, takeUntil } from 'rxjs/operators';\n\nimport { CanvasGroupDialogComponent } from './canvas-group-dialog.component';\n\n@Injectable()\nexport class CanvasGroupDialogService {\n  private isCanvasGroupDialogOpen = false;\n  private dialogRef: MatDialogRef<CanvasGroupDialogComponent>;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(private dialog: MatDialog) {}\n\n  public initialize(): void {}\n\n  public destroy() {\n    this.close();\n    this.destroyed.next();\n  }\n\n  public open(timeout?: number): void {\n    if (!this.isCanvasGroupDialogOpen) {\n      const config = this.getDialogConfig();\n      this.dialogRef = this.dialog.open(CanvasGroupDialogComponent, config);\n      this.dialogRef.afterClosed().subscribe(result => {\n        this.isCanvasGroupDialogOpen = false;\n      });\n      this.isCanvasGroupDialogOpen = true;\n    }\n  }\n\n  public close(): void {\n    if (this.dialogRef) {\n      this.dialogRef.close();\n      this.isCanvasGroupDialogOpen = false;\n    }\n  }\n\n  public toggle(): void {\n    this.isCanvasGroupDialogOpen ? this.close() : this.open();\n  }\n\n  private getDialogConfig(): MatDialogConfig {\n    return {\n      hasBackdrop: false,\n      disableClose: true,\n      panelClass: 'canvas-group-panel'\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { SharedModule } from './../shared/shared.module';\nimport { CanvasGroupDialogComponent } from './canvas-group-dialog.component';\nimport { CanvasGroupDialogService } from './canvas-group-dialog.service';\nimport { MimeDomHelper } from '../core/mime-dom-helper';\n\n@NgModule({\n  imports: [SharedModule],\n  declarations: [CanvasGroupDialogComponent],\n  providers: [CanvasGroupDialogService],\n  entryComponents: [CanvasGroupDialogComponent]\n})\nexport class CanvasGroupDialogModule {}\n","import { NgModule } from '@angular/core';\n\nimport { SharedModule } from './../shared/shared.module';\nimport { ContentSearchDialogService } from './content-search-dialog.service';\nimport { ContentSearchDialogConfigStrategyFactory } from './content-search-dialog-config-strategy-factory';\nimport { ContentSearchDialogComponent } from './content-search-dialog.component';\n\n@NgModule({\n  imports: [SharedModule],\n  declarations: [ContentSearchDialogComponent],\n  providers: [\n    ContentSearchDialogService,\n    ContentSearchDialogConfigStrategyFactory\n  ],\n  entryComponents: [ContentSearchDialogComponent]\n})\nexport class ContentSearchDialogModule {}\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { MediaObserver } from '@angular/flex-layout';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { MimeViewerIntl } from '../core/intl/viewer-intl';\nimport { MimeResizeService } from '../core/mime-resize-service/mime-resize.service';\nimport { Dimensions } from '../core/models/dimensions';\n\n@Component({\n  selector: 'mime-help',\n  templateUrl: './help-dialog.component.html',\n  styleUrls: ['./help-dialog.component.scss']\n})\nexport class HelpDialogComponent implements OnInit, OnDestroy {\n  public tabHeight = {};\n  private mimeHeight = 0;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    public mediaObserver: MediaObserver,\n    public intl: MimeViewerIntl,\n    private mimeResizeService: MimeResizeService\n  ) {}\n\n  ngOnInit(): void {\n    this.mimeResizeService.onResize\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((dimensions: Dimensions) => {\n        this.mimeHeight = dimensions.height;\n        this.resizeTabHeight();\n      });\n\n    this.resizeTabHeight();\n  }\n\n  ngOnDestroy(): void {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  private resizeTabHeight() {\n    let height = this.mimeHeight;\n\n    if (this.mediaObserver.isActive('lt-md')) {\n      this.tabHeight = {\n        maxHeight: window.innerHeight - 128 + 'px'\n      };\n    } else {\n      height -= 272;\n      this.tabHeight = {\n        maxHeight: height + 'px'\n      };\n    }\n  }\n\n}\n","import { ElementRef } from '@angular/core';\nimport { MatDialogConfig } from '@angular/material/dialog';\nimport { Dimensions } from '../core/models/dimensions';\nimport { MimeDomHelper } from '../core/mime-dom-helper';\n\n\nexport interface HelpDialogConfigStrategy {\n  getConfig(elementRef?: ElementRef): MatDialogConfig;\n}\n\nexport class MobileHelpDialogConfigStrategy\n  implements HelpDialogConfigStrategy {\n  public getConfig(elementRef: ElementRef): MatDialogConfig {\n    return {\n      hasBackdrop: false,\n      disableClose: false,\n      autoFocus: false,\n      width: '100%',\n      height: '100%',\n      panelClass: 'help-panel'\n    };\n  }\n}\n\nexport class DesktopHelpDialogConfigStrategy\n  implements HelpDialogConfigStrategy {\n  public static readonly dialogWidth = 350;\n  public static readonly paddingRight = 20;\n  private mimeDomHelper: MimeDomHelper;\n\n  constructor(mimeDomHelper: MimeDomHelper) {\n    this.mimeDomHelper = mimeDomHelper;\n  }\n\n  public getConfig(el: ElementRef): MatDialogConfig {\n    const dimensions = this.getPosition(el);\n    return {\n      hasBackdrop: false,\n      disableClose: false,\n      autoFocus: false,\n      width: `${DesktopHelpDialogConfigStrategy.dialogWidth}px`,\n      position: {\n        top: dimensions.top + 'px',\n        left: dimensions.left + 'px'\n      },\n      panelClass: 'help-panel'\n    };\n  }\n\n  private getPosition(el: ElementRef): Dimensions {\n    const dimensions = this.mimeDomHelper.getBoundingClientRect(el);\n    return new Dimensions({\n      top: dimensions.top + 64,\n      left:\n        dimensions.right -\n        DesktopHelpDialogConfigStrategy.dialogWidth -\n        DesktopHelpDialogConfigStrategy.paddingRight\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { MediaObserver } from '@angular/flex-layout';\nimport { MimeDomHelper } from '../core/mime-dom-helper';\nimport {\n  DesktopHelpDialogConfigStrategy,\n  HelpDialogConfigStrategy,\n  MobileHelpDialogConfigStrategy\n} from './help-dialog-config-strategy';\n\n@Injectable()\nexport class HelpDialogConfigStrategyFactory {\n  constructor(\n    private mediaObserver: MediaObserver,\n    private mimeDomHelper: MimeDomHelper\n  ) {}\n\n  public create(): HelpDialogConfigStrategy {\n    return this.mediaObserver.isActive('lt-md')\n    ? new MobileHelpDialogConfigStrategy()\n    : new DesktopHelpDialogConfigStrategy(this.mimeDomHelper);\n  }\n}\n","import { ElementRef, Injectable } from '@angular/core';\nimport { MatDialog, MatDialogRef } from '@angular/material/dialog';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { HelpDialogComponent } from './help-dialog.component';\nimport { HelpDialogConfigStrategyFactory } from './help-dialog-config-strategy-factory';\nimport { MimeResizeService } from '../core/mime-resize-service/mime-resize.service';\n\n@Injectable()\nexport class HelpDialogService {\n  private _el: ElementRef;\n  private isHelpDialogOpen = false;\n  private dialogRef: MatDialogRef<HelpDialogComponent>;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    private dialog: MatDialog,\n    private helpDialogConfigStrategyFactory: HelpDialogConfigStrategyFactory,\n    private mimeResizeService: MimeResizeService\n  ) {}\n\n  public initialize(): void {\n    this.mimeResizeService.onResize\n      .pipe(takeUntil(this.destroyed))\n      .subscribe(() => {\n        if (this.isHelpDialogOpen) {\n          const config = this.getDialogConfig();\n          this.dialogRef.updatePosition(config.position);\n          this.dialogRef.updateSize(config.width, config.height);\n        }\n      })\n  }\n\n  public destroy(): void {\n    this.close();\n    this.destroyed.next();\n  }\n\n  set el(el: ElementRef) {\n    this._el = el;\n  }\n\n  public open(): void {\n    if (!this.isHelpDialogOpen) {\n      const config = this.getDialogConfig();\n      this.dialogRef = this.dialog.open(HelpDialogComponent, config);\n      this.dialogRef.afterClosed().subscribe(() => {\n        this.isHelpDialogOpen = false;\n      });\n      this.isHelpDialogOpen = true;\n    }\n  }\n\n  public close(): void {\n    if (this.dialogRef) {\n      this.dialogRef.close();\n    }\n    this.isHelpDialogOpen = false;\n  }\n\n  public toggle(): void {\n    this.isHelpDialogOpen ? this.close() : this.open();\n  }\n\n  public isOpen(): boolean {\n    return this.isHelpDialogOpen;\n  }\n\n  private getDialogConfig() {\n    return this.helpDialogConfigStrategyFactory\n      .create()\n      .getConfig(this._el);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { SharedModule } from '../shared/shared.module';\nimport { HelpDialogComponent } from './help-dialog.component';\nimport { HelpDialogService } from './help-dialog.service';\nimport { HelpDialogConfigStrategyFactory } from './help-dialog-config-strategy-factory';\n\n@NgModule({\n  imports: [SharedModule],\n  declarations: [HelpDialogComponent],\n  providers: [\n    HelpDialogService,\n    HelpDialogConfigStrategyFactory\n  ]\n})\nexport class HelpDialogModule {}\n","import {\n  Component,\n  OnInit,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnDestroy\n} from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { MimeViewerIntl } from './../../core/intl/viewer-intl';\nimport { IiifManifestService } from './../../core/iiif-manifest-service/iiif-manifest-service';\nimport { Manifest } from './../../core/models/manifest';\n\n@Component({\n  selector: 'mime-metadata',\n  templateUrl: './metadata.component.html',\n  styleUrls: ['./metadata.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MetadataComponent implements OnInit, OnDestroy {\n  public manifest: Manifest;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    public intl: MimeViewerIntl,\n    private changeDetectorRef: ChangeDetectorRef,\n    private iiifManifestService: IiifManifestService\n  ) {}\n\n  ngOnInit() {\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        this.manifest = manifest;\n        this.changeDetectorRef.markForCheck();\n      });\n  }\n\n  ngOnDestroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  OnDestroy,\n  OnInit,\n  Output\n} from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { CanvasService } from '../../core/canvas-service/canvas-service';\nimport { IiifManifestService } from '../../core/iiif-manifest-service/iiif-manifest-service';\nimport { MimeViewerIntl } from '../../core/intl/viewer-intl';\nimport { Manifest } from '../../core/models/manifest';\nimport { ViewerService } from '../../core/viewer-service/viewer.service';\n\n@Component({\n  selector: 'mime-toc',\n  templateUrl: './table-of-contents.component.html',\n  styleUrls: ['./table-of-contents.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TocComponent implements OnInit, OnDestroy {\n  @Output()\n  canvasChanged: EventEmitter<number> = new EventEmitter();\n  public manifest: Manifest;\n  public currentCanvasGroupIndex: number;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    public intl: MimeViewerIntl,\n    private changeDetectorRef: ChangeDetectorRef,\n    private iiifManifestService: IiifManifestService,\n    private viewerService: ViewerService,\n    private canvasService: CanvasService\n  ) {}\n\n  ngOnInit() {\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        this.manifest = manifest;\n        this.currentCanvasGroupIndex = this.canvasService.currentCanvasGroupIndex;\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.viewerService.onCanvasGroupIndexChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((canvasGroupIndex: number) => {\n        this.currentCanvasGroupIndex = canvasGroupIndex;\n        this.changeDetectorRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  goToCanvas(event: Event, canvasIndex: number): void {\n    event.preventDefault();\n    this.viewerService.goToCanvas(canvasIndex, false);\n    this.canvasChanged.emit(canvasIndex);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport {\n  ErrorStateMatcher,\n  ShowOnDirtyErrorStateMatcher\n} from '@angular/material/core';\n\nimport { SharedModule } from './../shared/shared.module';\nimport { ContentsDialogService } from './contents-dialog.service';\nimport { ContentsDialogConfigStrategyFactory } from './contents-dialog-config-strategy-factory';\nimport { ContentsDialogComponent } from './contents-dialog.component';\nimport { MetadataComponent } from './metadata/metadata.component';\nimport { TocComponent } from './table-of-contents/table-of-contents.component';\n\n@NgModule({\n  imports: [SharedModule],\n  declarations: [ContentsDialogComponent, MetadataComponent, TocComponent],\n  providers: [\n    ContentsDialogService,\n    ContentsDialogConfigStrategyFactory,\n    { provide: ErrorStateMatcher, useClass: ShowOnDirtyErrorStateMatcher }\n  ],\n  entryComponents: [ContentsDialogComponent]\n})\nexport class ContentsDialogModule {}\n","import { SpinnerService } from './spinner-service/spinner.service';\nimport { NgModule } from '@angular/core';\n\nimport { MimeViewerIntl } from './intl/viewer-intl';\nimport { IiifManifestService } from './iiif-manifest-service/iiif-manifest-service';\nimport { IiifContentSearchService } from './iiif-content-search-service/iiif-content-search.service';\nimport { CanvasService } from './canvas-service/canvas-service';\nimport { MimeResizeService } from './mime-resize-service/mime-resize.service';\nimport { FullscreenService } from './fullscreen-service/fullscreen.service';\nimport { ViewerService } from './viewer-service/viewer.service';\nimport { ModeService } from './mode-service/mode.service';\nimport { ClickService } from './click-service/click.service';\nimport { ViewerLayoutService } from './viewer-layout-service/viewer-layout-service';\nimport { AccessKeysService } from './access-keys-handler-service/access-keys.service';\nimport { ContentSearchNavigationService } from './navigation/content-search-navigation-service/content-search-navigation.service';\nimport { StyleService } from './style-service/style.service';\n\n@NgModule({\n  providers: [\n    MimeViewerIntl,\n    IiifManifestService,\n    IiifContentSearchService,\n    MimeResizeService,\n    FullscreenService,\n    ViewerService,\n    ClickService,\n    CanvasService,\n    ModeService,\n    SpinnerService,\n    AccessKeysService,\n    ViewerLayoutService,\n    ContentSearchNavigationService,\n    StyleService\n  ]\n})\nexport class CoreModule {}\n","import {\n  animate,\n  group,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\nimport {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  HostBinding,\n  OnDestroy,\n  OnInit,\n  Renderer2,\n  ViewChild\n} from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { IiifManifestService } from '../../core/iiif-manifest-service/iiif-manifest-service';\nimport { Manifest } from '../../core/models/manifest';\nimport { ViewerOptions } from '../../core/models/viewer-options';\nimport { ViewingDirection } from '../../core/models/viewing-direction';\nimport { StyleService } from '../../core/style-service/style.service';\nimport { CanvasService } from './../../core/canvas-service/canvas-service';\nimport { MimeViewerIntl } from './../../core/intl/viewer-intl';\nimport { MimeResizeService } from './../../core/mime-resize-service/mime-resize.service';\nimport { Dimensions } from './../../core/models/dimensions';\nimport { ViewerService } from './../../core/viewer-service/viewer.service';\n\n@Component({\n  selector: 'mime-osd-toolbar',\n  templateUrl: './osd-toolbar.component.html',\n  styleUrls: ['./osd-toolbar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  animations: [\n    trigger('osdToolbarState', [\n      state(\n        'hide',\n        style({\n          transform: 'translate(-120px, 0)',\n          display: 'none'\n        })\n      ),\n      state(\n        'show',\n        style({\n          transform: 'translate(0px, 0px)',\n          display: 'block'\n        })\n      ),\n      transition('hide => show', [\n        group([\n          style({ display: 'block' }),\n          animate(`${ViewerOptions.transitions.toolbarsEaseInTime}ms ease-out`)\n        ])\n      ]),\n      transition(\n        'show => hide',\n        animate(`${ViewerOptions.transitions.toolbarsEaseOutTime}ms ease-in`)\n      )\n    ])\n  ]\n})\nexport class OsdToolbarComponent implements OnInit, AfterViewInit, OnDestroy {\n  @ViewChild('container', { static: true }) container: ElementRef;\n  @HostBinding('@osdToolbarState')\n  get osdToolbarState() {\n    return this.state;\n  }\n  public osdToolbarStyle = {};\n  public numberOfCanvasGroups: number;\n  public isFirstCanvasGroup: boolean;\n  public isLastCanvasGroup: boolean;\n  public state = 'hide';\n  invert = false;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    public intl: MimeViewerIntl,\n    private renderer: Renderer2,\n    private changeDetectorRef: ChangeDetectorRef,\n    private mimeService: MimeResizeService,\n    private viewerService: ViewerService,\n    private canvasService: CanvasService,\n    private styleService: StyleService,\n    private iiifManifestService: IiifManifestService\n  ) {}\n\n  ngOnInit() {\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        this.invert = manifest.viewingDirection === ViewingDirection.LTR;\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.mimeService.onResize\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((dimensions: Dimensions) => {\n        this.osdToolbarStyle = {\n          top: dimensions.top + 110 + 'px'\n        };\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.viewerService.onCanvasGroupIndexChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((currentCanvasGroupIndex: number) => {\n        this.numberOfCanvasGroups = this.canvasService.numberOfCanvasGroups;\n        this.isFirstCanvasGroup = this.isOnFirstCanvasGroup(\n          currentCanvasGroupIndex\n        );\n        this.isLastCanvasGroup = this.isOnLastCanvasGroup(\n          currentCanvasGroupIndex\n        );\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.intl.changes\n      .pipe(takeUntil(this.destroyed))\n      .subscribe(() => this.changeDetectorRef.markForCheck());\n  }\n\n  ngAfterViewInit() {\n    this.styleService.onChange.pipe(takeUntil(this.destroyed)).subscribe(c => {\n      const backgroundRgbaColor = this.styleService.convertToRgba(c, 0.3);\n      this.renderer.setStyle(\n        this.container.nativeElement,\n        'background-color',\n        backgroundRgbaColor\n      );\n    });\n  }\n\n  zoomIn(): void {\n    this.viewerService.zoomIn();\n  }\n\n  zoomOut(): void {\n    this.viewerService.zoomOut();\n  }\n\n  home(): void {\n    this.viewerService.home();\n  }\n\n  rotate(): void {\n    this.viewerService.rotate();\n  }\n\n  ngOnDestroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  public goToPreviousCanvasGroup(): void {\n    this.viewerService.goToPreviousCanvasGroup();\n  }\n\n  public goToNextCanvasGroup(): void {\n    this.viewerService.goToNextCanvasGroup();\n  }\n\n  private isOnFirstCanvasGroup(currentCanvasGroupIndex: number): boolean {\n    return currentCanvasGroupIndex === 0;\n  }\n\n  private isOnLastCanvasGroup(currentCanvasGroupIndex: number): boolean {\n    return currentCanvasGroupIndex === this.numberOfCanvasGroups - 1;\n  }\n}\n","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { MatSliderChange } from '@angular/material/slider';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { CanvasGroupDialogService } from '../../../canvas-group-dialog/canvas-group-dialog.service';\nimport { IiifManifestService } from '../../../core/iiif-manifest-service/iiif-manifest-service';\nimport { AccessKeys } from '../../../core/models/AccessKeys';\nimport { Manifest } from '../../../core/models/manifest';\nimport { ViewingDirection } from '../../../core/models/viewing-direction';\nimport { CanvasService } from './../../../core/canvas-service/canvas-service';\nimport { MimeViewerIntl } from './../../../core/intl/viewer-intl';\nimport { SearchResult } from './../../../core/models/search-result';\nimport { ViewerService } from './../../../core/viewer-service/viewer.service';\n\n@Component({\n  selector: 'mime-page-navigator',\n  templateUrl: './canvas-group-navigator.component.html',\n  styleUrls: ['./canvas-group-navigator.component.scss']\n})\nexport class CanvasGroupNavigatorComponent implements OnInit, OnDestroy {\n  @Input() public searchResult: SearchResult;\n  public numberOfCanvases: number;\n  public canvasGroupLabel: string;\n  public numberOfCanvasGroups: number;\n  public currentCanvasGroupIndex: number;\n  public isFirstCanvasGroup: boolean;\n  public isLastCanvasGroup: boolean;\n  invert = false;\n  private currentSliderCanvasGroupIndex = -1;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    public intl: MimeViewerIntl,\n    private changeDetectorRef: ChangeDetectorRef,\n    private viewerService: ViewerService,\n    private canvasService: CanvasService,\n    private pageDialogService: CanvasGroupDialogService,\n    private iiifManifestService: IiifManifestService\n  ) {}\n\n  ngOnInit() {\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        this.invert = manifest.viewingDirection === ViewingDirection.LTR;\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.canvasService.onCanvasGroupIndexChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((currentCanvasGroupIndex: number) => {\n        if (\n          this.currentSliderCanvasGroupIndex !== -1 &&\n          this.currentSliderCanvasGroupIndex === currentCanvasGroupIndex\n        ) {\n          this.currentSliderCanvasGroupIndex = -1;\n        } else if (this.currentSliderCanvasGroupIndex === -1) {\n          this.currentCanvasGroupIndex = currentCanvasGroupIndex;\n          this.canvasGroupLabel = this.canvasService.getCanvasGroupLabel(\n            this.currentCanvasGroupIndex\n          );\n        }\n        this.isFirstCanvasGroup = this.isOnFirstCanvasGroup(\n          currentCanvasGroupIndex\n        );\n        this.isLastCanvasGroup = this.isOnLastCanvasGroup(\n          currentCanvasGroupIndex\n        );\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.canvasService.onNumberOfCanvasGroupsChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((numberOfCanvasGroups: number) => {\n        this.numberOfCanvasGroups = numberOfCanvasGroups;\n        this.numberOfCanvases = this.canvasService.numberOfCanvases;\n        this.isFirstCanvasGroup = this.isOnFirstCanvasGroup(\n          this.currentCanvasGroupIndex\n        );\n        this.isLastCanvasGroup = this.isOnLastCanvasGroup(\n          this.currentCanvasGroupIndex\n        );\n        this.changeDetectorRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  goToPreviousCanvasGroup(): void {\n    this.viewerService.goToPreviousCanvasGroup();\n  }\n\n  goToNextCanvasGroup(): void {\n    this.viewerService.goToNextCanvasGroup();\n  }\n\n  onSliderChange(change: MatSliderChange): void {\n    this.currentSliderCanvasGroupIndex = change.value;\n    this.currentCanvasGroupIndex = change.value;\n    this.canvasGroupLabel = this.canvasService.getCanvasGroupLabel(\n      this.currentCanvasGroupIndex\n    );\n    this.viewerService.goToCanvasGroup(change.value, false);\n    this.changeDetectorRef.detectChanges();\n  }\n\n  onSliderHotKey(event: KeyboardEvent) {\n    const accessKeys = new AccessKeys(event);\n    if (accessKeys.isSliderKeys()) {\n       event.stopPropagation();\n    }\n  }\n\n  openCanvasGroupDialog(): void {\n    this.pageDialogService.toggle();\n  }\n\n  private isOnFirstCanvasGroup(currentCanvasGroupIndex: number): boolean {\n    return currentCanvasGroupIndex === 0;\n  }\n\n  private isOnLastCanvasGroup(currentCanvasGroupIndex: number): boolean {\n    return currentCanvasGroupIndex === this.numberOfCanvasGroups - 1;\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { CanvasService } from '../../../core/canvas-service/canvas-service';\nimport { IiifContentSearchService } from '../../../core/iiif-content-search-service/iiif-content-search.service';\nimport { IiifManifestService } from '../../../core/iiif-manifest-service/iiif-manifest-service';\nimport { MimeViewerIntl } from '../../../core/intl/viewer-intl';\nimport { Manifest } from '../../../core/models/manifest';\nimport { SearchResult } from '../../../core/models/search-result';\nimport { ViewingDirection } from '../../../core/models/viewing-direction';\nimport { ContentSearchNavigationService } from '../../../core/navigation/content-search-navigation-service/content-search-navigation.service';\n\n@Component({\n  selector: 'mime-content-search-navigator',\n  templateUrl: './content-search-navigator.component.html',\n  styleUrls: ['./content-search-navigator.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContentSearchNavigatorComponent implements OnInit, OnDestroy {\n  @Input() searchResult: SearchResult;\n  public isHitOnActiveCanvasGroup = false;\n  public isFirstCanvasGroupHit = false;\n  public isLastCanvasGroupHit = false;\n  public currentIndex = 0;\n  invert = false;\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    public intl: MimeViewerIntl,\n    private changeDetectorRef: ChangeDetectorRef,\n    private canvasService: CanvasService,\n    private iiifContentSearchService: IiifContentSearchService,\n    private contentSearchNavigationService: ContentSearchNavigationService,\n    private iiifManifestService: IiifManifestService\n  ) {}\n\n  ngOnInit() {\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        this.invert = manifest.viewingDirection === ViewingDirection.LTR;\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.intl.changes\n      .pipe(takeUntil(this.destroyed))\n      .subscribe(() => this.changeDetectorRef.markForCheck());\n\n    this.canvasService.onCanvasGroupIndexChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe(canvasGroupIndex => {\n        this.contentSearchNavigationService.update(canvasGroupIndex);\n        this.currentIndex = this.contentSearchNavigationService.getCurrentIndex();\n        this.isHitOnActiveCanvasGroup = this.contentSearchNavigationService.getHitOnActiveCanvasGroup();\n        this.isFirstCanvasGroupHit = this.contentSearchNavigationService.getFirstHitCanvasGroup();\n        this.isLastCanvasGroupHit = this.contentSearchNavigationService.getLastHitCanvasGroup();\n        this.changeDetectorRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  clear(): void {\n    this.iiifContentSearchService.destroy();\n  }\n\n  goToPreviousCanvasGroupHit() {\n    this.contentSearchNavigationService.goToPreviousCanvasGroupHit();\n  }\n\n  goToNextCanvasGroupHit() {\n    this.contentSearchNavigationService.goToNextCanvasGroupHit();\n  }\n}\n","import {\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\nimport {\n  ChangeDetectorRef,\n  Component,\n  HostBinding,\n  OnDestroy,\n  OnInit,\n  ViewChild,\n  ViewContainerRef\n} from '@angular/core';\nimport { MediaChange, MediaObserver } from '@angular/flex-layout';\nimport { Subject, Subscription } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { ViewerOptions } from '../../core/models/viewer-options';\nimport { IiifContentSearchService } from './../../core/iiif-content-search-service/iiif-content-search.service';\nimport { SearchResult } from './../../core/models/search-result';\n\n@Component({\n  selector: 'mime-viewer-footer',\n  templateUrl: './viewer-footer.component.html',\n  styleUrls: ['./viewer-footer.component.scss'],\n  animations: [\n    trigger('footerState', [\n      state(\n        'hide',\n        style({\n          transform: 'translate(0, 100%)'\n        })\n      ),\n      state(\n        'show',\n        style({\n          transform: 'translate(0, 0)'\n        })\n      ),\n      transition(\n        'hide => show',\n        animate(ViewerOptions.transitions.toolbarsEaseInTime + 'ms ease-in')\n      ),\n      transition(\n        'show => hide',\n        animate(ViewerOptions.transitions.toolbarsEaseOutTime + 'ms ease-out')\n      )\n    ])\n  ]\n})\nexport class ViewerFooterComponent implements OnInit, OnDestroy {\n  @ViewChild('mimeFooterBefore', { read: ViewContainerRef, static: true })\n  mimeFooterBefore: ViewContainerRef;\n  @ViewChild('mimeFooterAfter', { read: ViewContainerRef, static: true })\n  mimeFooterAfter: ViewContainerRef;\n  public state = 'hide';\n  public showNavigationToolbar = true;\n  public searchResult: SearchResult = new SearchResult();\n  public showPageNavigator = true;\n  public showContentSearchNavigator = false;\n  private destroyed: Subject<void> = new Subject();\n  private mediaSubscription: Subscription;\n\n  constructor(\n    private iiifContentSearchService: IiifContentSearchService,\n    public mediaObserver: MediaObserver,\n    private changeDetectorRef: ChangeDetectorRef\n  ) {}\n\n  @HostBinding('@footerState')\n  get footerState() {\n    return this.state;\n  }\n\n  ngOnInit() {\n    this.iiifContentSearchService.onChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((sr: SearchResult) => {\n        this.searchResult = sr;\n        this.showContentSearchNavigator = this.searchResult.size() > 0;\n        this.showPageNavigator =\n          this.searchResult.size() === 0 || !this.isMobile();\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.mediaSubscription = this.mediaObserver.asObservable().subscribe(\n      (changes: MediaChange[]) => {\n        this.showPageNavigator =\n          this.searchResult.size() === 0 || !this.isMobile();\n        this.changeDetectorRef.detectChanges();\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n    this.mediaSubscription.unsubscribe();\n  }\n\n  private isMobile(): boolean {\n    return this.mediaObserver.isActive('lt-md');\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\n@Component({\n  selector: 'mime-icon',\n  templateUrl: './icon.component.html',\n  styleUrls: ['./icon.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class IconComponent implements OnInit {\n  @Input() iconName: string;\n\n  constructor() {}\n\n  ngOnInit() {}\n}\n","import {\n  animate,\n  state,\n  style,\n  transition,\n  trigger\n} from '@angular/animations';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  HostBinding,\n  OnDestroy,\n  OnInit,\n  ViewChild,\n  ViewContainerRef\n} from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { ManifestUtils } from '../../core/iiif-manifest-service/iiif-manifest-utils';\nimport { MimeDomHelper } from '../../core/mime-dom-helper';\nimport { ViewerLayout } from '../../core/models/viewer-layout';\nimport { ViewerOptions } from '../../core/models/viewer-options';\nimport { ViewerLayoutService } from '../../core/viewer-layout-service/viewer-layout-service';\nimport { ContentSearchDialogService } from './../../content-search-dialog/content-search-dialog.service';\nimport { ContentsDialogService } from './../../contents-dialog/contents-dialog.service';\nimport { FullscreenService } from './../../core/fullscreen-service/fullscreen.service';\nimport { IiifManifestService } from './../../core/iiif-manifest-service/iiif-manifest-service';\nimport { MimeViewerIntl } from './../../core/intl/viewer-intl';\nimport { Manifest } from './../../core/models/manifest';\nimport { HelpDialogService } from '../../help-dialog/help-dialog.service';\n\n@Component({\n  selector: 'mime-viewer-header',\n  templateUrl: './viewer-header.component.html',\n  styleUrls: ['./viewer-header.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default,\n  animations: [\n    trigger('headerState', [\n      state(\n        'hide',\n        style({\n          transform: 'translate(0, -100%)'\n        })\n      ),\n      state(\n        'show',\n        style({\n          transform: 'translate(0px, 0px)'\n        })\n      ),\n      transition(\n        'hide => show',\n        animate(ViewerOptions.transitions.toolbarsEaseInTime + 'ms ease-in')\n      ),\n      transition(\n        'show => hide',\n        animate(ViewerOptions.transitions.toolbarsEaseOutTime + 'ms ease-out')\n      )\n    ])\n  ]\n})\nexport class ViewerHeaderComponent implements OnInit, OnDestroy {\n  @ViewChild('mimeHeaderBefore', { read: ViewContainerRef, static: true })\n  mimeHeaderBefore: ViewContainerRef;\n  @ViewChild('mimeHeaderAfter', { read: ViewContainerRef, static: true })\n  mimeHeaderAfter: ViewContainerRef;\n  public manifest: Manifest;\n  public state = 'hide';\n  isContentSearchEnabled = false;\n  isFullscreenEnabled = false;\n  isInFullscreen = false;\n  fullscreenLabel = this.intl.fullScreenLabel;\n  isPagedManifest = false;\n  viewerLayout: ViewerLayout = ViewerLayout.ONE_PAGE;\n\n  ViewerLayout: typeof ViewerLayout = ViewerLayout; // enables parsing of enum in template\n  private destroyed: Subject<void> = new Subject();\n\n  constructor(\n    public intl: MimeViewerIntl,\n    private changeDetectorRef: ChangeDetectorRef,\n    private contentsDialogService: ContentsDialogService,\n    private contentSearchDialogService: ContentSearchDialogService,\n    private helpDialogService: HelpDialogService,\n    private iiifManifestService: IiifManifestService,\n    private fullscreenService: FullscreenService,\n    private mimeDomHelper: MimeDomHelper,\n    private viewerLayoutService: ViewerLayoutService\n  ) {}\n\n  @HostBinding('@headerState')\n  get headerState() {\n    return this.state;\n  }\n\n  ngOnInit() {\n    this.isFullscreenEnabled = this.fullscreenService.isEnabled();\n\n    this.intl.changes\n      .pipe(takeUntil(this.destroyed))\n      .subscribe(() => this.changeDetectorRef.markForCheck());\n\n    this.fullscreenService.onChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe(() => {\n        this.isInFullscreen = this.fullscreenService.isFullscreen();\n        this.fullscreenLabel = this.isInFullscreen\n          ? this.intl.exitFullScreenLabel\n          : this.intl.fullScreenLabel;\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        this.manifest = manifest;\n        this.isContentSearchEnabled = manifest.service ? true : false;\n        this.isPagedManifest = ManifestUtils.isManifestPaged(manifest);\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.viewerLayoutService.onChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((viewerLayout: ViewerLayout) => {\n        this.viewerLayout = viewerLayout;\n      });\n  }\n\n  ngOnDestroy() {\n    this.destroyed.next();\n    this.destroyed.complete();\n  }\n\n  public toggleContents() {\n    this.contentSearchDialogService.close();\n    this.helpDialogService.close();\n    this.contentsDialogService.toggle();\n  }\n\n  public toggleSearch() {\n    this.contentsDialogService.close();\n    this.helpDialogService.close();\n    this.contentSearchDialogService.toggle();\n  }\n\n  public toggleHelp() {\n    this.contentsDialogService.close();\n    this.contentSearchDialogService.close();\n    this.helpDialogService.toggle();\n  }\n\n  public toggleFullscreen(): void {\n    return this.mimeDomHelper.toggleFullscreen();\n  }\n\n  public isInFullScreen(): boolean {\n    return this.fullscreenService.isFullscreen();\n  }\n\n  public toggleViewerLayout(): void {\n    this.viewerLayoutService.toggle();\n  }\n\n  public setLayoutOnePage(): void {\n    this.viewerLayoutService.setLayout(ViewerLayout.ONE_PAGE);\n  }\n\n  public setLayoutTwoPage(): void {\n    this.viewerLayoutService.setLayout(ViewerLayout.TWO_PAGE);\n  }\n}\n","import { ChangeDetectorRef } from '@angular/core';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport {\n  SpinnerState,\n  SpinnerService\n} from '../../core/spinner-service/spinner.service';\n\n@Component({\n  selector: 'mime-spinner',\n  templateUrl: './viewer-spinner.component.html',\n  styleUrls: ['./viewer-spinner.component.scss']\n})\nexport class ViewerSpinnerComponent implements OnDestroy, OnInit {\n  public visible = false;\n  private spinnerSub: Subscription;\n\n  constructor(\n    private spinnerService: SpinnerService,\n    private changeDetectorRef: ChangeDetectorRef\n  ) {}\n\n  ngOnInit() {\n    this.spinnerSub = this.spinnerService.spinnerState.subscribe(\n      (state: SpinnerState) => {\n        this.visible = state.show;\n        this.changeDetectorRef.detectChanges();\n      }\n    );\n  }\n\n  ngOnDestroy() {\n    this.spinnerSub.unsubscribe();\n  }\n}\n","export class ContentDialogState {\n  public isOpen = false;\n  public selectedIndex = 0;\n\n  constructor(fields?: { isOpen?: boolean; selectedIndex?: number }) {\n    if (fields) {\n      this.isOpen = fields.isOpen !== undefined ? fields.isOpen : this.isOpen;\n      this.selectedIndex =\n        fields.selectedIndex !== undefined\n          ? fields.selectedIndex\n          : this.selectedIndex;\n    }\n  }\n}\n","export class ContentsSearchDialogState {\n  public isOpen = false;\n\n  constructor(fields?: { isOpen?: boolean }) {\n    if (fields) {\n      this.isOpen = fields.isOpen !== undefined ? fields.isOpen : this.isOpen;\n    }\n  }\n}\n","export class HelpDialogState {\n  public isOpen = false;\n\n  constructor(fields?: { isOpen?: boolean }) {\n    if (fields) {\n      this.isOpen = fields.isOpen !== undefined ? fields.isOpen : this.isOpen;\n    }\n  }\n}\n","import { ContentDialogState } from './content-dialog-state';\nimport { ContentsSearchDialogState } from './contents-search-dialog-state';\nimport { HelpDialogState } from './help-dialog-state';\n\nexport class ViewerState {\n  public contentDialogState = new ContentDialogState();\n  public contentsSearchDialogState = new ContentsSearchDialogState();\n  public helpDialogState = new HelpDialogState();\n\n  constructor(fields?: {\n    contentDialogState?: ContentDialogState;\n    contentsSearchDialogState?: ContentsSearchDialogState;\n    helpDialogState?: HelpDialogState;\n  }) {\n    if (fields) {\n      this.contentDialogState = fields.contentDialogState\n        ? fields.contentDialogState\n        : this.contentDialogState;\n      this.contentsSearchDialogState = fields.contentsSearchDialogState\n        ? fields.contentsSearchDialogState\n        : this.contentsSearchDialogState;\n      this.helpDialogState = fields.helpDialogState\n        ? fields.helpDialogState\n        : this.helpDialogState;\n    }\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  NgZone,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Output,\n  SimpleChange,\n  SimpleChanges,\n  ViewChild,\n  ViewContainerRef,\n  AfterViewChecked\n} from '@angular/core';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { Subject, interval } from 'rxjs';\nimport { throttle, takeUntil, take } from 'rxjs/operators';\n\nimport { IiifManifestService } from '../core/iiif-manifest-service/iiif-manifest-service';\nimport { ContentsDialogService } from '../contents-dialog/contents-dialog.service';\nimport { AttributionDialogService } from '../attribution-dialog/attribution-dialog.service';\nimport { ContentSearchDialogService } from '../content-search-dialog/content-search-dialog.service';\nimport { MimeResizeService } from '../core/mime-resize-service/mime-resize.service';\nimport { Manifest } from '../core/models/manifest';\nimport { ModeService } from '../core/mode-service/mode.service';\nimport { ViewerMode } from '../core/models/viewer-mode';\nimport { CanvasService } from '../core/canvas-service/canvas-service';\nimport { ViewerHeaderComponent } from './viewer-header/viewer-header.component';\nimport { ViewerFooterComponent } from './viewer-footer/viewer-footer.component';\nimport { OsdToolbarComponent } from './osd-toolbar/osd-toolbar.component';\nimport { ViewerService } from '../core/viewer-service/viewer.service';\nimport { MimeViewerConfig } from '../core/mime-viewer-config';\nimport { IiifContentSearchService } from './../core/iiif-content-search-service/iiif-content-search.service';\nimport { SearchResult } from './../core/models/search-result';\nimport { ViewerOptions } from '../core/models/viewer-options';\nimport { MimeViewerIntl } from '../core/intl/viewer-intl';\nimport { AccessKeysService } from '../core/access-keys-handler-service/access-keys.service';\nimport { ViewerLayout } from '../core/models/viewer-layout';\nimport { ViewerLayoutService } from '../core/viewer-layout-service/viewer-layout-service';\nimport { ManifestUtils } from '../core/iiif-manifest-service/iiif-manifest-utils';\nimport { ViewerState } from '../core/models/viewerState';\nimport { ModeChanges } from '../core/models/modeChanges';\nimport { StyleService } from '../core/style-service/style.service';\nimport { HelpDialogService } from '../help-dialog/help-dialog.service';\n\n@Component({\n  selector: 'mime-viewer',\n  templateUrl: './viewer.component.html',\n  styleUrls: ['./viewer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ViewerComponent\n  implements OnInit, AfterViewChecked, OnDestroy, OnChanges {\n  @Input() public manifestUri: string;\n  @Input() public q: string;\n  @Input() public canvasIndex: number;\n  @Input() public config: MimeViewerConfig = new MimeViewerConfig();\n  @Input() public tabIndex = 0;\n  @Output() viewerModeChanged: EventEmitter<ViewerMode> = new EventEmitter();\n  @Output() canvasChanged: EventEmitter<number> = new EventEmitter();\n  @Output() qChanged: EventEmitter<string> = new EventEmitter();\n  @Output() manifestChanged: EventEmitter<Manifest> = new EventEmitter();\n\n  private destroyed: Subject<void> = new Subject();\n  private isCanvasPressed = false;\n  private currentManifest: Manifest;\n  private viewerLayout: ViewerLayout;\n  private viewerState = new ViewerState();\n\n  public errorMessage: string = null;\n\n  // Viewchilds\n  @ViewChild('mimeHeader', { static: true })\n  private header: ViewerHeaderComponent;\n  @ViewChild('mimeFooter', { static: true })\n  private footer: ViewerFooterComponent;\n  @ViewChild('mimeOsdToolbar')\n  private osdToolbar: OsdToolbarComponent;\n\n  constructor(\n    public snackBar: MatSnackBar,\n    public intl: MimeViewerIntl,\n    private el: ElementRef,\n    private iiifManifestService: IiifManifestService,\n    private contentsDialogService: ContentsDialogService,\n    private attributionDialogService: AttributionDialogService,\n    private contentSearchDialogService: ContentSearchDialogService,\n    private helpDialogService: HelpDialogService,\n    private viewerService: ViewerService,\n    private mimeService: MimeResizeService,\n    private changeDetectorRef: ChangeDetectorRef,\n    private modeService: ModeService,\n    private iiifContentSearchService: IiifContentSearchService,\n    private accessKeysHandlerService: AccessKeysService,\n    private canvasService: CanvasService,\n    private viewerLayoutService: ViewerLayoutService,\n    private styleService: StyleService,\n    public zone: NgZone\n  ) {\n    contentsDialogService.el = el;\n    attributionDialogService.el = el;\n    contentSearchDialogService.el = el;\n    helpDialogService.el = el;\n    mimeService.el = el;\n  }\n\n  get mimeHeaderBeforeRef(): ViewContainerRef {\n    return this.header.mimeHeaderBefore;\n  }\n\n  get mimeHeaderAfterRef(): ViewContainerRef {\n    return this.header.mimeHeaderAfter;\n  }\n\n  get mimeFooterBeforeRef(): ViewContainerRef {\n    return this.footer.mimeFooterBefore;\n  }\n\n  get mimeFooterAfterRef(): ViewContainerRef {\n    return this.footer.mimeFooterAfter;\n  }\n\n  ngOnInit(): void {\n    this.styleService.init();\n    this.modeService.initialMode = this.config.initViewerMode;\n    this.iiifManifestService.currentManifest\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((manifest: Manifest) => {\n        if (manifest) {\n          this.initialize();\n          this.currentManifest = manifest;\n          this.manifestChanged.next(manifest);\n          this.viewerLayoutService.init(\n            ManifestUtils.isManifestPaged(manifest)\n          );\n          this.changeDetectorRef.detectChanges();\n          this.viewerService.setUpViewer(manifest, this.config);\n          if (this.config.attributionDialogEnabled && manifest.attribution) {\n            this.attributionDialogService.open(\n              this.config.attributionDialogHideTimeout\n            );\n          }\n\n          if (this.q) {\n            this.iiifContentSearchService.search(manifest, this.q);\n          }\n        }\n      });\n\n    this.viewerService.onOsdReadyChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((state: boolean) => {\n        // Don't reset current page when switching layout\n        if (\n          state &&\n          this.canvasIndex &&\n          !this.canvasService.currentCanvasGroupIndex\n        ) {\n          this.viewerService.goToCanvas(this.canvasIndex, false);\n        }\n      });\n\n    this.iiifManifestService.errorMessage\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((error: string) => {\n        this.resetCurrentManifest();\n        this.errorMessage = error;\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.iiifContentSearchService.onQChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((q: string) => {\n        this.qChanged.emit(q);\n      });\n\n    this.iiifContentSearchService.onChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((sr: SearchResult) => {\n        this.viewerService.highlight(sr);\n      });\n\n    this.viewerService.isCanvasPressed\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((value: boolean) => {\n        this.isCanvasPressed = value;\n        this.changeDetectorRef.detectChanges();\n      });\n\n    this.modeService.onChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((mode: ModeChanges) => {\n        this.toggleToolbarsState(mode.currentValue);\n        if (\n          mode.previousValue === ViewerMode.DASHBOARD &&\n          mode.currentValue === ViewerMode.PAGE\n        ) {\n          this.viewerState.contentDialogState.isOpen = this.contentsDialogService.isOpen();\n          this.viewerState.contentDialogState.selectedIndex = this.contentsDialogService.getSelectedIndex();\n          this.viewerState.contentsSearchDialogState.isOpen = this.contentSearchDialogService.isOpen();\n          this.viewerState.helpDialogState.isOpen = this.helpDialogService.isOpen();\n          this.zone.run(() => {\n            this.contentsDialogService.close();\n            this.contentSearchDialogService.close();\n            this.helpDialogService.close();\n          });\n        }\n        if (mode.currentValue === ViewerMode.DASHBOARD) {\n          this.zone.run(() => {\n            if (this.viewerState.contentDialogState.isOpen) {\n              this.contentsDialogService.open(\n                this.viewerState.contentDialogState.selectedIndex\n              );\n            }\n            if (this.viewerState.contentsSearchDialogState.isOpen) {\n              this.contentSearchDialogService.open();\n            }\n            if (this.viewerState.helpDialogState.isOpen) {\n              this.helpDialogService.open();\n            }\n          });\n        }\n        this.viewerModeChanged.emit(mode.currentValue);\n      });\n\n    this.canvasService.onCanvasGroupIndexChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((canvasGroupIndex: number) => {\n        const canvasIndex = this.canvasService.findCanvasByCanvasIndex(\n          canvasGroupIndex\n        );\n        if (canvasIndex !== -1) {\n          this.canvasChanged.emit(canvasIndex);\n        }\n      });\n\n    this.mimeService.onResize\n      .pipe(\n        takeUntil(this.destroyed),\n        throttle(val => interval(ViewerOptions.transitions.OSDAnimationTime))\n      )\n      .subscribe(() => {\n        setTimeout(() => {\n          this.viewerService.home();\n        }, ViewerOptions.transitions.OSDAnimationTime);\n      });\n\n    this.viewerLayoutService.onChange\n      .pipe(takeUntil(this.destroyed))\n      .subscribe((viewerLayout: ViewerLayout) => {\n        this.viewerLayout = viewerLayout;\n      });\n\n    this.loadManifest();\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    let manifestUriIsChanged = false;\n    let qIsChanged = false;\n    let canvasIndexChanged = false;\n    if (changes['q']) {\n      const qChanges: SimpleChange = changes['q'];\n      if (\n        !qChanges.isFirstChange() &&\n        qChanges.currentValue !== qChanges.firstChange\n      ) {\n        this.q = qChanges.currentValue;\n        qIsChanged = true;\n      }\n    }\n    if (changes['canvasIndex']) {\n      const canvasIndexChanges: SimpleChange = changes['canvasIndex'];\n      if (\n        !canvasIndexChanges.isFirstChange() &&\n        canvasIndexChanges.currentValue !== canvasIndexChanges.firstChange\n      ) {\n        this.canvasIndex = canvasIndexChanges.currentValue;\n        canvasIndexChanged = true;\n      }\n    }\n    if (changes['manifestUri']) {\n      const manifestUriChanges: SimpleChange = changes['manifestUri'];\n      if (\n        !manifestUriChanges.isFirstChange() &&\n        manifestUriChanges.currentValue !== manifestUriChanges.previousValue\n      ) {\n        this.modeService.mode = this.config.initViewerMode;\n        this.manifestUri = manifestUriChanges.currentValue;\n        manifestUriIsChanged = true;\n      }\n    }\n\n    if (manifestUriIsChanged) {\n      this.loadManifest();\n    } else {\n      if (qIsChanged) {\n        this.iiifContentSearchService.search(this.currentManifest, this.q);\n      }\n      if (canvasIndexChanged) {\n        this.viewerService.goToCanvas(this.canvasIndex, true);\n      }\n    }\n  }\n\n  @HostListener('keyup', ['$event'])\n  handleKeys(event: KeyboardEvent) {\n    this.accessKeysHandlerService.handleKeyEvents(event);\n  }\n\n  @HostListener('drop', ['$event'])\n  public onDrop(event: any) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (this.config.isDropEnabled) {\n      const url = event.dataTransfer.getData('URL');\n      const params = new URL(url).searchParams;\n      const manifestUri = params.get('manifest');\n      const startCanvasId = params.get('canvas');\n      if (manifestUri) {\n        this.manifestUri = manifestUri.startsWith('//')\n          ? `${location.protocol}${manifestUri}`\n          : manifestUri;\n        this.loadManifest();\n        if (startCanvasId) {\n          this.manifestChanged.pipe(take(1)).subscribe(manifest => {\n            const canvasIndex = manifest.sequences[0].canvases.findIndex(\n              c => c.id === startCanvasId\n            );\n            if (canvasIndex !== -1) {\n              setTimeout(() => {\n                this.viewerService.goToCanvas(canvasIndex, true);\n              }, 0);\n            }\n          });\n        }\n      }\n    } else {\n      this.snackBar.open(this.intl.dropDisabled, null, {\n        duration: 3000\n      });\n    }\n  }\n\n  @HostListener('dragover', ['$event'])\n  public onDragOver(event: any) {\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  @HostListener('dragleave', ['$event'])\n  public onDragLeave(event: any) {\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  ngOnDestroy(): void {\n    this.destroyed.next();\n    this.destroyed.complete();\n    this.cleanup();\n    this.iiifManifestService.destroy();\n    this.iiifContentSearchService.destroy();\n  }\n\n  toggleToolbarsState(mode: ViewerMode): void {\n    if (this.header && this.footer) {\n      switch (mode) {\n        case ViewerMode.DASHBOARD:\n          this.header.state = this.footer.state = 'show';\n          if (this.config.navigationControlEnabled && this.osdToolbar) {\n            this.osdToolbar.state = 'hide';\n          }\n          break;\n        case ViewerMode.PAGE:\n          this.header.state = this.footer.state = 'hide';\n          if (this.config.navigationControlEnabled && this.osdToolbar) {\n            this.osdToolbar.state = 'show';\n          }\n          break;\n      }\n      this.changeDetectorRef.detectChanges();\n    }\n  }\n\n  ngAfterViewChecked() {\n    this.mimeService.markForCheck();\n  }\n\n  private loadManifest() {\n    this.cleanup();\n    this.iiifManifestService.load(this.manifestUri);\n  }\n\n  private initialize() {\n    this.attributionDialogService.initialize();\n    this.contentsDialogService.initialize();\n    this.contentSearchDialogService.initialize();\n    this.helpDialogService.initialize();\n  }\n\n  private cleanup() {\n    this.viewerState = new ViewerState();\n    this.attributionDialogService.destroy();\n    this.contentsDialogService.destroy();\n    this.contentSearchDialogService.destroy();\n    this.helpDialogService.destroy();\n    this.viewerService.destroy();\n    this.resetErrorMessage();\n  }\n\n  private resetCurrentManifest(): void {\n    this.currentManifest = null;\n  }\n\n  private resetErrorMessage(): void {\n    this.errorMessage = null;\n  }\n\n  setClasses() {\n    return {\n      'mode-page': this.modeService.mode === ViewerMode.PAGE,\n      'mode-page-zoomed': this.modeService.mode === ViewerMode.PAGE_ZOOMED,\n      'mode-dashboard': this.modeService.mode === ViewerMode.DASHBOARD,\n      'layout-one-page': this.viewerLayout === ViewerLayout.ONE_PAGE,\n      'layout-two-page': this.viewerLayout === ViewerLayout.TWO_PAGE,\n      'canvas-pressed': this.isCanvasPressed\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport 'd3';\nimport 'openseadragon';\nimport { AttributionDialogModule } from './attribution-dialog/attribution-dialog.module';\nimport { CanvasGroupDialogModule } from './canvas-group-dialog/canvas-group-dialog.module';\nimport { ContentSearchDialogModule } from './content-search-dialog/content-search-dialog.module';\nimport { HelpDialogModule } from './help-dialog/help-dialog.module';\nimport { ContentsDialogModule } from './contents-dialog/contents-dialog.module';\nimport { CoreModule } from './core/core.module';\nimport { SharedModule } from './shared/shared.module';\nimport { OsdToolbarComponent } from './viewer/osd-toolbar/osd-toolbar.component';\nimport { CanvasGroupNavigatorComponent } from './viewer/viewer-footer/canvas-group-navigator/canvas-group-navigator.component';\nimport { ContentSearchNavigatorComponent } from './viewer/viewer-footer/content-search-navigator/content-search-navigator.component';\nimport { ViewerFooterComponent } from './viewer/viewer-footer/viewer-footer.component';\nimport { IconComponent } from './viewer/viewer-header/icon/icon.component';\nimport { ViewerHeaderComponent } from './viewer/viewer-header/viewer-header.component';\nimport { ViewerSpinnerComponent } from './viewer/viewer-spinner/viewer-spinner.component';\nimport { ViewerComponent } from './viewer/viewer.component';\n\n@NgModule({\n  declarations: [\n    ViewerComponent,\n    ViewerHeaderComponent,\n    ViewerFooterComponent,\n    OsdToolbarComponent,\n    ContentSearchNavigatorComponent,\n    CanvasGroupNavigatorComponent,\n    ViewerSpinnerComponent,\n    IconComponent\n  ],\n  imports: [\n    CoreModule,\n    SharedModule,\n    ContentsDialogModule,\n    AttributionDialogModule,\n    HelpDialogModule,\n    ContentSearchDialogModule,\n    CanvasGroupDialogModule\n  ],\n  exports: [ViewerComponent]\n})\nexport class MimeModule {}\n"]}