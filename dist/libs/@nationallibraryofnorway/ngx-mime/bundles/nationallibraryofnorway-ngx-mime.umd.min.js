!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("d3"),require("openseadragon"),require("@angular/common"),require("@angular/forms"),require("@angular/flex-layout"),require("@angular/material/button"),require("@angular/material/card"),require("@angular/material/dialog"),require("@angular/material/icon"),require("@angular/material/input"),require("@angular/material/list"),require("@angular/material/progress-bar"),require("@angular/material/progress-spinner"),require("@angular/material/slider"),require("@angular/material/snack-bar"),require("@angular/material/tabs"),require("@angular/material/toolbar"),require("@angular/material/tooltip"),require("rxjs/operators"),require("@angular/common/http"),require("@angular/material/core"),require("@angular/animations")):"function"==typeof define&&define.amd?define("@nationallibraryofnorway/ngx-mime",["exports","@angular/core","rxjs","d3","openseadragon","@angular/common","@angular/forms","@angular/flex-layout","@angular/material/button","@angular/material/card","@angular/material/dialog","@angular/material/icon","@angular/material/input","@angular/material/list","@angular/material/progress-bar","@angular/material/progress-spinner","@angular/material/slider","@angular/material/snack-bar","@angular/material/tabs","@angular/material/toolbar","@angular/material/tooltip","rxjs/operators","@angular/common/http","@angular/material/core","@angular/animations"],t):t(((e=e||self).nationallibraryofnorway=e.nationallibraryofnorway||{},e.nationallibraryofnorway["ngx-mime"]={}),e.ng.core,e.rxjs,e.d3,e.OpenSeadragon,e.ng.common,e.ng.forms,e.ng.flexLayout,e.ng.material.button,e.ng.material.card,e.ng.material.dialog,e.ng.material.icon,e.ng.material.input,e.ng.material.list,e.ng.material.progressBar,e.ng.material.progressSpinner,e.ng.material.slider,e.ng.material.snackBar,e.ng.material.tabs,e.ng.material.toolbar,e.ng.material.tooltip,e.rxjs.operators,e.ng.common.http,e.ng.material.core,e.ng.animations)}(this,(function(e,t,i,n,o,r,a,s,c,u,l,h,p,d,g,v,f,m,y,b,C,w,S,x,G){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var O=function(e,t){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function D(e,t){function i(){this.constructor=e}O(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var M=function(){return(M=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function H(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a}function P(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var R,L,T=function(){this.helpLabel="Help",this.line1="<strong>ARROW LEFT</strong> or <strong>PAGE UP</strong>: Previous page",this.line2="<strong>ARROW RIGHT</strong> or <strong>PAGE DOWN</strong>: Next page",this.line3="<strong>HOME</strong>: Go to first page",this.line4="<strong>END</strong>: Go to last page",this.line5="<strong>C</strong>: Contents window with more information/metadata about the object. (Close with <strong>ESC</strong>.)",this.line6="<strong>S</strong>: Search inside the object. (Close with <strong>ESC</strong>.)",this.line7="<strong>N</strong>: Next result",this.line8="<strong>P</strong>: Previous result",this.line9="<strong>F</strong>: Fullscreen on/off (Close with <strong>F</strong> or <strong>ESC</strong>.)",this.line10="<strong>R</strong>: Rotate 90°"},I=function(){function e(){this.changes=new i.Subject,this.help=new T,this.closeLabel="Close",this.attributionLabel="Attribution",this.attributonCloseAriaLabel="Close attribution dialog",this.contentsLabel="Contents",this.twoPageViewLabel="Two page display",this.singlePageViewLabel="Single page display",this.metadataLabel="Metadata",this.licenseLabel="License",this.tocLabel="Table of Contents",this.fullScreenLabel="Full screen",this.exitFullScreenLabel="Exit full screen",this.zoomInLabel="Zoom in",this.zoomOutLabel="Zoom out",this.previousPageLabel="Previous Page",this.nextPageLabel="Next Page",this.homeLabel="Go Home",this.rotateCwLabel="Rotate 90°",this.searchLabel="Search",this.clearSearchLabel="Clear",this.previousHitLabel="Previous Hit",this.nextHitLabel="Next Hit",this.goToPageLabel="Go to page",this.currentPageLabel="Current page",this.enterPageNumber="Enter page number",this.dropDisabled="Sorry, but drag and drop is disabled",this.somethingHasGoneWrongLabel="Oh dear, something has gone terribly wrong...",this.manifestUriMissingLabel="ManifestUri is missing",this.manifestNotValidLabel="Manifest is not valid",this.pageDoesNotExists="Sorry, that page does not exist",this.noResultsFoundLabel=function(e){return'No results found for <em class="current-search">'+e+"</em>"},this.resultsFoundLabel=function(e,t){return e+' results found for <em class="current-search">'+t+"</em>"},this.currentHitLabel=function(e,t){return e+" of "+t+" hits"}}return e=H([t.Injectable()],e)}(),k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.helpLabel="Hjelp",t.line1="<strong>PIL VENSTRE</strong> eller <strong>PAGE UP</strong>: Gå til forrige side",t.line2="<strong>PIL HØYRE</strong> eller <strong>PAGE DOWN</strong>: Gå til neste side",t.line3="<strong>HOME</strong>: Gå til første side",t.line4="<strong>END</strong>: Gå til siste side",t.line5="<strong>C</strong>: Slår innholdsfanen på, og viser mer informasjon/metadata om objektet. (Lukk med <strong>ESC</strong>-tasten.)",t.line6="<strong>S</strong>: Åpner søkefeltet for søk i objektet. (Lukk med <strong>ESC</strong>-tasten.)",t.line7="<strong>N</strong>: Går til neste treff i objektet",t.line8="<strong>P</strong>: Går til forrige treff i objektet",t.line9="<strong>F</strong>: Fullskjerm av og på (Lukk med <strong>F</strong> eller <strong>ESC</strong>-tasten.)",t.line10="<strong>R</strong>: Rotér 90°",t}return D(t,e),t}(T),E=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.help=new k,t.closeLabel="Lukk",t.attributionLabel="Tillatelse",t.attributonCloseAriaLabel="Steng tillatelse dialog",t.contentsLabel="Innhold",t.twoPageViewLabel="Tosidevisning",t.singlePageViewLabel="Enkeltsidevisning",t.metadataLabel="Metadata",t.licenseLabel="Lisens",t.tocLabel="Innholdsfortegnelse",t.fullScreenLabel="Fullskjerm",t.exitFullScreenLabel="Avslutt fullskjerm",t.zoomInLabel="Zoom inn",t.zoomOutLabel="Zoom ut",t.previousPageLabel="Forrige side",t.nextPageLabel="Neste side",t.homeLabel="Hjem",t.rotateCwLabel="Rotér 90°",t.searchLabel="Søk",t.clearSearchLabel="Tøm",t.previousHitLabel="Forrige treff",t.nextHitLabel="Neste treff",t.goToPageLabel="Gå til side",t.currentPageLabel="Nåværende side",t.enterPageNumber="Skriv inn sidenummer",t.dropDisabled="Beklager, men drag and drop er ikke aktivert",t.somethingHasGoneWrongLabel="Å nei! Noe har gått galt...",t.manifestUriMissingLabel="Lenke til manifest mangler",t.manifestNotValidLabel="Manifestet er ikke gyldig",t.pageDoesNotExists="Beklager, men den siden finnes ikke",t.noResultsFoundLabel=function(e){return'Ingen treff funnet for <em class="current-search">'+e+"</em>"},t.resultsFoundLabel=function(e,t){return e+' treff funnet for <em class="current-search">'+t+"</em>"},t.currentHitLabel=function(e,t){return e+" av "+t+" treff"},t}return D(i,e),i=H([t.Injectable()],i)}(I),z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.helpLabel="Pagalba",t.line1="<strong>RODYKLĖ KAIRĖN</strong> arba <strong>PAGE UP</strong>: Buvęs puslapis",t.line2="<strong>RODYKLĖ DEŠINĖN</strong> arba <strong>PAGE DOWN</strong>: Kitas puslapis",t.line3="<strong>HOME</strong>: Pirmas puslapis",t.line4="<strong>END</strong>: Paskutinis puslapis",t.line5="<strong>C</strong>: Turinio langas su daugiau informacijos apie objektą. (Uždaromas paspaudus <strong>ESC</strong>.)",t.line6="<strong>S</strong>: Paieška objekto viduje. (Uždaroma paspaudus <strong>ESC</strong>.)",t.line7="<strong>N</strong>: Kitas rezultatas",t.line8="<strong>P</strong>: Buvęs rezultatas",t.line9="<strong>F</strong>: Pilno ekrano režimas (Uždaroma paspaudus <strong>F</strong> arba <strong>ESC</strong>.)",t.line10="<strong>R</strong>: Pasukti 90 laipsnių",t}return D(t,e),t}(T),A=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.help=new z,t.closeLabel="Uždaryti",t.attributionLabel="Teisių priskyrimas",t.attributonCloseAriaLabel="Uždaryti teisių priskyrimo langą",t.contentsLabel="Informacija apie objektą",t.twoPageViewLabel="Atvaizduoti po du puslapius",t.singlePageViewLabel="Atvaizduoti po vieną puslapį",t.metadataLabel="Metaduomenys",t.licenseLabel="Licencija",t.tocLabel="Turinys",t.fullScreenLabel="Pilno ekrano režimas",t.exitFullScreenLabel="Išeiti iš pilno ekrano režimo",t.zoomInLabel="Priartinti",t.zoomOutLabel="Atitolinti",t.previousPageLabel="Buvęs puslapis",t.nextPageLabel="Kitas puslapis",t.homeLabel="Grįžti į pradžią",t.rotateCwLabel="Pasukti 90°",t.searchLabel="Paieška",t.clearSearchLabel="Išvalyti",t.previousHitLabel="Buvęs rezultatas",t.nextHitLabel="Kitas rezultatas",t.goToPageLabel="Persikelti į puslapį",t.currentPageLabel="Dabartinis puslapis",t.enterPageNumber="Įveskite puslapio numerį",t.dropDisabled="Atleiskite, bet veiksmas negalimas",t.somethingHasGoneWrongLabel="Objekto atvaizduoti nepavyko...",t.manifestUriMissingLabel="Nerastas objektų sąrašo identifikatorius (ManifestUri)",t.manifestNotValidLabel="Netinkamas objektų sąrašas (Manifest)",t.pageDoesNotExists="Nepavyko rasti šio paslapio",t.noResultsFoundLabel=function(e){return'Objekte nerasta atitikmenų <em class="current-search">'+e+"</em>"},t.resultsFoundLabel=function(e,t){return e+" rezultata"+(1===e?"s":"i")+' su <em class="current-search">'+t+"</em>"},t.currentHitLabel=function(e,t){return e+" iš "+t+" atitikmenų"},t}return D(i,e),i=H([t.Injectable()],i)}(I);!function(e){e[e.ONE_PAGE=0]="ONE_PAGE",e[e.TWO_PAGE=1]="TWO_PAGE"}(R||(R={})),(L=e.MimeViewerMode||(e.MimeViewerMode={}))[L.DASHBOARD=0]="DASHBOARD",L[L.PAGE=1]="PAGE",L[L.PAGE_ZOOMED=2]="PAGE_ZOOMED";var F,V=function(t){this.attributionDialogEnabled=!0,this.attributionDialogHideTimeout=-1,this.navigationControlEnabled=!0,this.initViewerMode=e.MimeViewerMode.PAGE,this.initViewerLayout=R.TWO_PAGE,this.withCredentials=!1,this.loadTilesWithAjax=!1,this.crossOriginPolicy=!1,this.ajaxHeaders=null,this.preserveZoomOnCanvasGroupChange=!1,this.startOnTopOnCanvasGroupChange=!1,this.isDropEnabled=!1,t&&(this.attributionDialogEnabled=void 0!==t.attributionDialogEnabled?t.attributionDialogEnabled:this.attributionDialogEnabled,this.attributionDialogHideTimeout=t.attributionDialogHideTimeout||this.attributionDialogHideTimeout,this.navigationControlEnabled=void 0!==t.navigationControlEnabled?t.navigationControlEnabled:this.navigationControlEnabled,this.initViewerMode=void 0!==t.initViewerMode?t.initViewerMode:this.initViewerMode,this.initViewerLayout=void 0!==t.initViewerLayout?t.initViewerLayout:this.initViewerLayout,this.withCredentials=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,this.loadTilesWithAjax=void 0!==t.loadTilesWithAjax?t.loadTilesWithAjax:this.loadTilesWithAjax,this.crossOriginPolicy=void 0!==t.crossOriginPolicy?t.crossOriginPolicy:this.crossOriginPolicy,this.ajaxHeaders=void 0!==t.ajaxHeaders?t.ajaxHeaders:this.ajaxHeaders,this.preserveZoomOnCanvasGroupChange=void 0!==t.preserveZoomOnCanvasGroupChange?t.preserveZoomOnCanvasGroupChange:this.preserveZoomOnCanvasGroupChange,this.startOnTopOnCanvasGroupChange=void 0!==t.startOnTopOnCanvasGroupChange?t.startOnTopOnCanvasGroupChange:this.startOnTopOnCanvasGroupChange,this.isDropEnabled=void 0!==t.isDropEnabled?t.isDropEnabled:this.isDropEnabled)};!function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(F||(F={}));var _=function(e){this.viewingDirection=F.LTR,this.structures=[],e&&(this.context=e.context||this.context,this.type=e.type||this.type,this.id=e.id||this.id,this.viewingDirection=e.viewingDirection||this.viewingDirection,this.label=e.label||this.label,this.metadata=e.metadata||this.metadata,this.license=e.license||this.license,this.logo=e.logo||this.logo,this.attribution=e.attribution||this.attribution,this.service=e.service||this.service,this.sequences=e.sequences||this.sequences,this.structures=e.structures||this.structures,this.tileSource=e.tileSource||this.tileSource,this.viewingHint=e.viewingHint||this.viewingHint)},N=function(e,t){this.label=e,this.value=t},j=function(e){e&&(this.id=e.id||this.id,this.type=e.type||this.type,this.label=e.label||this.label,this.viewingHint=e.viewingHint||this.viewingHint,this.canvases=e.canvases||this.canvases)},B=function(e){e&&(this.id=e.id||this.id,this.type=e.type||this.type,this.label=e.label||this.label,this.thumbnail=e.thumbnail||this.thumbnail,this.height=e.height||this.height,this.width=e.width||this.width,this.images=e.images||this.images)},K=function(e){e&&(this.id=e.id||this.id,this.type=e.type||this.type,this.motivation=e.motivation||this.motivation,this.resource=e.resource||this.resource,this.on=e.on||this.on)},U=function(e){e&&(this.id=e.id||this.id,this.type=e.type||this.type,this.format=e.format||this.format,this.service=e.service||this.service,this.height=e.height||this.height,this.width=e.width||this.width)},Z=function(e){e&&(this.context=e.context||this.context,this.id=e.id||this.id,this.protocol=e.protocol||this.protocol,this.width=e.width||this.width,this.height=e.height||this.height,this.sizes=e.sizes||this.sizes,this.tiles=e.tiles||this.tiles,this.profile=e.profile||this.profile,this.physicalScale=e.physicalScale||this.physicalScale,this.physicalUnits=e.physicalUnits||this.physicalUnits,this.service=e.service||this.service)},q=function(e,t){this.width=e,this.height=t},W=function(e){e&&(this.width=e.width||this.width,this.scaleFactors=e.scaleFactors||this.scaleFactors)},X=function(e){e&&(this.id=e.id||this.id,this.type=e.type||this.type,this.label=e.label||this.label,this.canvases=e.canvases||this.canvases,this.canvasIndex=e.canvasIndex)},$=function(){function e(){}return e=H([t.NgModule({exports:[b.MatToolbarModule,c.MatButtonModule,h.MatIconModule,C.MatTooltipModule,l.MatDialogModule,y.MatTabsModule,d.MatListModule,f.MatSliderModule,v.MatProgressSpinnerModule,p.MatInputModule,g.MatProgressBarModule,u.MatCardModule,m.MatSnackBarModule]})],e)}(),Y=function(){function e(){this.spinnerSubject=new i.Subject,this.spinnerState=this.spinnerSubject.asObservable()}return e.prototype.show=function(){this.spinnerSubject.next({show:!0})},e.prototype.hide=function(){this.spinnerSubject.next({show:!1})},e=H([t.Injectable()],e)}(),Q=function(){function e(){}return e=H([t.NgModule({imports:[r.CommonModule,a.FormsModule,a.ReactiveFormsModule,s.FlexLayoutModule,$],exports:[r.CommonModule,s.FlexLayoutModule,a.FormsModule,a.ReactiveFormsModule,$],providers:[Y]})],e)}(),J=function(e){e&&(this.currentValue=e.currentValue||this.currentValue,this.previousValue=e.previousValue||this.previousValue)},ee=function(){function n(){this.toggleModeSubject=new i.ReplaySubject,this.modeChanges=new J}return Object.defineProperty(n.prototype,"onChange",{get:function(){return this.toggleModeSubject.asObservable().pipe(w.distinctUntilChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e,this.change()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"initialMode",{get:function(){return this._initialMode},set:function(e){this._initialMode=e,this.mode=e},enumerable:!0,configurable:!0}),n.prototype.toggleMode=function(){this.mode===e.MimeViewerMode.DASHBOARD?this.mode=e.MimeViewerMode.PAGE:this.mode!==e.MimeViewerMode.PAGE&&this.mode!==e.MimeViewerMode.PAGE_ZOOMED||(this.mode=e.MimeViewerMode.DASHBOARD)},n.prototype.change=function(){this.modeChanges.previousValue=this.modeChanges.currentValue,this.modeChanges.currentValue=this._mode,this.toggleModeSubject.next(M({},this.modeChanges))},n=H([t.Injectable()],n)}(),te={zoom:{zoomFactor:1.15,dblClickZoomFactor:2.7,pinchZoomThreshold:3},pan:{swipeDirectionThreshold:70},transitions:{toolbarsEaseInTime:400,toolbarsEaseOutTime:500,OSDAnimationTime:600},overlays:{canvasGroupMarginInDashboardView:300,canvasGroupMarginInPageView:20},padding:{header:80,footer:80},colors:{canvasGroupBackgroundColor:"#fafafa"}},ie=function(e){this.x=0,this.y=0,this.width=0,this.height=0,this.centerX=0,this.centerY=0,e&&(this.x=e.x||this.x,this.y=e.y||this.y,this.width=e.width||this.width,this.height=e.height||this.height,this.centerX=this.x+this.width/2,this.centerY=this.y+this.height/2)},ne=function(e,t,i){var n={};return n=90===e||270===e?{height:t.canvasSource.width,width:t.canvasSource.height,x:i,y:t.canvasSource.width/2*-1}:{height:t.canvasSource.height,width:t.canvasSource.width,x:i,y:t.canvasSource.height/2*-1},new ie(n)},oe=function(){function e(){}return e.prototype.calculateCanvasGroupPosition=function(e,t){var i;return void 0===t&&(t=0),i=e.canvasGroupIndex?e.viewingDirection===F.LTR?this.calculateLtrX(e):this.calculateRtlX(e):90===t||270===t?e.canvasSource.height/2*-1:e.canvasSource.width/2*-1,ne(t,e,i)},e.prototype.calculateLtrX=function(e){return e.previousCanvasGroupPosition.x+e.previousCanvasGroupPosition.width+te.overlays.canvasGroupMarginInDashboardView},e.prototype.calculateRtlX=function(e){return e.previousCanvasGroupPosition.x-e.previousCanvasGroupPosition.width-te.overlays.canvasGroupMarginInDashboardView},e}(),re=function(){function e(){}return e.prototype.calculateCanvasGroupPosition=function(e,t){var i;return void 0===t&&(t=0),i=e.canvasGroupIndex?e.canvasGroupIndex%2?e.viewingDirection===F.LTR?this.calculateEvenLtrX(e):this.calculateEvenRtlX(e):e.viewingDirection===F.LTR?this.calculateOddLtrX(e):this.calculateOddRtlX(e):0,ne(t,e,i)},e.prototype.calculateEvenLtrX=function(e){return e.previousCanvasGroupPosition.x+e.previousCanvasGroupPosition.width+te.overlays.canvasGroupMarginInDashboardView},e.prototype.calculateOddLtrX=function(e){return e.previousCanvasGroupPosition.x+e.previousCanvasGroupPosition.width},e.prototype.calculateEvenRtlX=function(e){return e.previousCanvasGroupPosition.x-e.canvasSource.width-te.overlays.canvasGroupMarginInDashboardView},e.prototype.calculateOddRtlX=function(e){return e.previousCanvasGroupPosition.x-e.canvasSource.width},e}(),ae=function(){function e(){}return e.create=function(e,t){return e!==R.ONE_PAGE&&t?e===R.TWO_PAGE?new re:void 0:new oe},e}(),se=function(){function e(){this.canvasGroupRects=[],this.canvasRects=[],this.canvasesPerCanvasGroup=[]}return e.prototype.add=function(e){this.canvasGroupRects.push(e)},e.prototype.addRange=function(e){this.canvasGroupRects=e},e.prototype.get=function(e){return M({},this.canvasGroupRects[e])},e.prototype.findClosestIndex=function(e){var t,i=0;return null===e?-1:(this.canvasGroupRects.some((function(n,o){var r=Math.abs(e.x-n.centerX);if(r>=t)return!0;i=o,t=r})),i)},e.prototype.getMaxHeight=function(){return Math.max.apply(Math,this.canvasGroupRects.map((function(e){return e.height})))},e.prototype.getMaxWidth=function(){return Math.max.apply(Math,this.canvasGroupRects.map((function(e){return e.width})))},e.prototype.length=function(){return this.canvasGroupRects.length},e}(),ce=function(){this.addAll=function(e){var t=new se;t.addRange(e),t.canvasRects=e;for(var i=0;i<e.length;i++)t.canvasesPerCanvasGroup.push([i]);return t}},ue=function(){this.addAll=function(e){var t=new se;t.add(e[0]),t.canvasRects=e,t.canvasesPerCanvasGroup.push([0]);for(var i=1;i<e.length;i+=2)if(i+1<e.length){var n=e[i],o=e[i+1],r=new ie({x:Math.min(n.x,o.x),y:Math.min(n.y,o.y),height:Math.max(n.height,o.height),width:n.width+o.width});t.add(r),t.canvasesPerCanvasGroup.push([i,i+1])}else t.add(e[i]),t.canvasesPerCanvasGroup.push([i]);return t}},le=function(){function e(){}return e.create=function(e){return e===R.ONE_PAGE?new ce:e===R.TWO_PAGE?new ue:null},e}(),he=function(){function e(){this._currentNumberOfCanvasGroups=new i.BehaviorSubject(0),this._currentCanvasGroupIndex=new i.BehaviorSubject(0),this.canvasGroups=new se,this._numberOfCanvases=0}return e.prototype.addAll=function(e,t){this.numberOfCanvases=e.length;var i=le.create(t);this.canvasGroups=i.addAll(e),this._currentNumberOfCanvasGroups.next(this.canvasGroups.length())},e.prototype.reset=function(){this.numberOfCanvases=0,this._currentCanvasGroupIndex.next(0),this.canvasGroups=new se},Object.defineProperty(e.prototype,"onCanvasGroupIndexChange",{get:function(){return this._currentCanvasGroupIndex.asObservable().pipe(w.distinctUntilChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onNumberOfCanvasGroupsChange",{get:function(){return this._currentNumberOfCanvasGroups.asObservable().pipe(w.distinctUntilChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentCanvasGroupIndex",{get:function(){return this._currentCanvasGroupIndex.value},set:function(e){this.isWithinBounds(e)&&this._currentCanvasGroupIndex.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfCanvases",{get:function(){return this._numberOfCanvases},set:function(e){this._numberOfCanvases=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfCanvasGroups",{get:function(){return this.canvasGroups.length()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentCanvasIndex",{get:function(){return this.canvasGroups.canvasesPerCanvasGroup[this.currentCanvasGroupIndex][0]},enumerable:!0,configurable:!0}),e.prototype.isWithinBounds=function(e){return e>-1&&e<=this.numberOfCanvasGroups-1},e.prototype.isCurrentCanvasGroupValid=function(){return this.isWithinBounds(this.currentCanvasGroupIndex)},e.prototype.getNextCanvasGroupIndex=function(){return this.isWithinBounds(this.currentCanvasGroupIndex+1)?(this.currentCanvasGroupIndex++,this.currentCanvasGroupIndex):-1},e.prototype.getPrevCanvasGroupIndex=function(){return this.isWithinBounds(this.currentCanvasGroupIndex-1)?(this.currentCanvasGroupIndex--,this.currentCanvasGroupIndex):-1},e.prototype.constrainToRange=function(e){return e<0?0:e>=this.numberOfCanvasGroups-1?this.numberOfCanvasGroups-1:e},e.prototype.findClosestCanvasGroupIndex=function(e){return this.canvasGroups.findClosestIndex(e)},e.prototype.findCanvasGroupByCanvasIndex=function(e){return this.canvasGroups.canvasesPerCanvasGroup.findIndex((function(t){return t.indexOf(e)>=0}))},e.prototype.findCanvasByCanvasIndex=function(e){return 0===this.canvasGroups.canvasesPerCanvasGroup.length?-1:this.canvasGroups.canvasesPerCanvasGroup[e][0]},e.prototype.getCanvasGroupLabel=function(e){if(!this.canvasGroups.canvasGroupRects||0===this.canvasGroups.canvasesPerCanvasGroup.length)return"1";var t=this.canvasGroups.canvasesPerCanvasGroup[e],i=""+(t[0]+1);return t.length>1&&(i=i+"-"+(t[t.length-1]+1)),i},e.prototype.getCanvasesPerCanvasGroup=function(e){return this.canvasGroups.canvasGroupRects?this.canvasGroups.canvasesPerCanvasGroup[e]:[0]},e.prototype.getCanvasRect=function(e){return this.canvasGroups.canvasRects[e]},e.prototype.getCurrentCanvasGroupRect=function(){return this.getCanvasGroupRect(this.currentCanvasGroupIndex)},e.prototype.getCanvasGroupRect=function(e){return this.canvasGroups.get(e)},e.prototype.getMaxHeight=function(){return this.canvasGroups.getMaxHeight()},e.prototype.getMaxWidth=function(){return this.canvasGroups.getMaxWidth()},e=H([t.Injectable()],e)}(),pe=function(){function e(){var e=this;this.clickCount=0,this.click=function(t){t.preventDefaultAction=!0,t.quick&&(e.clickCount++,1===e.clickCount?e.dblClickTimeOut=setTimeout((function(){e.clickCount=0,e.triggerSingleClick(t)}),t.tracker.dblClickTimeThreshold):2===e.clickCount&&(clearTimeout(e.dblClickTimeOut),e.clickCount=0,e.triggerDoubleClick(t)))},this.reset()}return e.prototype.reset=function(){this.singleClickHandlers=[],this.doubleClickHandlers=[]},e.prototype.addSingleClickHandler=function(e){this.singleClickHandlers.push(e)},e.prototype.addDoubleClickHandler=function(e){this.doubleClickHandlers.push(e)},e.prototype.triggerSingleClick=function(e){this.singleClickHandlers.forEach((function(t){t(e)}))},e.prototype.triggerDoubleClick=function(e){this.doubleClickHandlers.forEach((function(t){t(e)}))},e=H([t.Injectable()],e)}();var de,ge=function(e){this.id=0,this.index=0,e&&(this.id=e.id||this.id,this.index=e.index||this.index,this.label=e.label||this.label,this.match=e.match||this.match,this.before=e.before||this.before,this.after=e.after||this.after,this.rects=e.rects||this.rects)},ve=function(){function e(e){this.q="",this.hits=[],e&&(this.q=e.q||this.q,this.hits=e.hits||this.hits)}return e.prototype.add=function(e){this.hits.push(e)},e.prototype.get=function(e){return new ge(M({},this.hits[e]))},e.prototype.size=function(){return this.hits.length},e.prototype.last=function(){return this.get(this.size()-1)},e}(),fe=function(){function e(e,t,i){this.q=e,this.manifest=t,this.iiifSearchResult=i}return e.prototype.build=function(){var e=this,t=new ve;t.q=this.q;if(this.iiifSearchResult&&this.iiifSearchResult.hits)return this.iiifSearchResult.hits.forEach((function(i,n){var o,r,a=n,s=-1,c=null,u=[];if(e.manifest.sequences&&e.manifest.sequences[0].canvases){var l=e.findResources(i);try{for(var h=P(l),p=h.next();!p.done;p=h.next()){var d=p.value;s=e.findSequenceIndex(d),c=e.findLabel(s);var g=d.on,v=g.substring(g.indexOf("=")+1).split(","),f=new ie({x:parseInt(v[0],10),y:parseInt(v[1],10),width:parseInt(v[2],10),height:parseInt(v[3],10)});u.push(f)}}catch(e){o={error:e}}finally{try{p&&!p.done&&(r=h.return)&&r.call(h)}finally{if(o)throw o.error}}}t.add(new ge({id:a,index:s,label:c,match:i.match,before:i.before,after:i.after,rects:u}))})),t},e.prototype.findResources=function(e){var t,i,n=[],o=function(e){var t=r.iiifSearchResult.resources.find((function(t){return t["@id"]===e}));n.push(t)},r=this;try{for(var a=P(e.annotations),s=a.next();!s.done;s=a.next()){o(s.value)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}return n},e.prototype.findSequenceIndex=function(e){var t=this.manifest.sequences[0],i=e.on,n=i.substring(0,i.indexOf("#"));return t.canvases.findIndex((function(e){return e.id===n}))},e.prototype.findLabel=function(e){return-1===e?null:this.manifest.sequences[0].canvases[e].label},e}(),me=function(){function e(e){this.http=e,this._currentSearchResult=new i.BehaviorSubject(new ve({})),this._searching=new i.BehaviorSubject(!1),this._currentQ=new i.Subject,this._selected=new i.BehaviorSubject(null)}return e.prototype.destroy=function(){this._currentSearchResult.next(new ve({})),this._selected.next(null)},Object.defineProperty(e.prototype,"onQChange",{get:function(){return this._currentQ.asObservable().pipe(w.distinctUntilChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onChange",{get:function(){return this._currentSearchResult.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSearching",{get:function(){return this._searching.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSelected",{get:function(){return this._selected.asObservable()},enumerable:!0,configurable:!0}),e.prototype.search=function(e,t){var i=this;this._currentQ.next(t),this._selected.next(null),0!==t.length?e.service&&null!==e.service&&(this._searching.next(!0),this.http.get(e.service.id+"?q="+t).pipe(w.finalize((function(){return i._searching.next(!1)}))).subscribe((function(n){return i._currentSearchResult.next(i.extractData(t,e,n))}),(function(e){return i.handleError}))):this._currentSearchResult.next(new ve)},e.prototype.selected=function(e){this._selected.next(e)},e.prototype.extractData=function(e,t,i){return new fe(e,t,i).build()},e.prototype.handleError=function(e){var t;return t=e.error instanceof Error?e.error.message:e.error,i.throwError(t)},e.ctorParameters=function(){return[{type:S.HttpClient}]},e=H([t.Injectable()],e)}(),ye=function(){function e(){}return e.isManifestPaged=function(e){return e&&("paged"===e.viewingHint||e.sequences&&"paged"===e.sequences[0].viewingHint)},e}(),be=function(){this.scrollToZoom=!1,this.clickToZoom=!1,this.dblClickToZoom=!1,this.pinchToZoom=!1,this.flickEnabled=!1,this.flickMinSpeed=120,this.flickMomentum=.25,this.pinchRotate=!1},Ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return D(t,e),t}(be),we=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return D(t,e),t}(be),Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return D(t,e),t}(be),xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return D(t,e),t}(be);!function(e){e[e.NONE=0]="NONE",e[e.TOP_LEFT=1]="TOP_LEFT",e[e.TOP_RIGHT=2]="TOP_RIGHT",e[e.BOTTOM_RIGHT=3]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=4]="BOTTOM_LEFT",e[e.ABSOLUTE=5]="ABSOLUTE"}(de||(de={}));var Ge,Oe=function(){this.id="openseadragon",this.tileSources=[],this.tabIndex=0,this.xmlPath=null,this.prefixUrl="https://openseadragon.github.io/openseadragon/images/",this.debugMode=!1,this.debugGridColor="#08f",this.blendTime=0,this.alwaysBlend=!1,this.autoHideControls=!0,this.immediateRender=!1,this.defaultZoomLevel=0,this.opacity=1,this.compositeOperation=null,this.placeholderFillStyle=null,this.degrees=0,this.minZoomLevel=this.defaultZoomLevel,this.maxZoomLevel=null,this.homeFillsViewer=!1,this.panHorizontal=!0,this.panVertical=!1,this.constrainDuringPan=!1,this.wrapHorizontal=!1,this.wrapVertical=!1,this.minZoomImageRatio=1,this.maxZoomPixelRatio=1,this.smoothTileEdgesMinZoom=1,this.iOSDevice=!0,this.autoResize=!0,this.preserveImageSizeOnResize=!0,this.minScrollDeltaTime=50,this.pixelsPerWheelLine=40,this.visibilityRatio=1,this.viewportMargins={},this.imageLoaderLimit=0,this.clickTimeThreshold=300,this.clickDistThreshold=5,this.dblClickTimeThreshold=300,this.dblClickDistThreshold=20,this.springStiffness=6.5,this.animationTime=te.transitions.OSDAnimationTime/1e3,this.gestureSettingsMouse=new Ce,this.gestureSettingsTouch=new we,this.gestureSettingsPen=new Se,this.gestureSettingsUnknown=new xe,this.zoomPerClick=2,this.zoomPerScroll=1.2,this.zoomPerSecond=1,this.showNavigator=!1,this.navigatorPosition="TOP_RIGHT",this.navigatorSizeRatio=.2,this.navigatorMaintainSizeRatio=!1,this.navigatorTop=null,this.navigatorLeft=null,this.navigatorHeight=null,this.navigatorWidth=null,this.navigatorAutoResize=!0,this.navigatorAutoFade=!0,this.navigatorRotate=!0,this.controlsFadeDelay=2e3,this.controlsFadeLength=1500,this.maxImageCacheCount=200,this.timeout=3e4,this.useCanvas=!0,this.minPixelRatio=.5,this.mouseNavEnabled=!0,this.showNavigationControl=!1,this.navigationControlAnchor=de.TOP_LEFT,this.showZoomControl=!0,this.showHomeControl=!0,this.showFullPageControl=!1,this.showRotationControl=!1,this.showSequenceControl=!1,this.sequenceControlAnchor=de.TOP_LEFT,this.navPrevNextWrap=!1,this.zoomInButton=null,this.zoomOutButton=null,this.homeButton=null,this.previousButton=null,this.nextButton=null,this.sequenceMode=!0,this.initialPage=0,this.preserveViewport=!1,this.preserveOverlays=!1,this.showReferenceStrip=!1,this.referenceStripScroll="horizontal",this.referenceStripElement=null,this.referenceStripHeight=null,this.referenceStripWidth=null,this.referenceStripPosition="BOTTOM_LEFT",this.referenceStripSizeRatio=.2,this.collectionMode=!1,this.collectionRows=1,this.collectionColumns=0,this.collectionLayout="horizontal",this.collectionTileSize=800,this.collectionTileMargin=80,this.crossOriginPolicy=!1,this.ajaxWithCredentials=!1,this.loadTilesWithAjax=!1,this.ajaxHeaders=null},De=function(){this.active=!1,this.previousGestureId=0,this.shouldStop=!1};!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.TOP=2]="TOP",e[e.BOTTOM=3]="BOTTOM"}(Ge||(Ge={}));var Me,He=function(){function e(e){this.zone=e,this.colorSubject=new i.ReplaySubject}return Object.defineProperty(e.prototype,"onChange",{get:function(){return this.colorSubject.asObservable().pipe(w.filter((function(e){return null!==e})),w.distinctUntilChanged())},enumerable:!0,configurable:!0}),e.prototype.init=function(){var e=this;this.zone.runOutsideAngular((function(){i.interval(1e3).pipe(w.tap((function(){var t=e.currentRgbColor,i=e.getComputedBackgroundColor(1);t!==i&&(e.currentRgbColor=i,e.colorSubject.next(i))}))).subscribe()}))},e.prototype.convertToRgba=function(e,t){return e.replace(/rgb/i,"rgba").replace(/\)/i,","+t+")")},e.prototype.getComputedBackgroundColor=function(e){var t=document.getElementsByClassName("mat-app-background"),i=document.getElementsByTagName("mat-sidenav-container");return t.length>0?this.getComputedStyle(t[0],"background-color"):i.length>0?this.getComputedStyle(i[0],"background-color"):null},e.prototype.getComputedStyle=function(e,t){return window.getComputedStyle(e,null).getPropertyValue(t)},e.ctorParameters=function(){return[{type:t.NgZone}]},e.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(t.NgZone))},token:e,providedIn:"root"}),e=H([t.Injectable({providedIn:"root"})],e)}(),Pe=function(){function e(e){this.mediaObserver=e,this.mimeConfig=new V,this.subject=new i.BehaviorSubject(this.mimeConfig.initViewerLayout)}return e.prototype.init=function(e){this.mimeConfig.initViewerLayout===R.TWO_PAGE&&e&&!this.isMobile()?(this._layout=R.TWO_PAGE,this.change()):(this._layout=R.ONE_PAGE,this.change())},Object.defineProperty(e.prototype,"onChange",{get:function(){return this.subject.asObservable().pipe(w.distinctUntilChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0}),e.prototype.setLayout=function(e){this._layout=e,this.change()},e.prototype.toggle=function(){this._layout===R.TWO_PAGE?this.setLayout(R.ONE_PAGE):this._layout===R.ONE_PAGE&&this.setLayout(R.TWO_PAGE)},e.prototype.change=function(){this.subject.next(this._layout)},e.prototype.isMobile=function(){return this.mediaObserver.isActive("lt-md")},e.ctorParameters=function(){return[{type:s.MediaObserver}]},e=H([t.Injectable()],e)}();!function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.UP=3]="UP",e[e.DOWN=4]="DOWN",e[e.NEXT=5]="NEXT",e[e.PREVIOUS=6]="PREVIOUS"}(Me||(Me={}));var Re=function(){function e(){}return e.prototype.calculateNextCanvasGroup=function(e){var t=e.direction,i=1;return i=e.currentCanvasGroupIndex+(i=t===Me.NEXT?i:-1*i)},e}(),Le=function(){function e(){}return e.prototype.calculateNextCanvasGroup=function(e){var t,i=e.speed,n=e.direction,o=e.currentCanvasGroupIndex,r=e.currentCanvasGroupCenter,a=this.calculateNumberOfCanvasGroupsToGo(i);return 0===a?t=r:(a=n===Me.LEFT?a:-1*a,t=e.viewingDirection===F.LTR?o+a:o-a),t},e.prototype.calculateNumberOfCanvasGroupsToGo=function(e){return e<500?0:e>=500&&e<1500?1:e>=1500&&e<2500?3:e>=2500&&e<3500?5:10},e}(),Te=function(){function e(){}return e.prototype.calculateNextCanvasGroup=function(e){var t=e.currentCanvasGroupIndex!==e.currentCanvasGroupCenter,i=e.speed,n=e.direction,o=e.currentCanvasGroupIndex;if(i>=200){var r=n===Me.LEFT?1:-1;o=e.viewingDirection===F.LTR?e.currentCanvasGroupIndex+r:e.currentCanvasGroupIndex-r}else t&&(o=e.currentCanvasGroupCenter);return o},e}(),Ie=function(){function e(){}return e.prototype.calculateNextCanvasGroup=function(e){var t=e.direction,i=e.currentCanvasGroupIndex,n=e.canvasGroupEndHitCountReached?1:0;return n=t===Me.LEFT?n:-1*n,n=e.viewingDirection===F.LTR?i+n:i-n},e}(),ke=function(){function t(){}return t.create=function(t){return t===e.MimeViewerMode.DASHBOARD?new Le:t===e.MimeViewerMode.PAGE?new Te:t===e.MimeViewerMode.PAGE_ZOOMED?new Ie:new Re},t}(),Ee=function(){function e(e,t){var n=this;this.styleService=t,this.disableResize=!1,this.destroyed=new i.Subject,this.animationHandler=function(){n.resize()},this.resizeHandler=function(){n.setCenter(),n.resize()},this.canvasGroupPinchHandler=function(){n.disableResize=!1},this.canvasGroupDragHandler=function(e){(e.delta.x||e.delta.y)&&e.speed>0&&0!==e.direction&&(n.disableResize=!0)},this.canvasGroupDragEndHandler=function(){n.disableResize=!1,n.resize()},this.viewer=e,t.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){n.backgroundColor=e,n.leftMask&&n.leftMask.style("fill",n.backgroundColor),n.rightMask&&n.rightMask.style("fill",n.backgroundColor)}))}return e.prototype.initialise=function(e,t){this.canvasGroupRect=e,this.addCanvasGroupMask(),this.setCenter(),this.resize(),t?this.show():this.hide()},e.prototype.destroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.changeCanvasGroup=function(e){this.canvasGroupRect=e,this.resize()},e.prototype.show=function(){this.addHandlers(),this.leftMask&&this.rightMask&&(this.setCenter(),this.resize(),this.leftMask.attr("height","100%"),this.rightMask.attr("height","100%"))},e.prototype.hide=function(){this.removeHandlers(),this.leftMask&&this.rightMask&&(this.leftMask.attr("height","0"),this.rightMask.attr("height","0"))},e.prototype.addHandlers=function(){this.viewer.addHandler("animation",this.animationHandler),this.viewer.addHandler("resize",this.resizeHandler),this.viewer.addHandler("canvas-pinch",this.canvasGroupPinchHandler),this.viewer.addHandler("canvas-drag",this.canvasGroupDragHandler),this.viewer.addHandler("canvas-drag-end",this.canvasGroupDragEndHandler)},e.prototype.removeHandlers=function(){this.viewer.removeHandler("animation",this.animationHandler),this.viewer.removeHandler("resize",this.resizeHandler),this.viewer.removeHandler("canvas-pinch",this.canvasGroupPinchHandler),this.viewer.removeHandler("canvas-drag",this.canvasGroupDragHandler),this.viewer.removeHandler("canvas-drag-end",this.canvasGroupDragEndHandler)},e.prototype.addCanvasGroupMask=function(){var e=n.select(this.viewer.svgOverlay().node().parentNode).append("g").attr("id","page-mask");this.leftMask=e.append("rect").attr("id","mime-left-page-mask").attr("height","100%").attr("y",0).style("fill",this.backgroundColor),this.rightMask=e.append("rect").attr("id","mime-right-page-mask").attr("height","100%").attr("y",0).style("fill",this.backgroundColor)},e.prototype.setCenter=function(){this.center=new o.Point(this.viewer.viewport._containerInnerSize.x/2,this.viewer.viewport._containerInnerSize.y/2)},e.prototype.resize=function(){if(!this.disableResize&&this.leftMask&&this.rightMask){var e=this.getLeftMaskRect(),t=this.getRightMaskRect();this.leftMask.attr("width",e.width).attr("x",e.x),this.rightMask.attr("width",t.width).attr("x",Math.round(t.x))}},e.prototype.getLeftMaskRect=function(){var e=new o.Rect(this.canvasGroupRect.x,this.canvasGroupRect.y,this.canvasGroupRect.width,this.canvasGroupRect.height),t=this.viewer.viewport.viewportToViewerElementCoordinates(e.getTopLeft()).x-te.overlays.canvasGroupMarginInPageView;return t<0&&(t=0),new ie({x:0,width:t})},e.prototype.getRightMaskRect=function(){var e=new o.Rect(this.canvasGroupRect.x,this.canvasGroupRect.y,this.canvasGroupRect.width,this.canvasGroupRect.height),t=this.viewer.viewport.viewportToViewerElementCoordinates(e.getTopRight()),i=this.viewer.viewport._containerInnerSize.x-t.x,n=this.viewer.viewport._containerInnerSize.x-i+te.overlays.canvasGroupMarginInPageView;return i<0&&(i=0),new ie({x:n,width:i})},e}(),ze=function(){function t(e,t,i,n,o,r){this.viewer=e,this.zoomStrategy=t,this.canvasService=i,this.modeService=n,this.config=o,this.viewingDirection=r}return t.prototype.goToCanvasGroup=function(t){var i=this,n=this.canvasService.currentCanvasGroupIndex;this.canvasService.currentCanvasGroupIndex=this.canvasService.constrainToRange(t.canvasGroupIndex);var o=this.canvasService.getCanvasGroupRect(this.canvasService.currentCanvasGroupIndex);if(this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED&&this.config.preserveZoomOnCanvasGroupChange){var r=void 0;if(n>t.canvasGroupIndex)if(this.config.startOnTopOnCanvasGroupChange){var a=this.canvasService.getCanvasesPerCanvasGroup(t.canvasGroupIndex),s=a[a.length-1],c=this.canvasService.getCanvasRect(s);r=this.viewingDirection===F.LTR?this.leftX(c):this.rightX(o)}else r=this.viewingDirection===F.LTR?this.rightX(o):this.leftX(o);else r=this.viewingDirection===F.LTR?this.leftX(o):this.rightX(o);var u=this.config.startOnTopOnCanvasGroupChange?o.y+this.getViewportBounds().height/2-(new Oe).collectionTileMargin:this.getViewportCenter().y;this.panTo(r,u,t.immediately)}else if(this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED){var l=this.canvasService.getCanvasGroupRect(n);this.panToCenter(l,t.immediately),this.zoomStrategy.goToHomeZoom(),setTimeout((function(){i.panToCenter(o,t.immediately),i.modeService.mode=e.MimeViewerMode.PAGE}),te.transitions.OSDAnimationTime)}else this.panToCenter(o,t.immediately)},t.prototype.goToPreviousCanvasGroup=function(e){if(this.canvasService.currentCanvasGroupIndex>0){var t=this.getViewportCenter(),i=this.canvasService.findClosestCanvasGroupIndex(t),n=ke.create(null).calculateNextCanvasGroup({direction:Me.PREVIOUS,currentCanvasGroupIndex:i,currentCanvasGroupCenter:e,viewingDirection:this.viewingDirection});this.goToCanvasGroup({canvasGroupIndex:n,immediately:!1})}},t.prototype.goToNextCanvasGroup=function(e){if(this.canvasService.currentCanvasGroupIndex<this.canvasService.numberOfCanvasGroups){var t=this.getViewportCenter(),i=this.canvasService.findClosestCanvasGroupIndex(t),n=ke.create(null).calculateNextCanvasGroup({direction:Me.NEXT,currentCanvasGroupIndex:i,currentCanvasGroupCenter:e,viewingDirection:this.viewingDirection});this.goToCanvasGroup({canvasGroupIndex:n,immediately:!1})}},t.prototype.centerCurrentCanvas=function(){var e=this.canvasService.currentCanvasGroupIndex,t=this.canvasService.getCanvasGroupRect(e);this.panToCenter(t,!1)},t.prototype.leftX=function(e){return e.x+this.getViewportBounds().width/2},t.prototype.rightX=function(e){return e.x+e.width-this.getViewportBounds().width/2},t.prototype.panToCenter=function(e,t){this.panTo(e.centerX,e.centerY,t)},t.prototype.panTo=function(e,t,i){this.viewer.viewport.panTo({x:e,y:t},i)},t.prototype.getViewportCenter=function(){return this.viewer.viewport.getCenter(!0)},t.prototype.getViewportBounds=function(){return this.viewer.viewport.getBounds(!0)},t}(),Ae=function(){function e(){this.reset()}return e.prototype.reset=function(){this.leftCount=0,this.rightCount=0},e.prototype.addHit=function(e,t){this.incrementSide(e),this.clearOppositeSideOfDragDirection(t)},e.prototype.hitCountReached=function(){return this.leftCount>=2||this.rightCount>=2},e.prototype.incrementSide=function(e){e===Ge.LEFT?(this.leftCount++,this.rightCount=0):e===Ge.RIGHT&&(this.rightCount++,this.leftCount=0)},e.prototype.clearOppositeSideOfDragDirection=function(e){e===Me.LEFT?this.leftCount=0:e===Me.RIGHT&&(this.rightCount=0)},e}(),Fe=function(){function e(){}return e.getSwipeDirection=function(e,t,i){var n=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y);return n=i?n-te.pan.swipeDirectionThreshold:n,e.x>t.x&&n>=o?Me.LEFT:e.x<t.x&&n>=o?Me.RIGHT:void 0},e.getSideIfPanningPastEndOfCanvasGroup=function(e,t){return this.isPanningOutsideLeft(e,t)?Ge.LEFT:this.isPanningOutsideRight(e,t)?Ge.RIGHT:void 0},e.isPanningOutsideCanvasGroup=function(e,t){return this.isPanningOutsideLeft(e,t)||this.isPanningOutsideRight(e,t)},e.isPanningOutsideLeft=function(e,t){return t.x<e.x},e.isPanningOutsideRight=function(e,t){return t.x+t.width>e.x+e.width},e.isDirectionInRightSemicircle=function(e){return e>-Math.PI/2&&e<Math.PI/2},e.isDirectionInLeftSemicircle=function(e){return!this.isDirectionInRightSemicircle(e)||0===e},e}(),Ve=function(){function e(){}return e.prototype.getTileSource=function(e){var t;return t=e.service.service?e.service:(t=(t=e.service["@id"]).startsWith("//")?""+location.protocol+t:t).endsWith("/info.json")?t:t+"/info.json"},e}(),_e=function(){function e(){}return e.prototype.getTileSource=function(e){return{type:"image",url:e["@id"]}},e}(),Ne=function(){function e(){}return e.create=function(e){return e.service?new Ve:new _e},e}(),je=function(e){this.bottom=0,this.height=0,this.left=0,this.right=0,this.top=0,this.width=0,e&&(this.bottom=e.bottom||this.bottom,this.height=e.height||this.height,this.left=e.left||this.left,this.right=e.right||this.right,this.top=e.top||this.top,this.width=e.width||this.width)},Be=function(){function e(){}return e.numbersAreClose=function(e,t,i){return Math.abs(e-t)<=i},e.shortenDecimals=function(e,t){var i=Number(e).toPrecision(t);return Number(i)},e}(),Ke=function(){function e(){}return e.constrainPositionToCanvasGroup=function(e,t){return e.x<t.x?e.x=t.x:e.x>t.x+t.width&&(e.x=t.x+t.width),e},e.constraintZoomFactor=function(e,t,i){var n=t*e;return n>i?i/n*e:e},e}(),Ue=function(e){function t(t,i,n,o){return e.call(this,t,i,n,o)||this}return D(t,e),t}(function(){function t(e,t,i,n){this.viewer=e,this.canvasService=t,this.modeService=i,this.viewerLayoutService=n}return t.prototype.setMinZoom=function(e){this.viewer.viewport.minZoomLevel=this.getHomeZoomLevel(e)},t.prototype.getMinZoom=function(){return Be.shortenDecimals(this.viewer.viewport.getMinZoom(),5)},t.prototype.getMaxZoom=function(){return Be.shortenDecimals(this.viewer.viewport.getMaxZoom(),5)},t.prototype.getZoom=function(){return Be.shortenDecimals(this.viewer.viewport.getZoom(!0),5)},t.prototype.goToHomeZoom=function(){this.zoomTo(this.getHomeZoomLevel(this.modeService.mode)),this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED&&(this.modeService.mode=e.MimeViewerMode.PAGE)},t.prototype.zoomTo=function(e,t){this.viewer.viewport.zoomTo(e,t)},t.prototype.getHomeZoomLevel=function(t){if(this.viewer&&this.canvasService){var i,n,o;if(t===e.MimeViewerMode.DASHBOARD)i=this.canvasService.getMaxHeight(),n=this.canvasService.getMaxWidth(),o=this.getDashboardViewportBounds();else{var r=this.canvasService.getCurrentCanvasGroupRect();i=r.height,n=r.width,o=this.viewer.viewport.getBounds()}return this.getFittedZoomLevel(o,i,n)}},t.prototype.zoomIn=function(t,i){void 0===t&&(t=te.zoom.zoomFactor),void 0!==i&&(i=this.viewer.viewport.pointFromPixel(i),i=Ke.constrainPositionToCanvasGroup(i,this.canvasService.getCurrentCanvasGroupRect())),this.modeService.mode!==e.MimeViewerMode.PAGE_ZOOMED&&(this.modeService.mode=e.MimeViewerMode.PAGE_ZOOMED),this.zoomBy(t,i)},t.prototype.zoomOut=function(t,i){void 0===t&&(t=Math.pow(te.zoom.zoomFactor,-1)),void 0!==i&&(i=this.viewer.viewport.pointFromPixel(i),i=Ke.constrainPositionToCanvasGroup(i,this.canvasService.getCurrentCanvasGroupRect())),this.isViewportLargerThanCanvasGroup()?this.modeService.mode=e.MimeViewerMode.PAGE:this.zoomBy(t,i)},t.prototype.getDashboardViewportBounds=function(){if(this.viewer){var e=this.getHomeZoomFactor(),t=new je(n.select(this.viewer.container.parentNode.parentNode).node().getBoundingClientRect()),i=t.height-te.padding.header-te.padding.footer,r=t.width*e,a=this.viewer.viewport.deltaPointsFromPixels(new o.Point(r,i));return new o.Rect(0,0,a.x,a.y)}},t.prototype.getFittedZoomLevel=function(e,t,i){var n=this.viewer.viewport.getZoom(),o=e.height/t;return o*i<=e.width?Be.shortenDecimals(o*n,5):Be.shortenDecimals(e.width/i*n,5)},t.prototype.zoomBy=function(e,t){var i=this.viewer.viewport.getZoom(!1);e=Ke.constraintZoomFactor(e,i,this.getMaxZoom()),this.viewer.viewport.zoomBy(e,t)},t.prototype.isViewportLargerThanCanvasGroup=function(){var e=this.canvasService.getCurrentCanvasGroupRect(),t=this.viewer.viewport.getBounds(),i=Math.round(e.width),n=Math.round(e.height),o=Math.round(t.width);return Math.round(t.height)>=n||o>=i},t.prototype.getHomeZoomFactor=function(){return this.modeService.mode===e.MimeViewerMode.DASHBOARD?this.getDashboardZoomHomeFactor():1},t.prototype.getDashboardZoomHomeFactor=function(){return this.viewerLayoutService.layout===R.ONE_PAGE?.85:.66},t}()),Ze=function(){function o(t,n,o,r,a,s,c){var u=this;this.zone=t,this.clickService=n,this.canvasService=o,this.modeService=r,this.viewerLayoutService=a,this.iiifContentSearchService=s,this.styleService=c,this.subscriptions=[],this.destroyed=new i.Subject,this.isCanvasPressed=new i.BehaviorSubject(!1),this.currentCenter=new i.Subject,this.currentCanvasIndex=new i.BehaviorSubject(0),this.currentHit=new i.BehaviorSubject(null),this.osdIsReady=new i.BehaviorSubject(!1),this.swipeDragEndCounter=new Ae,this.pinchStatus=new De,this.rotation=0,this.scrollHandler=function(e){var t=Math.pow(te.zoom.zoomFactor,e.scroll);e.scroll>0?u.zoomInGesture(e.position,t):e.scroll<0&&u.zoomOutGesture(e.position,t)},this.pinchHandler=function(e){u.pinchStatus.active=!0;var t=e.distance/e.lastDistance;e.distance>e.lastDistance+te.zoom.pinchZoomThreshold?u.zoomInPinchGesture(e,t):e.distance+te.zoom.pinchZoomThreshold<e.lastDistance&&u.zoomOutPinchGesture(e,t)},this.singleClickHandler=function(e){var t=e.originalEvent.target,i=u.getOverlayIndexFromClickEvent(t),n=u.canvasService.findCanvasGroupByCanvasIndex(i);n&&(u.canvasService.currentCanvasGroupIndex=n),u.modeService.toggleMode()},this.dblClickHandler=function(t){var i=t.originalEvent.target;if(u.modeService.mode===e.MimeViewerMode.PAGE)u.modeService.mode=e.MimeViewerMode.PAGE_ZOOMED,u.zoomStrategy.zoomIn(te.zoom.dblClickZoomFactor,t.position);else{u.modeService.mode=e.MimeViewerMode.PAGE;var n=u.getOverlayIndexFromClickEvent(i),o=u.canvasService.findCanvasGroupByCanvasIndex(n);o>=0&&(u.canvasService.currentCanvasGroupIndex=o)}},this.dragHandler=function(t){if(u.viewer.panHorizontal=!0,u.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED){t.position;var i=u.canvasService.getCurrentCanvasGroupRect(),n=u.getViewportBounds(),o=Fe.getSideIfPanningPastEndOfCanvasGroup(i,n),r=t.direction;(o===Ge.LEFT&&Fe.isDirectionInRightSemicircle(r)||o===Ge.RIGHT&&Fe.isDirectionInLeftSemicircle(r))&&(u.viewer.panHorizontal=!1)}}}return Object.defineProperty(o.prototype,"onCenterChange",{get:function(){return this.currentCenter.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onCanvasGroupIndexChange",{get:function(){return this.currentCanvasIndex.asObservable().pipe(w.distinctUntilChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onHitChange",{get:function(){return this.currentHit.asObservable().pipe(w.distinctUntilChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onOsdReadyChange",{get:function(){return this.osdIsReady.asObservable().pipe(w.distinctUntilChanged())},enumerable:!0,configurable:!0}),o.prototype.getViewer=function(){return this.viewer},o.prototype.getTilesources=function(){return this.tileSources},o.prototype.getOverlays=function(){return this.overlays},o.prototype.getZoom=function(){return this.zoomStrategy.getZoom()},o.prototype.getMinZoom=function(){return this.zoomStrategy.getMinZoom()},o.prototype.getMaxZoom=function(){return this.zoomStrategy.getMaxZoom()},o.prototype.home=function(){this.osdIsReady.getValue()&&(this.zoomStrategy.setMinZoom(this.modeService.mode),this.goToCanvasGroupStrategy.centerCurrentCanvas(),this.zoomStrategy.goToHomeZoom())},o.prototype.goToPreviousCanvasGroup=function(){this.goToCanvasGroupStrategy.goToPreviousCanvasGroup(this.currentCanvasIndex.getValue())},o.prototype.goToNextCanvasGroup=function(){this.goToCanvasGroupStrategy.goToNextCanvasGroup(this.currentCanvasIndex.getValue())},o.prototype.goToCanvasGroup=function(e,t){this.goToCanvasGroupStrategy.goToCanvasGroup({canvasGroupIndex:e,immediately:t})},o.prototype.goToCanvas=function(e,t){var i=this.canvasService.findCanvasGroupByCanvasIndex(e);this.goToCanvasGroupStrategy.goToCanvasGroup({canvasGroupIndex:i,immediately:t})},o.prototype.highlight=function(e){var t,i,n,o;if(this.clearHightlight(),this.viewer){e.q&&(this.currentSearch=e);try{for(var r=P(e.hits),a=r.next();!a.done;a=r.next()){var s=a.value;try{for(var c=(n=void 0,P(s.rects)),u=c.next();!u.done;u=c.next()){var l=u.value,h=this.canvasService.getCanvasRect(s.index);if(h){var p=h.x+l.x,d=h.y+l.y,g=l.width,v=l.height;this.svgNode.append("rect").attr("mimeHitIndex",s.id).attr("x",p).attr("y",d).attr("width",g).attr("height",v).attr("class","hit")}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}}},o.prototype.highlightCurrentHit=function(e){this.svgNode.selectAll("g > rect.selected").attr("class","hit"),this.svgNode.selectAll("g > rect[mimeHitIndex='"+e.id+"']").attr("class","hit selected")},o.prototype.clearHightlight=function(){this.svgNode&&(this.svgNode.selectAll(".hit").remove(),this.currentSearch=null)},o.prototype.setUpViewer=function(e,t){var i=this;this.config=t,e&&e.tileSource&&(this.tileSources=e.tileSource,this.zone.runOutsideAngular((function(){i.manifest=e,i.isManifestPaged=ye.isManifestPaged(i.manifest),i.viewer=new OpenSeadragon.Viewer(Object.assign({},i.getOptions())),function(){if(OpenSeadragon){var e="http://www.w3.org/2000/svg",t=function(){function t(t){var i=this;this._viewer=t,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(e,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(e,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",(function(){i.resize()})),this._viewer.addHandler("open",(function(){i.resize()})),this._viewer.addHandler("rotate",(function(e){i.resize()})),this._viewer.addHandler("resize",(function(){i.resize()})),this.resize()}return t.prototype.node=function(){return this._node},t.prototype.resize=function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));var e=this._viewer.viewport.pixelFromPoint(new OpenSeadragon.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0),i=this._viewer.viewport.getRotation(),n=this._viewer.viewport._containerInnerSize.x*t;this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+n+") rotate("+i+")")},t.prototype.onClick=function(e,t){new OpenSeadragon.MouseTracker({element:e,clickHandler:t}).setTracking(!0)},t}();OpenSeadragon.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo||(this._svgOverlayInfo=new t(this)),this._svgOverlayInfo}}else console.error("[openseadragon-svg-overlay] requires OpenSeadragon")}(),i.zoomStrategy=new Ue(i.viewer,i.canvasService,i.modeService,i.viewerLayoutService),i.goToCanvasGroupStrategy=new ze(i.viewer,i.zoomStrategy,i.canvasService,i.modeService,i.config,i.manifest.viewingDirection),i.defaultKeyDownHandler=i.viewer.innerTracker.keyDownHandler,i.disableKeyDownHandler(),i.viewer.innerTracker.keyHandler=null,i.canvasService.reset(),i.canvasGroupMask=new Ee(i.viewer,i.styleService)})),this.addToWindow(),this.setupOverlays(),this.createOverlays(),this.addEvents(),this.addSubscriptions())},o.prototype.addSubscriptions=function(){var t=this;this.modeService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){t.modeChanged(e)})),this.zone.runOutsideAngular((function(){t.onCenterChange.pipe(w.takeUntil(t.destroyed),w.sample(i.interval(500))).subscribe((function(e){t.calculateCurrentCanvasGroup(e),e&&null!==e&&t.osdIsReady.next(!0)}))})),this.canvasService.onCanvasGroupIndexChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(i){t.swipeDragEndCounter.reset(),-1!==i&&(t.canvasGroupMask.changeCanvasGroup(t.canvasService.getCanvasGroupRect(i)),t.modeService.mode===e.MimeViewerMode.PAGE&&t.zoomStrategy.goToHomeZoom())})),this.onOsdReadyChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){e&&(t.initialCanvasGroupLoaded(),t.currentCenter.next(t.viewer.viewport.getCenter(!0)))})),this.viewerLayoutService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){t.layoutPages()})),this.iiifContentSearchService.onSelected.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){e&&(t.highlightCurrentHit(e),t.goToCanvas(e.index,!1))}))},o.prototype.layoutPages=function(){if(this.osdIsReady.getValue()){var e=this.canvasService.currentCanvasIndex;this.destroy(!0),this.setUpViewer(this.manifest,this.config),this.goToCanvasGroupStrategy.goToCanvasGroup({canvasGroupIndex:this.canvasService.findCanvasGroupByCanvasIndex(e),immediately:!1}),this.currentSearch&&this.highlight(this.currentSearch)}},o.prototype.addToWindow=function(){window.openSeadragonViewer=this.viewer},o.prototype.setupOverlays=function(){this.svgOverlay=this.viewer.svgOverlay(),this.svgNode=n.select(this.svgOverlay.node())},o.prototype.disableKeyDownHandler=function(){this.viewer.innerTracker.keyDownHandler=null},o.prototype.resetKeyDownHandler=function(){this.viewer.innerTracker.keyDownHandler=this.defaultKeyDownHandler},o.prototype.destroy=function(e){this.osdIsReady.next(!1),this.currentCenter.next(null),null!=this.viewer&&this.viewer.isOpen()&&(null!=this.viewer.container&&n.select(this.viewer.container.parentNode).style("opacity","0"),this.viewer.destroy()),this.destroyed.next(),this.overlays=null,this.canvasService.reset(),this.canvasGroupMask&&this.canvasGroupMask.destroy(),e||(this.currentSearch=null,this.iiifContentSearchService.destroy(),this.rotation=0)},o.prototype.addEvents=function(){var e=this;this.clickService.reset(),this.clickService.addSingleClickHandler(this.singleClickHandler),this.clickService.addDoubleClickHandler(this.dblClickHandler),this.viewer.addHandler("animation-finish",(function(){e.currentCenter.next(e.viewer.viewport.getCenter(!0))})),this.viewer.addHandler("canvas-click",this.clickService.click),this.viewer.addHandler("canvas-double-click",(function(e){return e.preventDefaultAction=!0})),this.viewer.addHandler("canvas-press",(function(t){e.pinchStatus.active=!1,e.dragStartPosition=t.position,e.isCanvasPressed.next(!0)})),this.viewer.addHandler("canvas-release",(function(){return e.isCanvasPressed.next(!1)})),this.viewer.addHandler("canvas-scroll",this.scrollHandler),this.viewer.addHandler("canvas-pinch",this.pinchHandler),this.viewer.addHandler("canvas-drag",(function(t){return e.dragHandler(t)})),this.viewer.addHandler("canvas-drag-end",(function(t){return e.swipeToCanvasGroup(t)})),this.viewer.addHandler("animation",(function(t){e.currentCenter.next(e.viewer.viewport.getCenter(!0))}))},o.prototype.zoomIn=function(e,t){this.zoomStrategy.zoomIn(e,t)},o.prototype.zoomOut=function(e,t){this.zoomStrategy.zoomOut(e,t)},o.prototype.rotate=function(){this.rotation=(this.rotation+90)%360,this.layoutPages()},o.prototype.modeChanged=function(t){t.currentValue===e.MimeViewerMode.DASHBOARD?(this.viewer.panVertical=!1,this.toggleToDashboard(),this.disableKeyDownHandler()):t.currentValue===e.MimeViewerMode.PAGE?(this.viewer.panVertical=!1,this.toggleToPage(),this.disableKeyDownHandler()):t.currentValue===e.MimeViewerMode.PAGE_ZOOMED&&(this.viewer.panVertical=!0,this.resetKeyDownHandler())},o.prototype.toggleToDashboard=function(){this.canvasService.isCurrentCanvasGroupValid()&&(this.goToCanvasGroupStrategy.goToCanvasGroup({canvasGroupIndex:this.canvasService.currentCanvasGroupIndex,immediately:!1}),this.canvasGroupMask.hide(),this.zoomStrategy.setMinZoom(e.MimeViewerMode.DASHBOARD),this.zoomStrategy.goToHomeZoom())},o.prototype.toggleToPage=function(){this.canvasService.isCurrentCanvasGroupValid()&&(this.goToCanvasGroupStrategy.goToCanvasGroup({canvasGroupIndex:this.canvasService.currentCanvasGroupIndex,immediately:!1}),this.canvasGroupMask.show(),this.zoomStrategy.setMinZoom(e.MimeViewerMode.PAGE),this.zoomStrategy.goToHomeZoom())},o.prototype.zoomInGesture=function(t,i){this.modeService.mode===e.MimeViewerMode.DASHBOARD?this.modeService.mode=e.MimeViewerMode.PAGE:t?this.zoomStrategy.zoomIn(i,t):this.zoomStrategy.zoomIn()},o.prototype.zoomOutGesture=function(t,i){this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED?this.zoomStrategy.zoomOut(i,t):this.modeService.mode===e.MimeViewerMode.PAGE&&(this.modeService.mode=e.MimeViewerMode.DASHBOARD)},o.prototype.zoomInPinchGesture=function(t,i){this.modeService.mode===e.MimeViewerMode.DASHBOARD?this.modeService.mode=e.MimeViewerMode.PAGE:this.zoomIn(i,this.dragStartPosition||t.center)},o.prototype.zoomOutPinchGesture=function(t,i){var n=t.gesturePoints[0].id;this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED?(this.pinchStatus.shouldStop=!0,this.zoomStrategy.zoomOut(i,t.center)):this.modeService.mode===e.MimeViewerMode.PAGE&&(this.pinchStatus.shouldStop&&n!==this.pinchStatus.previousGestureId+2||(this.pinchStatus.shouldStop=!1,this.modeService.toggleMode()),this.pinchStatus.previousGestureId=n)},o.prototype.isCanvasGroupHit=function(e){return e instanceof SVGRectElement},o.prototype.createOverlays=function(){var e=this;this.overlays=[];var t=[],i=ae.create(this.viewerLayoutService.layout,this.isManifestPaged),n=this.viewerLayoutService.layout===R.TWO_PAGE,o=this.svgNode.append("g").attr("class","page-group");this.tileSources.forEach((function(r,a){var s=i.calculateCanvasGroupPosition({canvasGroupIndex:a,canvasSource:r,previousCanvasGroupPosition:t[a-1],viewingDirection:e.manifest.viewingDirection},e.rotation);t.push(s);var c=Ne.create(r).getTileSource(r);e.zone.runOutsideAngular((function(){var t;t=90===e.rotation||270===e.rotation?new OpenSeadragon.Rect(s.x+(s.width-s.height)/2,s.y-(s.width-s.height)/2,s.height,s.width):new OpenSeadragon.Rect(s.x,s.y,s.width,s.height),e.viewer.addTiledImage({index:a,tileSource:c,fitBounds:t,degrees:e.rotation})})),n&&a%2!=0&&(o=e.svgNode.append("g").attr("class","page-group"));var u=o.append("rect").attr("x",s.x).attr("y",s.y).attr("width",s.width).attr("height",s.height).attr("class","tile");if(n)if(a%2==0&&0!==a){var l=Number(2*s.width+s.height)+", "+2*s.width;u.style("stroke-dasharray",l)}else if(a%2!=0&&0!==a){var h=s.width+", "+s.height+", "+Number(2*s.width+s.height);u.style("stroke-dasharray",h)}var p=u.node();e.overlays[a]=p}));var r=this.viewerLayoutService.layout!==R.ONE_PAGE&&this.isManifestPaged?R.TWO_PAGE:R.ONE_PAGE;this.canvasService.addAll(t,r)},o.prototype.initialCanvasGroupLoaded=function(){this.home(),this.canvasGroupMask.initialise(this.canvasService.getCurrentCanvasGroupRect(),this.modeService.mode!==e.MimeViewerMode.DASHBOARD),n.select(this.viewer.container.parentNode).transition().duration(te.transitions.OSDAnimationTime).style("opacity","1")},o.prototype.getOverlayIndexFromClickEvent=function(e){if(this.isCanvasGroupHit(e)){var t=this.overlays.indexOf(e);if(t>=0)return t}return-1},o.prototype.getOptions=function(){var e=new Oe;return e.ajaxWithCredentials=this.config.withCredentials,e.loadTilesWithAjax=this.config.loadTilesWithAjax,e.crossOriginPolicy=this.config.crossOriginPolicy,e.ajaxHeaders=this.config.ajaxHeaders,e},o.prototype.calculateCurrentCanvasGroup=function(e){if(e){var t=this.canvasService.findClosestCanvasGroupIndex(e);this.currentCanvasIndex.next(t)}},o.prototype.swipeToCanvasGroup=function(t){if(!this.pinchStatus.active){var i,n,o=t.speed,r=t.position,a=this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED,s=this.canvasService.getCurrentCanvasGroupRect(),c=this.getViewportBounds(),u=Fe.getSwipeDirection(this.dragStartPosition,r,a),l=this.canvasService.currentCanvasGroupIndex,h=ke.create(this.modeService.mode);this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED&&(i=Fe.getSideIfPanningPastEndOfCanvasGroup(s,c),this.swipeDragEndCounter.addHit(i,u),n=this.swipeDragEndCounter.hitCountReached());var p=h.calculateNextCanvasGroup({currentCanvasGroupCenter:this.currentCanvasIndex.getValue(),speed:o,direction:u,currentCanvasGroupIndex:l,canvasGroupEndHitCountReached:n,viewingDirection:this.manifest.viewingDirection});(this.modeService.mode===e.MimeViewerMode.DASHBOARD||this.modeService.mode===e.MimeViewerMode.PAGE||n&&u)&&this.goToCanvasGroupStrategy.goToCanvasGroup({canvasGroupIndex:p,immediately:!1,direction:u})}},o.prototype.getViewportBounds=function(){return this.viewer.viewport.getBounds()},o.ctorParameters=function(){return[{type:t.NgZone},{type:pe},{type:he},{type:ee},{type:Pe},{type:me},{type:He}]},o=H([t.Injectable()],o)}(),qe=function(){function e(){}return e.extractId=function(e){return e["@id"]},e.extracType=function(e){return e["@type"]},e.extractContext=function(e){return e["@context"]},e.extractViewingDirection=function(e){return"left-to-right"===e.viewingDirection?F.LTR:"right-to-left"===e.viewingDirection?F.RTL:void 0},e.findCanvasIndex=function(e,t){var i=-1;return t[0]&&t[0].canvases&&e[0]&&(i=t[0].canvases.findIndex((function(t){return t.id===e[0]}))),i},e}(),We=function(){function e(e){this.sizes=e}return e.prototype.build=function(){var e=[];if(this.sizes)for(var t=0;t<this.sizes.length;t++){var i=this.sizes[t];e.push(new q(i.width,i.height))}return e},e}(),Xe=function(){function e(e){this.tiles=e}return e.prototype.build=function(){var e=[];if(this.tiles)for(var t=0;t<this.tiles.length;t++){var i=this.tiles[t];e.push(new W({width:i.width,scaleFactors:i.scaleFactors}))}return e},e}(),$e=function(){function e(e){this.service=e}return e.prototype.build=function(){return this.service?new Z({id:qe.extractId(this.service),context:qe.extractContext(this.service),protocol:this.service.protocol,width:this.service.width,height:this.service.height,sizes:new We(this.service.sizes).build(),tiles:new Xe(this.service.tiles).build(),profile:this.service.profile,physicalScale:this.service.physicalScale,physicalUnits:this.service.physicalUnits,service:new e(this.service.service).build()}):null},e}(),Ye=function(){function e(e){this.resource=e}return e.prototype.build=function(){return this.resource?new U({id:qe.extractId(this.resource),type:qe.extracType(this.resource),format:this.resource.format,service:new $e(this.resource.service).build(),height:this.resource.height,width:this.resource.width}):null},e}(),Qe=function(){function e(e){this.images=e}return e.prototype.build=function(){var e=[];if(this.images)for(var t=0;t<this.images.length;t++){var i=this.images[t];e.push(new K({id:qe.extractId(i),type:qe.extracType(i),motivation:i.motivation,resource:new Ye(i.resource).build(),on:i.on}))}return e},e}(),Je=function(){function e(e){this.canvases=e}return e.prototype.build=function(){var e=[];if(this.canvases)for(var t=0;t<this.canvases.length;t++){var i=this.canvases[t];e.push(new B({id:qe.extractId(i),type:qe.extracType(i),label:i.label,thumbnail:i.thumbnail,height:i.height,width:i.width,images:new Qe(i.images).build()}))}return e},e}(),et=function(){function e(e){this.sequences=e}return e.prototype.build=function(){var e=[];if(this.sequences)for(var t=0;t<this.sequences.length;t++){var i=this.sequences[t];e.push(new j({id:qe.extractId(i),type:qe.extracType(i),label:i.label,viewingHint:i.viewingHint,canvases:new Je(i.canvases).build()}))}return e},e}(),tt=function(){function e(e){this.metadatas=e}return e.prototype.build=function(){var e=[];if(this.metadatas)for(var t=0;t<this.metadatas.length;t++){var i=this.metadatas[t];e.push(new N(i.label,i.value))}return e},e}(),it=function(){function e(e,t){this.structures=e,this.sequences=t}return e.prototype.build=function(){var e=[];if(this.structures)for(var t=0;t<this.structures.length;t++){var i=this.structures[t];e.push(new X({id:qe.extractId(i),type:qe.extracType(i),label:i.label,canvases:i.canvases,canvasIndex:qe.findCanvasIndex(i.canvases,this.sequences)}))}return e},e}(),nt=function(){function e(e){this.sequences=e}return e.prototype.build=function(){var e=[];if(this.sequences&&this.sequences.length>0)for(var t=this.sequences[0].canvases,i=0;i<t.length;i++){var n=t[i];n&&e.push(n.images[0].resource)}return e},e}(),ot=function(){function e(e){this.data=e}return e.prototype.build=function(){var e=new et(this.data.sequences).build();return new _({context:qe.extractContext(this.data),type:qe.extracType(this.data),id:qe.extractId(this.data),viewingDirection:qe.extractViewingDirection(this.data),label:this.data.label,metadata:new tt(this.data.metadata).build(),license:this.data.license,logo:this.data.logo,attribution:this.data.attribution,service:new $e(this.data.service).build(),sequences:e,structures:new it(this.data.structures,e).build(),tileSource:new nt(this.data.sequences).build(),viewingHint:this.data.viewingHint})},e}(),rt=function(){function e(e,t,n){this.intl=e,this.http=t,this.spinnerService=n,this._currentManifest=new i.BehaviorSubject(null),this._errorMessage=new i.BehaviorSubject(null)}return Object.defineProperty(e.prototype,"currentManifest",{get:function(){return this._currentManifest.asObservable().pipe(w.filter((function(e){return null!==e})),w.distinctUntilChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorMessage",{get:function(){return this._errorMessage.asObservable()},enumerable:!0,configurable:!0}),e.prototype.load=function(e){var t=this;null===e?this._errorMessage.next(this.intl.manifestUriMissingLabel):(this.spinnerService.show(),this.http.get(e).pipe(w.finalize((function(){return t.spinnerService.hide()}))).subscribe((function(e){var i=t.extractData(e);t.isManifestValid(i)?t._currentManifest.next(i):t._errorMessage.next(t.intl.manifestNotValidLabel)}),(function(e){t._errorMessage.next(t.handleError(e))})))},e.prototype.destroy=function(){this.resetCurrentManifest(),this.resetErrorMessage()},e.prototype.resetCurrentManifest=function(){this._currentManifest.next(null)},e.prototype.resetErrorMessage=function(){this._errorMessage.next(null)},e.prototype.extractData=function(e){return new ot(e).build()},e.prototype.isManifestValid=function(e){return e&&e.tileSource&&e.tileSource.length>0},e.prototype.handleError=function(e){return e.error instanceof Object?e.message:e.error},e.ctorParameters=function(){return[{type:I},{type:S.HttpClient},{type:Y}]},e=H([t.Injectable()],e)}(),at=function(){function e(){this.changeSubject=new i.ReplaySubject,this.onchange()}return Object.defineProperty(e.prototype,"onChange",{get:function(){return this.changeSubject.asObservable()},enumerable:!0,configurable:!0}),e.prototype.isEnabled=function(){var e=document;return e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled},e.prototype.isFullscreen=function(){var e=document;return e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement},e.prototype.toggle=function(e){this.isFullscreen()?this.closeFullscreen(e):this.openFullscreen(e)},e.prototype.onchange=function(){var e=this,t=document,i=function(){e.changeSubject.next(!0)};t.fullscreenEnabled?document.addEventListener("fullscreenchange",i):t.webkitFullscreenEnabled?document.addEventListener("webkitfullscreenchange",i):t.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",i):t.msFullscreenEnabled&&document.addEventListener("msfullscreenchange",i)},e.prototype.openFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},e.prototype.closeFullscreen=function(e){var t=document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen?t.webkitExitFullscreen():t.msExitFullscreen&&t.msExitFullscreen()},e=H([t.Injectable()],e)}(),st=function(){function e(e){this.fullscreen=e}return e.prototype.getBoundingClientRect=function(e){try{return this.isDocumentInFullScreenMode()&&"MIME-VIEWER"===e.nativeElement.nodeName?this.createFullscreenDimensions(e):this.createDimensions(e)}catch(e){return new je}},e.prototype.isDocumentInFullScreenMode=function(){return this.fullscreen.isFullscreen()},e.prototype.toggleFullscreen=function(){var e=document.getElementById("mimeViewer");this.fullscreen.isEnabled()&&this.fullscreen.toggle(e)},e.prototype.setFocusOnViewer=function(){var e=document.getElementById("mimeViewer");e&&e.focus()},e.prototype.createFullscreenDimensions=function(e){var t=e.nativeElement.getBoundingClientRect(),i=this.getFullscreenWidth(),n=this.getFullscreenHeight();return new je(M(M({},t),{top:0,bottom:n,width:i,height:n,left:0,right:i}))},e.prototype.createDimensions=function(e){var t=e.nativeElement.getBoundingClientRect();return new je({top:t.top,bottom:t.bottom,width:t.width,height:t.height,left:t.left,right:t.right})},e.prototype.getFullscreenWidth=function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},e.prototype.getFullscreenHeight=function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},e.ctorParameters=function(){return[{type:at}]},e=H([t.Injectable()],e)}(),ct=function(){function e(e){this.mimeDomHelper=e,this.resizeSubject=new i.ReplaySubject,this.dimensions=new je}return Object.defineProperty(e.prototype,"el",{get:function(){return this._el},set:function(e){this._el=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onResize",{get:function(){return this.resizeSubject.asObservable()},enumerable:!0,configurable:!0}),e.prototype.markForCheck=function(){var e=this.mimeDomHelper.getBoundingClientRect(this.el);this.dimensions.bottom===e.bottom&&this.dimensions.height===e.height&&this.dimensions.left===e.left&&this.dimensions.right===e.right&&this.dimensions.top===e.top&&this.dimensions.width===e.width||(this.dimensions=e,this.resizeSubject.next(M({},this.dimensions)))},e.ctorParameters=function(){return[{type:st}]},e=H([t.Injectable()],e)}(),ut=function(){function e(e,t,n,o,r,a,s,c){this.dialogRef=e,this.intl=t,this.mediaObserver=n,this.mimeResizeService=o,this.iiifManifestService=r,this.iiifContentSearchService=a,this.el=s,this.mimeDomHelper=c,this.hits=[],this.currentSearch="",this.numberOfHits=0,this.isSearching=!1,this.tabHeight={},this.mimeHeight=0,this.destroyed=new i.Subject}return e.prototype.ngOnInit=function(){var e=this;this.mimeResizeService.onResize.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.mimeHeight=t.height,e.resizeTabHeight()})),this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.manifest=t})),this.iiifContentSearchService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.hits=t.hits,e.currentSearch=t.q?t.q:"",e.q=t.q,e.numberOfHits=t.size(),null!==e.resultContainer&&e.numberOfHits>0?e.resultContainer.nativeElement.focus():0!==e.q.length&&0!==e.numberOfHits||e.qEl.nativeElement.focus()})),this.iiifContentSearchService.isSearching.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.isSearching=t})),this.iiifContentSearchService.onSelected.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){null===t?e.currentHit=t:e.currentHit&&e.currentHit.id===t.id||(e.currentHit=t,e.scrollCurrentHitIntoView())})),this.resizeTabHeight()},e.prototype.ngAfterViewInit=function(){this.scrollCurrentHitIntoView()},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.onResize=function(e){this.resizeTabHeight()},e.prototype.onSubmit=function(e){e.preventDefault(),this.search()},e.prototype.clear=function(){this.q="",this.search()},e.prototype.goToHit=function(e){this.currentHit=e,this.iiifContentSearchService.selected(e),this.mediaObserver.isActive("lt-md")&&this.dialogRef.close()},e.prototype.search=function(){this.currentSearch=this.q,this.iiifContentSearchService.search(this.manifest,this.q)},e.prototype.resizeTabHeight=function(){this.mimeDomHelper.getBoundingClientRect(this.el);var e=this.mimeHeight;this.mediaObserver.isActive("lt-md")?this.tabHeight={maxHeight:window.innerHeight-128+"px"}:(e-=272,this.tabHeight={maxHeight:e+"px"})},e.prototype.scrollCurrentHitIntoView=function(){var e=this;this.iiifContentSearchService.onSelected.pipe(w.take(1),w.filter((function(e){return null!==e}))).subscribe((function(t){var i=e.findSelected(t);i&&i.nativeElement.focus()}))},e.prototype.findSelected=function(e){if(this.hitList){var t=this.hitList.filter((function(t,i){return i===e.id}));return t.length>0?t[0]:null}return null},e.ctorParameters=function(){return[{type:l.MatDialogRef},{type:I},{type:s.MediaObserver},{type:ct},{type:rt},{type:me},{type:t.ElementRef},{type:st}]},H([t.ViewChild("contentSearchResult",{static:!0})],e.prototype,"resultContainer",void 0),H([t.ViewChild("query",{static:!0})],e.prototype,"qEl",void 0),H([t.ViewChildren("hitButton",{read:t.ElementRef})],e.prototype,"hitList",void 0),H([t.HostListener("window:resize",["$event"])],e.prototype,"onResize",null),e=H([t.Component({selector:"mime-search",template:'<div class="content-search-container">\n  <div [ngSwitch]="mediaObserver.isActive(\'lt-md\')">\n    <div *ngSwitchCase="true">\n      <mat-toolbar color="primary">\n        <div fxLayout="row" fxLayoutAlign="start center">\n          <button\n            id="close-content-search-dialog-button"\n            mat-icon-button\n            [aria-label]="intl.closeLabel"\n            [matTooltip]="intl.closeLabel"\n            [matDialogClose]="true"\n          >\n            <mat-icon>close</mat-icon>\n          </button>\n          <div class="heading">{{ intl.searchLabel }}</div>\n        </div>\n      </mat-toolbar>\n    </div>\n    <div *ngSwitchDefault>\n      <mat-toolbar>\n        <div fxLayout="row" fxLayoutAlign="space-between center" fxFlex>\n          <div class="heading heading-desktop">{{ intl.searchLabel }}</div>\n          <button\n            id="close-content-search-dialog-button"\n            mat-icon-button\n            [aria-label]="intl.closeLabel"\n            [matTooltip]="intl.closeLabel"\n            [matDialogClose]="true"\n          >\n            <mat-icon>close</mat-icon>\n          </button>\n        </div>\n      </mat-toolbar>\n    </div>\n  </div>\n  <div class="content-search-form">\n    <form (ngSubmit)="onSubmit($event)" #searchForm="ngForm">\n      <mat-form-field class="content-search-box">\n        <button\n          id="content-search-form-submit"\n          type="submit"\n          matPrefix\n          mat-icon-button\n          [attr.aria-label]="intl.searchLabel"\n          [matTooltip]="intl.searchLabel"\n        >\n          <mat-icon class="icon">search</mat-icon>\n        </button>\n        <input\n          #query\n          cdkFocusInitial\n          matInput\n          class="content-search-input"\n          [(ngModel)]="q"\n          name="q"\n          autocomplete="off"\n          aria-labelledby="content-search-form-submit"\n        />\n        <button\n          *ngIf="q"\n          id="clearSearchButton"\n          type="button"\n          matSuffix\n          mat-icon-button\n          [attr.aria-label]="intl.clearSearchLabel"\n          [matTooltip]="intl.clearSearchLabel"\n          (click)="clear()"\n        >\n          <mat-icon class="icon">clear</mat-icon>\n        </button>\n      </mat-form-field>\n    </form>\n  </div>\n  <div\n    #contentSearchResult\n    class="content-search-result-container"\n    [ngStyle]="tabHeight"\n  >\n    <div *ngIf="!isSearching" class="content-search-result" fxLayout="column">\n      <input type="hidden" id="numberOfHits" [value]="numberOfHits" />\n      <div *ngIf="currentSearch && currentSearch.length > 0">\n        <div\n          *ngIf="numberOfHits > 0"\n          [innerHTML]="intl.resultsFoundLabel(numberOfHits, currentSearch)"\n        ></div>\n        <div\n          *ngIf="numberOfHits === 0"\n          [innerHTML]="intl.noResultsFoundLabel(currentSearch)"\n        ></div>\n      </div>\n      <ng-container *ngFor="let hit of hits; let last = last">\n        <button\n          #hitButton\n          mat-button\n          [color]="currentHit && hit.id === currentHit.id ? \'primary\' : null"\n          [ngClass]="\'hit\'"\n          (click)="goToHit(hit)"\n          (keyup.enter)="goToHit(hit)"\n        >\n          <div fxLayout="row" fxLayoutAlign="space-between start">\n            <div fxFlex class="summary">\n              {{ hit.before }} <em>{{ hit.match }}</em> {{ hit.after }}\n            </div>\n            <div fxFlex="40px" class="canvasGroup">{{ hit.index + 1 }}</div>\n          </div>\n        </button>\n        <mat-divider *ngIf="!last"></mat-divider>\n      </ng-container>\n    </div>\n    <div *ngIf="isSearching" class="content-search-result" fxLayout="column">\n      <mat-progress-bar mode="indeterminate"></mat-progress-bar>\n    </div>\n  </div>\n</div>\n',styles:[".heading{font-size:17px}.heading-desktop{padding-left:16px}.label{text-decoration:underline}.content-search-form{padding:0 16px}.content-search-box{width:100%}.content-search-input{font-size:20px}.content-search-result-container{font-family:Roboto,'Helvetica Neue',sans-serif;overflow:auto;margin-bottom:8px}.content-search-result{padding:8px 16px}.content-search-result .mat-button{line-height:initial;white-space:initial;word-wrap:initial;max-width:none;padding:8px;text-align:left;font-size:14px}::ng-deep .content-search-container .current-content-search{font-weight:700}em{font-weight:700}.canvasGroupLabel{text-align:right;opacity:.54}::ng-deep .content-search-panel{max-width:none!important}::ng-deep .content-search-panel>.mat-dialog-container{padding:0!important;overflow:initial}::ng-deep .content-search-container>div>div>.mat-toolbar{padding:0!important}input{font-family:Roboto,'Helvetica Neue',sans-serif}.icon{font-size:22px!important}"]})],e)}(),lt=function(){function e(){}return e.prototype.getConfig=function(e){return{hasBackdrop:!1,disableClose:!1,autoFocus:!1,width:"100%",height:"100%",panelClass:"content-search-panel"}},e}(),ht=function(){function e(e){this.mimeDomHelper=e}return e.prototype.getConfig=function(t){var i=this.getPosition(t);return{hasBackdrop:!1,disableClose:!1,autoFocus:!1,width:e.dialogWidth+"px",position:{top:i.top+"px",left:i.left+"px"},panelClass:"content-search-panel"}},e.prototype.getPosition=function(t){var i=this.mimeDomHelper.getBoundingClientRect(t);return new je({top:i.top+64,left:i.right-e.dialogWidth-e.paddingRight})},e.dialogWidth=350,e.paddingRight=20,e}(),pt=function(){function e(e,t){this.mediaObserver=e,this.mimeDomHelper=t}return e.prototype.create=function(){return this.mediaObserver.isActive("lt-md")?new lt:new ht(this.mimeDomHelper)},e.ctorParameters=function(){return[{type:s.MediaObserver},{type:st}]},e=H([t.Injectable()],e)}(),dt=function(){function e(e,t,n){this.dialog=e,this.contentSearchDialogConfigStrategyFactory=t,this.mimeResizeService=n,this.isContentSearchDialogOpen=!1,this.destroyed=new i.Subject}return e.prototype.initialize=function(){var e=this;this.mimeResizeService.onResize.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){if(e.isContentSearchDialogOpen){var i=e.getDialogConfig();e.dialogRef.updatePosition(i.position),e.dialogRef.updateSize(i.width,i.height)}}))},e.prototype.destroy=function(){this.close(),this.destroyed.next()},Object.defineProperty(e.prototype,"el",{set:function(e){this._el=e},enumerable:!0,configurable:!0}),e.prototype.open=function(){var e=this;if(!this.isContentSearchDialogOpen){var t=this.getDialogConfig();this.dialogRef=this.dialog.open(ut,t),this.dialogRef.afterClosed().subscribe((function(t){e.isContentSearchDialogOpen=!1})),this.isContentSearchDialogOpen=!0}},e.prototype.close=function(){this.dialogRef&&this.dialogRef.close(),this.isContentSearchDialogOpen=!1},e.prototype.toggle=function(){this.isContentSearchDialogOpen?this.close():this.open()},e.prototype.isOpen=function(){return this.isContentSearchDialogOpen},e.prototype.getDialogConfig=function(){return this.contentSearchDialogConfigStrategyFactory.create().getConfig(this._el)},e.ctorParameters=function(){return[{type:l.MatDialog},{type:pt},{type:ct}]},e=H([t.Injectable()],e)}(),gt=function(){function e(e,t,n,o,r,a,s,c){var u=this;this.intl=e,this.mediaObserver=t,this.dialogRef=n,this.el=o,this.mimeDomHelper=r,this.changeDetectorRef=a,this.iiifManifestService=s,this.tabHeight={},this.showToc=!1,this.selectedIndex=0,this.mimeHeight=0,this.destroyed=new i.Subject,c.onResize.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){u.mimeHeight=e.height,u.resizeTabHeight()}))}return e.prototype.ngOnInit=function(){var e=this;this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.manifest=t,e.showToc=e.manifest&&e.manifest.structures.length>0,e.changeDetectorRef.detectChanges()})),this.resizeTabHeight()},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.onResize=function(e){this.resizeTabHeight()},e.prototype.onCanvasChanged=function(){this.mediaObserver.isActive("lt-md")&&this.dialogRef.close()},e.prototype.resizeTabHeight=function(){this.mimeDomHelper.getBoundingClientRect(this.el);var e=this.mimeHeight;this.mediaObserver.isActive("lt-md")?(e-=104,this.tabHeight={maxHeight:window.innerHeight-128+"px"}):(e-=278,this.tabHeight={maxHeight:e+"px"})},e.ctorParameters=function(){return[{type:I},{type:s.MediaObserver},{type:l.MatDialogRef},{type:t.ElementRef},{type:st},{type:t.ChangeDetectorRef},{type:rt},{type:ct}]},H([t.HostListener("window:resize",["$event"])],e.prototype,"onResize",null),e=H([t.Component({selector:"mime-contents",template:'<div class="contents-container">\n  <ng-container [ngSwitch]="mediaObserver.isActive(\'lt-md\')">\n    <ng-container *ngSwitchCase="true">\n      <mat-toolbar color="primary" data-test-id="mobile-toolbar">\n        <div fxLayout="row" fxLayoutAlign="start center">\n          <button\n            mat-icon-button\n            [aria-label]="intl.closeLabel"\n            [matTooltip]="intl.closeLabel"\n            [matDialogClose]="true"\n          >\n            <mat-icon>close</mat-icon>\n          </button>\n          <h1 mat-dialog-title>{{ intl.contentsLabel }}</h1>\n        </div>\n      </mat-toolbar>\n    </ng-container>\n    <ng-container *ngSwitchDefault>\n      <mat-toolbar data-test-id="desktop-toolbar">\n        <div fxLayout="row" fxLayoutAlign="space-between center" fxFlex>\n          <h1 mat-dialog-title>{{ intl.contentsLabel }}</h1>\n          <button\n            mat-icon-button\n            [aria-label]="intl.closeLabel"\n            [matTooltip]="intl.closeLabel"\n            [matDialogClose]="true"\n          >\n            <mat-icon>close</mat-icon>\n          </button>\n        </div>\n      </mat-toolbar>\n    </ng-container>\n  </ng-container>\n  <div mat-dialog-content>\n    <mat-tab-group [(selectedIndex)]="selectedIndex">\n      <mat-tab [label]="intl.metadataLabel">\n        <div class="tab-container" [ngStyle]="tabHeight">\n          <mime-metadata></mime-metadata>\n        </div>\n      </mat-tab>\n      <mat-tab *ngIf="showToc" [label]="intl.tocLabel">\n        <div class="tab-container" [ngStyle]="tabHeight">\n          <mime-toc (canvasChanged)="onCanvasChanged()"></mime-toc>\n        </div>\n      </mat-tab>\n    </mat-tab-group>\n  </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".label{text-decoration:underline}::ng-deep .contents-panel{max-width:none!important}::ng-deep .contents-panel>.mat-dialog-container{padding:0!important;overflow:initial}::ng-deep .contents-container>div>div>.mat-toolbar{padding:0!important}.tab-container{overflow:auto;padding:8px 16px}.mat-dialog-content{max-height:none}"]})],e)}(),vt=function(){function e(){}return e.prototype.getConfig=function(e){return{hasBackdrop:!1,disableClose:!1,width:"100%",height:"100%",panelClass:"contents-panel"}},e}(),ft=function(){function e(e){this.mimeDomHelper=e}return e.prototype.getConfig=function(t){var i=this.getPosition(t);return{hasBackdrop:!1,disableClose:!1,width:e.dialogWidth+"px",position:{top:i.top+"px",left:i.left+"px"},panelClass:"contents-panel"}},e.prototype.getPosition=function(t){var i=this.mimeDomHelper.getBoundingClientRect(t);return new je({top:i.top+64,left:i.right-e.dialogWidth-e.paddingRight})},e.dialogWidth=350,e.paddingRight=20,e}(),mt=function(){function e(e,t){this.mediaObserver=e,this.mimeDomHelper=t}return e.prototype.create=function(){return this.mediaObserver.isActive("lt-md")?new vt:new ft(this.mimeDomHelper)},e.ctorParameters=function(){return[{type:s.MediaObserver},{type:st}]},e=H([t.Injectable()],e)}(),yt=function(){function e(e,t,n){this.dialog=e,this.contentsDialogConfigStrategyFactory=t,this.mimeResizeService=n,this.isContentsDialogOpen=!1,this.destroyed=new i.Subject}return e.prototype.initialize=function(){var e=this;this.mimeResizeService.onResize.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){if(e.isContentsDialogOpen){var i=e.getDialogConfig();e.dialogRef.updatePosition(i.position),e.dialogRef.updateSize(i.width,i.height)}}))},e.prototype.destroy=function(){this.close(),this.destroyed.next()},Object.defineProperty(e.prototype,"el",{set:function(e){this._el=e},enumerable:!0,configurable:!0}),e.prototype.open=function(e){var t=this;if(!this.isContentsDialogOpen){var i=this.getDialogConfig();this.dialogRef=this.dialog.open(gt,i),e&&(this.dialogRef.componentInstance.selectedIndex=e),this.dialogRef.afterClosed().subscribe((function(e){t.isContentsDialogOpen=!1})),this.isContentsDialogOpen=!0}},e.prototype.close=function(){this.dialogRef&&(this.dialogRef.close(),this.isContentsDialogOpen=!1),this.isContentsDialogOpen=!1},e.prototype.toggle=function(){this.isContentsDialogOpen?this.close():this.open()},e.prototype.isOpen=function(){return this.isContentsDialogOpen},e.prototype.getSelectedIndex=function(){return this.dialogRef&&this.dialogRef.componentInstance?this.dialogRef.componentInstance.selectedIndex:0},e.prototype.getDialogConfig=function(){return this.contentsDialogConfigStrategyFactory.create().getConfig(this._el)},e.ctorParameters=function(){return[{type:l.MatDialog},{type:mt},{type:ct}]},e=H([t.Injectable()],e)}(),bt=function(){function e(e){this.altKey=!1,this.shiftKey=!1,this.ctrlkey=!1,this.keyCode=e.keyCode,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.ctrlkey=e.ctrlKey}return e.prototype.isArrowRightKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.ARROWRIGHT)},e.prototype.isArrowLeftKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.ARROWLEFT)},e.prototype.isPageUpKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.PAGEUP)},e.prototype.isPageDownKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.PAGEDOWN)},e.prototype.isFirstCanvasGroupKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.firstCanvasGroupCodes)},e.prototype.isLastCanvasGroupKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.lastCanvasGroupCodes)},e.prototype.isSliderKeys=function(){return this.isArrowLeftKeys()||this.isArrowRightKeys()||this.isPageDownKeys()||this.isPageUpKeys()||this.isFirstCanvasGroupKeys()||this.isLastCanvasGroupKeys()},e.prototype.isZoomInKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.zoomInCodes)},e.prototype.isZoomOutKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.zoomOutCodes)},e.prototype.isZoomHomeKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.zoomHomeCodes)},e.prototype.isNextHitKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.nextHit)},e.prototype.isPreviousHitKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.previousHit)},e.prototype.isSearchDialogKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.toggleSearchDialogCodes)},e.prototype.isContentsDialogKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.toggleContentsDialogCodes)},e.prototype.isFullscreenKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.toggleFullscreenCodes)},e.prototype.isResetSearchKeys=function(){return this.isShiftPressed()&&this.arrayContainsKeys(e.resetSearch)},e.prototype.isRotateKeys=function(){return!this.isMultiKeys()&&this.arrayContainsKeys(e.rotateCwCodes)},e.prototype.isMultiKeys=function(){return this.altKey||this.shiftKey||this.ctrlkey},e.prototype.arrayContainsKeys=function(e){return e.indexOf(this.keyCode)>-1},e.prototype.isShiftPressed=function(){return this.shiftKey},e.PAGEDOWN=[34],e.PAGEUP=[33],e.ARROWRIGHT=[39],e.ARROWLEFT=[37],e.firstCanvasGroupCodes=[36],e.lastCanvasGroupCodes=[35],e.zoomInCodes=[107,187,171],e.zoomOutCodes=[109,189,173],e.zoomHomeCodes=[96,48],e.nextHit=[78],e.previousHit=[80],e.toggleSearchDialogCodes=[83],e.toggleContentsDialogCodes=[67],e.toggleFullscreenCodes=[70],e.resetSearch=[83],e.rotateCwCodes=[82],e}(),Ct=function(){function e(e,t){var i=this;this.canvasService=e,this.iiifContentSearchService=t,this.currentIndex=0,this.isHitOnActiveCanvasGroup=!1,this._isFirstHitOnCanvasGroup=!1,this._isLastHitOnCanvasGroup=!1,this.canvasesPerCanvasGroup=[-1],this.iiifContentSearchService.onChange.subscribe((function(e){i.searchResult=e}))}return e.prototype.update=function(e){this.canvasesPerCanvasGroup=this.canvasService.getCanvasesPerCanvasGroup(e),this.currentIndex=this.findCurrentHitIndex(this.canvasesPerCanvasGroup),this.isHitOnActiveCanvasGroup=this.findHitOnActiveCanvasGroup(),this._isFirstHitOnCanvasGroup=this.isFirstHitOnCanvasGroup(),this._isLastHitOnCanvasGroup=this.findLastHitOnCanvasGroup()},e.prototype.getCurrentIndex=function(){return this.currentIndex},e.prototype.getHitOnActiveCanvasGroup=function(){return this.isHitOnActiveCanvasGroup},e.prototype.getFirstHitCanvasGroup=function(){return this._isFirstHitOnCanvasGroup},e.prototype.getLastHitCanvasGroup=function(){return this._isLastHitOnCanvasGroup},e.prototype.goToNextCanvasGroupHit=function(){if(!this._isLastHitOnCanvasGroup){var e=void 0;if(-1===this.currentIndex)e=this.searchResult.get(0);else{var t=this.searchResult.get(this.currentIndex),i=this.canvasService.findCanvasGroupByCanvasIndex(t.index),n=this.canvasService.getCanvasesPerCanvasGroup(i),o=this.getLastCanvasGroupIndex(n);e=this.searchResult.hits.find((function(e){return e.index>o}))}e&&this.goToCanvasIndex(e)}},e.prototype.goToPreviousCanvasGroupHit=function(){var e=this.isHitOnActiveCanvasGroup?this.currentIndex-1:this.currentIndex,t=this.findFirstHitOnCanvasGroup(e);this.goToCanvasIndex(t)},e.prototype.goToCanvasIndex=function(e){this.currentIndex=this.findCurrentHitIndex([e.index]),this.iiifContentSearchService.selected(e)},e.prototype.findLastHitOnCanvasGroup=function(){var e=this.searchResult.get(this.searchResult.size()-1).index;return this.searchResult.get(this.currentIndex).index===e},e.prototype.findFirstHitOnCanvasGroup=function(e){var t=this.searchResult.get(e),i=this.canvasService.findCanvasGroupByCanvasIndex(t.index),n=this.canvasService.getCanvasesPerCanvasGroup(i),o=n[0],r=this.searchResult.hits.find((function(e){return e.index===o}));if(r)t=r;else if(2===n.length){var a=n[1];t=this.searchResult.hits.find((function(e){return e.index===a}))}return t},e.prototype.findHitOnActiveCanvasGroup=function(){return this.canvasesPerCanvasGroup.indexOf(this.searchResult.get(this.currentIndex).index)>=0},e.prototype.findCurrentHitIndex=function(e){for(var t=function(t){var n=i.searchResult.get(t);if(e.indexOf(n.index)>=0)return{value:t};if(n.index>=e[e.length-1]){if(0===t)return{value:-1};var o=i.searchResult.get(t-1);return{value:i.searchResult.hits.findIndex((function(e){return e.index===o.index}))}}},i=this,n=0;n<this.searchResult.size();n++){var o=t(n);if("object"==typeof o)return o.value}return this.searchResult.size()-1},e.prototype.isFirstHitOnCanvasGroup=function(){return this.currentIndex<=0},e.prototype.getLastCanvasGroupIndex=function(e){return 1===e.length?e[0]:e[1]},e.ctorParameters=function(){return[{type:he},{type:me}]},e=H([t.Injectable()],e)}(),wt=function(){function n(e,t,n,o,r,a,s,c,u){var l=this;this.viewerService=e,this.canvasService=t,this.modeService=n,this.iiifManifestService=o,this.iiifContentSearchService=r,this.contentSearchDialogService=a,this.contentsDialogService=s,this.mimeDomHelper=c,this.contentSearchNavigationService=u,this.isSearchable=!1,this.hasHits=!1,this.disabledKeys=[],this.destroyed=new i.Subject,this.invert=!1,this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){l.isSearchable=l.isManifestSearchable(e),l.invert=e.viewingDirection===F.RTL})),this.iiifContentSearchService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){l.hasHits=e.hits.length>0}))}return n.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},n.prototype.handleKeyEvents=function(e){var t=new bt(e);this.isKeyDisabled(e.keyCode)||(t.isArrowLeftKeys()?this.isZoomedIn()||(this.invert?this.goToNextCanvasGroup():this.goToPreviousCanvasGroup()):t.isArrowRightKeys()?this.isZoomedIn()||(this.invert?this.goToPreviousCanvasGroup():this.goToNextCanvasGroup()):t.isFirstCanvasGroupKeys()?this.goToFirstCanvasGroup():t.isLastCanvasGroupKeys()?this.goToLastCanvasGroup():t.isNextHitKeys()&&this.hasHits?this.goToNextHit():t.isPreviousHitKeys()&&this.hasHits?this.goToPreviousHit():t.isFullscreenKeys()?this.toggleFullscreen():t.isSearchDialogKeys()&&this.isSearchable?this.toggleSearchDialog():t.isContentsDialogKeys()?this.toggleContentsDialog():t.isResetSearchKeys()?this.resetSearch():t.isPageDownKeys()?this.goToNextCanvasGroup():t.isPageUpKeys()?this.goToPreviousCanvasGroup():t.isZoomInKeys()?this.zoomIn():t.isZoomOutKeys()?this.zoomOut():t.isZoomHomeKeys()?this.zoomHome():t.isRotateKeys()&&this.rotateClockWise())},n.prototype.goToNextCanvasGroup=function(){this.viewerService.goToNextCanvasGroup()},n.prototype.goToPreviousCanvasGroup=function(){this.viewerService.goToPreviousCanvasGroup()},n.prototype.goToFirstCanvasGroup=function(){this.viewerService.goToCanvasGroup(0,!1)},n.prototype.goToLastCanvasGroup=function(){this.viewerService.goToCanvasGroup(this.canvasService.numberOfCanvasGroups-1,!1)},n.prototype.rotateClockWise=function(){this.viewerService.rotate(),this.mimeDomHelper.setFocusOnViewer()},n.prototype.goToNextHit=function(){this.contentSearchNavigationService.goToNextCanvasGroupHit()},n.prototype.goToPreviousHit=function(){this.contentSearchNavigationService.goToPreviousCanvasGroupHit()},n.prototype.zoomIn=function(){this.modeService.mode===e.MimeViewerMode.DASHBOARD?this.modeService.toggleMode():this.viewerService.zoomIn()},n.prototype.zoomOut=function(){this.modeService.mode===e.MimeViewerMode.PAGE?this.modeService.toggleMode():this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED&&this.viewerService.zoomOut()},n.prototype.zoomHome=function(){this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED&&this.viewerService.home()},n.prototype.toggleSearchDialog=function(){this.modeService.mode===e.MimeViewerMode.PAGE||this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED?(this.modeService.mode=e.MimeViewerMode.DASHBOARD,this.contentSearchDialogService.open()):this.contentSearchDialogService.isOpen()?this.contentSearchDialogService.close():this.contentSearchDialogService.open(),this.contentsDialogService.close()},n.prototype.toggleContentsDialog=function(){this.modeService.mode===e.MimeViewerMode.PAGE||this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED?(this.modeService.mode=e.MimeViewerMode.DASHBOARD,this.contentsDialogService.open()):this.contentsDialogService.isOpen()?this.contentsDialogService.close():this.contentsDialogService.open(),this.contentSearchDialogService.close()},n.prototype.toggleFullscreen=function(){this.mimeDomHelper.toggleFullscreen(),this.mimeDomHelper.setFocusOnViewer()},n.prototype.resetSearch=function(){this.iiifContentSearchService.destroy()},n.prototype.isManifestSearchable=function(e){return!!e.service},n.prototype.isZoomedIn=function(){return this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED},n.prototype.updateDisabledKeys=function(){this.resetDisabledKeys(),this.contentsDialogService.isOpen()?this.disableKeysForContentDialog():this.contentSearchDialogService.isOpen()&&this.diableKeysForContentSearchDialog()},n.prototype.disableKeysForContentDialog=function(){this.disabledKeys=this.disabledKeys.concat(bt.ARROWLEFT).concat(bt.ARROWRIGHT)},n.prototype.diableKeysForContentSearchDialog=function(){this.disabledKeys=this.disabledKeys.concat(bt.ARROWLEFT).concat(bt.ARROWRIGHT).concat(bt.firstCanvasGroupCodes).concat(bt.lastCanvasGroupCodes).concat(bt.zoomInCodes).concat(bt.zoomOutCodes).concat(bt.zoomHomeCodes).concat(bt.nextHit).concat(bt.previousHit).concat(bt.toggleSearchDialogCodes).concat(bt.toggleContentsDialogCodes).concat(bt.toggleFullscreenCodes)},n.prototype.resetDisabledKeys=function(){this.disabledKeys=[]},n.prototype.isKeyDisabled=function(e){return this.updateDisabledKeys(),this.disabledKeys.indexOf(e)>-1},n.ctorParameters=function(){return[{type:Ze},{type:he},{type:ee},{type:rt},{type:me},{type:dt},{type:yt},{type:st},{type:Ct}]},n=H([t.Injectable()],n)}(),St=function(){function e(e){this.mimeDomHelper=e,this.resizeSubject=new i.ReplaySubject,this.dimensions=new je}return Object.defineProperty(e.prototype,"el",{get:function(){return this._el},set:function(e){this._el=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onResize",{get:function(){return this.resizeSubject.asObservable()},enumerable:!0,configurable:!0}),e.prototype.markForCheck=function(){var e=this.mimeDomHelper.getBoundingClientRect(this.el);this.dimensions.bottom===e.bottom&&this.dimensions.height===e.height&&this.dimensions.left===e.left&&this.dimensions.right===e.right&&this.dimensions.top===e.top&&this.dimensions.width===e.width||(this.dimensions=e,this.resizeSubject.next(M({},this.dimensions)))},e.ctorParameters=function(){return[{type:st}]},e=H([t.Injectable()],e)}(),xt=function(){function e(e,t,n,o,r,a,s,c){this.intl=e,this.renderer=t,this.el=n,this.changeDetectorRef=o,this.iiifManifestService=r,this.attributionDialogResizeService=a,this.styleService=s,this.accessKeysHandlerService=c,this.destroyed=new i.Subject,a.el=n}return e.prototype.ngOnInit=function(){var e=this;this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.manifest=t,e.changeDetectorRef.markForCheck()}))},e.prototype.ngAfterViewInit=function(){var e=this;this.styleService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){var i=e.styleService.convertToRgba(t,.3);e.renderer.setStyle(e.container.nativeElement,"background-color",i)}))},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.handleKeys=function(e){this.accessKeysHandlerService.handleKeyEvents(e)},e.prototype.onResize=function(e){this.attributionDialogResizeService.markForCheck()},e.prototype.ngAfterViewChecked=function(){this.attributionDialogResizeService.markForCheck()},e.ctorParameters=function(){return[{type:I},{type:t.Renderer2},{type:t.ElementRef},{type:t.ChangeDetectorRef},{type:rt},{type:St},{type:He},{type:wt}]},H([t.ViewChild("container",{static:!0})],e.prototype,"container",void 0),H([t.HostListener("keyup",["$event"])],e.prototype,"handleKeys",null),H([t.HostListener("window:resize",["$event"])],e.prototype,"onResize",null),e=H([t.Component({template:'<div #container id="attribution-container" class="attribution-container">\n  <mat-toolbar class="attribution-toolbar">\n    <div fxLayout="row" fxLayoutAlign="space-between center" fxFlex>\n      <h1 mat-dialog-title>{{ intl.attributionLabel }}</h1>\n      <button\n        mat-icon-button\n        [aria-label]="intl.attributonCloseAriaLabel"\n        [matTooltip]="intl.closeLabel"\n        [matDialogClose]="true"\n      >\n        <mat-icon>close</mat-icon>\n      </button>\n    </div>\n  </mat-toolbar>\n  <p mat-dialog-content [innerHTML]="manifest?.attribution"> </p>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".attribution-toolbar{font-size:14px;background:0 0;min-height:20px!important;padding:8px}.mat-dialog-title{font-size:16px}.mat-dialog-content{padding:8px;margin:0}::ng-deep .attribution-panel{font-family:Roboto,'Helvetica Neue',sans-serif}::ng-deep .attribution-panel>.mat-dialog-container{background:0 0!important;font-size:11px;padding:0}::ng-deep .attribution-toolbar>.mat-toolbar-layout>.mat-toolbar-row{height:20px}"]})],e)}(),Gt=function(){function e(e,t,n,o){this.dialog=e,this.mimeResizeService=t,this.attributionDialogResizeService=n,this.mimeDomHelper=o,this.isAttributionDialogOpen=!1,this.attributionDialogHeight=0,this.destroyed=new i.Subject}return e.prototype.initialize=function(){var e=this;this.mimeResizeService.onResize.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){if(e.isAttributionDialogOpen){var i=e.getDialogConfig();e.dialogRef.updatePosition(i.position)}})),this.attributionDialogResizeService.onResize.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){if(e.isAttributionDialogOpen){e.attributionDialogHeight=t.height;var i=e.getDialogConfig();e.dialogRef.updatePosition(i.position)}}))},e.prototype.destroy=function(){this.close(),this.destroyed.next()},Object.defineProperty(e.prototype,"el",{set:function(e){this._el=e},enumerable:!0,configurable:!0}),e.prototype.open=function(e){var t=this;this.isAttributionDialogOpen||i.interval(1e3).pipe(w.take(1)).subscribe((function(){var i=t.getDialogConfig();t.dialogRef=t.dialog.open(xt,i),t.dialogRef.afterClosed().subscribe((function(e){t.isAttributionDialogOpen=!1,t.mimeDomHelper.setFocusOnViewer()})),t.isAttributionDialogOpen=!0,t.closeDialogAfter(e)}))},e.prototype.close=function(){this.dialogRef&&(this.dialogRef.close(),this.isAttributionDialogOpen=!1)},e.prototype.toggle=function(){this.isAttributionDialogOpen?this.close():this.open()},e.prototype.closeDialogAfter=function(e){var t=this;e>0&&i.interval(1e3*e).pipe(w.take(1)).subscribe((function(){t.close()}))},e.prototype.getDialogConfig=function(){var e=this.getPosition(this._el);return{hasBackdrop:!1,width:"180px",panelClass:"attribution-panel",position:{top:e.top+"px",left:e.left+"px"},autoFocus:!0,restoreFocus:!1}},e.prototype.getPosition=function(e){var t=this.mimeDomHelper.getBoundingClientRect(e);return new je({top:t.top+t.height-this.attributionDialogHeight-68,left:t.left+20})},e.ctorParameters=function(){return[{type:l.MatDialog},{type:ct},{type:St},{type:st}]},e=H([t.Injectable()],e)}(),Ot=function(){function e(){}return e=H([t.NgModule({imports:[Q],declarations:[xt],providers:[Gt,St,st],entryComponents:[xt]})],e)}(),Dt=function(){function e(e,t,n,o,r,a){this.dialogRef=e,this.fb=t,this.viewerService=n,this.canvasService=o,this.intl=r,this.changeDetectorRef=a,this.destroyed=new i.Subject,this.numberOfCanvases=this.canvasService.numberOfCanvases,this.createForm()}return e.prototype.createForm=function(){this.canvasGroupControl=new a.FormControl("",[a.Validators.required,a.Validators.min(1),a.Validators.max(this.numberOfCanvases)]),this.canvasGroupForm=this.fb.group({canvasGroupControl:this.canvasGroupControl})},e.prototype.ngOnInit=function(){var e=this;this.intl.changes.pipe(w.takeUntil(this.destroyed)).subscribe((function(){return e.changeDetectorRef.markForCheck()}))},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.onSubmit=function(){if(this.canvasGroupForm.valid){var e=this.canvasGroupForm.get("canvasGroupControl").value-1;this.viewerService.goToCanvasGroup(this.canvasService.findCanvasGroupByCanvasIndex(e),!1),this.dialogRef.close()}},e.ctorParameters=function(){return[{type:l.MatDialogRef},{type:a.FormBuilder},{type:Ze},{type:he},{type:I},{type:t.ChangeDetectorRef}]},e=H([t.Component({template:'<div fxLayout="column">\n  <h1 class="canvas-group-dialog-title">{{ intl.goToPageLabel }}</h1>\n  <form\n    [formGroup]="canvasGroupForm"\n    (ngSubmit)="onSubmit()"\n    novalidate\n    autocomplete="off"\n  >\n    <mat-form-field [floatLabel]="\'always\'">\n      <input\n        id="goToCanvasGroupInput"\n        type="number"\n        matInput\n        min="1"\n        [placeholder]="intl.enterPageNumber"\n        formControlName="canvasGroupControl"\n      />\n      <mat-error\n        id="canvasGroupDoesNotExistsError"\n        *ngIf="canvasGroupControl.errors?.max"\n        >{{ intl.pageDoesNotExists }}</mat-error\n      >\n    </mat-form-field>\n    <div fxLayout="row" fxLayoutAlign="end center">\n      <button id="cancelButton" type="button" mat-button matDialogClose>\n        CANCEL\n      </button>\n      <button\n        id="goToCanvasGroupSubmitButton"\n        type="submit"\n        mat-button\n        [disabled]="canvasGroupForm.pristine || canvasGroupForm.invalid"\n      >\n        OK\n      </button>\n    </div>\n  </form>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".canvas-group-dialog-title{margin:0 0 20px;display:block}"]})],e)}(),Mt=function(){function e(e){this.dialog=e,this.isCanvasGroupDialogOpen=!1,this.destroyed=new i.Subject}return e.prototype.initialize=function(){},e.prototype.destroy=function(){this.close(),this.destroyed.next()},e.prototype.open=function(e){var t=this;if(!this.isCanvasGroupDialogOpen){var i=this.getDialogConfig();this.dialogRef=this.dialog.open(Dt,i),this.dialogRef.afterClosed().subscribe((function(e){t.isCanvasGroupDialogOpen=!1})),this.isCanvasGroupDialogOpen=!0}},e.prototype.close=function(){this.dialogRef&&(this.dialogRef.close(),this.isCanvasGroupDialogOpen=!1)},e.prototype.toggle=function(){this.isCanvasGroupDialogOpen?this.close():this.open()},e.prototype.getDialogConfig=function(){return{hasBackdrop:!1,disableClose:!0,panelClass:"canvas-group-panel"}},e.ctorParameters=function(){return[{type:l.MatDialog}]},e=H([t.Injectable()],e)}(),Ht=function(){function e(){}return e=H([t.NgModule({imports:[Q],declarations:[Dt],providers:[Mt],entryComponents:[Dt]})],e)}(),Pt=function(){function e(){}return e=H([t.NgModule({imports:[Q],declarations:[ut],providers:[dt,pt],entryComponents:[ut]})],e)}(),Rt=function(){function e(e,t,n){this.mediaObserver=e,this.intl=t,this.mimeResizeService=n,this.tabHeight={},this.mimeHeight=0,this.destroyed=new i.Subject}return e.prototype.ngOnInit=function(){var e=this;this.mimeResizeService.onResize.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.mimeHeight=t.height,e.resizeTabHeight()})),this.resizeTabHeight()},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.resizeTabHeight=function(){var e=this.mimeHeight;this.mediaObserver.isActive("lt-md")?this.tabHeight={maxHeight:window.innerHeight-128+"px"}:(e-=272,this.tabHeight={maxHeight:e+"px"})},e.ctorParameters=function(){return[{type:s.MediaObserver},{type:I},{type:ct}]},e=H([t.Component({selector:"mime-help",template:'<div id="help-container" class="help-container">\n  <div [ngSwitch]="mediaObserver.isActive(\'lt-md\')">\n    <div *ngSwitchCase="true">\n      <mat-toolbar color="primary">\n        <div fxLayout="row" fxLayoutAlign="start center">\n          <button\n            mat-icon-button\n            [matDialogClose]="true"\n          >\n            <mat-icon>close</mat-icon>\n          </button>\n          <h1 mat-dialog-title>{{intl.help.helpLabel}}</h1>\n        </div>\n      </mat-toolbar>\n    </div>\n    <div *ngSwitchDefault>\n      <mat-toolbar>\n        <div fxLayout="row" fxLayoutAlign="space-between center" fxFlex>\n          <h1 class="heading-desktop" mat-dialog-title>{{intl.help.helpLabel}}</h1>\n          <button\n            mat-icon-button\n            [matDialogClose]="true"\n          >\n            <mat-icon>close</mat-icon>\n          </button>\n        </div>\n      </mat-toolbar>\n    </div>\n  </div>\n  <div [ngStyle]="tabHeight" class="help-content">\n    <p [innerHTML]="intl.help.line1"></p>\n    <p [innerHTML]="intl.help.line2"></p>\n    <p [innerHTML]="intl.help.line3"></p>\n    <p [innerHTML]="intl.help.line4"></p>\n    <p [innerHTML]="intl.help.line5"></p>\n    <p [innerHTML]="intl.help.line6"></p>\n    <p [innerHTML]="intl.help.line7"></p>\n    <p [innerHTML]="intl.help.line8"></p>\n    <p [innerHTML]="intl.help.line9"></p>\n    <p [innerHTML]="intl.help.line10"></p>\n  </div>\n</div>\n',styles:[".help-container{font-family:Roboto,'Helvetica Neue',sans-serif;font-size:14px}.help-content{padding:16px;overflow:auto}::ng-deep .help-panel{max-width:none!important}::ng-deep .help-panel>.mat-dialog-container{padding:0!important;overflow:initial}"]})],e)}(),Lt=function(){function e(){}return e.prototype.getConfig=function(e){return{hasBackdrop:!1,disableClose:!1,autoFocus:!1,width:"100%",height:"100%",panelClass:"help-panel"}},e}(),Tt=function(){function e(e){this.mimeDomHelper=e}return e.prototype.getConfig=function(t){var i=this.getPosition(t);return{hasBackdrop:!1,disableClose:!1,autoFocus:!1,width:e.dialogWidth+"px",position:{top:i.top+"px",left:i.left+"px"},panelClass:"help-panel"}},e.prototype.getPosition=function(t){var i=this.mimeDomHelper.getBoundingClientRect(t);return new je({top:i.top+64,left:i.right-e.dialogWidth-e.paddingRight})},e.dialogWidth=350,e.paddingRight=20,e}(),It=function(){function e(e,t){this.mediaObserver=e,this.mimeDomHelper=t}return e.prototype.create=function(){return this.mediaObserver.isActive("lt-md")?new Lt:new Tt(this.mimeDomHelper)},e.ctorParameters=function(){return[{type:s.MediaObserver},{type:st}]},e=H([t.Injectable()],e)}(),kt=function(){function e(e,t,n){this.dialog=e,this.helpDialogConfigStrategyFactory=t,this.mimeResizeService=n,this.isHelpDialogOpen=!1,this.destroyed=new i.Subject}return e.prototype.initialize=function(){var e=this;this.mimeResizeService.onResize.pipe(w.takeUntil(this.destroyed)).subscribe((function(){if(e.isHelpDialogOpen){var t=e.getDialogConfig();e.dialogRef.updatePosition(t.position),e.dialogRef.updateSize(t.width,t.height)}}))},e.prototype.destroy=function(){this.close(),this.destroyed.next()},Object.defineProperty(e.prototype,"el",{set:function(e){this._el=e},enumerable:!0,configurable:!0}),e.prototype.open=function(){var e=this;if(!this.isHelpDialogOpen){var t=this.getDialogConfig();this.dialogRef=this.dialog.open(Rt,t),this.dialogRef.afterClosed().subscribe((function(){e.isHelpDialogOpen=!1})),this.isHelpDialogOpen=!0}},e.prototype.close=function(){this.dialogRef&&this.dialogRef.close(),this.isHelpDialogOpen=!1},e.prototype.toggle=function(){this.isHelpDialogOpen?this.close():this.open()},e.prototype.isOpen=function(){return this.isHelpDialogOpen},e.prototype.getDialogConfig=function(){return this.helpDialogConfigStrategyFactory.create().getConfig(this._el)},e.ctorParameters=function(){return[{type:l.MatDialog},{type:It},{type:ct}]},e=H([t.Injectable()],e)}(),Et=function(){function e(){}return e=H([t.NgModule({imports:[Q],declarations:[Rt],providers:[kt,It]})],e)}(),zt=function(){function e(e,t,n){this.intl=e,this.changeDetectorRef=t,this.iiifManifestService=n,this.destroyed=new i.Subject}return e.prototype.ngOnInit=function(){var e=this;this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.manifest=t,e.changeDetectorRef.markForCheck()}))},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.ctorParameters=function(){return[{type:I},{type:t.ChangeDetectorRef},{type:rt}]},e=H([t.Component({selector:"mime-metadata",template:'<div id="metadata-container" class="metadata-container">\n  <div *ngFor="let metadata of manifest?.metadata" class="metadata">\n    <div class="title">{{ metadata.label }}</div>\n    <span class="content" [innerHTML]="metadata.value"></span>\n  </div>\n  <div *ngIf="manifest?.attribution">\n    <div class="title">{{ intl.attributionLabel }}</div>\n    <span\n      id="metadata-attribution"\n      class="content attribution"\n      [innerHTML]="manifest?.attribution"\n    ></span>\n  </div>\n  <div *ngIf="manifest?.license">\n    <div class="title">{{ intl.licenseLabel }}</div>\n    <span id="metadata-license" class="content license"\n      ><a [href]="manifest?.license" target="_blank">{{\n        manifest?.license\n      }}</a></span\n    >\n  </div>\n  <div *ngIf="manifest?.logo">\n    <span id="metadata-logo"\n      ><img class="content logo" [src]="manifest?.logo"\n    /></span>\n  </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".title{font-size:14px!important;font-weight:400;margin-bottom:4px}.content{display:block;font-size:12px;word-break:break-all;margin-bottom:8px}.logo{max-width:300px;max-height:64px}"]})],e)}(),At=function(){function e(e,n,o,r,a){this.intl=e,this.changeDetectorRef=n,this.iiifManifestService=o,this.viewerService=r,this.canvasService=a,this.canvasChanged=new t.EventEmitter,this.destroyed=new i.Subject}return e.prototype.ngOnInit=function(){var e=this;this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.manifest=t,e.currentCanvasGroupIndex=e.canvasService.currentCanvasGroupIndex,e.changeDetectorRef.detectChanges()})),this.viewerService.onCanvasGroupIndexChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.currentCanvasGroupIndex=t,e.changeDetectorRef.detectChanges()}))},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.goToCanvas=function(e,t){e.preventDefault(),this.viewerService.goToCanvas(t,!1),this.canvasChanged.emit(t)},e.ctorParameters=function(){return[{type:I},{type:t.ChangeDetectorRef},{type:rt},{type:Ze},{type:he}]},H([t.Output()],e.prototype,"canvasChanged",void 0),e=H([t.Component({selector:"mime-toc",template:'<div id="toc-container" class="toc-container">\n  <div *ngFor="let structure of manifest?.structures">\n    <a\n      href=""\n      class="toc-link"\n      [class.currentCanvasGroup]="\n        currentCanvasGroupIndex === structure.canvasIndex\n      "\n      (click)="goToCanvas($event, structure.canvasIndex)"\n      fxLayout="row"\n      fxLayoutAlign="space-between center"\n    >\n      <span class="label">{{ structure.label }}</span>\n      <span class="canvasGroupIndex">{{ structure.canvasIndex + 1 }}</span>\n    </a>\n  </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".toc-link{text-decoration:none;font-size:14px!important;font-weight:400;margin-bottom:8px}.currentCanvasGroup{font-weight:700}"]})],e)}(),Ft=function(){function e(){}return e=H([t.NgModule({imports:[Q],declarations:[gt,zt,At],providers:[yt,mt,{provide:x.ErrorStateMatcher,useClass:x.ShowOnDirtyErrorStateMatcher}],entryComponents:[gt]})],e)}(),Vt=function(){function e(){}return e=H([t.NgModule({providers:[I,rt,me,ct,at,Ze,pe,he,ee,Y,wt,Pe,Ct,He]})],e)}(),_t=function(){function e(e,t,n,o,r,a,s,c){this.intl=e,this.renderer=t,this.changeDetectorRef=n,this.mimeService=o,this.viewerService=r,this.canvasService=a,this.styleService=s,this.iiifManifestService=c,this.osdToolbarStyle={},this.state="hide",this.invert=!1,this.destroyed=new i.Subject}return Object.defineProperty(e.prototype,"osdToolbarState",{get:function(){return this.state},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.invert=t.viewingDirection===F.LTR,e.changeDetectorRef.detectChanges()})),this.mimeService.onResize.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.osdToolbarStyle={top:t.top+110+"px"},e.changeDetectorRef.detectChanges()})),this.viewerService.onCanvasGroupIndexChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.numberOfCanvasGroups=e.canvasService.numberOfCanvasGroups,e.isFirstCanvasGroup=e.isOnFirstCanvasGroup(t),e.isLastCanvasGroup=e.isOnLastCanvasGroup(t),e.changeDetectorRef.detectChanges()})),this.intl.changes.pipe(w.takeUntil(this.destroyed)).subscribe((function(){return e.changeDetectorRef.markForCheck()}))},e.prototype.ngAfterViewInit=function(){var e=this;this.styleService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){var i=e.styleService.convertToRgba(t,.3);e.renderer.setStyle(e.container.nativeElement,"background-color",i)}))},e.prototype.zoomIn=function(){this.viewerService.zoomIn()},e.prototype.zoomOut=function(){this.viewerService.zoomOut()},e.prototype.home=function(){this.viewerService.home()},e.prototype.rotate=function(){this.viewerService.rotate()},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.goToPreviousCanvasGroup=function(){this.viewerService.goToPreviousCanvasGroup()},e.prototype.goToNextCanvasGroup=function(){this.viewerService.goToNextCanvasGroup()},e.prototype.isOnFirstCanvasGroup=function(e){return 0===e},e.prototype.isOnLastCanvasGroup=function(e){return e===this.numberOfCanvasGroups-1},e.ctorParameters=function(){return[{type:I},{type:t.Renderer2},{type:t.ChangeDetectorRef},{type:ct},{type:Ze},{type:he},{type:He},{type:rt}]},H([t.ViewChild("container",{static:!0})],e.prototype,"container",void 0),H([t.HostBinding("@osdToolbarState")],e.prototype,"osdToolbarState",null),e=H([t.Component({selector:"mime-osd-toolbar",template:'<div #container class="osd-toolbar" [ngStyle]="osdToolbarStyle">\n  <div fxHide fxShow.gt-sm="true">\n    <div\n      class="osd-toolbar-container"\n      fxLayout="column"\n      fxLayoutAlign="center center"\n    >\n      <div class="osd-toolbar-row"> </div>\n      <div class="osd-toolbar-row">\n        <ng-container *ngIf="invert">\n          <button\n            id="navigateBeforeButton"\n            mat-icon-button\n            [attr.aria-label]="intl.previousPageLabel"\n            [matTooltip]="intl.previousPageLabel"\n            [disabled]="isFirstCanvasGroup"\n            (click)="goToPreviousCanvasGroup()"\n          >\n            <mat-icon>navigate_before</mat-icon>\n          </button>\n        </ng-container>\n        <ng-container *ngIf="!invert">\n          <button\n            id="navigateNextButton"\n            mat-icon-button\n            [attr.aria-label]="intl.nextPageLabel"\n            [matTooltip]="intl.nextPageLabel"\n            [disabled]="isLastCanvasGroup"\n            (click)="goToNextCanvasGroup()"\n          >\n            <mat-icon>navigate_before</mat-icon>\n          </button>\n        </ng-container>\n        <button\n          (click)="home()"\n          id="homeButton"\n          mat-icon-button\n          [attr.aria-label]="intl.homeLabel"\n          [matTooltip]="intl.homeLabel"\n        >\n          <mat-icon>home</mat-icon>\n        </button>\n        <ng-container *ngIf="invert">\n          <button\n            id="navigateNextButton"\n            mat-icon-button\n            [attr.aria-label]="intl.nextPageLabel"\n            [matTooltip]="intl.nextPageLabel"\n            [disabled]="isLastCanvasGroup"\n            (click)="goToNextCanvasGroup()"\n          >\n            <mat-icon>navigate_next</mat-icon>\n          </button>\n        </ng-container>\n        <ng-container *ngIf="!invert">\n          <button\n            id="navigateBeforeButton"\n            mat-icon-button\n            [attr.aria-label]="intl.previousPageLabel"\n            [matTooltip]="intl.previousPageLabel"\n            [disabled]="isFirstCanvasGroup"\n            (click)="goToPreviousCanvasGroup()"\n          >\n            <mat-icon>navigate_next</mat-icon>\n          </button>\n        </ng-container>\n      </div>\n\n      <div class="osd-toolbar-row">\n        <button\n          (click)="zoomIn()"\n          id="zoomInButton"\n          mat-icon-button\n          [attr.aria-label]="intl.zoomInLabel"\n          [matTooltip]="intl.zoomInLabel"\n        >\n          <mat-icon>zoom_in</mat-icon>\n        </button>\n\n        <button\n          (click)="rotate()"\n          id="rotateButton"\n          mat-icon-button\n          [attr.aria-label]="intl.rotateCwLabel"\n          [matTooltip]="intl.rotateCwLabel"\n        >\n          <mat-icon>rotate_right</mat-icon>\n        </button>\n        <button\n          (click)="zoomOut()"\n          id="zoomOutButton"\n          mat-icon-button\n          [attr.aria-label]="intl.zoomOutLabel"\n          [matTooltip]="intl.zoomOutLabel"\n        >\n          <mat-icon>zoom_out</mat-icon>\n        </button>\n      </div>\n    </div>\n  </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,animations:[G.trigger("osdToolbarState",[G.state("hide",G.style({transform:"translate(-120px, 0)",display:"none"})),G.state("show",G.style({transform:"translate(0px, 0px)",display:"block"})),G.transition("hide => show",[G.group([G.style({display:"block"}),G.animate(te.transitions.toolbarsEaseInTime+"ms ease-out")])]),G.transition("show => hide",G.animate(te.transitions.toolbarsEaseOutTime+"ms ease-in"))])],styles:[":host{z-index:1}::ng-deep .osd-toolbar-row>.mat-toolbar-row{height:40px}.osd-toolbar{position:absolute;z-index:2;background:0 0;width:auto;border-radius:8px;margin-left:16px}"]})],e)}(),Nt=function(){function e(e,t,n,o,r,a){this.intl=e,this.changeDetectorRef=t,this.viewerService=n,this.canvasService=o,this.pageDialogService=r,this.iiifManifestService=a,this.invert=!1,this.currentSliderCanvasGroupIndex=-1,this.destroyed=new i.Subject}return e.prototype.ngOnInit=function(){var e=this;this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.invert=t.viewingDirection===F.LTR,e.changeDetectorRef.detectChanges()})),this.canvasService.onCanvasGroupIndexChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){-1!==e.currentSliderCanvasGroupIndex&&e.currentSliderCanvasGroupIndex===t?e.currentSliderCanvasGroupIndex=-1:-1===e.currentSliderCanvasGroupIndex&&(e.currentCanvasGroupIndex=t,e.canvasGroupLabel=e.canvasService.getCanvasGroupLabel(e.currentCanvasGroupIndex)),e.isFirstCanvasGroup=e.isOnFirstCanvasGroup(t),e.isLastCanvasGroup=e.isOnLastCanvasGroup(t),e.changeDetectorRef.detectChanges()})),this.canvasService.onNumberOfCanvasGroupsChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.numberOfCanvasGroups=t,e.numberOfCanvases=e.canvasService.numberOfCanvases,e.isFirstCanvasGroup=e.isOnFirstCanvasGroup(e.currentCanvasGroupIndex),e.isLastCanvasGroup=e.isOnLastCanvasGroup(e.currentCanvasGroupIndex),e.changeDetectorRef.detectChanges()}))},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.goToPreviousCanvasGroup=function(){this.viewerService.goToPreviousCanvasGroup()},e.prototype.goToNextCanvasGroup=function(){this.viewerService.goToNextCanvasGroup()},e.prototype.onSliderChange=function(e){this.currentSliderCanvasGroupIndex=e.value,this.currentCanvasGroupIndex=e.value,this.canvasGroupLabel=this.canvasService.getCanvasGroupLabel(this.currentCanvasGroupIndex),this.viewerService.goToCanvasGroup(e.value,!1),this.changeDetectorRef.detectChanges()},e.prototype.onSliderHotKey=function(e){new bt(e).isSliderKeys()&&e.stopPropagation()},e.prototype.openCanvasGroupDialog=function(){this.pageDialogService.toggle()},e.prototype.isOnFirstCanvasGroup=function(e){return 0===e},e.prototype.isOnLastCanvasGroup=function(e){return e===this.numberOfCanvasGroups-1},e.ctorParameters=function(){return[{type:I},{type:t.ChangeDetectorRef},{type:Ze},{type:he},{type:Mt},{type:rt}]},H([t.Input()],e.prototype,"searchResult",void 0),e=H([t.Component({selector:"mime-page-navigator",template:'<mat-toolbar>\n  <div fxLayout="row" fxFlex fxLayoutAlign="start center">\n    <div fxFlex>\n      <mat-slider\n        id="navigationSlider"\n        class="navigation-slider"\n        [invert]="!invert"\n        [max]="numberOfCanvasGroups - 1"\n        [value]="currentCanvasGroupIndex"\n        [attr.aria-label]="intl.currentPageLabel"\n        (input)="onSliderChange($event)"\n        (keyup)="onSliderHotKey($event)"\n        fxFlex\n      ></mat-slider>\n    </div>\n    <button\n      mat-button\n      id="goToCanvasGroupButton"\n      class="canvasGroups"\n      (click)="openCanvasGroupDialog()"\n    >\n      <div fxLayout="row" fxLayoutGap="1px">\n        <span id="currentCanvasGroupLabel">{{ canvasGroupLabel }}</span\n        ><span>/</span\n        ><span id="numOfCanvasGroups">{{ numberOfCanvases }}</span>\n      </div>\n    </button>\n    <div class="navigation-buttons">\n      <ng-container *ngIf="invert">\n        <button\n          id="footerNavigateBeforeButton"\n          mat-icon-button\n          [attr.aria-label]="intl.previousPageLabel"\n          [matTooltip]="intl.previousPageLabel"\n          matTooltipPosition="above"\n          [disabled]="isFirstCanvasGroup"\n          (click)="goToPreviousCanvasGroup()"\n        >\n          <mat-icon>navigate_before</mat-icon>\n        </button>\n        <button\n          id="footerNavigateNextButton"\n          mat-icon-button\n          [attr.aria-label]="intl.nextPageLabel"\n          [matTooltip]="intl.nextPageLabel"\n          matTooltipPosition="above"\n          [disabled]="isLastCanvasGroup"\n          (click)="goToNextCanvasGroup()"\n        >\n          <mat-icon>navigate_next</mat-icon>\n        </button>\n      </ng-container>\n      <ng-container *ngIf="!invert">\n        <button\n          id="footerNavigateNextButton"\n          mat-icon-button\n          [attr.aria-label]="intl.nextPageLabel"\n          [matTooltip]="intl.nextPageLabel"\n          matTooltipPosition="above"\n          [disabled]="isLastCanvasGroup"\n          (click)="goToNextCanvasGroup()"\n        >\n          <mat-icon>navigate_before</mat-icon>\n        </button>\n        <button\n          id="footerNavigateBeforeButton"\n          mat-icon-button\n          [attr.aria-label]="intl.previousPageLabel"\n          [matTooltip]="intl.previousPageLabel"\n          matTooltipPosition="above"\n          [disabled]="isFirstCanvasGroup"\n          (click)="goToPreviousCanvasGroup()"\n        >\n          <mat-icon>navigate_next</mat-icon>\n        </button>\n      </ng-container>\n    </div>\n  </div>\n</mat-toolbar>\n',styles:[".canvasGroups{font-size:13px;text-align:center;cursor:pointer}.navigation-slider{width:100%}"]})],e)}(),jt=function(){function e(e,t,n,o,r,a){this.intl=e,this.changeDetectorRef=t,this.canvasService=n,this.iiifContentSearchService=o,this.contentSearchNavigationService=r,this.iiifManifestService=a,this.isHitOnActiveCanvasGroup=!1,this.isFirstCanvasGroupHit=!1,this.isLastCanvasGroupHit=!1,this.currentIndex=0,this.invert=!1,this.destroyed=new i.Subject}return e.prototype.ngOnInit=function(){var e=this;this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.invert=t.viewingDirection===F.LTR,e.changeDetectorRef.detectChanges()})),this.intl.changes.pipe(w.takeUntil(this.destroyed)).subscribe((function(){return e.changeDetectorRef.markForCheck()})),this.canvasService.onCanvasGroupIndexChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.contentSearchNavigationService.update(t),e.currentIndex=e.contentSearchNavigationService.getCurrentIndex(),e.isHitOnActiveCanvasGroup=e.contentSearchNavigationService.getHitOnActiveCanvasGroup(),e.isFirstCanvasGroupHit=e.contentSearchNavigationService.getFirstHitCanvasGroup(),e.isLastCanvasGroupHit=e.contentSearchNavigationService.getLastHitCanvasGroup(),e.changeDetectorRef.detectChanges()}))},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.clear=function(){this.iiifContentSearchService.destroy()},e.prototype.goToPreviousCanvasGroupHit=function(){this.contentSearchNavigationService.goToPreviousCanvasGroupHit()},e.prototype.goToNextCanvasGroupHit=function(){this.contentSearchNavigationService.goToNextCanvasGroupHit()},e.ctorParameters=function(){return[{type:I},{type:t.ChangeDetectorRef},{type:he},{type:me},{type:Ct},{type:rt}]},H([t.Input()],e.prototype,"searchResult",void 0),e=H([t.Component({selector:"mime-content-search-navigator",template:'<mat-toolbar id="content-search-navigator-toolbar" color="primary">\n  <div\n    *ngIf="searchResult"\n    fxLayout="row"\n    fxFlex\n    fxLayoutAlign="space-between center"\n  >\n    <div>\n      <button\n        id="footerNavigateCloseHitsButton"\n        mat-icon-button\n        [attr.aria-label]="intl.closeLabel"\n        [matTooltip]="intl.closeLabel"\n        matTooltipPosition="above"\n        (click)="clear()"\n      >\n        <mat-icon>close</mat-icon>\n      </button>\n    </div>\n    <div\n      fxFlex\n      class="current-hit-label"\n      [ngClass]="{ \'not-on-page\': !isHitOnActiveCanvasGroup }"\n      fxFlex\n      [innerHTML]="intl.currentHitLabel(currentIndex + 1, searchResult.size())"\n    ></div>\n    <div class="navigation-buttons">\n      <ng-container *ngIf="invert">\n        <button\n          id="footerNavigatePreviousHitButton"\n          mat-icon-button\n          [attr.aria-label]="intl.previousHitLabel"\n          [matTooltip]="intl.previousHitLabel"\n          matTooltipPosition="above"\n          [disabled]="isFirstCanvasGroupHit"\n          (click)="goToPreviousCanvasGroupHit()"\n        >\n          <mat-icon>navigate_before</mat-icon>\n        </button>\n        <button\n          id="footerNavigateNextHitButton"\n          mat-icon-button\n          [attr.aria-label]="intl.nextHitLabel"\n          [matTooltip]="intl.nextHitLabel"\n          matTooltipPosition="above"\n          [disabled]="isLastCanvasGroupHit"\n          (click)="goToNextCanvasGroupHit()"\n        >\n          <mat-icon>navigate_next</mat-icon>\n        </button>\n      </ng-container>\n      <ng-container *ngIf="!invert">\n        <button\n          id="footerNavigateNextHitButton"\n          mat-icon-button\n          [attr.aria-label]="intl.nextHitLabel"\n          [matTooltip]="intl.nextHitLabel"\n          matTooltipPosition="above"\n          [disabled]="isLastCanvasGroupHit"\n          (click)="goToNextCanvasGroupHit()"\n        >\n          <mat-icon>navigate_before</mat-icon>\n        </button>\n        <button\n          id="footerNavigatePreviousHitButton"\n          mat-icon-button\n          [attr.aria-label]="intl.previousHitLabel"\n          [matTooltip]="intl.previousHitLabel"\n          matTooltipPosition="above"\n          [disabled]="isFirstCanvasGroupHit"\n          (click)="goToPreviousCanvasGroupHit()"\n        >\n          <mat-icon>navigate_next</mat-icon>\n        </button>\n      </ng-container>\n    </div>\n  </div>\n</mat-toolbar>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".current-hit-label{font-size:13px;text-align:center}.not-on-page{opacity:.6}"]})],e)}(),Bt=function(){function e(e,t,n){this.iiifContentSearchService=e,this.mediaObserver=t,this.changeDetectorRef=n,this.state="hide",this.showNavigationToolbar=!0,this.searchResult=new ve,this.showPageNavigator=!0,this.showContentSearchNavigator=!1,this.destroyed=new i.Subject}return Object.defineProperty(e.prototype,"footerState",{get:function(){return this.state},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.iiifContentSearchService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.searchResult=t,e.showContentSearchNavigator=e.searchResult.size()>0,e.showPageNavigator=0===e.searchResult.size()||!e.isMobile(),e.changeDetectorRef.detectChanges()})),this.mediaSubscription=this.mediaObserver.asObservable().subscribe((function(t){e.showPageNavigator=0===e.searchResult.size()||!e.isMobile(),e.changeDetectorRef.detectChanges()}))},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete(),this.mediaSubscription.unsubscribe()},e.prototype.isMobile=function(){return this.mediaObserver.isActive("lt-md")},e.ctorParameters=function(){return[{type:me},{type:s.MediaObserver},{type:t.ChangeDetectorRef}]},H([t.ViewChild("mimeFooterBefore",{read:t.ViewContainerRef,static:!0})],e.prototype,"mimeFooterBefore",void 0),H([t.ViewChild("mimeFooterAfter",{read:t.ViewContainerRef,static:!0})],e.prototype,"mimeFooterAfter",void 0),H([t.HostBinding("@footerState")],e.prototype,"footerState",null),e=H([t.Component({selector:"mime-viewer-footer",template:'<mat-toolbar class="footer-toolbar">\n  <div fxLayout="row" fxFlex fxLayoutAlign="start center">\n    <div><ng-template #mimeFooterBefore></ng-template></div>\n    <div fxFlex="250px" fxFlex.lt-md="100%" *ngIf="searchResult.size() > 0">\n      <mime-content-search-navigator\n        *ngIf="showContentSearchNavigator"\n        [searchResult]="searchResult"\n      ></mime-content-search-navigator>\n    </div>\n    <div fxFlex [hidden]="!showPageNavigator">\n      <mime-page-navigator [searchResult]="searchResult"></mime-page-navigator>\n    </div>\n  </div>\n  <div><ng-template #mimeFooterAfter></ng-template></div>\n</mat-toolbar>\n',animations:[G.trigger("footerState",[G.state("hide",G.style({transform:"translate(0, 100%)"})),G.state("show",G.style({transform:"translate(0, 0)"})),G.transition("hide => show",G.animate(te.transitions.toolbarsEaseInTime+"ms ease-in")),G.transition("show => hide",G.animate(te.transitions.toolbarsEaseOutTime+"ms ease-out"))])],styles:[":host{display:block;width:100%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.footer-toolbar{padding:0}[hidden]{display:none}"]})],e)}(),Kt=function(){function e(){}return e.prototype.ngOnInit=function(){},H([t.Input()],e.prototype,"iconName",void 0),e=H([t.Component({selector:"mime-icon",template:'<div class="mat-icon">\n  <ng-container *ngIf="iconName === \'single_page_display\'">\n    <div class="single-page-display">\n      <svg\n        version="1.1"\n        id="Layer_1"\n        xmlns="http://www.w3.org/2000/svg"\n        xmlns:xlink="http://www.w3.org/1999/xlink"\n        viewBox="0 0 90 90"\n        preserveAspectRatio="xMidYMin slice"\n      >\n        <style type="text/css">\n          .st0 {\n            clip-path: url(#SVGID_2_);\n          }\n        </style>\n        <g>\n          <defs><rect id="SVGID_1_" width="100%" height="100%" /></defs>\n          <clipPath id="SVGID_2_">\n            <use xlink:href="#SVGID_1_" style="overflow:visible;" />\n          </clipPath>\n          <path\n            class="st0"\n            d="M21.7,25.2H8.3v2.7h13.4V25.2z M21.7,18.1H8.3v2.7h13.4V18.1z M26.1,31.8H4V4.1h13.6v8.4h8.5V31.8z M30,31.6\n          V11.4L18.7,0H4.3C4.3,0,0,0,0,4.3v27.4c0,0,0,4.3,4.3,4.3h21.5C25.8,35.9,30,35.9,30,31.6"\n          />\n        </g>\n      </svg>\n    </div>\n  </ng-container>\n  <ng-container *ngIf="iconName === \'two_page_display\'">\n    <svg\n      version="1.1"\n      id="Layer_1"\n      xmlns="http://www.w3.org/2000/svg"\n      xmlns:xlink="http://www.w3.org/1999/xlink"\n      viewBox="0 0 90 90"\n      preserveAspectRatio="xMidYMin slice"\n    >\n      <style type="text/css">\n        .st0 {\n          clip-path: url(#SVGID_2_);\n        }\n      </style>\n      <g>\n        <defs><rect id="SVGID_1_" width="100%" height="100%" /></defs>\n        <clipPath id="SVGID_2_">\n          <use xlink:href="#SVGID_1_" style="overflow:visible;" />\n        </clipPath>\n        <path\n          class="st0"\n          d="M52.5,25.2H39.1v2.7h13.4V25.2z M52.5,18.1H39.1v2.7h13.4V18.1z M56.8,31.8H34.7V4.1h13.6v8.4h8.5V31.8z\n        M60.8,31.6V11.4L49.4,0H35c0,0-4.3,0-4.3,4.3v27.4c0,0,0,4.3,4.3,4.3h21.5C56.6,35.9,60.8,35.9,60.8,31.6"\n        />\n        <path\n          class="st0"\n          d="M21.7,25.2H8.3v2.7h13.4V25.2z M21.7,18.1H8.3v2.7h13.4V18.1z M21.7,11.1H8.3v2.7h13.4V11.1z M26.1,31.8H4V4.1\n       h22.1V31.8z M30,31.6V4.3c0,0,0-4.3-4.3-4.3H4.3C4.3,0,0,0,0,4.3v27.4c0,0,0,4.3,4.3,4.3h21.5C25.8,35.9,30,35.9,30,31.6"\n        />\n      </g>\n    </svg>\n  </ng-container>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".mat-icon{position:absolute;top:12px;left:7px;vertical-align:middle}.single-page-display{margin-left:5px}svg{height:40px;width:40px}"]})],e)}(),Ut=function(){function e(e,t,n,o,r,a,s,c,u){this.intl=e,this.changeDetectorRef=t,this.contentsDialogService=n,this.contentSearchDialogService=o,this.helpDialogService=r,this.iiifManifestService=a,this.fullscreenService=s,this.mimeDomHelper=c,this.viewerLayoutService=u,this.state="hide",this.isContentSearchEnabled=!1,this.isFullscreenEnabled=!1,this.isInFullscreen=!1,this.fullscreenLabel=this.intl.fullScreenLabel,this.isPagedManifest=!1,this.viewerLayout=R.ONE_PAGE,this.ViewerLayout=R,this.destroyed=new i.Subject}return Object.defineProperty(e.prototype,"headerState",{get:function(){return this.state},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.isFullscreenEnabled=this.fullscreenService.isEnabled(),this.intl.changes.pipe(w.takeUntil(this.destroyed)).subscribe((function(){return e.changeDetectorRef.markForCheck()})),this.fullscreenService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(){e.isInFullscreen=e.fullscreenService.isFullscreen(),e.fullscreenLabel=e.isInFullscreen?e.intl.exitFullScreenLabel:e.intl.fullScreenLabel,e.changeDetectorRef.detectChanges()})),this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.manifest=t,e.isContentSearchEnabled=!!t.service,e.isPagedManifest=ye.isManifestPaged(t),e.changeDetectorRef.detectChanges()})),this.viewerLayoutService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(t){e.viewerLayout=t}))},e.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete()},e.prototype.toggleContents=function(){this.contentSearchDialogService.close(),this.helpDialogService.close(),this.contentsDialogService.toggle()},e.prototype.toggleSearch=function(){this.contentsDialogService.close(),this.helpDialogService.close(),this.contentSearchDialogService.toggle()},e.prototype.toggleHelp=function(){this.contentsDialogService.close(),this.contentSearchDialogService.close(),this.helpDialogService.toggle()},e.prototype.toggleFullscreen=function(){return this.mimeDomHelper.toggleFullscreen()},e.prototype.isInFullScreen=function(){return this.fullscreenService.isFullscreen()},e.prototype.toggleViewerLayout=function(){this.viewerLayoutService.toggle()},e.prototype.setLayoutOnePage=function(){this.viewerLayoutService.setLayout(R.ONE_PAGE)},e.prototype.setLayoutTwoPage=function(){this.viewerLayoutService.setLayout(R.TWO_PAGE)},e.ctorParameters=function(){return[{type:I},{type:t.ChangeDetectorRef},{type:yt},{type:dt},{type:kt},{type:rt},{type:at},{type:st},{type:Pe}]},H([t.ViewChild("mimeHeaderBefore",{read:t.ViewContainerRef,static:!0})],e.prototype,"mimeHeaderBefore",void 0),H([t.ViewChild("mimeHeaderAfter",{read:t.ViewContainerRef,static:!0})],e.prototype,"mimeHeaderAfter",void 0),H([t.HostBinding("@headerState")],e.prototype,"headerState",null),e=H([t.Component({selector:"mime-viewer-header",template:'<mat-toolbar>\n  <div\n    class="header-container"\n    fxLayout="row"\n    fxLayoutAlign="space-between center"\n  >\n    <div><ng-template #mimeHeaderBefore></ng-template></div>\n    <div fxFlexOffset="16px" class="label" [matTooltip]="manifest?.label">{{\n      manifest?.label\n    }}</div>\n    <div\n      fxFlex="noshrink"\n      fxLayout="row"\n      fxLayoutAlign="end center"\n      class="buttons-container"\n    >\n      <button\n        *ngIf="isPagedManifest"\n        mat-icon-button\n        [id]="\n          viewerLayout === ViewerLayout.ONE_PAGE\n            ? \'toggleTwoPageViewButton\'\n            : \'toggleSinglePageViewButton\'\n        "\n        [attr.aria-label]="\n          viewerLayout === ViewerLayout.ONE_PAGE\n            ? intl.twoPageViewLabel\n            : intl.singlePageViewLabel\n        "\n        [matTooltip]="\n          viewerLayout === ViewerLayout.ONE_PAGE\n            ? intl.twoPageViewLabel\n            : intl.singlePageViewLabel\n        "\n        (click)="toggleViewerLayout()"\n      >\n        <mime-icon\n          [iconName]="\n            viewerLayout === ViewerLayout.ONE_PAGE\n              ? \'two_page_display\'\n              : \'single_page_display\'\n          "\n        >\n        </mime-icon>\n      </button>\n      <button\n        id="contentsDialogButton"\n        mat-icon-button\n        [attr.aria-label]="intl.contentsLabel"\n        [matTooltip]="intl.contentsLabel"\n        (click)="toggleContents()"\n      >\n        <mat-icon aria-hidden="true">list</mat-icon>\n      </button>\n      <button\n        id="contentSearchDialogButton"\n        *ngIf="isContentSearchEnabled"\n        mat-icon-button\n        [attr.aria-label]="intl.searchLabel"\n        [matTooltip]="intl.searchLabel"\n        (click)="toggleSearch()"\n      >\n        <mat-icon aria-hidden="true">search</mat-icon>\n      </button>\n      <button\n        id="helpDialogButton"\n        mat-icon-button\n        [attr.aria-label]="intl.help.helpLabel"\n        [matTooltip]="intl.help.helpLabel"\n        (click)="toggleHelp()"\n      >\n        <mat-icon aria-hidden="true">help</mat-icon>\n      </button>\n\n      <button\n        id="fullscreenButton"\n        *ngIf="isFullscreenEnabled"\n        mat-icon-button\n        [attr.aria-label]="fullscreenLabel"\n        [matTooltip]="fullscreenLabel"\n        (click)="toggleFullscreen()"\n      >\n        <mat-icon *ngIf="isInFullScreen" aria-hidden="true"\n          >fullscreen_exit</mat-icon\n        >\n        <mat-icon *ngIf="!isInFullScreen" aria-hidden="true"\n          >fullscreen</mat-icon\n        >\n      </button>\n    </div>\n    <div><ng-template #mimeHeaderAfter></ng-template></div>\n  </div>\n</mat-toolbar>\n',changeDetection:t.ChangeDetectionStrategy.Default,animations:[G.trigger("headerState",[G.state("hide",G.style({transform:"translate(0, -100%)"})),G.state("show",G.style({transform:"translate(0px, 0px)"})),G.transition("hide => show",G.animate(te.transitions.toolbarsEaseInTime+"ms ease-in")),G.transition("show => hide",G.animate(te.transitions.toolbarsEaseOutTime+"ms ease-out"))])],styles:[":host{max-height:64px}.header-container{width:100%}.label{font-size:17px;overflow:hidden;text-overflow:ellipsis}mat-toolbar{padding:0}.buttons-container{padding:0 16px}"]})],e)}(),Zt=function(){function e(e,t){this.spinnerService=e,this.changeDetectorRef=t,this.visible=!1}return e.prototype.ngOnInit=function(){var e=this;this.spinnerSub=this.spinnerService.spinnerState.subscribe((function(t){e.visible=t.show,e.changeDetectorRef.detectChanges()}))},e.prototype.ngOnDestroy=function(){this.spinnerSub.unsubscribe()},e.ctorParameters=function(){return[{type:Y},{type:t.ChangeDetectorRef}]},e=H([t.Component({selector:"mime-spinner",template:'<div class="mime-spinner" [class.mime-spinner--active]="visible">\n  <mat-spinner></mat-spinner>\n</div>\n',styles:[".mime-spinner{display:none;position:absolute;left:50%;top:45%;transform:translate(-50%,0);z-index:9999}.mime-spinner--active{display:block}"]})],e)}(),qt=function(e){this.isOpen=!1,this.selectedIndex=0,e&&(this.isOpen=void 0!==e.isOpen?e.isOpen:this.isOpen,this.selectedIndex=void 0!==e.selectedIndex?e.selectedIndex:this.selectedIndex)},Wt=function(e){this.isOpen=!1,e&&(this.isOpen=void 0!==e.isOpen?e.isOpen:this.isOpen)},Xt=function(e){this.isOpen=!1,e&&(this.isOpen=void 0!==e.isOpen?e.isOpen:this.isOpen)},$t=function(e){this.contentDialogState=new qt,this.contentsSearchDialogState=new Wt,this.helpDialogState=new Xt,e&&(this.contentDialogState=e.contentDialogState?e.contentDialogState:this.contentDialogState,this.contentsSearchDialogState=e.contentsSearchDialogState?e.contentsSearchDialogState:this.contentsSearchDialogState,this.helpDialogState=e.helpDialogState?e.helpDialogState:this.helpDialogState)},Yt=function(){function n(e,n,o,r,a,s,c,u,l,h,p,d,g,v,f,m,y,b){this.snackBar=e,this.intl=n,this.el=o,this.iiifManifestService=r,this.contentsDialogService=a,this.attributionDialogService=s,this.contentSearchDialogService=c,this.helpDialogService=u,this.viewerService=l,this.mimeService=h,this.changeDetectorRef=p,this.modeService=d,this.iiifContentSearchService=g,this.accessKeysHandlerService=v,this.canvasService=f,this.viewerLayoutService=m,this.styleService=y,this.zone=b,this.config=new V,this.tabIndex=0,this.viewerModeChanged=new t.EventEmitter,this.canvasChanged=new t.EventEmitter,this.qChanged=new t.EventEmitter,this.manifestChanged=new t.EventEmitter,this.destroyed=new i.Subject,this.isCanvasPressed=!1,this.viewerState=new $t,this.errorMessage=null,a.el=o,s.el=o,c.el=o,u.el=o,h.el=o}return Object.defineProperty(n.prototype,"mimeHeaderBeforeRef",{get:function(){return this.header.mimeHeaderBefore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mimeHeaderAfterRef",{get:function(){return this.header.mimeHeaderAfter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mimeFooterBeforeRef",{get:function(){return this.footer.mimeFooterBefore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mimeFooterAfterRef",{get:function(){return this.footer.mimeFooterAfter},enumerable:!0,configurable:!0}),n.prototype.ngOnInit=function(){var t=this;this.styleService.init(),this.modeService.initialMode=this.config.initViewerMode,this.iiifManifestService.currentManifest.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){e&&(t.initialize(),t.currentManifest=e,t.manifestChanged.next(e),t.viewerLayoutService.init(ye.isManifestPaged(e)),t.changeDetectorRef.detectChanges(),t.viewerService.setUpViewer(e,t.config),t.config.attributionDialogEnabled&&e.attribution&&t.attributionDialogService.open(t.config.attributionDialogHideTimeout),t.q&&t.iiifContentSearchService.search(e,t.q))})),this.viewerService.onOsdReadyChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){e&&t.canvasIndex&&!t.canvasService.currentCanvasGroupIndex&&t.viewerService.goToCanvas(t.canvasIndex,!1)})),this.iiifManifestService.errorMessage.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){t.resetCurrentManifest(),t.errorMessage=e,t.changeDetectorRef.detectChanges()})),this.iiifContentSearchService.onQChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){t.qChanged.emit(e)})),this.iiifContentSearchService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){t.viewerService.highlight(e)})),this.viewerService.isCanvasPressed.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){t.isCanvasPressed=e,t.changeDetectorRef.detectChanges()})),this.modeService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(i){t.toggleToolbarsState(i.currentValue),i.previousValue===e.MimeViewerMode.DASHBOARD&&i.currentValue===e.MimeViewerMode.PAGE&&(t.viewerState.contentDialogState.isOpen=t.contentsDialogService.isOpen(),t.viewerState.contentDialogState.selectedIndex=t.contentsDialogService.getSelectedIndex(),t.viewerState.contentsSearchDialogState.isOpen=t.contentSearchDialogService.isOpen(),t.viewerState.helpDialogState.isOpen=t.helpDialogService.isOpen(),t.zone.run((function(){t.contentsDialogService.close(),t.contentSearchDialogService.close(),t.helpDialogService.close()}))),i.currentValue===e.MimeViewerMode.DASHBOARD&&t.zone.run((function(){t.viewerState.contentDialogState.isOpen&&t.contentsDialogService.open(t.viewerState.contentDialogState.selectedIndex),t.viewerState.contentsSearchDialogState.isOpen&&t.contentSearchDialogService.open(),t.viewerState.helpDialogState.isOpen&&t.helpDialogService.open()})),t.viewerModeChanged.emit(i.currentValue)})),this.canvasService.onCanvasGroupIndexChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){var i=t.canvasService.findCanvasByCanvasIndex(e);-1!==i&&t.canvasChanged.emit(i)})),this.mimeService.onResize.pipe(w.takeUntil(this.destroyed),w.throttle((function(e){return i.interval(te.transitions.OSDAnimationTime)}))).subscribe((function(){setTimeout((function(){t.viewerService.home()}),te.transitions.OSDAnimationTime)})),this.viewerLayoutService.onChange.pipe(w.takeUntil(this.destroyed)).subscribe((function(e){t.viewerLayout=e})),this.loadManifest()},n.prototype.ngOnChanges=function(e){var t=!1,i=!1,n=!1;if(e.q){var o=e.q;o.isFirstChange()||o.currentValue===o.firstChange||(this.q=o.currentValue,i=!0)}if(e.canvasIndex){var r=e.canvasIndex;r.isFirstChange()||r.currentValue===r.firstChange||(this.canvasIndex=r.currentValue,n=!0)}if(e.manifestUri){var a=e.manifestUri;a.isFirstChange()||a.currentValue===a.previousValue||(this.modeService.mode=this.config.initViewerMode,this.manifestUri=a.currentValue,t=!0)}t?this.loadManifest():(i&&this.iiifContentSearchService.search(this.currentManifest,this.q),n&&this.viewerService.goToCanvas(this.canvasIndex,!0))},n.prototype.handleKeys=function(e){this.accessKeysHandlerService.handleKeyEvents(e)},n.prototype.onDrop=function(e){var t=this;if(e.preventDefault(),e.stopPropagation(),this.config.isDropEnabled){var i=e.dataTransfer.getData("URL"),n=new URL(i).searchParams,o=n.get("manifest"),r=n.get("canvas");o&&(this.manifestUri=o.startsWith("//")?""+location.protocol+o:o,this.loadManifest(),r&&this.manifestChanged.pipe(w.take(1)).subscribe((function(e){var i=e.sequences[0].canvases.findIndex((function(e){return e.id===r}));-1!==i&&setTimeout((function(){t.viewerService.goToCanvas(i,!0)}),0)})))}else this.snackBar.open(this.intl.dropDisabled,null,{duration:3e3})},n.prototype.onDragOver=function(e){e.preventDefault(),e.stopPropagation()},n.prototype.onDragLeave=function(e){e.preventDefault(),e.stopPropagation()},n.prototype.ngOnDestroy=function(){this.destroyed.next(),this.destroyed.complete(),this.cleanup(),this.iiifManifestService.destroy(),this.iiifContentSearchService.destroy()},n.prototype.toggleToolbarsState=function(t){if(this.header&&this.footer){switch(t){case e.MimeViewerMode.DASHBOARD:this.header.state=this.footer.state="show",this.config.navigationControlEnabled&&this.osdToolbar&&(this.osdToolbar.state="hide");break;case e.MimeViewerMode.PAGE:this.header.state=this.footer.state="hide",this.config.navigationControlEnabled&&this.osdToolbar&&(this.osdToolbar.state="show")}this.changeDetectorRef.detectChanges()}},n.prototype.ngAfterViewChecked=function(){this.mimeService.markForCheck()},n.prototype.loadManifest=function(){this.cleanup(),this.iiifManifestService.load(this.manifestUri)},n.prototype.initialize=function(){this.attributionDialogService.initialize(),this.contentsDialogService.initialize(),this.contentSearchDialogService.initialize(),this.helpDialogService.initialize()},n.prototype.cleanup=function(){this.viewerState=new $t,this.attributionDialogService.destroy(),this.contentsDialogService.destroy(),this.contentSearchDialogService.destroy(),this.helpDialogService.destroy(),this.viewerService.destroy(),this.resetErrorMessage()},n.prototype.resetCurrentManifest=function(){this.currentManifest=null},n.prototype.resetErrorMessage=function(){this.errorMessage=null},n.prototype.setClasses=function(){return{"mode-page":this.modeService.mode===e.MimeViewerMode.PAGE,"mode-page-zoomed":this.modeService.mode===e.MimeViewerMode.PAGE_ZOOMED,"mode-dashboard":this.modeService.mode===e.MimeViewerMode.DASHBOARD,"layout-one-page":this.viewerLayout===R.ONE_PAGE,"layout-two-page":this.viewerLayout===R.TWO_PAGE,"canvas-pressed":this.isCanvasPressed}},n.ctorParameters=function(){return[{type:m.MatSnackBar},{type:I},{type:t.ElementRef},{type:rt},{type:yt},{type:Gt},{type:dt},{type:kt},{type:Ze},{type:ct},{type:t.ChangeDetectorRef},{type:ee},{type:me},{type:wt},{type:he},{type:Pe},{type:He},{type:t.NgZone}]},H([t.Input()],n.prototype,"manifestUri",void 0),H([t.Input()],n.prototype,"q",void 0),H([t.Input()],n.prototype,"canvasIndex",void 0),H([t.Input()],n.prototype,"config",void 0),H([t.Input()],n.prototype,"tabIndex",void 0),H([t.Output()],n.prototype,"viewerModeChanged",void 0),H([t.Output()],n.prototype,"canvasChanged",void 0),H([t.Output()],n.prototype,"qChanged",void 0),H([t.Output()],n.prototype,"manifestChanged",void 0),H([t.ViewChild("mimeHeader",{static:!0})],n.prototype,"header",void 0),H([t.ViewChild("mimeFooter",{static:!0})],n.prototype,"footer",void 0),H([t.ViewChild("mimeOsdToolbar")],n.prototype,"osdToolbar",void 0),H([t.HostListener("keyup",["$event"])],n.prototype,"handleKeys",null),H([t.HostListener("drop",["$event"])],n.prototype,"onDrop",null),H([t.HostListener("dragover",["$event"])],n.prototype,"onDragOver",null),H([t.HostListener("dragleave",["$event"])],n.prototype,"onDragLeave",null),n=H([t.Component({selector:"mime-viewer",template:'<div\n  id="mimeViewer"\n  class="viewer-container"\n  [ngClass]="setClasses()"\n  [hidden]="errorMessage !== null"\n  [tabIndex]="tabIndex"\n>\n  <mime-spinner></mime-spinner>\n  <mime-viewer-header\n    class="navbar navbar-header"\n    #mimeHeader\n  ></mime-viewer-header>\n  <mime-osd-toolbar\n    *ngIf="config?.navigationControlEnabled"\n    #mimeOsdToolbar\n  ></mime-osd-toolbar>\n  <div id="openseadragon"></div>\n  <mime-viewer-footer\n    class="navbar navbar-footer"\n    #mimeFooter\n  ></mime-viewer-footer>\n</div>\n\n<div\n  class="error-container"\n  *ngIf="errorMessage"\n  fxLayout="column"\n  fxLayoutAlign="center center"\n>\n  <span>{{ intl.somethingHasGoneWrongLabel }}</span>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".viewer-container{overflow:hidden;box-sizing:border-box;position:relative;width:100%;height:100%;display:flex;flex-direction:column}:host::ng-deep.openseadragon-container{flex-grow:1}:host::ng-deep.openseadragon-canvas:focus{outline:0}#openseadragon{display:flex;flex-grow:1;flex-direction:column;opacity:0;width:100%}::ng-deep .viewer-container.mode-page-zoomed .tile:hover{cursor:-webkit-grab}.viewer-container.canvas-pressed,.viewer-container.canvas-pressed::ng-deep.tile:hover{cursor:grabbing;cursor:-webkit-grabbing}::ng-deep .viewer-container .tile{cursor:pointer;fill-opacity:0}::ng-deep .viewer-container.mode-dashboard.layout-one-page .tile,::ng-deep .viewer-container.mode-dashboard.layout-two-page .page-group .tile{stroke:rgba(0,0,0,.15);stroke-width:8;transition:stroke .25s}::ng-deep .viewer-container.mode-dashboard.layout-one-page .tile:hover,::ng-deep .viewer-container.mode-dashboard.layout-two-page .page-group:hover .tile{stroke:rgba(0,0,0,.45)}::ng-deep .viewer-container .hit{fill:rgba(255,255,0,.6)}::ng-deep .viewer-container .selected{fill:rgba(255,225,0,.6)}.navbar{position:absolute;width:100%;overflow:hidden;z-index:2}.navbar-header{top:0;width:100%}.navbar-footer{bottom:0}::ng-deep .cdk-overlay-container{z-index:2147483647}.error-container{width:100%;height:100%}[hidden]{display:none}"]})],n)}(),Qt=function(){function e(){}return e=H([t.NgModule({declarations:[Yt,Ut,Bt,_t,jt,Nt,Zt,Kt],imports:[Vt,Q,Ft,Ot,Et,Pt,Ht],exports:[Yt]})],e)}();e.MimeManifest=_,e.MimeModule=Qt,e.MimeViewerComponent=Yt,e.MimeViewerConfig=V,e.MimeViewerIntl=I,e.MimeViewerIntlLt=A,e.MimeViewerIntlNoNb=E,e.ɵa=rt,e.ɵb=Y,e.ɵba=jt,e.ɵbb=Nt,e.ɵbc=Mt,e.ɵbd=Zt,e.ɵbe=Kt,e.ɵbf=Vt,e.ɵbg=Q,e.ɵbh=$,e.ɵbi=Ft,e.ɵbj=gt,e.ɵbk=zt,e.ɵbl=At,e.ɵbm=Ot,e.ɵbn=xt,e.ɵbo=Et,e.ɵbp=Rt,e.ɵbq=Pt,e.ɵbr=ut,e.ɵbs=Ht,e.ɵbt=Dt,e.ɵc=yt,e.ɵd=mt,e.ɵe=st,e.ɵf=at,e.ɵg=ct,e.ɵh=Gt,e.ɵi=St,e.ɵj=dt,e.ɵk=pt,e.ɵl=kt,e.ɵm=It,e.ɵn=Ze,e.ɵo=pe,e.ɵp=he,e.ɵq=ee,e.ɵr=Pe,e.ɵs=me,e.ɵt=He,e.ɵu=wt,e.ɵv=Ct,e.ɵw=Ut,e.ɵx=te,e.ɵy=Bt,e.ɵz=_t,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=nationallibraryofnorway-ngx-mime.umd.min.js.map